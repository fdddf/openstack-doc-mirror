<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Store metadata on a configuration drive</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">
<link href="_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Store metadata on a configuration drive</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="cli-use-snapshots-to-migrate-instances.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Use snapshots to migrate instances"></i></a>
    
    
    <a href="cli-create-and-manage-networks.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Create and manage networks"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2017-02-14 08:42</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Store metadata on a configuration drive</a><ul>
<li><a class="reference internal" href="#requirements-and-guidelines">Requirements and guidelines</a></li>
<li><a class="reference internal" href="#enable-and-access-the-configuration-drive">Enable and access the configuration drive</a><ul>
<li><a class="reference internal" href="#configuration-drive-contents">Configuration drive contents</a></li>
<li><a class="reference internal" href="#openstack-metadata-format">OpenStack metadata format</a></li>
<li><a class="reference internal" href="#ec2-metadata-format">EC2 metadata format</a></li>
<li><a class="reference internal" href="#user-data">User data</a></li>
<li><a class="reference internal" href="#configuration-drive-format">Configuration drive format</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="store-metadata-on-a-configuration-drive">
<h1>Store metadata on a configuration drive<a class="headerlink" href="#store-metadata-on-a-configuration-drive" title="Permalink to this headline">¶</a></h1>
<p>You can configure OpenStack to write metadata to a special configuration drive
that attaches to the instance when it boots. The instance can mount this drive
and read files from it to get information that is normally available through
the <a class="reference external" href="https://docs.openstack.org/admin-guide/compute-networking-nova.html#metadata-service">metadata service</a>.
This metadata is different from the user data.</p>
<p>One use case for using the configuration drive is to pass a networking
configuration when you do not use DHCP to assign IP addresses to
instances. For example, you might pass the IP address configuration for
the instance through the configuration drive, which the instance can
mount and access before you configure the network settings for the
instance.</p>
<p>Any modern guest operating system that is capable of mounting an ISO
9660 or VFAT file system can use the configuration drive.</p>
<div class="section" id="requirements-and-guidelines">
<h2>Requirements and guidelines<a class="headerlink" href="#requirements-and-guidelines" title="Permalink to this headline">¶</a></h2>
<p>To use the configuration drive, you must follow the following
requirements for the compute host and image.</p>
<p><strong>Compute host requirements</strong></p>
<ul>
<li><p class="first">The following hypervisors support the configuration drive: libvirt,
XenServer, Hyper-V, and VMware.</p>
<p>Also, the Bare Metal service supports the configuration drive.</p>
</li>
<li><p class="first">To use configuration drive with libvirt, XenServer, or VMware, you
must first install the genisoimage package on each compute host.
Otherwise, instances do not boot properly.</p>
<p>Use the <code class="docutils literal"><span class="pre">mkisofs_cmd</span></code> flag to set the path where you install the
genisoimage program. If genisoimage is in same path as the
<code class="docutils literal"><span class="pre">nova-compute</span></code> service, you do not need to set this flag.</p>
</li>
<li><p class="first">To use configuration drive with Hyper-V, you must set the
<code class="docutils literal"><span class="pre">mkisofs_cmd</span></code> value to the full path to an <code class="docutils literal"><span class="pre">mkisofs.exe</span></code>
installation. Additionally, you must set the <code class="docutils literal"><span class="pre">qemu_img_cmd</span></code> value
in the <code class="docutils literal"><span class="pre">hyperv</span></code> configuration section to the full path to an
<strong class="command">qemu-img</strong> command installation.</p>
</li>
<li><p class="first">To use configuration drive with the Bare Metal service,
you do not need to prepare anything because the Bare Metal
service treats the configuration drive properly.</p>
</li>
</ul>
<p><strong>Image requirements</strong></p>
<ul class="simple">
<li>An image built with a recent version of the cloud-init package can
automatically access metadata passed through the configuration drive.
The cloud-init package version 0.7.1 works with Ubuntu, Fedora
based images (such as Red Hat Enterprise Linux) and openSUSE based
images (such as SUSE Linux Enterprise Server).</li>
<li>If an image does not have the cloud-init package installed, you must
customize the image to run a script that mounts the configuration
drive on boot, reads the data from the drive, and takes appropriate
action such as adding the public key to an account. You can read more
details about how data is organized on the configuration drive.</li>
<li>If you use Xen with a configuration drive, use the
<code class="docutils literal"><span class="pre">xenapi_disable_agent</span></code> configuration parameter to disable the
agent.</li>
</ul>
<p><strong>Guidelines</strong></p>
<ul class="simple">
<li>Do not rely on the presence of the EC2 metadata in the configuration
drive, because this content might be removed in a future release. For
example, do not rely on files in the <code class="docutils literal"><span class="pre">ec2</span></code> directory.</li>
<li>When you create images that access configuration drive data and
multiple directories are under the <code class="docutils literal"><span class="pre">openstack</span></code> directory, always
select the highest API version by date that your consumer supports.
For example, if your guest image supports the 2012-03-05, 2012-08-05,
and 2013-04-13 versions, try 2013-04-13 first and fall back to a
previous version if 2013-04-13 is not present.</li>
</ul>
</div>
<div class="section" id="enable-and-access-the-configuration-drive">
<h2>Enable and access the configuration drive<a class="headerlink" href="#enable-and-access-the-configuration-drive" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">To enable the configuration drive, pass the <code class="docutils literal"><span class="pre">--config-drive</span> <span class="pre">true</span></code>
parameter to the <strong class="command">openstack server create</strong> command.</p>
<p>The following example enables the configuration drive and passes user
data, two files, and two key/value metadata pairs, all of which are
accessible from the configuration drive:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack server create --config-drive <span class="nb">true</span> --image my-image-name <span class="se">\</span>
  --flavor <span class="m">1</span> --key-name mykey --user-data ./my-user-data.txt <span class="se">\</span>
  --file /etc/network/interfaces<span class="o">=</span>/home/myuser/instance-interfaces <span class="se">\</span>
  --file <span class="nv">known_hosts</span><span class="o">=</span>/home/myuser/.ssh/known_hosts <span class="se">\</span>
  --property <span class="nv">role</span><span class="o">=</span>webservers --property <span class="nv">essential</span><span class="o">=</span><span class="nb">false</span> MYINSTANCE
</pre></div>
</div>
<p>You can also configure the Compute service to always create a
configuration drive by setting the following option in the
<code class="docutils literal"><span class="pre">/etc/nova/nova.conf</span></code> file:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">force_config_drive = true</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a user passes the <code class="docutils literal"><span class="pre">--config-drive</span> <span class="pre">true</span></code> flag to the <strong class="command">nova
boot</strong> command, an administrator cannot disable the configuration
drive.</p>
</div>
</li>
<li><p class="first">If your guest operating system supports accessing disk by label, you
can mount the configuration drive as the
<code class="docutils literal"><span class="pre">/dev/disk/by-label/configurationDriveVolumeLabel</span></code> device. In the
following example, the configuration drive has the <code class="docutils literal"><span class="pre">config-2</span></code>
volume label:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> mkdir -p /mnt/config
<span class="gp">#</span> mount /dev/disk/by-label/config-2 /mnt/config
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Ensure that you use at least version 0.3.1 of CirrOS for
configuration drive support.</p>
<p>If your guest operating system does not use <code class="docutils literal"><span class="pre">udev</span></code>, the
<code class="docutils literal"><span class="pre">/dev/disk/by-label</span></code> directory is not present.</p>
<p>You can use the <strong class="command">blkid</strong> command to identify the block device that
corresponds to the configuration drive. For example, when you boot
the CirrOS image with the <code class="docutils literal"><span class="pre">m1.tiny</span></code> flavor, the device is
<code class="docutils literal"><span class="pre">/dev/vdb</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> blkid -t <span class="nv">LABEL</span><span class="o">=</span><span class="s2">&quot;config-2&quot;</span> -odevice
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">/dev/vdb</span>
</pre></div>
</div>
<p>Once identified, you can mount the device:</p>
<div class="last highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> mkdir -p /mnt/config
<span class="gp">#</span> mount /dev/vdb /mnt/config
</pre></div>
</div>
</div>
<div class="section" id="configuration-drive-contents">
<h3>Configuration drive contents<a class="headerlink" href="#configuration-drive-contents" title="Permalink to this headline">¶</a></h3>
<p>In this example, the contents of the configuration drive are as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ec2</span><span class="o">/</span><span class="mi">2009</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">04</span><span class="o">/</span><span class="n">meta</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">json</span>
<span class="n">ec2</span><span class="o">/</span><span class="mi">2009</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">04</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">data</span>
<span class="n">ec2</span><span class="o">/</span><span class="n">latest</span><span class="o">/</span><span class="n">meta</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">json</span>
<span class="n">ec2</span><span class="o">/</span><span class="n">latest</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">data</span>
<span class="n">openstack</span><span class="o">/</span><span class="mi">2012</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">10</span><span class="o">/</span><span class="n">meta_data</span><span class="o">.</span><span class="n">json</span>
<span class="n">openstack</span><span class="o">/</span><span class="mi">2012</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">10</span><span class="o">/</span><span class="n">user_data</span>
<span class="n">openstack</span><span class="o">/</span><span class="n">content</span>
<span class="n">openstack</span><span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="mi">0000</span>
<span class="n">openstack</span><span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="mi">0001</span>
<span class="n">openstack</span><span class="o">/</span><span class="n">latest</span><span class="o">/</span><span class="n">meta_data</span><span class="o">.</span><span class="n">json</span>
<span class="n">openstack</span><span class="o">/</span><span class="n">latest</span><span class="o">/</span><span class="n">user_data</span>
</pre></div>
</div>
<p>The files that appear on the configuration drive depend on the arguments
that you pass to the <strong class="command">openstack server create</strong> command.</p>
</div>
<div class="section" id="openstack-metadata-format">
<h3>OpenStack metadata format<a class="headerlink" href="#openstack-metadata-format" title="Permalink to this headline">¶</a></h3>
<p>The following example shows the contents of the
<code class="docutils literal"><span class="pre">openstack/2012-08-10/meta_data.json</span></code> and
<code class="docutils literal"><span class="pre">openstack/latest/meta_data.json</span></code> files. These files are identical.
The file contents are formatted for readability.</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;availability_zone&quot;</span><span class="p">:</span> <span class="s2">&quot;nova&quot;</span><span class="p">,</span>
    <span class="nt">&quot;files&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;content_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/content/0000&quot;</span><span class="p">,</span>
            <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/etc/network/interfaces&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;content_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/content/0001&quot;</span><span class="p">,</span>
            <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;known_hosts&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;test.novalocal&quot;</span><span class="p">,</span>
    <span class="nt">&quot;launch_index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;webservers&quot;</span><span class="p">,</span>
        <span class="nt">&quot;essential&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;public_keys&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;mykey&quot;</span><span class="p">:</span> <span class="s2">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAAgQDBqUfVvCSez0/Wfpd8dLLgZXV9GtXQ7hnMN+Z0OWQUyebVEHey1CXuin0uY1cAJMhUq8j98SiW+cU0sU4J3x5l2+xi1bodDm1BtFWVeLIOQINpfV1n8fKjHB+ynPpe1F6tMDvrFGUlJs44t30BrujMXBe8Rq44cCk6wqyjATA3rQ== Generated by Nova\n&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;83679162-1378-4288-a2d4-70e13ec132aa&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note the effect of the
<code class="docutils literal"><span class="pre">--file</span> <span class="pre">/etc/network/interfaces=/home/myuser/instance-interfaces</span></code>
argument that was passed to the <strong class="command">openstack server create</strong> command.
The contents of this file are contained in the <code class="docutils literal"><span class="pre">openstack/content/0000</span></code>
file on the configuration drive, and the path is specified as
<code class="docutils literal"><span class="pre">/etc/network/interfaces</span></code> in the <code class="docutils literal"><span class="pre">meta_data.json</span></code> file.</p>
</div>
<div class="section" id="ec2-metadata-format">
<h3>EC2 metadata format<a class="headerlink" href="#ec2-metadata-format" title="Permalink to this headline">¶</a></h3>
<p>The following example shows the contents of the
<code class="docutils literal"><span class="pre">ec2/2009-04-04/meta-data.json</span></code> and the <code class="docutils literal"><span class="pre">ec2/latest/meta-data.json</span></code>
files. These files are identical. The file contents are formatted to
improve readability.</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;ami-id&quot;</span><span class="p">:</span> <span class="s2">&quot;ami-00000001&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ami-launch-index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;ami-manifest-path&quot;</span><span class="p">:</span> <span class="s2">&quot;FIXME&quot;</span><span class="p">,</span>
    <span class="nt">&quot;block-device-mapping&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;ami&quot;</span><span class="p">:</span> <span class="s2">&quot;sda1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;ephemeral0&quot;</span><span class="p">:</span> <span class="s2">&quot;sda2&quot;</span><span class="p">,</span>
        <span class="nt">&quot;root&quot;</span><span class="p">:</span> <span class="s2">&quot;/dev/sda1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;swap&quot;</span><span class="p">:</span> <span class="s2">&quot;sda3&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;test.novalocal&quot;</span><span class="p">,</span>
    <span class="nt">&quot;instance-action&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="nt">&quot;instance-id&quot;</span><span class="p">:</span> <span class="s2">&quot;i-00000001&quot;</span><span class="p">,</span>
    <span class="nt">&quot;instance-type&quot;</span><span class="p">:</span> <span class="s2">&quot;m1.tiny&quot;</span><span class="p">,</span>
    <span class="nt">&quot;kernel-id&quot;</span><span class="p">:</span> <span class="s2">&quot;aki-00000002&quot;</span><span class="p">,</span>
    <span class="nt">&quot;local-hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;test.novalocal&quot;</span><span class="p">,</span>
    <span class="nt">&quot;local-ipv4&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;placement&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;availability-zone&quot;</span><span class="p">:</span> <span class="s2">&quot;nova&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;public-hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;test.novalocal&quot;</span><span class="p">,</span>
    <span class="nt">&quot;public-ipv4&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;public-keys&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;0&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;openssh-key&quot;</span><span class="p">:</span> <span class="s2">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAAgQDBqUfVvCSez0/Wfpd8dLLgZXV9GtXQ7hnMN+Z0OWQUyebVEHey1CXuin0uY1cAJMhUq8j98SiW+cU0sU4J3x5l2+xi1bodDm1BtFWVeLIOQINpfV1n8fKjHB+ynPpe1F6tMDvrFGUlJs44t30BrujMXBe8Rq44cCk6wqyjATA3rQ== Generated by Nova\n&quot;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;ramdisk-id&quot;</span><span class="p">:</span> <span class="s2">&quot;ari-00000003&quot;</span><span class="p">,</span>
    <span class="nt">&quot;reservation-id&quot;</span><span class="p">:</span> <span class="s2">&quot;r-7lfps8wj&quot;</span><span class="p">,</span>
    <span class="nt">&quot;security-groups&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;default&quot;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="user-data">
<h3>User data<a class="headerlink" href="#user-data" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">openstack/2012-08-10/user_data</span></code>, <code class="docutils literal"><span class="pre">openstack/latest/user_data</span></code>,
<code class="docutils literal"><span class="pre">ec2/2009-04-04/user-data</span></code>, and <code class="docutils literal"><span class="pre">ec2/latest/user-data</span></code> file are
present only if the <code class="docutils literal"><span class="pre">--user-data</span></code> flag and the contents of the user
data file are passed to the <strong class="command">openstack server create</strong> command.</p>
</div>
<div class="section" id="configuration-drive-format">
<h3>Configuration drive format<a class="headerlink" href="#configuration-drive-format" title="Permalink to this headline">¶</a></h3>
<p>The default format of the configuration drive as an ISO 9660 file
system. To explicitly specify the ISO 9660 format, add the following
line to the <code class="docutils literal"><span class="pre">/etc/nova/nova.conf</span></code> file:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">config_drive_format=iso9660</span>
</pre></div>
</div>
<p>By default, you cannot attach the configuration drive image as a CD
drive instead of as a disk drive. To attach a CD drive, add the
following line to the <code class="docutils literal"><span class="pre">/etc/nova/nova.conf</span></code> file:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">config_drive_cdrom=true</span>
</pre></div>
</div>
<p>For legacy reasons, you can configure the configuration drive to use
VFAT format instead of ISO 9660. It is unlikely that you would require
VFAT format because ISO 9660 is widely supported across operating
systems. However, to use the VFAT format, add the following line to the
<code class="docutils literal"><span class="pre">/etc/nova/nova.conf</span></code> file:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">config_drive_format=vfat</span>
</pre></div>
</div>
<p>If you choose VFAT, the configuration drive is 64&nbsp;MB.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In current version (Liberty) of OpenStack Compute, live migration with
<code class="docutils literal"><span class="pre">config_drive</span></code> on local disk is forbidden due to the bug in libvirt
of copying a read-only disk. However, if we use VFAT as the format of
<code class="docutils literal"><span class="pre">config_drive</span></code>, the function of live migration works well.</p>
</div>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="cli-use-snapshots-to-migrate-instances.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Use snapshots to migrate instances"></i></a>
          
          
            <a href="cli-create-and-manage-networks.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Create and manage networks"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2017-02-14 08:42</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro-user.html">How can I use an OpenStack cloud?</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">OpenStack dashboard</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="cli.html">OpenStack command-line clients</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="common/cli-overview.html">Command-line client overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="common/cli-install-openstack-command-line-clients.html">Install the OpenStack command-line clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="common/cli-discover-version-number-for-a-client.html">Discover the version number for a client</a></li>
<li class="toctree-l2"><a class="reference internal" href="common/cli-set-environment-variables-using-openstack-rc.html">Set environment variables using the OpenStack RC file</a></li>
<li class="toctree-l2"><a class="reference internal" href="common/cli-manage-images.html">Manage images</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli-manage-images-curl.html">Manage images using cURL</a></li>
<li class="toctree-l2"><a class="reference internal" href="common/cli-manage-volumes.html">Manage volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli-manage-shares.html">Manage shares</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli-nova-configure-access-security-for-instances.html">Configure access and security for instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli-launch-instances.html">Launch instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli-manage-instances-hosts.html">Manage instances and hosts</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli-provide-user-data-to-instances.html">Provide user data to instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli-use-snapshots-to-migrate-instances.html">Use snapshots to migrate instances</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Store metadata on a configuration drive</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli-create-and-manage-networks.html">Create and manage networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="managing-openstack-object-storage-with-swift-cli.html">Manage objects and containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli-create-and-manage-stacks.html">Create and manage stacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli-ceilometer.html">Measure cloud resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="trove-manage-db.html">Create and manage databases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sdk.html">OpenStack Python SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="hot.html">HOT Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli-cheat-sheet.html">OpenStack command-line interface cheat sheet</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/app-support.html">Community support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "cli-config-drive" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/openstack-manuals/tree/doc/user-guide/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 0719207c6d82d2c215b9c13234f3a27478e0c0f3";
        var bugProject = "openstack-manuals";
        var bugTitle = "Store metadata on a configuration drive in End User Guide";
    var fieldTags = "user-guide";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 1.0.0 on 2017-02-14 08:42";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>