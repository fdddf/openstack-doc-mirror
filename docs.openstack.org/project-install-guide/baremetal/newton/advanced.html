<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Advanced features</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">
<link href="_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Advanced features</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="setup-drivers.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Setup the drivers for the Bare Metal service"></i></a>
    
    
    <a href="troubleshooting.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Troubleshooting"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2017-02-06 13:15</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Advanced features</a><ul>
<li><a class="reference internal" href="#local-boot-with-partition-images">Local boot with partition images</a><ul>
<li><a class="reference internal" href="#enabling-local-boot-with-compute-service">Enabling local boot with Compute service</a></li>
<li><a class="reference internal" href="#enabling-local-boot-without-compute">Enabling local boot without Compute</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specifying-the-disk-for-deployment-root-device-hints">Specifying the disk for deployment (root device hints)</a></li>
<li><a class="reference internal" href="#appending-kernel-parameters-to-boot-instances">Appending kernel parameters to boot instances</a><ul>
<li><a class="reference internal" href="#network-boot">Network boot</a></li>
<li><a class="reference internal" href="#local-boot">Local boot</a></li>
</ul>
</li>
<li><a class="reference internal" href="#trusted-boot-with-partition-image">Trusted boot with partition image</a></li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="advanced-features">
<span id="advanced"></span><h1>Advanced features<a class="headerlink" href="#advanced-features" title="Permalink to this headline">¶</a></h1>
<div class="section" id="local-boot-with-partition-images">
<span id="local-boot-partition-images"></span><h2>Local boot with partition images<a class="headerlink" href="#local-boot-with-partition-images" title="Permalink to this headline">¶</a></h2>
<p>Starting with the Kilo release, Bare Metal service supports local boot with
partition images, meaning that after the deployment the node&#8217;s subsequent
reboots won&#8217;t happen via PXE or Virtual Media. Instead, it will boot from a
local boot loader installed on the disk.</p>
<p>It&#8217;s important to note that in order for this to work the image being
deployed with Bare Metal service <strong>must</strong> contain <code class="docutils literal"><span class="pre">grub2</span></code> installed within it.</p>
<p>Enabling the local boot is different when Bare Metal service is used with
Compute service and without it.
The following sections will describe both methods.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The local boot feature is dependent upon a updated deploy ramdisk built
with <a class="reference external" href="http://docs.openstack.org/developer/diskimage-builder/">diskimage-builder</a> <strong>version &gt;= 0.1.42</strong> or <a class="reference external" href="http://docs.openstack.org/developer/ironic-python-agent/newton/">ironic-python-agent</a>
in the kilo-era.</p>
</div>
<div class="section" id="enabling-local-boot-with-compute-service">
<h3>Enabling local boot with Compute service<a class="headerlink" href="#enabling-local-boot-with-compute-service" title="Permalink to this headline">¶</a></h3>
<p>To enable local boot we need to set a capability on the bare metal node,
for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update &lt;node-uuid&gt; add properties/capabilities=&quot;boot_option:local&quot;
</pre></div>
</div>
<p>Nodes having <code class="docutils literal"><span class="pre">boot_option</span></code> set to <code class="docutils literal"><span class="pre">local</span></code> may be requested by adding
an <code class="docutils literal"><span class="pre">extra_spec</span></code> to the Compute service flavor, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>nova flavor-key baremetal set capabilities:boot_option=&quot;local&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the node is configured to use <code class="docutils literal"><span class="pre">UEFI</span></code>, Bare Metal service will create
an <code class="docutils literal"><span class="pre">EFI</span> <span class="pre">partition</span></code> on the disk and switch the partition table format to
<code class="docutils literal"><span class="pre">gpt</span></code>. The <code class="docutils literal"><span class="pre">EFI</span> <span class="pre">partition</span></code> will be used later by the boot loader
(which is installed from the deploy ramdisk).</p>
</div>
</div>
<div class="section" id="enabling-local-boot-without-compute">
<span id="local-boot-without-compute"></span><h3>Enabling local boot without Compute<a class="headerlink" href="#enabling-local-boot-without-compute" title="Permalink to this headline">¶</a></h3>
<p>Since adding <code class="docutils literal"><span class="pre">capabilities</span></code> to the node&#8217;s properties is only used by
the nova scheduler to perform more advanced scheduling of instances,
we need a way to enable local boot when Compute is not present. To do that
we can simply specify the capability via the <code class="docutils literal"><span class="pre">instance_info</span></code> attribute
of the node, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update &lt;node-uuid&gt; add instance_info/capabilities=&#39;{&quot;boot_option&quot;: &quot;local&quot;}&#39;
</pre></div>
</div>
</div>
</div>
<div class="section" id="specifying-the-disk-for-deployment-root-device-hints">
<span id="root-device-hints"></span><h2>Specifying the disk for deployment (root device hints)<a class="headerlink" href="#specifying-the-disk-for-deployment-root-device-hints" title="Permalink to this headline">¶</a></h2>
<p>Starting with the Kilo release, Bare Metal service supports passing
hints to the deploy ramdisk about which disk it should pick for the
deployment. The list of support hints is:</p>
<ul>
<li><p class="first">model (STRING): device identifier</p>
</li>
<li><p class="first">vendor (STRING): device vendor</p>
</li>
<li><p class="first">serial (STRING): disk serial number</p>
</li>
<li><p class="first">size (INT): size of the device in GiB</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A node&#8217;s &#8216;local_gb&#8217; property is often set to a value 1 GiB less than the
actual disk size to account for partitioning (this is how DevStack, TripleO
and Ironic Inspector work, to name a few). However, in this case <code class="docutils literal"><span class="pre">size</span></code>
should be the actual size. For example, for a 128 GiB disk <code class="docutils literal"><span class="pre">local_gb</span></code>
will be 127, but size hint will be 128.</p>
</div>
</li>
<li><p class="first">wwn (STRING): unique storage identifier</p>
</li>
<li><p class="first">wwn_with_extension (STRING): unique storage identifier with the vendor extension appended</p>
</li>
<li><p class="first">wwn_vendor_extension (STRING): unique vendor storage identifier</p>
</li>
<li><p class="first">rotational (BOOLEAN): whether it&#8217;s a rotational device or not. This
hint makes it easier to distinguish HDDs (rotational) and SSDs (not
rotational) when choosing which disk Ironic should deploy the image onto.</p>
</li>
<li><p class="first">name (STRING): the device name, e.g /dev/md0</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The root device hint name should only be used for devices with
constant names (e.g RAID volumes). For SATA, SCSI and IDE disk
controllers this hint is not recommended because the order in which
the device nodes are added in Linux is arbitrary, resulting in
devices like /dev/sda and /dev/sdb <a class="reference external" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/persistent_naming.html">switching around at boot time</a>.</p>
</div>
</li>
</ul>
<p>To associate one or more hints with a node, update the node&#8217;s properties
with a <code class="docutils literal"><span class="pre">root_device</span></code> key, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update &lt;node-uuid&gt; add properties/root_device=&#39;{&quot;wwn&quot;: &quot;0x4000cca77fc4dba1&quot;}&#39;
</pre></div>
</div>
<p>That will guarantee that Bare Metal service will pick the disk device that
has the <code class="docutils literal"><span class="pre">wwn</span></code> equal to the specified wwn value, or fail the deployment if it
can not be found.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If multiple hints are specified, a device must satisfy all the hints.</p>
</div>
</div>
<div class="section" id="appending-kernel-parameters-to-boot-instances">
<span id="kernel-boot-parameters"></span><h2>Appending kernel parameters to boot instances<a class="headerlink" href="#appending-kernel-parameters-to-boot-instances" title="Permalink to this headline">¶</a></h2>
<p>The Bare Metal service supports passing custom kernel parameters to boot instances to fit
users&#8217; requirements. The way to append the kernel parameters is depending on how to boot instances.</p>
<div class="section" id="network-boot">
<h3>Network boot<a class="headerlink" href="#network-boot" title="Permalink to this headline">¶</a></h3>
<p>Currently, the Bare Metal service supports assigning unified kernel parameters to PXE
booted instances by:</p>
<ul>
<li><p class="first">Modifying the <code class="docutils literal"><span class="pre">[pxe]/pxe_append_params</span></code> configuration option, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[pxe]

pxe_append_params = quiet splash
</pre></div>
</div>
</li>
<li><p class="first">Copying a template from shipped templates to another place, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>https://git.openstack.org/cgit/openstack/ironic/tree/ironic/drivers/modules/pxe_config.template?stable%2Fnewton
</pre></div>
</div>
<p>Making the modifications and pointing to the custom template via the configuration
options: <code class="docutils literal"><span class="pre">[pxe]/pxe_config_template</span></code> and <code class="docutils literal"><span class="pre">[pxe]/uefi_pxe_config_template</span></code>.</p>
</li>
</ul>
</div>
<div class="section" id="local-boot">
<h3>Local boot<a class="headerlink" href="#local-boot" title="Permalink to this headline">¶</a></h3>
<p>For local boot instances, users can make use of configuration drive
(see <a class="reference internal" href="configdrive.html#configdrive"><span>Enabling the configuration drive (configdrive)</span></a>) to pass a custom
script to append kernel parameters when creating an instance. This is more
flexible and can vary per instance.
Here is an example for grub2 with ubuntu, users can customize it
to fit their use case:</p>
<blockquote>
<div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Default grub2 config file in Ubuntu</span>
<span class="n">grub_file</span> <span class="o">=</span> <span class="s1">&#39;/etc/default/grub&#39;</span>
<span class="c1"># Add parameters here to pass to instance.</span>
<span class="n">kernel_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;quiet&#39;</span><span class="p">,</span> <span class="s1">&#39;splash&#39;</span><span class="p">]</span>
<span class="n">grub_cmd</span> <span class="o">=</span> <span class="s1">&#39;GRUB_CMDLINE_LINUX&#39;</span>
<span class="n">old_grub_file</span> <span class="o">=</span> <span class="n">grub_file</span><span class="o">+</span><span class="s1">&#39;~&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">grub_file</span><span class="p">,</span> <span class="n">old_grub_file</span><span class="p">)</span>
<span class="n">cmdline_existed</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">grub_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">,</span> \
       <span class="nb">open</span><span class="p">(</span><span class="n">old_grub_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
       <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
           <span class="n">key</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">grub_cmd</span><span class="p">:</span>
               <span class="c1">#If there is already some value:</span>
               <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span>
                   <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kernel_parameters</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
               <span class="n">cmdline_existed</span> <span class="o">=</span> <span class="bp">True</span>
           <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
       <span class="k">if</span> <span class="ow">not</span> <span class="n">cmdline_existed</span><span class="p">:</span>
           <span class="n">line</span> <span class="o">=</span> <span class="n">grub_cmd</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kernel_parameters</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
           <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">old_grub_file</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;update-grub&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;reboot&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="trusted-boot-with-partition-image">
<span id="trusted-boot"></span><h2>Trusted boot with partition image<a class="headerlink" href="#trusted-boot-with-partition-image" title="Permalink to this headline">¶</a></h2>
<p>Starting with the Liberty release, Ironic supports trusted boot with partition
image. This means at the end of the deployment process, when the node is
rebooted with the new user image, <code class="docutils literal"><span class="pre">trusted</span> <span class="pre">boot</span></code> will be performed. It will
measure the node&#8217;s BIOS, boot loader, Option ROM and the Kernel/Ramdisk, to
determine whether a bare metal node deployed by Ironic should be trusted.</p>
<p>It&#8217;s important to note that in order for this to work the node being deployed
<strong>must</strong> have Intel <a class="reference external" href="http://en.wikipedia.org/wiki/Trusted_Execution_Technology">TXT</a> hardware support. The image being deployed with
Ironic must have <code class="docutils literal"><span class="pre">oat-client</span></code> installed within it.</p>
<p>The following will describe how to enable <code class="docutils literal"><span class="pre">trusted</span> <span class="pre">boot</span></code> and boot
with PXE and Nova:</p>
<ol class="arabic">
<li><p class="first">Create a customized user image with <code class="docutils literal"><span class="pre">oat-client</span></code> installed:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>disk-image-create -u fedora baremetal oat-client -o $TRUST_IMG
</pre></div>
</div>
<p>For more information on creating customized images, see <a class="reference internal" href="configure-integration.html#image-requirements"><span>Create and add images to the Image service</span></a>.</p>
</li>
<li><p class="first">Enable VT-x, VT-d, TXT and TPM on the node. This can be done manually through
the BIOS. Depending on the platform, several reboots may be needed.</p>
</li>
<li><p class="first">Enroll the node and update the node capability value:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-create -d pxe_ipmitool

ironic node-update $NODE_UUID add properties/capabilities={&#39;trusted_boot&#39;:true}
</pre></div>
</div>
</li>
<li><p class="first">Create a special flavor:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>nova flavor-key $TRUST_FLAVOR_UUID set &#39;capabilities:trusted_boot&#39;=true
</pre></div>
</div>
</li>
<li><p class="first">Prepare <a class="reference external" href="https://sourceforge.net/projects/tboot">tboot</a> and mboot.c32 and put them into tftp_root or http_root
directory on all nodes with the ironic-conductor processes:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu:
    cp /usr/lib/syslinux/mboot.c32 /tftpboot/

Fedora:
    cp /usr/share/syslinux/mboot.c32 /tftpboot/
</pre></div>
</div>
<p><em>Note: The actual location of mboot.c32 varies among different distribution versions.</em></p>
<p>tboot can be downloaded from
<a class="reference external" href="https://sourceforge.net/projects/tboot/files/latest/download">https://sourceforge.net/projects/tboot/files/latest/download</a></p>
</li>
<li><p class="first">Install an OAT Server. An <a class="reference external" href="https://github.com/OpenAttestation/OpenAttestation/wiki">OAT Server</a> should be running and configured correctly.</p>
</li>
<li><p class="first">Boot an instance with Nova:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>nova boot --flavor $TRUST_FLAVOR_UUID --image $TRUST_IMG --user-data $TRUST_SCRIPT trusted_instance
</pre></div>
</div>
<p><em>Note</em> that the node will be measured during <code class="docutils literal"><span class="pre">trusted</span> <span class="pre">boot</span></code> and the hash values saved
into <a class="reference external" href="http://en.wikipedia.org/wiki/Trusted_Platform_Module">TPM</a>. An example of TRUST_SCRIPT can be found in <a class="reference external" href="https://wiki.openstack.org/wiki/Bare-metal-trust#Trust_Script_Example">trust script example</a>.</p>
</li>
<li><p class="first">Verify the result via OAT Server.</p>
<p>This is outside the scope of Ironic. At the moment, users can manually verify the result
by following the <a class="reference external" href="https://wiki.openstack.org/wiki/Bare-metal-trust#Manual_verify_result">manual verify steps</a>.</p>
</li>
</ol>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="setup-drivers.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Setup the drivers for the Bare Metal service"></i></a>
          
          
            <a href="troubleshooting.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Troubleshooting"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2017-02-06 13:15</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="get_started.html">Bare Metal service overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install and configure the Bare Metal service</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure-integration.html">Integration with other OpenStack services</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure-cleaning.html">Configure the Bare Metal service for cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure-tenant-networks.html">Configure tenant networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="enrollment.html">Enrollment</a></li>
<li class="toctree-l1"><a class="reference internal" href="enabling-https.html">Enabling HTTPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="standalone.html">Using Bare Metal service as a standalone service</a></li>
<li class="toctree-l1"><a class="reference internal" href="configdrive.html">Enabling the configuration drive (configdrive)</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy-ramdisk.html">Building or downloading a deploy ramdisk image</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-drivers.html">Setup the drivers for the Bare Metal service</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Advanced features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#local-boot-with-partition-images">Local boot with partition images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#specifying-the-disk-for-deployment-root-device-hints">Specifying the disk for deployment (root device hints)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#appending-kernel-parameters-to-boot-instances">Appending kernel parameters to boot instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="#trusted-boot-with-partition-image">Trusted boot with partition image</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="next-steps.html">Next steps</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "advanced" + ".rst";
        gitURL = "Source: http://git.openstack.org/cgit/openstack/ironic/tree/install-guide/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 27318e28ceaa372868a7cb5dde53f377a7170e86";
        var bugProject = "ironic";
        var bugTitle = "Advanced features in Installation Guide for Bare Metal Service";
    var fieldTags = "install-guide";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.1 on 2017-02-06 13:15";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>