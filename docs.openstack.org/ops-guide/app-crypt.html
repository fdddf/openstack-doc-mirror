<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Tales From the Cryp^H^H^H^H Cloud</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">
<link href="_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Tales From the Cryp^H^H^H^H Cloud</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="app-usecases.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Use Cases"></i></a>
    
    
    <a href="app-roadmaps.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Working with Roadmaps"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2017-02-14 13:54</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Tales From the Cryp^H^H^H^H Cloud</a><ul>
<li><a class="reference internal" href="#double-vlan">Double VLAN</a></li>
<li><a class="reference internal" href="#the-issue">&#8220;The Issue&#8221;</a></li>
<li><a class="reference internal" href="#disappearing-images">Disappearing Images</a></li>
<li><a class="reference internal" href="#the-valentine-s-day-compute-node-massacre">The Valentine&#8217;s Day Compute Node Massacre</a></li>
<li><a class="reference internal" href="#down-the-rabbit-hole">Down the Rabbit Hole</a></li>
<li><a class="reference internal" href="#havana-haunted-by-the-dead">Havana Haunted by the Dead</a></li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="tales-from-the-cryp-h-h-h-h-cloud">
<h1>Tales From the Cryp^H^H^H^H Cloud<a class="headerlink" href="#tales-from-the-cryp-h-h-h-h-cloud" title="Permalink to this headline">¶</a></h1>
<p>Herein lies a selection of tales from OpenStack cloud operators. Read,
and learn from their wisdom.</p>
<div class="section" id="double-vlan">
<h2>Double VLAN<a class="headerlink" href="#double-vlan" title="Permalink to this headline">¶</a></h2>
<p>I was on-site in Kelowna, British Columbia, Canada setting up a new
OpenStack cloud. The deployment was fully automated: Cobbler deployed
the OS on the bare metal, bootstrapped it, and Puppet took over from
there. I had run the deployment scenario so many times in practice and
took for granted that everything was working.</p>
<p>On my last day in Kelowna, I was in a conference call from my hotel. In
the background, I was fooling around on the new cloud. I launched an
instance and logged in. Everything looked fine. Out of boredom, I ran
<strong class="command">ps aux</strong> and all of the sudden the instance locked up.</p>
<p>Thinking it was just a one-off issue, I terminated the instance and
launched a new one. By then, the conference call ended and I was off to
the data center.</p>
<p>At the data center, I was finishing up some tasks and remembered the
lock-up. I logged into the new instance and ran <strong class="command">ps aux</strong> again.
It worked. Phew. I decided to run it one more time. It locked up.</p>
<p>After reproducing the problem several times, I came to the unfortunate
conclusion that this cloud did indeed have a problem. Even worse, my
time was up in Kelowna and I had to return back to Calgary.</p>
<p>Where do you even begin troubleshooting something like this? An instance
that just randomly locks up when a command is issued. Is it the image?
Nope—it happens on all images. Is it the compute node? Nope—all nodes.
Is the instance locked up? No! New SSH connections work just fine!</p>
<p>We reached out for help. A networking engineer suggested it was an MTU
issue. Great! MTU! Something to go on! What&#8217;s MTU and why would it cause
a problem?</p>
<p>MTU is maximum transmission unit. It specifies the maximum number of
bytes that the interface accepts for each packet. If two interfaces have
two different MTUs, bytes might get chopped off and weird things
happen—such as random session lockups.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Not all packets have a size of 1500. Running the <strong class="command">ls</strong> command over
SSH might only create a single packets less than 1500 bytes.
However, running a command with heavy output, such as <strong class="command">ps aux</strong>
requires several packets of 1500 bytes.</p>
</div>
<p>OK, so where is the MTU issue coming from? Why haven&#8217;t we seen this in
any other deployment? What&#8217;s new in this situation? Well, new data
center, new uplink, new switches, new model of switches, new servers,
first time using this model of servers… so, basically everything was
new. Wonderful. We toyed around with raising the MTU at various areas:
the switches, the NICs on the compute nodes, the virtual NICs in the
instances, we even had the data center raise the MTU for our uplink
interface. Some changes worked, some didn&#8217;t. This line of
troubleshooting didn&#8217;t feel right, though. We shouldn&#8217;t have to be
changing the MTU in these areas.</p>
<p>As a last resort, our network admin (Alvaro) and myself sat down with
four terminal windows, a pencil, and a piece of paper. In one window, we
ran ping. In the second window, we ran <code class="docutils literal"><span class="pre">tcpdump</span></code> on the cloud
controller. In the third, <code class="docutils literal"><span class="pre">tcpdump</span></code> on the compute node. And the forth
had <code class="docutils literal"><span class="pre">tcpdump</span></code> on the instance. For background, this cloud was a
multi-node, non-multi-host setup.</p>
<p>One cloud controller acted as a gateway to all compute nodes.
VlanManager was used for the network config. This means that the cloud
controller and all compute nodes had a different VLAN for each OpenStack
project. We used the <code class="docutils literal"><span class="pre">-s</span></code> option of <code class="docutils literal"><span class="pre">ping</span></code> to change the packet
size. We watched as sometimes packets would fully return, sometimes they&#8217;d
only make it out and never back in, and sometimes the packets would stop at a
random point. We changed <code class="docutils literal"><span class="pre">tcpdump</span></code> to start displaying the hex dump of
the packet. We pinged between every combination of outside, controller,
compute, and instance.</p>
<p>Finally, Alvaro noticed something. When a packet from the outside hits
the cloud controller, it should not be configured with a VLAN. We
verified this as true. When the packet went from the cloud controller to
the compute node, it should only have a VLAN if it was destined for an
instance. This was still true. When the ping reply was sent from the
instance, it should be in a VLAN. True. When it came back to the cloud
controller and on its way out to the Internet, it should no longer have
a VLAN. False. Uh oh. It looked as though the VLAN part of the packet
was not being removed.</p>
<p>That made no sense.</p>
<p>While bouncing this idea around in our heads, I was randomly typing
commands on the compute node:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ip a
<span class="go">…</span>
<span class="go">10: vlan100@vlan20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br100 state UP</span>
<span class="go">…</span>
</pre></div>
</div>
<p>&#8220;Hey Alvaro, can you run a VLAN on top of a VLAN?&#8221;</p>
<p>&#8220;If you did, you&#8217;d add an extra 4 bytes to the packet…&#8221;</p>
<p>Then it all made sense…</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> grep vlan_interface /etc/nova/nova.conf
<span class="go">vlan_interface=vlan20</span>
</pre></div>
</div>
<p>In <code class="docutils literal"><span class="pre">nova.conf</span></code>, <code class="docutils literal"><span class="pre">vlan_interface</span></code> specifies what interface OpenStack
should attach all VLANs to. The correct setting should have been:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="na">vlan_interface</span><span class="o">=</span><span class="s">bond0</span>
</pre></div>
</div>
<p>As this would be the server&#8217;s bonded NIC.</p>
<p>vlan20 is the VLAN that the data center gave us for outgoing Internet
access. It&#8217;s a correct VLAN and is also attached to bond0.</p>
<p>By mistake, I configured OpenStack to attach all tenant VLANs to vlan20
instead of bond0 thereby stacking one VLAN on top of another. This added
an extra 4 bytes to each packet and caused a packet of 1504 bytes to be
sent out which would cause problems when it arrived at an interface that
only accepted 1500.</p>
<p>As soon as this setting was fixed, everything worked.</p>
</div>
<div class="section" id="the-issue">
<h2>&#8220;The Issue&#8221;<a class="headerlink" href="#the-issue" title="Permalink to this headline">¶</a></h2>
<p>At the end of August 2012, a post-secondary school in Alberta, Canada
migrated its infrastructure to an OpenStack cloud. As luck would have
it, within the first day or two of it running, one of their servers just
disappeared from the network. Blip. Gone.</p>
<p>After restarting the instance, everything was back up and running. We
reviewed the logs and saw that at some point, network communication
stopped and then everything went idle. We chalked this up to a random
occurrence.</p>
<p>A few nights later, it happened again.</p>
<p>We reviewed both sets of logs. The one thing that stood out the most was
DHCP. At the time, OpenStack, by default, set DHCP leases for one minute
(it&#8217;s now two minutes). This means that every instance contacts the
cloud controller (DHCP server) to renew its fixed IP. For some reason,
this instance could not renew its IP. We correlated the instance&#8217;s logs
with the logs on the cloud controller and put together a conversation:</p>
<ol class="arabic simple">
<li>Instance tries to renew IP.</li>
<li>Cloud controller receives the renewal request and sends a response.</li>
<li>Instance &#8220;ignores&#8221; the response and re-sends the renewal request.</li>
<li>Cloud controller receives the second request and sends a new
response.</li>
<li>Instance begins sending a renewal request to <code class="docutils literal"><span class="pre">255.255.255.255</span></code>
since it hasn&#8217;t heard back from the cloud controller.</li>
<li>The cloud controller receives the <code class="docutils literal"><span class="pre">255.255.255.255</span></code> request and
sends a third response.</li>
<li>The instance finally gives up.</li>
</ol>
<p>With this information in hand, we were sure that the problem had to do
with DHCP. We thought that for some reason, the instance wasn&#8217;t getting
a new IP address and with no IP, it shut itself off from the network.</p>
<p>A quick Google search turned up this: <a class="reference external" href="https://lists.launchpad.net/openstack/msg11696.html">DHCP lease errors in VLAN
mode</a>
which further supported our DHCP theory.</p>
<p>An initial idea was to just increase the lease time. If the instance
only renewed once every week, the chances of this problem happening
would be tremendously smaller than every minute. This didn&#8217;t solve the
problem, though. It was just covering the problem up.</p>
<p>We decided to have <code class="docutils literal"><span class="pre">tcpdump</span></code> run on this instance and see if we could
catch it in action again. Sure enough, we did.</p>
<p>The <code class="docutils literal"><span class="pre">tcpdump</span></code> looked very, very weird. In short, it looked as though
network communication stopped before the instance tried to renew its IP.
Since there is so much DHCP chatter from a one minute lease, it&#8217;s very
hard to confirm it, but even with only milliseconds difference between
packets, if one packet arrives first, it arrived first, and if that
packet reported network issues, then it had to have happened before
DHCP.</p>
<p>Additionally, this instance in question was responsible for a very, very
large backup job each night. While &#8220;The Issue&#8221; (as we were now calling
it) didn&#8217;t happen exactly when the backup happened, it was close enough
(a few hours) that we couldn&#8217;t ignore it.</p>
<p>Further days go by and we catch The Issue in action more and more. We
find that dhclient is not running after The Issue happens. Now we&#8217;re
back to thinking it&#8217;s a DHCP issue. Running <code class="docutils literal"><span class="pre">/etc/init.d/networking</span></code>
restart brings everything back up and running.</p>
<p>Ever have one of those days where all of the sudden you get the Google
results you were looking for? Well, that&#8217;s what happened here. I was
looking for information on dhclient and why it dies when it can&#8217;t renew
its lease and all of the sudden I found a bunch of OpenStack and dnsmasq
discussions that were identical to the problem we were seeing!</p>
<p><a class="reference external" href="http://www.gossamer-threads.com/lists/openstack/operators/18197">Problem with Heavy Network IO and
Dnsmasq</a>.</p>
<p><a class="reference external" href="http://www.gossamer-threads.com/lists/openstack/dev/14696">instances losing IP address while running, due to No
DHCPOFFER</a>.</p>
<p>Seriously, Google.</p>
<p>This bug report was the key to everything: <a class="reference external" href="https://bugs.launchpad.net/ubuntu/+source/qemu-kvm/+bug/997978">KVM images lose connectivity
with bridged
network</a>.</p>
<p>It was funny to read the report. It was full of people who had some
strange network problem but didn&#8217;t quite explain it in the same way.</p>
<p>So it was a qemu/kvm bug.</p>
<p>At the same time of finding the bug report, a co-worker was able to
successfully reproduce The Issue! How? He used <code class="docutils literal"><span class="pre">iperf</span></code> to spew a ton
of bandwidth at an instance. Within 30 minutes, the instance just
disappeared from the network.</p>
<p>Armed with a patched qemu and a way to reproduce, we set out to see if
we&#8217;ve finally solved The Issue. After 48 hours straight of hammering the
instance with bandwidth, we were confident. The rest is history. You can
search the bug report for &#8220;joe&#8221; to find my comments and actual tests.</p>
</div>
<div class="section" id="disappearing-images">
<h2>Disappearing Images<a class="headerlink" href="#disappearing-images" title="Permalink to this headline">¶</a></h2>
<p>At the end of 2012, Cybera (a nonprofit with a mandate to oversee the
development of cyberinfrastructure in Alberta, Canada) deployed an
updated OpenStack cloud for their <a class="reference external" href="http://www.canarie.ca/cloud/">DAIR
project</a>. A few days into
production, a compute node locks up. Upon rebooting the node, I checked
to see what instances were hosted on that node so I could boot them on
behalf of the customer. Luckily, only one instance.</p>
<p>The <strong class="command">nova reboot</strong> command wasn&#8217;t working, so I used <strong class="command">virsh</strong>,
but it immediately came back with an error saying it was unable to find the
backing disk. In this case, the backing disk is the Glance image that is
copied to <code class="docutils literal"><span class="pre">/var/lib/nova/instances/_base</span></code> when the image is used for
the first time. Why couldn&#8217;t it find it? I checked the directory and
sure enough it was gone.</p>
<p>I reviewed the <code class="docutils literal"><span class="pre">nova</span></code> database and saw the instance&#8217;s entry in the
<code class="docutils literal"><span class="pre">nova.instances</span></code> table. The image that the instance was using matched
what virsh was reporting, so no inconsistency there.</p>
<p>I checked Glance and noticed that this image was a snapshot that the
user created. At least that was good news—this user would have been the
only user affected.</p>
<p>Finally, I checked StackTach and reviewed the user&#8217;s events. They had
created and deleted several snapshots—most likely experimenting.
Although the timestamps didn&#8217;t match up, my conclusion was that they
launched their instance and then deleted the snapshot and it was somehow
removed from <code class="docutils literal"><span class="pre">/var/lib/nova/instances/_base</span></code>. None of that made sense,
but it was the best I could come up with.</p>
<p>It turns out the reason that this compute node locked up was a hardware
issue. We removed it from the DAIR cloud and called Dell to have it
serviced. Dell arrived and began working. Somehow or another (or a fat
finger), a different compute node was bumped and rebooted. Great.</p>
<p>When this node fully booted, I ran through the same scenario of seeing
what instances were running so I could turn them back on. There were a
total of four. Three booted and one gave an error. It was the same error
as before: unable to find the backing disk. Seriously, what?</p>
<p>Again, it turns out that the image was a snapshot. The three other
instances that successfully started were standard cloud images. Was it a
problem with snapshots? That didn&#8217;t make sense.</p>
<p>A note about DAIR&#8217;s architecture: <code class="docutils literal"><span class="pre">/var/lib/nova/instances</span></code> is a
shared NFS mount. This means that all compute nodes have access to it,
which includes the <code class="docutils literal"><span class="pre">_base</span></code> directory. Another centralized area is
<code class="docutils literal"><span class="pre">/var/log/rsyslog</span></code> on the cloud controller. This directory collects
all OpenStack logs from all compute nodes. I wondered if there were any
entries for the file that <strong class="command">virsh</strong> is reporting:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">dair-ua-c03/nova.log:Dec 19 12:10:59 dair-ua-c03</span>
<span class="go">2012-12-19 12:10:59 INFO nova.virt.libvirt.imagecache</span>
<span class="go">[-] Removing base file:</span>
<span class="go">/var/lib/nova/instances/_base/7b4783508212f5d242cbf9ff56fb8d33b4ce6166_10</span>
</pre></div>
</div>
<p>Ah-hah! So OpenStack was deleting it. But why?</p>
<p>A feature was introduced in Essex to periodically check and see if there
were any <code class="docutils literal"><span class="pre">_base</span></code> files not in use. If there were, OpenStack Compute
would delete them. This idea sounds innocent enough and has some good
qualities to it. But how did this feature end up turned on? It was
disabled by default in Essex. As it should be. It was <a class="reference external" href="https://bugs.launchpad.net/nova/+bug/1029674">decided to be
turned on in Folsom</a>.
I cannot emphasize enough that:</p>
<p><em>Actions which delete things should not be enabled by default.</em></p>
<p>Disk space is cheap these days. Data recovery is not.</p>
<p>Secondly, DAIR&#8217;s shared <code class="docutils literal"><span class="pre">/var/lib/nova/instances</span></code> directory
contributed to the problem. Since all compute nodes have access to this
directory, all compute nodes periodically review the _base directory.
If there is only one instance using an image, and the node that the
instance is on is down for a few minutes, it won&#8217;t be able to mark the
image as still in use. Therefore, the image seems like it&#8217;s not in use
and is deleted. When the compute node comes back online, the instance
hosted on that node is unable to start.</p>
</div>
<div class="section" id="the-valentine-s-day-compute-node-massacre">
<h2>The Valentine&#8217;s Day Compute Node Massacre<a class="headerlink" href="#the-valentine-s-day-compute-node-massacre" title="Permalink to this headline">¶</a></h2>
<p>Although the title of this story is much more dramatic than the actual
event, I don&#8217;t think, or hope, that I&#8217;ll have the opportunity to use
&#8220;Valentine&#8217;s Day Massacre&#8221; again in a title.</p>
<p>This past Valentine&#8217;s Day, I received an alert that a compute node was
no longer available in the cloud—meaning,</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack compute service list
</pre></div>
</div>
<p>showed this particular node in a down state.</p>
<p>I logged into the cloud controller and was able to both <code class="docutils literal"><span class="pre">ping</span></code> and SSH
into the problematic compute node which seemed very odd. Usually if I
receive this type of alert, the compute node has totally locked up and
would be inaccessible.</p>
<p>After a few minutes of troubleshooting, I saw the following details:</p>
<ul class="simple">
<li>A user recently tried launching a CentOS instance on that node</li>
<li>This user was the only user on the node (new node)</li>
<li>The load shot up to 8 right before I received the alert</li>
<li>The bonded 10gb network device (bond0) was in a DOWN state</li>
<li>The 1gb NIC was still alive and active</li>
</ul>
<p>I looked at the status of both NICs in the bonded pair and saw that
neither was able to communicate with the switch port. Seeing as how each
NIC in the bond is connected to a separate switch, I thought that the
chance of a switch port dying on each switch at the same time was quite
improbable. I concluded that the 10gb dual port NIC had died and needed
replaced. I created a ticket for the hardware support department at the
data center where the node was hosted. I felt lucky that this was a new
node and no one else was hosted on it yet.</p>
<p>An hour later I received the same alert, but for another compute node.
Crap. OK, now there&#8217;s definitely a problem going on. Just like the
original node, I was able to log in by SSH. The bond0 NIC was DOWN but
the 1gb NIC was active.</p>
<p>And the best part: the same user had just tried creating a CentOS
instance. What?</p>
<p>I was totally confused at this point, so I texted our network admin to
see if he was available to help. He logged in to both switches and
immediately saw the problem: the switches detected spanning tree packets
coming from the two compute nodes and immediately shut the ports down to
prevent spanning tree loops:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">Feb 15 01:40:18 SW-1 Stp: %SPANTREE-4-BLOCK_BPDUGUARD: Received BPDU packet on Port-Channel35 with BPDU guard enabled. Disabling interface. (source mac fa:16:3e:24:e7:22)</span>
<span class="go">Feb 15 01:40:18 SW-1 Ebra: %ETH-4-ERRDISABLE: bpduguard error detected on Port-Channel35.</span>
<span class="go">Feb 15 01:40:18 SW-1 Mlag: %MLAG-4-INTF_INACTIVE_LOCAL: Local interface Port-Channel35 is link down. MLAG 35 is inactive.</span>
<span class="go">Feb 15 01:40:18 SW-1 Ebra: %LINEPROTO-5-UPDOWN: Line protocol on Interface Port-Channel35 (Server35), changed state to down</span>
<span class="go">Feb 15 01:40:19 SW-1 Stp: %SPANTREE-6-INTERFACE_DEL: Interface Port-Channel35 has been removed from instance MST0</span>
<span class="go">Feb 15 01:40:19 SW-1 Ebra: %LINEPROTO-5-UPDOWN: Line protocol on Interface Ethernet35 (Server35), changed state to down</span>
</pre></div>
</div>
<p>He re-enabled the switch ports and the two compute nodes immediately
came back to life.</p>
<p>Unfortunately, this story has an open ending... we&#8217;re still looking into
why the CentOS image was sending out spanning tree packets. Further,
we&#8217;re researching a proper way on how to mitigate this from happening.
It&#8217;s a bigger issue than one might think. While it&#8217;s extremely important
for switches to prevent spanning tree loops, it&#8217;s very problematic to
have an entire compute node be cut from the network when this happens.
If a compute node is hosting 100 instances and one of them sends a
spanning tree packet, that instance has effectively DDOS&#8217;d the other 99
instances.</p>
<p>This is an ongoing and hot topic in networking circles —especially with
the raise of virtualization and virtual switches.</p>
</div>
<div class="section" id="down-the-rabbit-hole">
<h2>Down the Rabbit Hole<a class="headerlink" href="#down-the-rabbit-hole" title="Permalink to this headline">¶</a></h2>
<p>Users being able to retrieve console logs from running instances is a
boon for support—many times they can figure out what&#8217;s going on inside
their instance and fix what&#8217;s going on without bothering you.
Unfortunately, sometimes overzealous logging of failures can cause
problems of its own.</p>
<p>A report came in: VMs were launching slowly, or not at all. Cue the
standard checks—nothing on the Nagios, but there was a spike in network
towards the current master of our RabbitMQ cluster. Investigation
started, but soon the other parts of the queue cluster were leaking
memory like a sieve. Then the alert came in—the master Rabbit server
went down and connections failed over to the slave.</p>
<p>At that time, our control services were hosted by another team and we
didn&#8217;t have much debugging information to determine what was going on
with the master, and we could not reboot it. That team noted that it
failed without alert, but managed to reboot it. After an hour, the
cluster had returned to its normal state and we went home for the day.</p>
<p>Continuing the diagnosis the next morning was kick started by another
identical failure. We quickly got the message queue running again, and
tried to work out why Rabbit was suffering from so much network traffic.
Enabling debug logging on nova-api quickly brought understanding. A
<code class="docutils literal"><span class="pre">tail</span> <span class="pre">-f</span> <span class="pre">/var/log/nova/nova-api.log</span></code> was scrolling by faster
than we&#8217;d ever seen before. CTRL+C on that and we could plainly see the
contents of a system log spewing failures over and over again - a system
log from one of our users&#8217; instances.</p>
<p>After finding the instance ID we headed over to
<code class="docutils literal"><span class="pre">/var/lib/nova/instances</span></code> to find the <code class="docutils literal"><span class="pre">console.log</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">adm@cc12:/var/lib/nova/instances/instance-00000e05#</span> wc -l console.log
<span class="go">92890453 console.log</span>
<span class="gp">adm@cc12:/var/lib/nova/instances/instance-00000e05#</span> ls -sh console.log
<span class="go">5.5G console.log</span>
</pre></div>
</div>
<p>Sure enough, the user had been periodically refreshing the console log
page on the dashboard and the 5G file was traversing the Rabbit cluster
to get to the dashboard.</p>
<p>We called them and asked them to stop for a while, and they were happy
to abandon the horribly broken VM. After that, we started monitoring the
size of console logs.</p>
<p>To this day, <a class="reference external" href="https://bugs.launchpad.net/nova/+bug/832507">the issue</a>
doesn&#8217;t have a permanent resolution, but we look forward to the discussion
at the next summit.</p>
</div>
<div class="section" id="havana-haunted-by-the-dead">
<h2>Havana Haunted by the Dead<a class="headerlink" href="#havana-haunted-by-the-dead" title="Permalink to this headline">¶</a></h2>
<p>Felix Lee of Academia Sinica Grid Computing Centre in Taiwan contributed
this story.</p>
<p>I just upgraded OpenStack from Grizzly to Havana 2013.2-2 using the RDO
repository and everything was running pretty well—except the EC2 API.</p>
<p>I noticed that the API would suffer from a heavy load and respond slowly
to particular EC2 requests such as <code class="docutils literal"><span class="pre">RunInstances</span></code>.</p>
<p>Output from <code class="docutils literal"><span class="pre">/var/log/nova/nova-api.log</span></code> on <a class="reference internal" href="common/glossary.html#term-havana"><span class="xref std std-term">Havana</span></a>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">2014-01-10 09:11:45.072 129745 INFO nova.ec2.wsgi.server</span>
<span class="go">[req-84d16d16-3808-426b-b7af-3b90a11b83b0</span>
<span class="go">0c6e7dba03c24c6a9bce299747499e8a 7052bd6714e7460caeb16242e68124f9]</span>
<span class="go">117.103.103.29 &quot;GET</span>
<span class="go">/services/Cloud?AWSAccessKeyId=[something]&amp;Action=RunInstances&amp;ClientToken=[something]&amp;ImageId=ami-00000001&amp;InstanceInitiatedShutdownBehavior=terminate...</span>
<span class="go">HTTP/1.1&quot; status: 200 len: 1109 time: 138.5970151</span>
</pre></div>
</div>
<p>This request took over two minutes to process, but executed quickly on
another co-existing Grizzly deployment using the same hardware and
system configuration.</p>
<p>Output from <code class="docutils literal"><span class="pre">/var/log/nova/nova-api.log</span></code> on <a class="reference internal" href="common/glossary.html#term-grizzly"><span class="xref std std-term">Grizzly</span></a>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">2014-01-08 11:15:15.704 INFO nova.ec2.wsgi.server</span>
<span class="go">[req-ccac9790-3357-4aa8-84bd-cdaab1aa394e</span>
<span class="go">ebbd729575cb404081a45c9ada0849b7 8175953c209044358ab5e0ec19d52c37]</span>
<span class="go">117.103.103.29 &quot;GET</span>
<span class="go">/services/Cloud?AWSAccessKeyId=[something]&amp;Action=RunInstances&amp;ClientToken=[something]&amp;ImageId=ami-00000007&amp;InstanceInitiatedShutdownBehavior=terminate...</span>
<span class="go">HTTP/1.1&quot; status: 200 len: 931 time: 3.9426181</span>
</pre></div>
</div>
<p>While monitoring system resources, I noticed a significant increase in
memory consumption while the EC2 API processed this request. I thought
it wasn&#8217;t handling memory properly—possibly not releasing memory. If the
API received several of these requests, memory consumption quickly grew
until the system ran out of RAM and began using swap. Each node has 48
GB of RAM and the &#8220;nova-api&#8221; process would consume all of it within
minutes. Once this happened, the entire system would become unusably
slow until I restarted the nova-api service.</p>
<p>So, I found myself wondering what changed in the EC2 API on Havana that
might cause this to happen. Was it a bug or a normal behavior that I now
need to work around?</p>
<p>After digging into the nova (OpenStack Compute) code, I noticed two
areas in <code class="docutils literal"><span class="pre">api/ec2/cloud.py</span></code> potentially impacting my system:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">instances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_api</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">context</span><span class="p">,</span>
                                     <span class="n">search_opts</span><span class="o">=</span><span class="n">search_opts</span><span class="p">,</span>
                                     <span class="n">sort_dir</span><span class="o">=</span><span class="s1">&#39;asc&#39;</span><span class="p">)</span>

<span class="n">sys_metas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_api</span><span class="o">.</span><span class="n">get_all_system_metadata</span><span class="p">(</span>
    <span class="n">context</span><span class="p">,</span> <span class="n">search_filts</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;EC2_client_token&#39;</span><span class="p">]},</span>
                           <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">client_token</span><span class="p">]}])</span>
</pre></div>
</div>
<p>Since my database contained many records—over 1 million metadata records
and over 300,000 instance records in &#8220;deleted&#8221; or &#8220;errored&#8221; states—each
search took a long time. I decided to clean up the database by first
archiving a copy for backup and then performing some deletions using the
MySQL client. For example, I ran the following SQL command to remove
rows of instances deleted for over a year:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">mysql&gt; delete from nova.instances where deleted=1 and terminated_at &lt; (NOW() - INTERVAL 1 YEAR);</span>
</pre></div>
</div>
<p>Performance increased greatly after deleting the old records and my new
deployment continues to behave well.</p>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="app-usecases.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Use Cases"></i></a>
          
          
            <a href="app-roadmaps.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Working with Roadmaps"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2017-02-14 13:54</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="operations.html">Operations</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="app-usecases.html">Use Cases</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tales From the Cryp^H^H^H^H Cloud</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#double-vlan">Double VLAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-issue">&#8220;The Issue&#8221;</a></li>
<li class="toctree-l2"><a class="reference internal" href="#disappearing-images">Disappearing Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-valentine-s-day-compute-node-massacre">The Valentine&#8217;s Day Compute Node Massacre</a></li>
<li class="toctree-l2"><a class="reference internal" href="#down-the-rabbit-hole">Down the Rabbit Hole</a></li>
<li class="toctree-l2"><a class="reference internal" href="#havana-haunted-by-the-dead">Havana Haunted by the Dead</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="app-roadmaps.html">Working with Roadmaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="app-resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/app-support.html">Community support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "app-crypt" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/openstack-manuals/tree/doc/ops-guide/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 3993c81360ea23a2e599faf5f3de0d288b10c20a";
        var bugProject = "openstack-manuals";
        var bugTitle = "Tales From the Cryp^H^H^H^H Cloud in Operations Guide";
    var fieldTags = "ops-guide";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.0.1 on 2017-02-14 13:54";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>