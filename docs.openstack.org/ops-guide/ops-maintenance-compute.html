<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Compute Node Failures and Maintenance</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">
<link href="_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Compute Node Failures and Maintenance</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="ops-maintenance-controller.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Cloud Controller and Storage Proxy Failures and Maintenance"></i></a>
    
    
    <a href="ops-maintenance-storage.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Storage Node Failures and Maintenance"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2017-02-14 13:54</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Compute Node Failures and Maintenance</a><ul>
<li><a class="reference internal" href="#planned-maintenance">Planned Maintenance</a></li>
<li><a class="reference internal" href="#after-a-compute-node-reboots">After a Compute Node Reboots</a></li>
<li><a class="reference internal" href="#instances">Instances</a></li>
<li><a class="reference internal" href="#inspecting-and-recovering-data-from-failed-instances">Inspecting and Recovering Data from Failed Instances</a></li>
<li><a class="reference internal" href="#managing-floating-ip-addresses-between-instances">Managing floating IP addresses between instances</a></li>
<li><a class="reference internal" href="#volumes">Volumes</a></li>
<li><a class="reference internal" href="#total-compute-node-failure">Total Compute Node Failure</a></li>
<li><a class="reference internal" href="#var-lib-nova-instances">/var/lib/nova/instances</a></li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="compute-node-failures-and-maintenance">
<h1>Compute Node Failures and Maintenance<a class="headerlink" href="#compute-node-failures-and-maintenance" title="Permalink to this headline">¶</a></h1>
<p>Sometimes a compute node either crashes unexpectedly or requires a
reboot for maintenance reasons.</p>
<div class="section" id="planned-maintenance">
<h2>Planned Maintenance<a class="headerlink" href="#planned-maintenance" title="Permalink to this headline">¶</a></h2>
<p>If you need to reboot a compute node due to planned maintenance, such as
a software or hardware upgrade, perform the following steps:</p>
<ol class="arabic">
<li><p class="first">Disable scheduling of new VMs to the node, optionally providing a reason
comment:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> nova service-disable --reason maintenance c01.example.com nova-compute
</pre></div>
</div>
</li>
<li><p class="first">Verify that all hosted instances have been moved off the node:</p>
<ul>
<li><p class="first">If your cloud is using a shared storage:</p>
<ol class="arabic">
<li><p class="first">Get a list of instances that need to be moved:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> openstack server list --host c01.example.com --all-projects
</pre></div>
</div>
</li>
<li><p class="first">Migrate all instances one by one:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> openstack server migrate &lt;uuid&gt; --live c02.example.com
</pre></div>
</div>
</li>
</ol>
</li>
<li><p class="first">If your cloud is not using a shared storage, run:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> openstack server migrate &lt;uuid&gt; --live --block-migration c02.example.com
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Stop the <code class="docutils literal"><span class="pre">nova-compute</span></code> service:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> stop nova-compute
</pre></div>
</div>
<p>If you use a configuration-management system, such as Puppet, that
ensures the <code class="docutils literal"><span class="pre">nova-compute</span></code> service is always running, you can
temporarily move the <code class="docutils literal"><span class="pre">init</span></code> files:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> mkdir /root/tmp
<span class="gp">#</span> mv /etc/init/nova-compute.conf /root/tmp
<span class="gp">#</span> mv /etc/init.d/nova-compute /root/tmp
</pre></div>
</div>
</li>
<li><p class="first">Shut down your compute node, perform the maintenance, and turn
the node back on.</p>
</li>
<li><p class="first">Start the <code class="docutils literal"><span class="pre">nova-compute</span></code> service:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> start nova-compute
</pre></div>
</div>
<p>You can re-enable the <code class="docutils literal"><span class="pre">nova-compute</span></code> service by undoing the commands:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> mv /root/tmp/nova-compute.conf /etc/init
<span class="gp">#</span> mv /root/tmp/nova-compute /etc/init.d/
</pre></div>
</div>
</li>
<li><p class="first">Enable scheduling of VMs to the node:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> nova service-enable c01.example.com nova-compute
</pre></div>
</div>
</li>
<li><p class="first">Optionally, migrate the instances back to their original compute node.</p>
</li>
</ol>
</div>
<div class="section" id="after-a-compute-node-reboots">
<h2>After a Compute Node Reboots<a class="headerlink" href="#after-a-compute-node-reboots" title="Permalink to this headline">¶</a></h2>
<p>When you reboot a compute node, first verify that it booted
successfully. This includes ensuring that the <code class="docutils literal"><span class="pre">nova-compute</span></code> service
is running:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> ps aux <span class="p">|</span> grep nova-compute
<span class="gp">#</span> status nova-compute
</pre></div>
</div>
<p>Also ensure that it has successfully connected to the AMQP server:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> grep AMQP /var/log/nova/nova-compute.log
<span class="go">2013-02-26 09:51:31 12427 INFO nova.openstack.common.rpc.common [-] Connected to AMQP server on 199.116.232.36:5672</span>
</pre></div>
</div>
<p>After the compute node is successfully running, you must deal with the
instances that are hosted on that compute node because none of them are
running. Depending on your SLA with your users or customers, you might
have to start each instance and ensure that they start correctly.</p>
</div>
<div class="section" id="instances">
<h2>Instances<a class="headerlink" href="#instances" title="Permalink to this headline">¶</a></h2>
<p>You can create a list of instances that are hosted on the compute node
by performing the following command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> openstack server list --host c01.example.com --all-projects
</pre></div>
</div>
<p>After you have the list, you can use the <strong class="command">openstack</strong> command to
start each instance:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> openstack server reboot &lt;server&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any time an instance shuts down unexpectedly, it might have problems
on boot. For example, the instance might require an <code class="docutils literal"><span class="pre">fsck</span></code> on the
root partition. If this happens, the user can use the dashboard VNC
console to fix this.</p>
</div>
<p>If an instance does not boot, meaning <code class="docutils literal"><span class="pre">virsh</span> <span class="pre">list</span></code> never shows the
instance as even attempting to boot, do the following on the compute
node:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> tail -f /var/log/nova/nova-compute.log
</pre></div>
</div>
<p>Try executing the <strong class="command">openstack server reboot</strong> command again. You should
see an error message about why the instance was not able to boot.</p>
<p>In most cases, the error is the result of something in libvirt&#8217;s XML
file (<code class="docutils literal"><span class="pre">/etc/libvirt/qemu/instance-xxxxxxxx.xml</span></code>) that no longer
exists. You can enforce re-creation of the XML file as well as rebooting
the instance by running the following command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> openstack server reboot --hard &lt;server&gt;
</pre></div>
</div>
</div>
<div class="section" id="inspecting-and-recovering-data-from-failed-instances">
<h2>Inspecting and Recovering Data from Failed Instances<a class="headerlink" href="#inspecting-and-recovering-data-from-failed-instances" title="Permalink to this headline">¶</a></h2>
<p>In some scenarios, instances are running but are inaccessible through
SSH and do not respond to any command. The VNC console could be
displaying a boot failure or kernel panic error messages. This could be
an indication of file system corruption on the VM itself. If you need to
recover files or inspect the content of the instance, qemu-nbd can be
used to mount the disk.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you access or view the user&#8217;s content and data, get approval first!</p>
</div>
<p>To access the instance&#8217;s disk
(<code class="docutils literal"><span class="pre">/var/lib/nova/instances/instance-xxxxxx/disk</span></code>), use the following
steps:</p>
<ol class="arabic simple">
<li>Suspend the instance using the <code class="docutils literal"><span class="pre">virsh</span></code> command.</li>
<li>Connect the qemu-nbd device to the disk.</li>
<li>Mount the qemu-nbd device.</li>
<li>Unmount the device after inspecting.</li>
<li>Disconnect the qemu-nbd device.</li>
<li>Resume the instance.</li>
</ol>
<p>If you do not follow last three steps, OpenStack Compute cannot manage
the instance any longer. It fails to respond to any command issued by
OpenStack Compute, and it is marked as shut down.</p>
<p>Once you mount the disk file, you should be able to access it and treat
it as a collection of normal directories with files and a directory
structure. However, we do not recommend that you edit or touch any files
because this could change the
<a class="reference internal" href="common/glossary.html#term-access-control-list-acl"><span class="xref std std-term">access control lists (ACLs)</span></a> that are used
to determine which accounts can perform what operations on files and
directories. Changing ACLs can make the instance unbootable if it is not
already.</p>
<ol class="arabic">
<li><p class="first">Suspend the instance using the <strong class="command">virsh</strong> command, taking note of the
internal ID:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> virsh list
<span class="go">Id Name                 State</span>
<span class="go">----------------------------------</span>
<span class="go"> 1 instance-00000981    running</span>
<span class="go"> 2 instance-000009f5    running</span>
<span class="go">30 instance-0000274a    running</span>

<span class="gp">#</span> virsh <span class="nb">suspend</span> <span class="m">30</span>
<span class="go">Domain 30 suspended</span>
</pre></div>
</div>
</li>
<li><p class="first">Find the ID for each instance by listing the server IDs using the
following command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> openstack server list
<span class="go">+--------------------------------------+-------+---------+-----------------------------+------------+</span>
<span class="go">| ID                                   | Name  | Status  | Networks                    | Image Name |</span>
<span class="go">+--------------------------------------+-------+---------+-----------------------------+------------+</span>
<span class="go">| 2da14c5c-de6d-407d-a7d2-2dd0862b9967 | try3  | ACTIVE  | finance-internal=10.10.0.4  |            |</span>
<span class="go">| 223f4860-722a-44a0-bac7-f73f58beec7b | try2  | ACTIVE  | finance-internal=10.10.0.13 |            |</span>
<span class="go">+--------------------------------------+-------+---------+-----------------------------+------------+</span>
</pre></div>
</div>
</li>
<li><p class="first">Connect the qemu-nbd device to the disk:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> <span class="nb">cd</span> /var/lib/nova/instances/instance-0000274a
<span class="gp">#</span> ls -lh
<span class="go">total 33M</span>
<span class="go">-rw-rw---- 1 libvirt-qemu kvm  6.3K Oct 15 11:31 console.log</span>
<span class="go">-rw-r--r-- 1 libvirt-qemu kvm   33M Oct 15 22:06 disk</span>
<span class="go">-rw-r--r-- 1 libvirt-qemu kvm  384K Oct 15 22:06 disk.local</span>
<span class="go">-rw-rw-r-- 1 nova         nova 1.7K Oct 15 11:30 libvirt.xml</span>
<span class="gp">#</span> qemu-nbd -c /dev/nbd0 <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/disk
</pre></div>
</div>
</li>
<li><p class="first">Mount the qemu-nbd device.</p>
<p>The qemu-nbd device tries to export the instance disk&#8217;s different
partitions as separate devices. For example, if vda is the disk and
vda1 is the root partition, qemu-nbd exports the device as
<code class="docutils literal"><span class="pre">/dev/nbd0</span></code> and <code class="docutils literal"><span class="pre">/dev/nbd0p1</span></code>, respectively:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> mount /dev/nbd0p1 /mnt/
</pre></div>
</div>
<p>You can now access the contents of <code class="docutils literal"><span class="pre">/mnt</span></code>, which correspond to the
first partition of the instance&#8217;s disk.</p>
<p>To examine the secondary or ephemeral disk, use an alternate mount
point if you want both primary and secondary drives mounted at the
same time:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> umount /mnt
<span class="gp">#</span> qemu-nbd -c /dev/nbd1 <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/disk.local
<span class="gp">#</span> mount /dev/nbd1 /mnt/
<span class="gp">#</span> ls -lh /mnt/
<span class="go">total 76K</span>
<span class="go">lrwxrwxrwx.  1 root root    7 Oct 15 00:44 bin -&gt; usr/bin</span>
<span class="go">dr-xr-xr-x.  4 root root 4.0K Oct 15 01:07 boot</span>
<span class="go">drwxr-xr-x.  2 root root 4.0K Oct 15 00:42 dev</span>
<span class="go">drwxr-xr-x. 70 root root 4.0K Oct 15 11:31 etc</span>
<span class="go">drwxr-xr-x.  3 root root 4.0K Oct 15 01:07 home</span>
<span class="go">lrwxrwxrwx.  1 root root    7 Oct 15 00:44 lib -&gt; usr/lib</span>
<span class="go">lrwxrwxrwx.  1 root root    9 Oct 15 00:44 lib64 -&gt; usr/lib64</span>
<span class="go">drwx------.  2 root root  16K Oct 15 00:42 lost+found</span>
<span class="go">drwxr-xr-x.  2 root root 4.0K Feb  3  2012 media</span>
<span class="go">drwxr-xr-x.  2 root root 4.0K Feb  3  2012 mnt</span>
<span class="go">drwxr-xr-x.  2 root root 4.0K Feb  3  2012 opt</span>
<span class="go">drwxr-xr-x.  2 root root 4.0K Oct 15 00:42 proc</span>
<span class="go">dr-xr-x---.  3 root root 4.0K Oct 15 21:56 root</span>
<span class="go">drwxr-xr-x. 14 root root 4.0K Oct 15 01:07 run</span>
<span class="go">lrwxrwxrwx.  1 root root    8 Oct 15 00:44 sbin -&gt; usr/sbin</span>
<span class="go">drwxr-xr-x.  2 root root 4.0K Feb  3  2012 srv</span>
<span class="go">drwxr-xr-x.  2 root root 4.0K Oct 15 00:42 sys</span>
<span class="go">drwxrwxrwt.  9 root root 4.0K Oct 15 16:29 tmp</span>
<span class="go">drwxr-xr-x. 13 root root 4.0K Oct 15 00:44 usr</span>
<span class="go">drwxr-xr-x. 17 root root 4.0K Oct 15 00:44 var</span>
</pre></div>
</div>
</li>
<li><p class="first">Once you have completed the inspection, unmount the mount point and
release the qemu-nbd device:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> umount /mnt
<span class="gp">#</span> qemu-nbd -d /dev/nbd0
<span class="go">/dev/nbd0 disconnected</span>
</pre></div>
</div>
</li>
<li><p class="first">Resume the instance using <strong class="command">virsh</strong>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> virsh list
<span class="go">Id Name                 State</span>
<span class="go">----------------------------------</span>
<span class="go"> 1 instance-00000981    running</span>
<span class="go"> 2 instance-000009f5    running</span>
<span class="go">30 instance-0000274a    paused</span>

<span class="gp">#</span> virsh resume <span class="m">30</span>
<span class="go">Domain 30 resumed</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="managing-floating-ip-addresses-between-instances">
<h2>Managing floating IP addresses between instances<a class="headerlink" href="#managing-floating-ip-addresses-between-instances" title="Permalink to this headline">¶</a></h2>
<p>In an elastic cloud environment using the <code class="docutils literal"><span class="pre">Public_AGILE</span></code> network, each
instance has a publicly accessible IPv4 &amp; IPv6 address. It does not support
the concept of OpenStack floating IP addresses that can easily be attached,
removed, and transferred between instances. However, there is a workaround
using neutron ports which contain the IPv4 &amp; IPv6 address.</p>
<p><strong>Create a port that can be reused</strong></p>
<ol class="arabic">
<li><p class="first">Create a port on the <code class="docutils literal"><span class="pre">Public_AGILE</span></code> network:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron port-create Public_AGILE

<span class="go">Created a new port:</span>

<span class="go">+-----------------------+-------------------------------------------+</span>
<span class="go">| Field                 | Value                                     |</span>
<span class="go">+-----------------------+-------------------------------------------+</span>
<span class="go">| admin_state_up        | True                                      |</span>
<span class="go">| allowed_address_pairs |                                           |</span>
<span class="go">| binding:host_id       |                                           |</span>
<span class="go">| binding:profile       | {}                                        |</span>
<span class="go">| binding:vif_details   | {}                                        |</span>
<span class="go">| binding:vif_type      | unbound                                   |</span>
<span class="go">| binding:vnic_type     | normal                                    |</span>
<span class="go">| device_id             |                                           |</span>
<span class="go">| device_owner          |                                           |</span>
<span class="go">| fixed_ips             | {&quot;subnet_id&quot;: &quot;11d8087b-6288-4129-95ff... |</span>
<span class="go">|                       | &quot;ip_address&quot;: &quot;2001:558:fc0b:100:f816:... |</span>
<span class="go">|                       | {&quot;subnet_id&quot;: &quot;4279c70a-7218-4c7e-94e5... |</span>
<span class="go">|                       | &quot;ip_address&quot;: &quot;96.118.182.106&quot;}           |</span>
<span class="go">| id                    | 3871bf29-e963-4701-a7dd-8888dbaab375      |</span>
<span class="go">| mac_address           | fa:16:3e:e2:09:e0                         |</span>
<span class="go">| name                  |                                           |</span>
<span class="go">| network_id            | f41bd921-3a59-49c4-aa95-c2e4496a4b56      |</span>
<span class="go">| security_groups       | 20d96891-0055-428a-8fa6-d5aed25f0dc6      |</span>
<span class="go">| status                | DOWN                                      |</span>
<span class="go">| tenant_id             | 52f0574689f14c8a99e7ca22c4eb572           |</span>
<span class="go">+-----------------------+-------------------------------------------+</span>
</pre></div>
</div>
</li>
<li><p class="first">If you know the fully qualified domain name (FQDN) that will be assigned to
the IP address, assign the port with the same name:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron port-create Public_AGILE --name <span class="se">\</span>
<span class="s2">&quot;example-fqdn-01.sys.example.com&quot;</span>

<span class="go">Created a new port:</span>
<span class="go">+-----------------------+--------------------------------------------+</span>
<span class="go">| Field                 | Value                                      |</span>
<span class="go">+-----------------------+--------------------------------------------+</span>
<span class="go">| admin_state_up        | True                                       |</span>
<span class="go">| allowed_address_pairs |                                            |</span>
<span class="go">| binding:host_id       |                                            |</span>
<span class="go">| binding:profile       | {}                                         |</span>
<span class="go">| binding:vif_details   | {}                                         |</span>
<span class="go">| binding:vif_type      | unbound                                    |</span>
<span class="go">| binding:vnic_type     | normal                                     |</span>
<span class="go">| device_id             |                                            |</span>
<span class="go">| device_owner          |                                            |</span>
<span class="go">| fixed_ips             | {&quot;subnet_id&quot;: &quot;11d8087b-6288-4129-95ff...  |</span>
<span class="go">|                       | &quot;ip_address&quot;: &quot;2001:558:fc0b:100:f816:...  |</span>
<span class="go">|                       | {&quot;subnet_id&quot;: &quot;4279c70a-7218-4c7e-94e5...  |</span>
<span class="go">|                       | &quot;ip_address&quot;: &quot;96.118.182.107&quot;}            |</span>
<span class="go">| id                    | 731c3b28-3753-4e63-bae3-b58a52d6ccca       |</span>
<span class="go">| mac_address           | fa:16:3e:fb:65:fc                          |</span>
<span class="go">| name                  | example-fqdn-01.sys.example.com            |</span>
<span class="go">| network_id            | f41bd921-3a59-49c4-aa95-c2e4496a4b56       |</span>
<span class="go">| security_groups       | 20d96891-0055-428a-8fa6-d5aed25f0dc6       |</span>
<span class="go">| status                | DOWN                                       |</span>
<span class="go">| tenant_id             | 52f0574689f14c8a99e7ca22c4eb5720           |</span>
<span class="go">+-----------------------+--------------------------------------------+</span>
</pre></div>
</div>
</li>
<li><p class="first">Use the port when creating an instance:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack server create --flavor m1.medium --image ubuntu.qcow2 <span class="se">\</span>
  --key-name team_key --nic port-id<span class="o">=</span>PORT_ID <span class="se">\</span>
  <span class="s2">&quot;example-fqdn-01.sys.example.com&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify the instance has the correct IP address:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">+--------------------------------------+----------------------------------------------------------+</span>
<span class="go">| Field                                | Value                                                    |</span>
<span class="go">+--------------------------------------+----------------------------------------------------------+</span>
<span class="go">| OS-DCF:diskConfig                    | MANUAL                                                   |</span>
<span class="go">| OS-EXT-AZ:availability_zone          | nova                                                     |</span>
<span class="go">| OS-EXT-SRV-ATTR:host                 | os_compute-1                                             |</span>
<span class="go">| OS-EXT-SRV-ATTR:hypervisor_hostname  | os_compute.ece.example.com                               |</span>
<span class="go">| OS-EXT-SRV-ATTR:instance_name        | instance-00012b82                                        |</span>
<span class="go">| OS-EXT-STS:power_state               | Running                                                  |</span>
<span class="go">| OS-EXT-STS:task_state                | None                                                     |</span>
<span class="go">| OS-EXT-STS:vm_state                  | active                                                   |</span>
<span class="go">| OS-SRV-USG:launched_at               | 2016-11-30T08:55:27.000000                               |</span>
<span class="go">| OS-SRV-USG:terminated_at             | None                                                     |</span>
<span class="go">| accessIPv4                           |                                                          |</span>
<span class="go">| accessIPv6                           |                                                          |</span>
<span class="go">| addresses                            | public=172.24.4.236                                      |</span>
<span class="go">| config_drive                         |                                                          |</span>
<span class="go">| created                              | 2016-11-30T08:55:14Z                                     |</span>
<span class="go">| flavor                               | m1.medium (103)                                          |</span>
<span class="go">| hostId                               | aca973d5b7981faaf8c713a0130713bbc1e64151be65c8dfb53039f7 |</span>
<span class="go">| id                                   | f91bd761-6407-46a6-b5fd-11a8a46e4983                     |</span>
<span class="go">| image                                | Example Cloud Ubuntu 14.04 x86_64 v2.5 (fb49d7e1-273b-...|</span>
<span class="go">| key_name                             | team_key                                                 |</span>
<span class="go">| name                                 | example-fqdn-01.sys.example.com                          |</span>
<span class="go">| os-extended-volumes:volumes_attached | []                                                       |</span>
<span class="go">| progress                             | 0                                                        |</span>
<span class="go">| project_id                           | 2daf82a578e9437cab396c888ff0ca57                         |</span>
<span class="go">| properties                           |                                                          |</span>
<span class="go">| security_groups                      | [{u&#39;name&#39;: u&#39;default&#39;}]                                  |</span>
<span class="go">| status                               | ACTIVE                                                   |</span>
<span class="go">| updated                              | 2016-11-30T08:55:27Z                                     |</span>
<span class="go">| user_id                              | 8cbea24666ae49bbb8c1641f9b12d2d2                         |</span>
<span class="go">+--------------------------------------+----------------------------------------------------------+</span>
</pre></div>
</div>
</li>
<li><p class="first">Check the port connection using the netcat utility:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> nc -v -w <span class="m">2</span> <span class="m">96</span>.118.182.107 <span class="m">22</span>
<span class="go">Ncat: Version 7.00 ( https://nmap.org/ncat )</span>
<span class="go">Ncat: Connected to 96.118.182.107:22.</span>
<span class="go">SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.6</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Detach a port from an instance</strong></p>
<ol class="arabic">
<li><p class="first">Find the port corresponding to the instance. For example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron port-list <span class="p">|</span> grep -B1 <span class="m">96</span>.118.182.107

<span class="go">| 731c3b28-3753-4e63-bae3-b58a52d6ccca | example-fqdn-01.sys.comcast.net</span>
<span class="go">| fa:16:3e:fb:65:fc |</span>
<span class="go">{&quot;subnet_id&quot;: &quot;11d8087b-6288-4129-95ff-42c3df0c1df0&quot;,</span>
<span class="go"> &quot;ip_address&quot;: &quot;2001:558:fc0b:100:f816:3eff:fefb:65fc&quot;} |</span>
<span class="go">| {&quot;subnet_id&quot;: &quot;4279c70a-7218-4c7e-94e5-7bd4c045644e&quot;,</span>
<span class="go">&quot;ip_address&quot;: &quot;96.118.182.107&quot;}                           |</span>
</pre></div>
</div>
</li>
<li><p class="first">Run the <strong class="command">neutron port-update</strong> command to remove the port from
the instance:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron port-update 731c3b28-3753-4e63-bae3-b58a52d6ccca <span class="se">\</span>
--device_id <span class="s2">&quot;&quot;</span> --device_owner <span class="s2">&quot;&quot;</span> --binding:host_id <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Delete the instance and create a new instance using the
<code class="docutils literal"><span class="pre">--nic</span> <span class="pre">port-id</span></code> option.</p>
</li>
</ol>
<p><strong>Retrieve an IP address when an instance is deleted before detaching
a port</strong></p>
<p>The following procedure is a possible workaround to retrieve an IP address
when an instance has been deleted with the port still attached:</p>
<ol class="arabic">
<li><p class="first">Launch several neutron ports:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="k">for</span> i in <span class="o">{</span><span class="m">0</span>..10<span class="o">}</span><span class="p">;</span> <span class="k">do</span> neutron port-create Public_AGILE --name <span class="se">\</span>
ip-recovery<span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
</li>
<li><p class="first">Check the ports for the lost IP address and update the name:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron port-update 731c3b28-3753-4e63-bae3-b58a52d6ccca <span class="se">\</span>
--name <span class="s2">&quot;don&#39;t delete&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Delete the ports that are not needed:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="k">for</span> port in <span class="k">$(</span>neutron port-list <span class="p">|</span> grep -i ip-recovery <span class="p">|</span> <span class="se">\</span>
awk <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span> neutron port-delete <span class="nv">$port</span><span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
</li>
<li><p class="first">If you still cannot find the lost IP address, repeat these steps
again.</p>
</li>
</ol>
</div>
<div class="section" id="volumes">
<span id="id1"></span><h2>Volumes<a class="headerlink" href="#volumes" title="Permalink to this headline">¶</a></h2>
<p>If the affected instances also had attached volumes, first generate a
list of instance and volume UUIDs:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">nova</span><span class="p">.</span><span class="n">instances</span><span class="p">.</span><span class="n">uuid</span> <span class="k">as</span> <span class="n">instance_uuid</span><span class="p">,</span>
       <span class="n">cinder</span><span class="p">.</span><span class="n">volumes</span><span class="p">.</span><span class="n">id</span> <span class="k">as</span> <span class="n">volume_uuid</span><span class="p">,</span> <span class="n">cinder</span><span class="p">.</span><span class="n">volumes</span><span class="p">.</span><span class="n">status</span><span class="p">,</span>
       <span class="n">cinder</span><span class="p">.</span><span class="n">volumes</span><span class="p">.</span><span class="n">attach_status</span><span class="p">,</span> <span class="n">cinder</span><span class="p">.</span><span class="n">volumes</span><span class="p">.</span><span class="n">mountpoint</span><span class="p">,</span>
       <span class="n">cinder</span><span class="p">.</span><span class="n">volumes</span><span class="p">.</span><span class="n">display_name</span> <span class="k">from</span> <span class="n">cinder</span><span class="p">.</span><span class="n">volumes</span>
       <span class="k">inner</span> <span class="k">join</span> <span class="n">nova</span><span class="p">.</span><span class="n">instances</span> <span class="k">on</span> <span class="n">cinder</span><span class="p">.</span><span class="n">volumes</span><span class="p">.</span><span class="n">instance_uuid</span><span class="o">=</span><span class="n">nova</span><span class="p">.</span><span class="n">instances</span><span class="p">.</span><span class="n">uuid</span>
       <span class="k">where</span> <span class="n">nova</span><span class="p">.</span><span class="n">instances</span><span class="p">.</span><span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;c01.example.com&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>You should see a result similar to the following:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="o">+--------------+------------+-------+--------------+-----------+--------------+</span>
<span class="o">|</span><span class="n">instance_uuid</span> <span class="o">|</span><span class="n">volume_uuid</span> <span class="o">|</span><span class="n">status</span> <span class="o">|</span><span class="n">attach_status</span> <span class="o">|</span><span class="n">mountpoint</span> <span class="o">|</span> <span class="n">display_name</span> <span class="o">|</span>
<span class="o">+--------------+------------+-------+--------------+-----------+--------------+</span>
<span class="o">|</span><span class="mi">9</span><span class="n">b969a05</span>      <span class="o">|</span><span class="mi">1</span><span class="n">f0fbf36</span>    <span class="o">|</span><span class="k">in</span><span class="o">-</span><span class="k">use</span> <span class="o">|</span><span class="n">attached</span>      <span class="o">|/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdc</span>   <span class="o">|</span> <span class="n">test</span>         <span class="o">|</span>
<span class="o">+--------------+------------+-------+--------------+-----------+--------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, manually detach and reattach the volumes, where X is the proper
mount point:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> openstack server remove volume &lt;instance_uuid&gt; &lt;volume_uuid&gt;
<span class="gp">#</span> openstack server add volume &lt;instance_uuid&gt; &lt;volume_uuid&gt; --device /dev/vdX
</pre></div>
</div>
<p>Be sure that the instance has successfully booted and is at a login
screen before doing the above.</p>
</div>
<div class="section" id="total-compute-node-failure">
<h2>Total Compute Node Failure<a class="headerlink" href="#total-compute-node-failure" title="Permalink to this headline">¶</a></h2>
<p>Compute nodes can fail the same way a cloud controller can fail. A
motherboard failure or some other type of hardware failure can cause an
entire compute node to go offline. When this happens, all instances
running on that compute node will not be available. Just like with a
cloud controller failure, if your infrastructure monitoring does not
detect a failed compute node, your users will notify you because of
their lost instances.</p>
<p>If a compute node fails and won&#8217;t be fixed for a few hours (or at all),
you can relaunch all instances that are hosted on the failed node if you
use shared storage for <code class="docutils literal"><span class="pre">/var/lib/nova/instances</span></code>.</p>
<p>To do this, generate a list of instance UUIDs that are hosted on the
failed node by running the following query on the nova database:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">uuid</span> <span class="k">from</span> <span class="n">instances</span>
       <span class="k">where</span> <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;c01.example.com&#39;</span> <span class="k">and</span> <span class="n">deleted</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Next, update the nova database to indicate that all instances that used
to be hosted on c01.example.com are now hosted on c02.example.com:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">instances</span> <span class="kt">set</span> <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;c02.example.com&#39;</span>
       <span class="k">where</span> <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;c01.example.com&#39;</span> <span class="k">and</span> <span class="n">deleted</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>If you&#8217;re using the Networking service ML2 plug-in, update the
Networking service database to indicate that all ports that used to be
hosted on c01.example.com are now hosted on c02.example.com:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">ml2_port_bindings</span> <span class="kt">set</span> <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;c02.example.com&#39;</span>
       <span class="k">where</span> <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;c01.example.com&#39;</span><span class="p">;</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">ml2_port_binding_levels</span> <span class="kt">set</span> <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;c02.example.com&#39;</span>
       <span class="k">where</span> <span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;c01.example.com&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>After that, use the <strong class="command">openstack</strong> command to reboot all instances
that were on c01.example.com while regenerating their XML files at the same
time:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> openstack server reboot --hard &lt;server&gt;
</pre></div>
</div>
<p>Finally, reattach volumes using the same method described in the section
<a class="reference internal" href="#volumes"><span class="std std-ref">Volumes</span></a>.</p>
</div>
<div class="section" id="var-lib-nova-instances">
<h2>/var/lib/nova/instances<a class="headerlink" href="#var-lib-nova-instances" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s worth mentioning this directory in the context of failed compute
nodes. This directory contains the libvirt KVM file-based disk images
for the instances that are hosted on that compute node. If you are not
running your cloud in a shared storage environment, this directory is
unique across all compute nodes.</p>
<p><code class="docutils literal"><span class="pre">/var/lib/nova/instances</span></code> contains two types of directories.</p>
<p>The first is the <code class="docutils literal"><span class="pre">_base</span></code> directory. This contains all the cached base
images from glance for each unique image that has been launched on that
compute node. Files ending in <code class="docutils literal"><span class="pre">_20</span></code> (or a different number) are the
ephemeral base images.</p>
<p>The other directories are titled <code class="docutils literal"><span class="pre">instance-xxxxxxxx</span></code>. These
directories correspond to instances running on that compute node. The
files inside are related to one of the files in the <code class="docutils literal"><span class="pre">_base</span></code> directory.
They&#8217;re essentially differential-based files containing only the changes
made from the original <code class="docutils literal"><span class="pre">_base</span></code> directory.</p>
<p>All files and directories in <code class="docutils literal"><span class="pre">/var/lib/nova/instances</span></code> are uniquely
named. The files in _base are uniquely titled for the glance image that
they are based on, and the directory names <code class="docutils literal"><span class="pre">instance-xxxxxxxx</span></code> are
uniquely titled for that particular instance. For example, if you copy
all data from <code class="docutils literal"><span class="pre">/var/lib/nova/instances</span></code> on one compute node to
another, you do not overwrite any files or cause any damage to images
that have the same unique name, because they are essentially the same
file.</p>
<p>Although this method is not documented or supported, you can use it when
your compute node is permanently offline but you have instances locally
stored on it.</p>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="ops-maintenance-controller.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Cloud Controller and Storage Proxy Failures and Maintenance"></i></a>
          
          
            <a href="ops-maintenance-storage.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Storage Node Failures and Maintenance"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2017-02-14 13:54</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="operations.html">Operations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ops-lay-of-the-land.html">Lay of the Land</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops-projects-users.html">Managing Projects and Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops-user-facing-operations.html">User-Facing Operations</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="ops-maintenance.html">Maintenance, Failures, and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops-network-troubleshooting.html">Network Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops-logging-monitoring.html">Logging and Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops-backup-recovery.html">Backup and Recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops-customize.html">Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops-advanced-configuration.html">Advanced Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops-upgrades.html">Upgrades</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="app-usecases.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="app-crypt.html">Tales From the Cryp^H^H^H^H Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="app-roadmaps.html">Working with Roadmaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="app-resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/app-support.html">Community support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "ops-maintenance-compute" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/openstack-manuals/tree/doc/ops-guide/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 3993c81360ea23a2e599faf5f3de0d288b10c20a";
        var bugProject = "openstack-manuals";
        var bugTitle = "Compute Node Failures and Maintenance in Operations Guide";
    var fieldTags = "ops-guide";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.0.1 on 2017-02-14 13:54";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>