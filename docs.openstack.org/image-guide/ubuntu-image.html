<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Example: Ubuntu image</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">
<link href="_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Example: Ubuntu image</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="centos-image.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Example: CentOS image"></i></a>
    
    
    <a href="fedora-image.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Example: Fedora image"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2017-02-14 08:41</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Example: Ubuntu image</a><ul>
<li><a class="reference internal" href="#download-an-ubuntu-installation-iso">Download an Ubuntu installation ISO</a></li>
<li><a class="reference internal" href="#start-the-installation-process">Start the installation process</a></li>
<li><a class="reference internal" href="#step-through-the-installation">Step through the installation</a></li>
<li><a class="reference internal" href="#hostname">Hostname</a></li>
<li><a class="reference internal" href="#select-a-mirror">Select a mirror</a></li>
<li><a class="reference internal" href="#step-through-the-install">Step through the install</a></li>
<li><a class="reference internal" href="#partition-the-disks">Partition the disks</a></li>
<li><a class="reference internal" href="#automatic-updates">Automatic updates</a></li>
<li><a class="reference internal" href="#software-selection-openssh-server">Software selection: OpenSSH server</a></li>
<li><a class="reference internal" href="#install-grub-boot-loader">Install GRUB boot loader</a></li>
<li><a class="reference internal" href="#detach-the-cd-rom-and-reboot">Detach the CD-ROM and reboot</a></li>
<li><a class="reference internal" href="#log-in-to-newly-created-image">Log in to newly created image</a></li>
<li><a class="reference internal" href="#install-cloud-init">Install cloud-init</a></li>
<li><a class="reference internal" href="#shut-down-the-instance">Shut down the instance</a></li>
<li><a class="reference internal" href="#clean-up-remove-mac-address-details">Clean up (remove MAC address details)</a></li>
<li><a class="reference internal" href="#undefine-the-libvirt-domain">Undefine the libvirt domain</a></li>
<li><a class="reference internal" href="#image-is-complete">Image is complete</a></li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="example-ubuntu-image">
<h1>Example: Ubuntu image<a class="headerlink" href="#example-ubuntu-image" title="Permalink to this headline">¶</a></h1>
<p>This example installs an Ubuntu 14.04 (Trusty Tahr) image.
To create an image for a different version of Ubuntu,
follow these steps with the noted differences.</p>
<div class="section" id="download-an-ubuntu-installation-iso">
<h2>Download an Ubuntu installation ISO<a class="headerlink" href="#download-an-ubuntu-installation-iso" title="Permalink to this headline">¶</a></h2>
<p>Because the goal is to make the smallest possible base image,
this example uses the network installation ISO.
The Ubuntu 64-bit 14.04 network installation ISO is at the <a class="reference external" href="http://archive.ubuntu.com/ubuntu/dists/trusty/main/installer-amd64/current/images/netboot/mini.iso">Ubuntu download
page</a>.</p>
</div>
<div class="section" id="start-the-installation-process">
<h2>Start the installation process<a class="headerlink" href="#start-the-installation-process" title="Permalink to this headline">¶</a></h2>
<p>Start the installation process by using either <strong class="command">virt-manager</strong>
or <strong class="command">virt-install</strong> as described in the previous section.
If you use <strong class="command">virt-install</strong>, do not forget to connect
your VNC client to the virtual machine.</p>
<p>Assume that the name of your virtual machine image is <code class="docutils literal"><span class="pre">ubuntu-14.04</span></code>,
which you need to know when you use <strong class="command">virsh</strong> commands
to manipulate the state of the image.</p>
<p>If you are using <strong class="command">virt-manager</strong>,
the commands should look something like this:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> qemu-img create -f qcow2 /tmp/trusty.qcow2 10G
<span class="gp">#</span> virt-install --virt-type kvm --name trusty --ram <span class="m">1024</span> <span class="se">\</span>
  --cdrom<span class="o">=</span>/data/isos/trusty-64-mini.iso <span class="se">\</span>
  --disk /tmp/trusty.qcow2,format<span class="o">=</span>qcow2 <span class="se">\</span>
  --network <span class="nv">network</span><span class="o">=</span>default <span class="se">\</span>
  --graphics vnc,listen<span class="o">=</span><span class="m">0</span>.0.0.0 --noautoconsole <span class="se">\</span>
  --os-type<span class="o">=</span>linux --os-variant<span class="o">=</span>ubuntutrusty
</pre></div>
</div>
</div>
<div class="section" id="step-through-the-installation">
<h2>Step through the installation<a class="headerlink" href="#step-through-the-installation" title="Permalink to this headline">¶</a></h2>
<p>At the initial Installer boot menu, choose the <span class="guilabel">Install</span> option.
Step through the installation prompts, the defaults should be fine.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/ubuntu-install.png"><img alt="_images/ubuntu-install.png" src="_images/ubuntu-install.png" style="width: 100%;" /></a>
</div>
</div>
<div class="section" id="hostname">
<h2>Hostname<a class="headerlink" href="#hostname" title="Permalink to this headline">¶</a></h2>
<p>The installer may ask you to choose a host name.
The default (<code class="docutils literal"><span class="pre">ubuntu</span></code>) is fine. We will install the cloud-init
package later, which will set the host name on boot when a new
instance is provisioned using this image.</p>
</div>
<div class="section" id="select-a-mirror">
<h2>Select a mirror<a class="headerlink" href="#select-a-mirror" title="Permalink to this headline">¶</a></h2>
<p>The default mirror proposed by the installer should be fine.</p>
</div>
<div class="section" id="step-through-the-install">
<h2>Step through the install<a class="headerlink" href="#step-through-the-install" title="Permalink to this headline">¶</a></h2>
<p>Step through the install, using the default options.
When prompted for a user name, the default (<code class="docutils literal"><span class="pre">ubuntu</span></code>) is fine.</p>
</div>
<div class="section" id="partition-the-disks">
<h2>Partition the disks<a class="headerlink" href="#partition-the-disks" title="Permalink to this headline">¶</a></h2>
<p>There are different options for partitioning the disks.
The default installation will use LVM partitions, and will create
three partitions (<code class="docutils literal"><span class="pre">/boot</span></code>, <code class="docutils literal"><span class="pre">/</span></code>, swap), and this will work fine.
Alternatively, you may wish to create a single ext4 partition,
mounted to &#8220;<code class="docutils literal"><span class="pre">/</span></code>&#8221;, should also work fine.</p>
<p>If unsure, we recommend you use the installer&#8217;s default partition
scheme, since there is no clear advantage to one scheme or another.</p>
</div>
<div class="section" id="automatic-updates">
<h2>Automatic updates<a class="headerlink" href="#automatic-updates" title="Permalink to this headline">¶</a></h2>
<p>The Ubuntu installer will ask how you want to manage upgrades
on your system. This option depends on your specific use case.
If your virtual machine instances will be connected to the
Internet, we recommend &#8220;Install security updates automatically&#8221;.</p>
</div>
<div class="section" id="software-selection-openssh-server">
<h2>Software selection: OpenSSH server<a class="headerlink" href="#software-selection-openssh-server" title="Permalink to this headline">¶</a></h2>
<p>Choose <span class="guilabel">OpenSSH server</span> so that you will be able to SSH into
the virtual machine when it launches inside of an OpenStack cloud.</p>
<div class="figure">
<img alt="_images/ubuntu-software-selection.png" src="_images/ubuntu-software-selection.png" />
</div>
</div>
<div class="section" id="install-grub-boot-loader">
<h2>Install GRUB boot loader<a class="headerlink" href="#install-grub-boot-loader" title="Permalink to this headline">¶</a></h2>
<p>Select <span class="guilabel">Yes</span> when asked about installing the GRUB boot loader
to the master boot record.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/ubuntu-grub.png"><img alt="_images/ubuntu-grub.png" src="_images/ubuntu-grub.png" style="width: 100%;" /></a>
</div>
<p>For more information on configuring Grub, see the section
called &#8220;<a class="reference internal" href="openstack-images.html#write-to-console"><span class="std std-ref">Ensure image writes boot log to console</span></a>&#8221;.</p>
</div>
<div class="section" id="detach-the-cd-rom-and-reboot">
<h2>Detach the CD-ROM and reboot<a class="headerlink" href="#detach-the-cd-rom-and-reboot" title="Permalink to this headline">¶</a></h2>
<p>Select the defaults for all of the remaining options. When the
installation is complete, you will be prompted to remove the CD-ROM.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/ubuntu-finished.png"><img alt="_images/ubuntu-finished.png" src="_images/ubuntu-finished.png" style="width: 100%;" /></a>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is a known bug in Ubuntu 14.04; when you select <code class="docutils literal"><span class="pre">Continue</span></code>,
the virtual machine will shut down, even though it says it will reboot.</p>
</div>
<p>To eject a disk using <strong class="command">virsh</strong>, libvirt requires that
you attach an empty disk at the same target that the CDROM
was previously attached, which should be <code class="docutils literal"><span class="pre">hdc</span></code>.
You can confirm the appropriate target using the
<strong class="command">virsh dumpxml vm-image</strong> command.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> virsh dumpxml trusty
<span class="go">&lt;domain type=&#39;kvm&#39;&gt;</span>
<span class="go">  &lt;name&gt;trusty&lt;/name&gt;</span>
<span class="go">...</span>
<span class="go">    &lt;disk type=&#39;block&#39; device=&#39;cdrom&#39;&gt;</span>
<span class="go">    &lt;driver name=&#39;qemu&#39; type=&#39;raw&#39;/&gt;</span>
<span class="go">    &lt;target dev=&#39;hdc&#39; bus=&#39;ide&#39;/&gt;</span>
<span class="go">    &lt;readonly/&gt;</span>
<span class="go">    &lt;address type=&#39;drive&#39; controller=&#39;0&#39; bus=&#39;1&#39; target=&#39;0&#39; unit=&#39;0&#39;/&gt;</span>
<span class="go">  &lt;/disk&gt;</span>
<span class="go">...</span>
<span class="go">&lt;/domain&gt;</span>
</pre></div>
</div>
<p>Run the following commands in the host as root to start up
the machine again as paused, eject the disk and resume.
If you are using <code class="docutils literal"><span class="pre">virt-manager</span></code>, you may use the GUI instead.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> virsh start trusty --paused
<span class="gp">#</span> virsh attach-disk --type cdrom --mode <span class="nb">readonly</span> trusty <span class="s2">&quot;&quot;</span> hdc
<span class="gp">#</span> virsh resume trusty
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the previous example, you paused the instance, ejected
the disk, and unpaused the instance. In theory, you could have
ejected the disk at the <span class="guilabel">Installation complete</span> screen.
However, our testing indicates that the Ubuntu installer
locks the drive so that it cannot be ejected at that point.</p>
</div>
</div>
<div class="section" id="log-in-to-newly-created-image">
<h2>Log in to newly created image<a class="headerlink" href="#log-in-to-newly-created-image" title="Permalink to this headline">¶</a></h2>
<p>When you boot for the first time after install, it may ask
you about authentication tools, you can just choose <span class="guilabel">Exit</span>.
Then, log in as root using the root password you specified.</p>
</div>
<div class="section" id="install-cloud-init">
<h2>Install cloud-init<a class="headerlink" href="#install-cloud-init" title="Permalink to this headline">¶</a></h2>
<p>The <strong class="command">cloud-init</strong> script starts on instance boot and
will search for a metadata provider to fetch a public key from.
The public key will be placed in the default user account for the image.</p>
<p>Install the <code class="docutils literal"><span class="pre">cloud-init</span></code> package:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> apt-get install cloud-init
</pre></div>
</div>
<p>When building Ubuntu images <strong class="command">cloud-init</strong> must be
explicitly configured for the metadata source in use.
The OpenStack metadata server emulates the EC2 metadata
service used by images in Amazon EC2.</p>
<p>To set the metadata source to be used by the image run the
<strong class="command">dpkg-reconfigure</strong> command against the <code class="docutils literal"><span class="pre">cloud-init</span></code>
package. When prompted select the <span class="guilabel">EC2</span> data source:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> dpkg-reconfigure cloud-init
</pre></div>
</div>
<p>The account varies by distribution.
On Ubuntu-based virtual machines, the account is called <code class="docutils literal"><span class="pre">ubuntu</span></code>.
On Fedora-based virtual machines, the account is called <code class="docutils literal"><span class="pre">ec2-user</span></code>.</p>
<p>You can change the name of the account used by cloud-init by editing the
<code class="docutils literal"><span class="pre">/etc/cloud/cloud.cfg</span></code> file and adding a line with a different user.
For example, to configure cloud-init to put the key in an account named
<code class="docutils literal"><span class="pre">admin</span></code>, edit the config file so it has the line:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">user: admin</span>
</pre></div>
</div>
</div>
<div class="section" id="shut-down-the-instance">
<h2>Shut down the instance<a class="headerlink" href="#shut-down-the-instance" title="Permalink to this headline">¶</a></h2>
<p>From inside the instance, as root:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> /sbin/shutdown -h now
</pre></div>
</div>
</div>
<div class="section" id="clean-up-remove-mac-address-details">
<h2>Clean up (remove MAC address details)<a class="headerlink" href="#clean-up-remove-mac-address-details" title="Permalink to this headline">¶</a></h2>
<p>The operating system records the MAC address of the virtual Ethernet
card in locations such as <code class="docutils literal"><span class="pre">/etc/udev/rules.d/70-persistent-net.rules</span></code>
during the installation process. However, each time the image boots up,
the virtual Ethernet card will have a different MAC address,
so this information must be deleted from the configuration file.</p>
<p>There is a utility called <strong class="command">virt-sysprep</strong>, that performs
various cleanup tasks such as removing the MAC address references.
It will clean up a virtual machine image in place:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> virt-sysprep -d trusty
</pre></div>
</div>
</div>
<div class="section" id="undefine-the-libvirt-domain">
<h2>Undefine the libvirt domain<a class="headerlink" href="#undefine-the-libvirt-domain" title="Permalink to this headline">¶</a></h2>
<p>Now that the image is ready to be uploaded to the Image service,
you no longer need to have this virtual machine image managed by libvirt.
Use the <strong class="command">virsh undefine vm-image</strong> command to inform libvirt:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> virsh undefine trusty
</pre></div>
</div>
</div>
<div class="section" id="image-is-complete">
<h2>Image is complete<a class="headerlink" href="#image-is-complete" title="Permalink to this headline">¶</a></h2>
<p>The underlying image file that you created with the
<strong class="command">qemu-img create</strong> command, such as <code class="docutils literal"><span class="pre">/tmp/trusty.qcow2</span></code>,
is now ready for uploading to the Image service by using the
<strong class="command">openstack image create</strong> command. For more information, see the
<a class="reference external" href="https://docs.openstack.org/user-guide/common/cli-manage-images.html#create-or-update-an-image-glance">Create or update an image</a>.</p>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="centos-image.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Example: CentOS image"></i></a>
          
          
            <a href="fedora-image.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Example: Fedora image"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2017-02-14 08:41</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="obtain-images.html">Get images</a></li>
<li class="toctree-l1"><a class="reference internal" href="openstack-images.html">Image requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="modify-images.html">Modify images</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="create-images-manually.html">Create images manually</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="net-running.html">Verify the libvirt default network is running</a></li>
<li class="toctree-l2"><a class="reference internal" href="virt-manager.html">Use the virt-manager X11 GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="virt-install.html">Use virt-install and connect by using a local VNC client</a></li>
<li class="toctree-l2"><a class="reference internal" href="centos-image.html">Example: CentOS image</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Example: Ubuntu image</a></li>
<li class="toctree-l2"><a class="reference internal" href="fedora-image.html">Example: Fedora image</a></li>
<li class="toctree-l2"><a class="reference internal" href="windows-image.html">Example: Microsoft Windows image</a></li>
<li class="toctree-l2"><a class="reference internal" href="freebsd-image.html">Example: FreeBSD image</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="create-images-automatically.html">Tool support for image creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="convert-images.html">Converting between image formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="share-images.html">Image sharing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/app-support.html">Community support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "ubuntu-image" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/openstack-manuals/tree/doc/image-guide/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 0719207c6d82d2c215b9c13234f3a27478e0c0f3";
        var bugProject = "openstack-manuals";
        var bugTitle = "Example: Ubuntu image in Virtual Machine Image Guide";
    var fieldTags = "image-guide";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.9 on 2017-02-14 08:41";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>