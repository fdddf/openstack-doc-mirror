<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The oslo_db.sqlalchemy.utils Module &mdash; oslo.db 4.17.1.dev11 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.17.1.dev11',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="oslo.db 4.17.1.dev11 documentation" href="../index.html" />
    <link rel="up" title="&lt;no title&gt;" href="autoindex.html" />
    <link rel="prev" title="The oslo_db.sqlalchemy.update_match Module" href="oslo_db.sqlalchemy.update_match.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-oslo_db.sqlalchemy.utils">
<span id="the-oslo-db-sqlalchemy-utils-module"></span><h1>The <a class="reference internal" href="#module-oslo_db.sqlalchemy.utils" title="oslo_db.sqlalchemy.utils"><code class="xref py py-mod docutils literal"><span class="pre">oslo_db.sqlalchemy.utils</span></code></a> Module<a class="headerlink" href="#module-oslo_db.sqlalchemy.utils" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="oslo_db.sqlalchemy.utils.DialectFunctionDispatcher">
<em class="property">class </em><code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">DialectFunctionDispatcher</code><a class="headerlink" href="#oslo_db.sqlalchemy.utils.DialectFunctionDispatcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<dl class="method">
<dt id="oslo_db.sqlalchemy.utils.DialectFunctionDispatcher.dispatch_for">
<code class="descname">dispatch_for</code><span class="sig-paren">(</span><em>expr</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.DialectFunctionDispatcher.dispatch_for" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="oslo_db.sqlalchemy.utils.DialectFunctionDispatcher.dispatch_for_dialect">
<em class="property">classmethod </em><code class="descname">dispatch_for_dialect</code><span class="sig-paren">(</span><em>expr</em>, <em>multiple=False</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.DialectFunctionDispatcher.dispatch_for_dialect" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide dialect-specific functionality within distinct functions.</p>
<p>e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@dispatch_for_dialect</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_special_option</span><span class="p">(</span><span class="n">engine</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@set_special_option.dispatch_for</span><span class="p">(</span><span class="s2">&quot;sqlite&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_sqlite_special_option</span><span class="p">(</span><span class="n">engine</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;sqlite thing&quot;</span><span class="p">)</span>

<span class="nd">@set_special_option.dispatch_for</span><span class="p">(</span><span class="s2">&quot;mysql+mysqldb&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_mysqldb_special_option</span><span class="p">(</span><span class="n">engine</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;mysqldb thing&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>After the above registration, the <code class="docutils literal"><span class="pre">set_special_option()</span></code> function
is now a dispatcher, given a SQLAlchemy <code class="docutils literal"><span class="pre">Engine</span></code>, <code class="docutils literal"><span class="pre">Connection</span></code>,
URL string, or <code class="docutils literal"><span class="pre">sqlalchemy.engine.URL</span></code> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">eng</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">set_special_option</span><span class="p">(</span><span class="n">eng</span><span class="p">)</span>
</pre></div>
</div>
<p>The filter system supports two modes, &#8220;multiple&#8221; and &#8220;single&#8221;.
The default is &#8220;single&#8221;, and requires that one and only one function
match for a given backend.    In this mode, the function may also
have a return value, which will be returned by the top level
call.</p>
<p>&#8220;multiple&#8221; mode, on the other hand, does not support return
arguments, but allows for any number of matching functions, where
each function will be called:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># the initial call sets this up as a &quot;multiple&quot; dispatcher
@dispatch_for_dialect(&quot;*&quot;, multiple=True)
def set_options(engine):
    # set options that apply to *all* engines

@set_options.dispatch_for(&quot;postgresql&quot;)
def set_postgresql_options(engine):
    # set options that apply to all Postgresql engines

@set_options.dispatch_for(&quot;postgresql+psycopg2&quot;)
def set_postgresql_psycopg2_options(engine):
    # set options that apply only to &quot;postgresql+psycopg2&quot;

@set_options.dispatch_for(&quot;*+pyodbc&quot;)
def set_pyodbc_options(engine):
    # set options that apply to all pyodbc backends
</pre></div>
</div>
<p>Note that in both modes, any number of additional arguments can be
accepted by member functions.  For example, to populate a dictionary of
options, it may be passed in:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@dispatch_for_dialect</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_engine_options</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@set_engine_options.dispatch_for</span><span class="p">(</span><span class="s2">&quot;mysql+mysqldb&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_mysql_set_default_charset_to_utf8</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;charset&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="nd">@set_engine_options.dispatch_for</span><span class="p">(</span><span class="s2">&quot;sqlite&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_set_sqlite_in_memory_check_same_thread</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">database</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;memory&#39;</span><span class="p">):</span>
        <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;check_same_thread&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">opts</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">set_engine_options</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</pre></div>
</div>
<p>The driver specifiers are of the form:
<code class="docutils literal"><span class="pre">&lt;database</span> <span class="pre">|</span> <span class="pre">*&gt;[+&lt;driver</span> <span class="pre">|</span> <span class="pre">*&gt;]</span></code>.   That is, database name or &#8220;*&#8221;,
followed by an optional <code class="docutils literal"><span class="pre">+</span></code> sign with driver or &#8220;*&#8221;.   Omitting
the driver name implies all drivers for that database.</p>
</dd></dl>

<dl class="method">
<dt id="oslo_db.sqlalchemy.utils.DialectFunctionDispatcher.dispatch_on_drivername">
<code class="descname">dispatch_on_drivername</code><span class="sig-paren">(</span><em>drivername</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.DialectFunctionDispatcher.dispatch_on_drivername" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a sub-dispatcher for the given drivername.</p>
<p>This provides a means of calling a different function, such as the
&#8220;*&#8221; function, for a given target object that normally refers
to a sub-function.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="oslo_db.sqlalchemy.utils.DialectMultiFunctionDispatcher">
<em class="property">class </em><code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">DialectMultiFunctionDispatcher</code><a class="headerlink" href="#oslo_db.sqlalchemy.utils.DialectMultiFunctionDispatcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#oslo_db.sqlalchemy.utils.DialectFunctionDispatcher" title="oslo_db.sqlalchemy.utils.DialectFunctionDispatcher"><code class="xref py py-class docutils literal"><span class="pre">oslo_db.sqlalchemy.utils.DialectFunctionDispatcher</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="oslo_db.sqlalchemy.utils.DialectSingleFunctionDispatcher">
<em class="property">class </em><code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">DialectSingleFunctionDispatcher</code><a class="headerlink" href="#oslo_db.sqlalchemy.utils.DialectSingleFunctionDispatcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#oslo_db.sqlalchemy.utils.DialectFunctionDispatcher" title="oslo_db.sqlalchemy.utils.DialectFunctionDispatcher"><code class="xref py py-class docutils literal"><span class="pre">oslo_db.sqlalchemy.utils.DialectFunctionDispatcher</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="oslo_db.sqlalchemy.utils.InsertFromSelect">
<em class="property">class </em><code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">InsertFromSelect</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.InsertFromSelect" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Form the base for <cite>INSERT INTO table (SELECT ... )</cite> statement.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>table</strong> &#8211; table to insert records</li>
<li><strong>select</strong> &#8211; select query</li>
<li><strong>cols</strong> &#8211; list of columns to specify in insert clause</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">SQLAlchemy <code class="xref py py-class docutils literal"><span class="pre">Insert</span></code> object instance</p>
</td>
</tr>
</tbody>
</table>
<p>Usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">table_from</span><span class="p">)</span>
<span class="n">insert</span> <span class="o">=</span> <span class="n">InsertFromSelect</span><span class="p">(</span><span class="n">table_to</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span>
                          <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;insert_date&#39;</span><span class="p">])</span>
<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingConnectable">
<em class="property">class </em><code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">NonCommittingConnectable</code><span class="sig-paren">(</span><em>connection</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingConnectable" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>A <code class="docutils literal"><span class="pre">Connectable</span></code> substitute which rolls all operations back.</p>
<p><code class="docutils literal"><span class="pre">NonCommittingConnectable</span></code> forms the basis of mock
<code class="docutils literal"><span class="pre">Engine</span></code> and <code class="docutils literal"><span class="pre">Connection</span></code> objects within a test.   It provides
only that part of the API that should reasonably be used within
a single-connection test environment (e.g. no engine.dispose(),
connection.invalidate(), etc. ).   The connection runs both within
a transaction as well as a savepoint.   The transaction is there
so that any operations upon the connection can be rolled back.
If the test calls begin(), a &#8220;pseduo&#8221; transaction is returned that
won&#8217;t actually commit anything.   The subtransaction is there to allow
a test to successfully call rollback(), however, where all operations
to that point will be rolled back and the operations can continue,
simulating a real rollback while still remaining within a transaction
external to the test.</p>
<dl class="method">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingConnectable.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><em>obj</em>, <em>*multiparams</em>, <em>**params</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingConnectable.execute" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes the given construct and returns a <code class="xref py py-class docutils literal"><span class="pre">ResultProxy</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingConnectable.scalar">
<code class="descname">scalar</code><span class="sig-paren">(</span><em>obj</em>, <em>*multiparams</em>, <em>**params</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingConnectable.scalar" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes and returns the first column of the first row.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingConnection">
<em class="property">class </em><code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">NonCommittingConnection</code><span class="sig-paren">(</span><em>connection</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingConnection" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#oslo_db.sqlalchemy.utils.NonCommittingConnectable" title="oslo_db.sqlalchemy.utils.NonCommittingConnectable"><code class="xref py py-class docutils literal"><span class="pre">oslo_db.sqlalchemy.utils.NonCommittingConnectable</span></code></a></p>
<p><code class="docutils literal"><span class="pre">Connection</span></code> -specific non committing connectbale.</p>
<dl class="method">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingConnection.begin">
<code class="descname">begin</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingConnection.begin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingConnection.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingConnection.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close the &#8216;Connection&#8217;.</p>
<p>In this context, close() is a no-op.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingEngine">
<em class="property">class </em><code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">NonCommittingEngine</code><span class="sig-paren">(</span><em>connection</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingEngine" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#oslo_db.sqlalchemy.utils.NonCommittingConnectable" title="oslo_db.sqlalchemy.utils.NonCommittingConnectable"><code class="xref py py-class docutils literal"><span class="pre">oslo_db.sqlalchemy.utils.NonCommittingConnectable</span></code></a></p>
<p><code class="docutils literal"><span class="pre">Engine</span></code> -specific non committing connectbale.</p>
<dl class="method">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingEngine.begin">
<code class="descname">begin</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingEngine.begin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingEngine.connect">
<code class="descname">connect</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingEngine.connect" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingEngine.engine">
<code class="descname">engine</code><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingEngine.engine" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingEngine.url">
<code class="descname">url</code><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingEngine.url" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingTransaction">
<em class="property">class </em><code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">NonCommittingTransaction</code><span class="sig-paren">(</span><em>provisioned</em>, <em>transaction</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingTransaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>A wrapper for <code class="docutils literal"><span class="pre">Transaction</span></code>.</p>
<p>This is to accommodate being able to guaranteed start a new
SAVEPOINT when a transaction is rolled back.</p>
<dl class="method">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingTransaction.commit">
<code class="descname">commit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingTransaction.commit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="oslo_db.sqlalchemy.utils.NonCommittingTransaction.rollback">
<code class="descname">rollback</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.NonCommittingTransaction.rollback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.add_index">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">add_index</code><span class="sig-paren">(</span><em>engine</em>, <em>table_name</em>, <em>index_name</em>, <em>idx_columns</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.add_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an index for given columns.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>engine</strong> &#8211; sqlalchemy engine</li>
<li><strong>table_name</strong> &#8211; name of the table</li>
<li><strong>index_name</strong> &#8211; name of the index</li>
<li><strong>idx_columns</strong> &#8211; tuple with names of columns that will be indexed</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.change_deleted_column_type_to_boolean">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">change_deleted_column_type_to_boolean</code><span class="sig-paren">(</span><em>engine</em>, <em>table_name</em>, <em>**col_name_col_instance</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.change_deleted_column_type_to_boolean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.change_deleted_column_type_to_id_type">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">change_deleted_column_type_to_id_type</code><span class="sig-paren">(</span><em>engine</em>, <em>table_name</em>, <em>**col_name_col_instance</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.change_deleted_column_type_to_id_type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.change_index_columns">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">change_index_columns</code><span class="sig-paren">(</span><em>engine</em>, <em>table_name</em>, <em>index_name</em>, <em>new_columns</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.change_index_columns" title="Permalink to this definition">¶</a></dt>
<dd><p>Change set of columns that are indexed by given index.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>engine</strong> &#8211; sqlalchemy engine</li>
<li><strong>table_name</strong> &#8211; name of the table</li>
<li><strong>index_name</strong> &#8211; name of the index</li>
<li><strong>new_columns</strong> &#8211; tuple with names of columns that will be indexed</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.column_exists">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">column_exists</code><span class="sig-paren">(</span><em>engine</em>, <em>table_name</em>, <em>column</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.column_exists" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if table has given column.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>engine</strong> &#8211; sqlalchemy engine</li>
<li><strong>table_name</strong> &#8211; name of the table</li>
<li><strong>column</strong> &#8211; name of the colmn</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.drop_index">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">drop_index</code><span class="sig-paren">(</span><em>engine</em>, <em>table_name</em>, <em>index_name</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.drop_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Drop index with given name.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>engine</strong> &#8211; sqlalchemy engine</li>
<li><strong>table_name</strong> &#8211; name of the table</li>
<li><strong>index_name</strong> &#8211; name of the index</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.drop_old_duplicate_entries_from_table">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">drop_old_duplicate_entries_from_table</code><span class="sig-paren">(</span><em>engine</em>, <em>table_name</em>, <em>use_soft_delete</em>, <em>*uc_column_names</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.drop_old_duplicate_entries_from_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Drop all old rows having the same values for columns in uc_columns.</p>
<p>This method drop (or mark ad <cite>deleted</cite> if use_soft_delete is True) old
duplicate rows form table with name <cite>table_name</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>engine</strong> &#8211; Sqlalchemy engine</li>
<li><strong>table_name</strong> &#8211; Table with duplicates</li>
<li><strong>use_soft_delete</strong> &#8211; If True - values will be marked as <cite>deleted</cite>,
if False - values will be removed from table</li>
<li><strong>uc_column_names</strong> &#8211; Unique constraint columns</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.get_connect_string">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">get_connect_string</code><span class="sig-paren">(</span><em>backend</em>, <em>database</em>, <em>user=None</em>, <em>passwd=None</em>, <em>host='localhost'</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.get_connect_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Get database connection</p>
<p>Try to get a connection with a very specific set of values, if we get
these then we&#8217;ll run the tests, otherwise they are skipped</p>
<p>DEPRECATED: this function is deprecated and will be removed from oslo_db
in a few releases. Please use the provisioning system for dealing
with URLs and database provisioning.</p>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.get_db_connection_info">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">get_db_connection_info</code><span class="sig-paren">(</span><em>conn_pieces</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.get_db_connection_info" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.get_indexes">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">get_indexes</code><span class="sig-paren">(</span><em>engine</em>, <em>table_name</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.get_indexes" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all index list from a given table.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>engine</strong> &#8211; sqlalchemy engine</li>
<li><strong>table_name</strong> &#8211; name of the table</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.get_non_innodb_tables">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">get_non_innodb_tables</code><span class="sig-paren">(</span><em>connectable</em>, <em>skip_tables=('migrate_version'</em>, <em>'alembic_version')</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.get_non_innodb_tables" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of tables which don&#8217;t use InnoDB storage engine.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>connectable</strong> &#8211; a SQLAlchemy Engine or a Connection instance</li>
<li><strong>skip_tables</strong> &#8211; a list of tables which might have a different
storage engine</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.get_table">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">get_table</code><span class="sig-paren">(</span><em>engine</em>, <em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.get_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an sqlalchemy table dynamically from db.</p>
<p>Needed because the models don&#8217;t work for us in migrations
as models will be far out of sync with the current data.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not use this method when creating ForeignKeys in database migrations
because sqlalchemy needs the same MetaData object to hold information
about the parent table and the reference table in the ForeignKey. This
method uses a unique MetaData object per table object so it won&#8217;t work
with ForeignKey creation.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.get_unique_keys">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">get_unique_keys</code><span class="sig-paren">(</span><em>model</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.get_unique_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of sets of unique model keys.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>model</strong> &#8211; the ORM model class</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list of sets of strings</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">unique model keys or None if unable to find them</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.index_exists">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">index_exists</code><span class="sig-paren">(</span><em>engine</em>, <em>table_name</em>, <em>index_name</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.index_exists" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if given index exists.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>engine</strong> &#8211; sqlalchemy engine</li>
<li><strong>table_name</strong> &#8211; name of the table</li>
<li><strong>index_name</strong> &#8211; name of the index</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.index_exists_on_columns">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">index_exists_on_columns</code><span class="sig-paren">(</span><em>engine</em>, <em>table_name</em>, <em>columns</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.index_exists_on_columns" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if an index on given columns exists.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>engine</strong> &#8211; sqlalchemy engine</li>
<li><strong>table_name</strong> &#8211; name of the table</li>
<li><strong>columns</strong> &#8211; a list type of columns that will be checked</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.is_backend_avail">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">is_backend_avail</code><span class="sig-paren">(</span><em>backend</em>, <em>database</em>, <em>user=None</em>, <em>passwd=None</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.is_backend_avail" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if the given backend is available.</p>
<p>DEPRECATED: this function is deprecated and will be removed from oslo_db
in a few releases. Please use the provisioning system to access
databases based on backend availability.</p>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.model_query">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">model_query</code><span class="sig-paren">(</span><em>model</em>, <em>session</em>, <em>args=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.model_query" title="Permalink to this definition">¶</a></dt>
<dd><p>Query helper for db.sqlalchemy api methods.</p>
<p>This accounts for <cite>deleted</cite> and <cite>project_id</cite> fields.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>model</strong> (<a class="reference internal" href="oslo_db.sqlalchemy.models.html#oslo_db.sqlalchemy.models.ModelBase" title="oslo_db.sqlalchemy.models.ModelBase"><em>models.ModelBase</em></a>) &#8211; Model to query. Must be a subclass of ModelBase.</li>
<li><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) &#8211; The session to use.</li>
<li><strong>args</strong> (<em>tuple</em>) &#8211; Arguments to query. If None - model is used.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Keyword arguments:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>project_id</strong> (<em>iterable,
model.__table__.columns.project_id.type,
None type</em>) &#8211; If present, allows filtering by project_id(s).
Can be either a project_id value, or an iterable of
project_id values, or None. If an iterable is passed,
only rows whose project_id column value is on the
<cite>project_id</cite> list will be returned. If None is passed,
only rows which are not bound to any project, will be
returned.</li>
<li><strong>deleted</strong> (<em>bool</em>) &#8211; If present, allows filtering by deleted field.
If True is passed, only deleted entries will be
returned, if False - only existing entries.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">oslo_db.sqlalchemy</span> <span class="kn">import</span> <span class="n">utils</span>


<span class="k">def</span> <span class="nf">get_instance_by_uuid</span><span class="p">(</span><span class="n">uuid</span><span class="p">):</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">get_session</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">model_query</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Instance</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
                     <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Instance</span><span class="o">.</span><span class="n">uuid</span> <span class="o">==</span> <span class="n">uuid</span><span class="p">)</span>
                     <span class="o">.</span><span class="n">first</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">get_nodes_stat</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">Node</span><span class="o">.</span><span class="n">cpu</span><span class="p">,</span> <span class="n">Node</span><span class="o">.</span><span class="n">ram</span><span class="p">,</span> <span class="n">Node</span><span class="o">.</span><span class="n">hdd</span><span class="p">)</span>

    <span class="n">session</span> <span class="o">=</span> <span class="n">get_session</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">model_query</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p>Also you can create your own helper, based on <code class="docutils literal"><span class="pre">utils.model_query()</span></code>.
For example, it can be useful if you plan to use <code class="docutils literal"><span class="pre">project_id</span></code> and
<code class="docutils literal"><span class="pre">deleted</span></code> parameters from project&#8217;s <code class="docutils literal"><span class="pre">context</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">oslo_db.sqlalchemy</span> <span class="kn">import</span> <span class="n">utils</span>


<span class="k">def</span> <span class="nf">_model_query</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">project_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">project_only</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">read_deleted</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="c1"># We suppose, that functions ``_get_project_id()`` and</span>
    <span class="c1"># ``_get_deleted()`` should handle passed parameters and</span>
    <span class="c1"># context object (for example, decide, if we need to restrict a user</span>
    <span class="c1"># to query his own entries by project_id or only allow admin to read</span>
    <span class="c1"># deleted entries). For return values, we expect to get</span>
    <span class="c1"># ``project_id`` and ``deleted``, which are suitable for the</span>
    <span class="c1"># ``model_query()`` signature.</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">project_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;project_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_project_id</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span>
                                               <span class="n">project_only</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">read_deleted</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;deleted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_deleted_dict</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">read_deleted</span><span class="p">)</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">session</span> <span class="ow">or</span> <span class="n">get_session</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">model_query</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                                 <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_instance_by_uuid</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">_model_query</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Instance</span><span class="p">,</span> <span class="n">read_deleted</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Instance</span><span class="o">.</span><span class="n">uuid</span> <span class="o">==</span> <span class="n">uuid</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">first</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">get_nodes_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">project_only</span><span class="o">=</span><span class="s1">&#39;allow_none&#39;</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">Node</span><span class="o">.</span><span class="n">cpu</span><span class="p">,</span> <span class="n">Node</span><span class="o">.</span><span class="n">ram</span><span class="p">,</span> <span class="n">Node</span><span class="o">.</span><span class="n">hdd</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">_model_query</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">Node</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span>
                         <span class="n">project_only</span><span class="o">=</span><span class="n">project_only</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">all</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.paginate_query">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">paginate_query</code><span class="sig-paren">(</span><em>query</em>, <em>model</em>, <em>limit</em>, <em>sort_keys</em>, <em>marker=None</em>, <em>sort_dir=None</em>, <em>sort_dirs=None</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.paginate_query" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a query with sorting / pagination criteria added.</p>
<p>Pagination works by requiring a unique sort_key, specified by sort_keys.
(If sort_keys is not unique, then we risk looping through values.)
We use the last row in the previous page as the &#8216;marker&#8217; for pagination.
So we must return values that follow the passed marker in the order.
With a single-valued sort_key, this would be easy: sort_key &gt; X.
With a compound-values sort_key, (k1, k2, k3) we must do this to repeat
the lexicographical ordering:
(k1 &gt; X1) or (k1 == X1 &amp;&amp; k2 &gt; X2) or (k1 == X1 &amp;&amp; k2 == X2 &amp;&amp; k3 &gt; X3)</p>
<p>We also have to cope with different sort_directions and cases where k2,
k3, ... are nullable.</p>
<p>Typically, the id of the last row is used as the client-facing pagination
marker, then the actual marker object must be fetched from the db and
passed in to us as marker.</p>
<p>The &#8220;offset&#8221; parameter is intentionally avoided. As offset requires a
full scan through the preceding results each time, criteria-based
pagination is preferred. See <a class="reference external" href="http://use-the-index-luke.com/no-offset">http://use-the-index-luke.com/no-offset</a>
for further background.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>query</strong> &#8211; the query object to which we should add paging/sorting</li>
<li><strong>model</strong> &#8211; the ORM model class</li>
<li><strong>limit</strong> &#8211; maximum number of items to return</li>
<li><strong>sort_keys</strong> &#8211; array of attributes by which results should be sorted</li>
<li><strong>marker</strong> &#8211; the last item of the previous page; we returns the next
results after this value.</li>
<li><strong>sort_dir</strong> &#8211; direction in which results should be sorted (asc, desc)
suffix -nullsfirst, -nullslast can be added to defined
the ordering of null values</li>
<li><strong>sort_dirs</strong> &#8211; per-column array of sort_dirs, corresponding to sort_keys</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">sqlalchemy.orm.query.Query</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The query with sorting/pagination added.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.sanitize_db_url">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">sanitize_db_url</code><span class="sig-paren">(</span><em>url</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.sanitize_db_url" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="oslo_db.sqlalchemy.utils.to_list">
<code class="descclassname">oslo_db.sqlalchemy.utils.</code><code class="descname">to_list</code><span class="sig-paren">(</span><em>x</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_db.sqlalchemy.utils.to_list" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h4>Previous topic</h4>
            <p class="topless"><a href="oslo_db.sqlalchemy.update_match.html"
                                  title="previous chapter">The <code class="docutils literal"><span class="pre">oslo_db.sqlalchemy.update_match</span></code> Module</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/oslo.db
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/api/oslo_db.sqlalchemy.utils.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="oslo_db.sqlalchemy.update_match.html" title="The oslo_db.sqlalchemy.update_match Module"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">oslo.db 4.17.1.dev11 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="autoindex.html" accesskey="U">&lt;no title&gt;</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, OpenStack Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/oslo.db");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>