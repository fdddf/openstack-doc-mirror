<!DOCTYPE html>
<html>
<head>
    <meta http-eqiv='content-type' content='text/html;charset=utf-8'>
    <title>bootstrap</title>
    <link rel=stylesheet href="http://jashkenas.github.com/docco/resources/classic/docco.css">
</head>
<body>
<div id=container>
    <div id=background></div>
    <table cellspacing=0 cellpadding=0>
    <thead>
      <tr>
        <th class=docs><h1>bootstrap</h1></th>
        <th class=code></th>
      </tr>
    </thead>
    <tbody>
        <tr><td class='docs'><?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.13.1: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<p>Copyright 2015 Hewlett-Packard Development Company, L.P.</p>
<p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may
not use this file except in compliance with the License. You may obtain
a copy of the License at</p>
<blockquote>
<a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></blockquote>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.</p>
<span></span><span class="c1"># DIVIDER</span>
<span class="c1">#!/bin/bash</span>

<span class="c1"># DIVIDER</span>


<span class="c1"># DIVIDER</span>
<span class="k">function</span> echo_summary <span class="o">{</span>
    <span class="nb">local</span> xtrace
    <span class="nv">xtrace</span><span class="o">=</span><span class="k">$(</span><span class="nb">set</span> +o <span class="p">|</span> grep xtrace<span class="k">)</span>
    <span class="nb">set</span> +o xtrace

    <span class="nb">echo</span> <span class="nv">$@</span> &gt;<span class="p">&amp;</span><span class="m">6</span>
    <span class="nb">echo</span>
    <span class="nb">echo</span> <span class="s2">&quot;#********************************************&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;# &quot;</span> <span class="nv">$@</span>
    <span class="nb">echo</span> <span class="s2">&quot;#********************************************&quot;</span>
    <span class="nb">echo</span>

    <span class="nv">$xtrace</span>
<span class="o">}</span>

<span class="c1"># DIVIDER</span>
<span class="k">function</span> stop <span class="o">{</span>
    <span class="nv">stop</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">shift</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span> <span class="o">=</span>~ <span class="s2">&quot;</span><span class="nv">$stop</span><span class="s2">&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;STOP called for </span><span class="nv">$1</span><span class="s2">&quot;</span>
        <span class="nb">exit</span> <span class="m">1</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># DIVIDER</span>
<span class="k">function</span> trueorfalse <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">xtrace</span><span class="o">=</span><span class="k">$(</span><span class="nb">set</span> +o <span class="p">|</span> grep xtrace<span class="k">)</span>
    <span class="nb">set</span> +o xtrace
    <span class="nb">local</span> <span class="nv">default</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local</span> <span class="nv">literal</span><span class="o">=</span><span class="nv">$2</span>
    <span class="nb">local</span> <span class="nv">testval</span><span class="o">=</span><span class="si">${</span><span class="p">!literal</span><span class="k">:-</span><span class="si">}</span>

    <span class="o">[[</span> -z <span class="s2">&quot;</span><span class="nv">$testval</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$default</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="o">}</span>
    <span class="o">[[</span> <span class="s2">&quot;0 no No NO false False FALSE&quot;</span> <span class="o">=</span>~ <span class="s2">&quot;</span><span class="nv">$testval</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">&quot;False&quot;</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="o">}</span>
    <span class="o">[[</span> <span class="s2">&quot;1 yes Yes YES true True TRUE&quot;</span> <span class="o">=</span>~ <span class="s2">&quot;</span><span class="nv">$testval</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">&quot;True&quot;</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="o">}</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$default</span><span class="s2">&quot;</span>
    <span class="nv">$xtrace</span>
<span class="o">}</span>

<span class="c1"># DIVIDER</span>
<span class="k">function</span> git_clone <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">git_remote</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local</span> <span class="nv">git_dest</span><span class="o">=</span><span class="nv">$2</span>
    <span class="nb">local</span> <span class="nv">git_ref</span><span class="o">=</span><span class="nv">$3</span>
    <span class="nb">local</span> <span class="nv">orig_dir</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
    <span class="nb">local</span> <span class="nv">git_clone_flags</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

    <span class="nv">RECLONE</span><span class="o">=</span><span class="k">$(</span>trueorfalse False RECLONE<span class="k">)</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">GIT_DEPTH</span><span class="si">}</span><span class="s2">&quot;</span> -gt <span class="m">0</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">git_clone_flags</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$git_clone_flags</span><span class="s2"> --depth </span><span class="nv">$GIT_DEPTH</span><span class="s2">&quot;</span>
    <span class="k">fi</span>

    <span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$OFFLINE</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;Running in offline mode, clones already exist&quot;</span>
<span class="c1"># DIVIDER</span>
        <span class="nb">cd</span> <span class="nv">$git_dest</span>
        git show --oneline <span class="p">|</span> head -1
        <span class="nb">cd</span> <span class="nv">$orig_dir</span>
        <span class="k">return</span>
    <span class="k">fi</span>

    <span class="k">if</span> <span class="nb">echo</span> <span class="nv">$git_ref</span> <span class="p">|</span> egrep -q <span class="s2">&quot;^refs&quot;</span><span class="p">;</span> <span class="k">then</span>
<span class="c1"># DIVIDER</span>
        <span class="k">if</span> <span class="o">[[</span> ! -d <span class="nv">$git_dest</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
            <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$ERROR_ON_CLONE</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
                die <span class="nv">$LINENO</span> <span class="s2">&quot;Cloning not allowed in this configuration&quot;</span>
            git_timed clone <span class="nv">$git_clone_flags</span> <span class="nv">$git_remote</span> <span class="nv">$git_dest</span>
        <span class="k">fi</span>
        <span class="nb">cd</span> <span class="nv">$git_dest</span>
        git_timed fetch <span class="nv">$git_remote</span> <span class="nv">$git_ref</span> <span class="o">&amp;&amp;</span> git checkout FETCH_HEAD
    <span class="k">else</span>
<span class="c1"># DIVIDER</span>
        <span class="k">if</span> <span class="o">[[</span> ! -d <span class="nv">$git_dest</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
            <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$ERROR_ON_CLONE</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
                die <span class="nv">$LINENO</span> <span class="s2">&quot;Cloning not allowed in this configuration&quot;</span>
            git_timed clone <span class="nv">$git_clone_flags</span> <span class="nv">$git_remote</span> <span class="nv">$git_dest</span>
            <span class="nb">cd</span> <span class="nv">$git_dest</span>
<span class="c1"># DIVIDER</span>
            git checkout <span class="nv">$git_ref</span>
        <span class="k">elif</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$RECLONE</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="c1"># DIVIDER</span>
            <span class="nb">cd</span> <span class="nv">$git_dest</span>
<span class="c1"># DIVIDER</span>
            git remote set-url origin <span class="nv">$git_remote</span>
            git_timed fetch origin
<span class="c1"># DIVIDER</span>
            find <span class="nv">$git_dest</span> -name <span class="s1">&#39;*.pyc&#39;</span> -delete

<span class="c1"># DIVIDER</span>
            <span class="k">if</span> <span class="o">[[</span> -n <span class="s2">&quot;`git show-ref refs/tags/</span><span class="nv">$git_ref</span><span class="s2">`&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
                git_update_tag <span class="nv">$git_ref</span>
            <span class="k">elif</span> <span class="o">[[</span> -n <span class="s2">&quot;`git show-ref refs/heads/</span><span class="nv">$git_ref</span><span class="s2">`&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
                git_update_branch <span class="nv">$git_ref</span>
            <span class="k">elif</span> <span class="o">[[</span> -n <span class="s2">&quot;`git show-ref refs/remotes/origin/</span><span class="nv">$git_ref</span><span class="s2">`&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
                git_update_remote_branch <span class="nv">$git_ref</span>
            <span class="k">else</span>
                die <span class="nv">$LINENO</span> <span class="s2">&quot;</span><span class="nv">$git_ref</span><span class="s2"> is neither branch nor tag&quot;</span>
            <span class="k">fi</span>

        <span class="k">fi</span>
    <span class="k">fi</span>

<span class="c1"># DIVIDER</span>
    <span class="nb">cd</span> <span class="nv">$git_dest</span>
    git show --oneline <span class="p">|</span> head -1
    <span class="nb">cd</span> <span class="nv">$orig_dir</span>
<span class="o">}</span>

<span class="c1"># DIVIDER</span>
<span class="k">function</span> git_timed <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">count</span><span class="o">=</span><span class="m">0</span>
    <span class="nb">local</span> <span class="nv">timeout</span><span class="o">=</span><span class="m">0</span>

    <span class="k">if</span> <span class="o">[[</span> -n <span class="s2">&quot;</span><span class="si">${</span><span class="nv">GIT_TIMEOUT</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">timeout</span><span class="o">=</span><span class="si">${</span><span class="nv">GIT_TIMEOUT</span><span class="si">}</span>
    <span class="k">fi</span>

    <span class="k">until</span> timeout -s SIGINT <span class="si">${</span><span class="nv">timeout</span><span class="si">}</span> git <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">do</span>
<span class="c1"># DIVIDER</span>
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> -ne <span class="m">124</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
            die <span class="nv">$LINENO</span> <span class="s2">&quot;git call failed: [git </span><span class="nv">$@</span><span class="s2">]&quot;</span>
        <span class="k">fi</span>

        <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="nv">$count</span> <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
        warn <span class="s2">&quot;timeout </span><span class="si">${</span><span class="nv">count</span><span class="si">}</span><span class="s2"> for git call: [git </span><span class="nv">$@</span><span class="s2">]&quot;</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$count</span> -eq <span class="m">3</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
            die <span class="nv">$LINENO</span> <span class="s2">&quot;Maximum of 3 git retries reached&quot;</span>
        <span class="k">fi</span>
        sleep <span class="m">5</span>
    <span class="k">done</span>
<span class="o">}</span>

<span class="c1"># DIVIDER</span>
<span class="k">function</span> git_update_branch <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">git_branch</span><span class="o">=</span><span class="nv">$1</span>

    git checkout -f origin/<span class="nv">$git_branch</span>
<span class="c1"># DIVIDER</span>
    git branch -D <span class="nv">$git_branch</span> <span class="o">||</span> <span class="nb">true</span>
    git checkout -b <span class="nv">$git_branch</span>
<span class="o">}</span>

<span class="c1"># DIVIDER</span>
<span class="k">function</span> git_update_remote_branch <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">git_branch</span><span class="o">=</span><span class="nv">$1</span>

    git checkout -b <span class="nv">$git_branch</span> -t origin/<span class="nv">$git_branch</span>
<span class="o">}</span>

<span class="c1"># DIVIDER</span>
<span class="k">function</span> git_update_tag <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">git_tag</span><span class="o">=</span><span class="nv">$1</span>

    git tag -d <span class="nv">$git_tag</span>
<span class="c1"># DIVIDER</span>
    git_timed fetch origin tag <span class="nv">$git_tag</span>
    git checkout -f <span class="nv">$git_tag</span>
<span class="o">}</span>

<span class="k">function</span> localrc_path <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">side</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local</span> path
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$side</span> <span class="o">==</span> <span class="s2">&quot;base&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">path</span><span class="o">=</span><span class="nv">$BASE_DEVSTACK_DIR</span>
    <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$side</span> <span class="o">==</span> <span class="s2">&quot;target&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">path</span><span class="o">=</span><span class="nv">$TARGET_DEVSTACK_DIR</span>
    <span class="k">else</span>
        die <span class="nv">$LINENO</span> <span class="s2">&quot;side must be base or target!&quot;</span>
    <span class="k">fi</span>
    <span class="k">if</span> <span class="o">[[</span> -e <span class="s2">&quot;</span><span class="nv">$path</span><span class="s2">/local.conf&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$path</span><span class="s2">/local.conf&quot;</span>
    <span class="k">else</span>
        <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$path</span><span class="s2">/localrc&quot;</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function</span> dump_local_files <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">dir</span><span class="o">=</span><span class="nv">$1</span>
    <span class="k">for</span> i in <span class="nv">$dir</span>/local*<span class="p">;</span> <span class="k">do</span>
        <span class="nb">echo</span> <span class="s2">&quot;_______________________________________________&quot;</span>
        <span class="nb">echo</span> <span class="s2">&quot;-- </span><span class="nv">$i</span><span class="s2"> -- file dump&quot;</span>
        <span class="nb">echo</span> <span class="s2">&quot;_______________________________________________&quot;</span>
        cat <span class="nv">$i</span>
        <span class="nb">echo</span> <span class="s2">&quot;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^&quot;</span>
    <span class="k">done</span>
<span class="o">}</span>

<span class="k">function</span> fetch_devstacks <span class="o">{</span>
<span class="c1"># DIVIDER</span>

<span class="c1"># DIVIDER</span>
    <span class="k">if</span> <span class="o">[[</span> ! -d <span class="nv">$BASE_DEVSTACK_DIR</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        git_clone <span class="nv">$BASE_DEVSTACK_REPO</span> <span class="nv">$BASE_DEVSTACK_DIR</span> <span class="nv">$BASE_DEVSTACK_BRANCH</span>
    <span class="k">fi</span>
<span class="c1"># DIVIDER</span>
    <span class="k">if</span> <span class="o">[[</span> ! -d <span class="nv">$TARGET_DEVSTACK_DIR</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        git_clone <span class="nv">$TARGET_DEVSTACK_REPO</span> <span class="nv">$TARGET_DEVSTACK_DIR</span> <span class="nv">$TARGET_DEVSTACK_BRANCH</span>
    <span class="k">fi</span>

<span class="c1"># DIVIDER</span>
    <span class="nb">source</span> <span class="nv">$TARGET_DEVSTACK_DIR</span>/functions-common
    <span class="nb">source</span> <span class="nv">$TARGET_DEVSTACK_DIR</span>/inc/python
    install_devstack_tools

<span class="c1"># DIVIDER</span>
    <span class="k">if</span> <span class="o">[[</span> -d <span class="si">${</span><span class="nv">STACK_ROOT</span><span class="si">}</span>/images <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        rsync -a <span class="si">${</span><span class="nv">STACK_ROOT</span><span class="si">}</span>/images/* <span class="nv">$BASE_DEVSTACK_DIR</span>/files
    <span class="k">fi</span>

<span class="c1"># DIVIDER</span>

<span class="c1"># DIVIDER</span>
    <span class="k">if</span> <span class="o">[[</span> -r <span class="nv">$BASE_DEVSTACK_DIR</span>/localrc <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="c1"># DIVIDER</span>
        <span class="nb">echo</span> <span class="s2">&quot;[[local|localrc]]&quot;</span> &gt; <span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf.orig
        cat <span class="nv">$BASE_DEVSTACK_DIR</span>/localrc &gt;&gt; <span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf.orig
        rm <span class="nv">$BASE_DEVSTACK_DIR</span>/localrc
    <span class="k">fi</span>

<span class="c1"># DIVIDER</span>
    <span class="k">if</span> <span class="o">[[</span> -r <span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        dsconf merge_lc <span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf.orig <span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf
        rm <span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf
    <span class="k">fi</span>

<span class="c1"># DIVIDER</span>
    sed -e <span class="s2">&quot;</span>
<span class="s2">        s|\@BASE_RELEASE_DIR\@|</span><span class="nv">$BASE_RELEASE_DIR</span><span class="s2">|</span>
<span class="s2">        s|\@DATA_DIR@|</span><span class="nv">$DATA_DIR</span><span class="s2">|</span>
<span class="s2">&quot;</span> <span class="nv">$GRENADE_DIR</span>/devstack.local.conf.base &gt;<span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf

<span class="c1"># DIVIDER</span>
    <span class="k">if</span> <span class="o">[[</span> -r <span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf.orig <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        dsconf merge_lc <span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf <span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf.orig
    <span class="k">fi</span>

<span class="c1"># DIVIDER</span>
    <span class="k">if</span> <span class="o">[[</span> -r <span class="nv">$GRENADE_DIR</span>/devstack.local.conf <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        dsconf merge_lc <span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf <span class="nv">$GRENADE_DIR</span>/devstack.local.conf
    <span class="k">elif</span> <span class="o">[[</span> -r <span class="nv">$GRENADE_DIR</span>/devstack.localrc <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;[[local|localrc]]&quot;</span> &gt; <span class="nv">$GRENADE_DIR</span>/devstack.local.conf
        cat <span class="nv">$GRENADE_DIR</span>/devstack.localrc &gt;&gt; <span class="nv">$GRENADE_DIR</span>/devstack.local.conf
        dsconf merge_lc <span class="nv">$BASE_DEVSTACK_DIR</span>/local.conf <span class="nv">$GRENADE_DIR</span>/devstack.local.conf
    <span class="k">fi</span>

    dump_local_files <span class="nv">$BASE_DEVSTACK_DIR</span>

<span class="c1"># DIVIDER</span>

<span class="c1"># DIVIDER</span>

<span class="c1"># DIVIDER</span>
    <span class="k">if</span> <span class="o">[[</span> -r <span class="nv">$TARGET_DEVSTACK_DIR</span>/localrc <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
<span class="c1"># DIVIDER</span>
        <span class="nb">echo</span> <span class="s2">&quot;[[local|localrc]]&quot;</span> &gt; <span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf.orig
        cat <span class="nv">$TARGET_DEVSTACK_DIR</span>/localrc &gt;&gt; <span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf.orig
        rm <span class="nv">$TARGET_DEVSTACK_DIR</span>/localrc
    <span class="k">fi</span>

<span class="c1"># DIVIDER</span>
    <span class="k">if</span> <span class="o">[[</span> -r <span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        dsconf merge_lc <span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf.orig <span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf
        rm <span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf
    <span class="k">fi</span>

<span class="c1"># DIVIDER</span>
    sed -e <span class="s2">&quot;</span>
<span class="s2">        s|\@TARGET_RELEASE_DIR\@|</span><span class="nv">$TARGET_RELEASE_DIR</span><span class="s2">|</span>
<span class="s2">        s|\@DATA_DIR@|</span><span class="nv">$DATA_DIR</span><span class="s2">|</span>
<span class="s2">&quot;</span> <span class="nv">$GRENADE_DIR</span>/devstack.local.conf.target &gt;<span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf

<span class="c1"># DIVIDER</span>
    <span class="k">if</span> <span class="o">[[</span> -r <span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf.orig <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        dsconf merge_lc <span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf <span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf.orig
    <span class="k">fi</span>

<span class="c1"># DIVIDER</span>
    <span class="k">if</span> <span class="o">[[</span> -r <span class="nv">$GRENADE_DIR</span>/devstack.local.conf <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        dsconf merge_lc <span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf <span class="nv">$GRENADE_DIR</span>/devstack.local.conf
    <span class="k">elif</span> <span class="o">[[</span> -r <span class="nv">$GRENADE_DIR</span>/devstack.localrc <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;[[local|localrc]]&quot;</span> &gt; <span class="nv">$GRENADE_DIR</span>/devstack.local.conf
        cat <span class="nv">$GRENADE_DIR</span>/devstack.localrc &gt;&gt; <span class="nv">$GRENADE_DIR</span>/devstack.local.conf
        dsconf merge_lc <span class="nv">$TARGET_DEVSTACK_DIR</span>/local.conf <span class="nv">$GRENADE_DIR</span>/devstack.local.conf
    <span class="k">fi</span>
    dump_local_files <span class="nv">$TARGET_DEVSTACK_DIR</span>
<span class="o">}</span>


<span class="c1"># DIVIDER</span>

</pre></div></td></tr><tr><td class=docs>
<div class="section" id="bootstrapping-library-for-grenade">
<h1>Bootstrapping Library for Grenade</h1>
<p>We'd like grenade to largely use DEVSTACK_TARGET functions, but in
order to do that we need to get to the point where we have a working
DEVSTACK_TARGET. This file includes <em>just</em> enough functions to get
us a working DEVSTACK_TARGET which then lets us pivot our
functionality into there. Most of these will have been manually
copied from upstream devstack.</p>
<p>The following variables are assumed to be defined by certain functions:</p>
<ul class="simple">
<li><tt class="docutils literal">GRENADE_DIR</tt></li>
<li><tt class="docutils literal">STACK_ROOT</tt></li>
<li><tt class="docutils literal">BASE_DEVSTACK_DIR</tt></li>
<li><tt class="docutils literal">BASE_DEVSTACK_BRANCH</tt></li>
<li><tt class="docutils literal">TARGET_DEVSTACK_DIR</tt></li>
<li><tt class="docutils literal">TARGET_DEVSTACK_BRANCH</tt></li>
</ul>
<p>for git related functions</p>
<ul class="simple">
<li><tt class="docutils literal">RECLONE</tt></li>
<li><tt class="docutils literal">OFFLINE</tt></li>
<li><tt class="docutils literal">ERROR_ON_CLONE</tt></li>
<li><tt class="docutils literal">GIT_TIMEOUT</tt></li>
</ul>
</pre></div></td></tr><tr><td class=docs>
<p>Echo to summary log file</p>
<p>This function should be used to send messages out to the summary log
file which makes for good high level progress monitoring.</p>
</pre></div></td></tr><tr><td class=docs>
<p>Stop at a specific phase</p>
<p>Use is DEPRECATED and will be removed once the refactor is done.</p>
</pre></div></td></tr><tr><td class=docs>
<p>Normalize config values to True or False
Accepts as False: 0 no No NO false False FALSE
Accepts as True: 1 yes Yes YES true True TRUE
VAR=$(trueorfalse default-value test-value)</p>
</pre></div></td></tr><tr><td class=docs>
<p>git clone only if directory doesn't exist already.  Since <tt class="docutils literal">DEST</tt> might not
be owned by the installation user, we create the directory and change the
ownership to the proper user.
Set global <tt class="docutils literal">RECLONE=yes</tt> to simulate a clone when dest-dir exists
Set global <tt class="docutils literal">ERROR_ON_CLONE=True</tt> to abort execution with an error if the git repo
does not exist (default is False, meaning the repo will be cloned).
Uses globals <tt class="docutils literal">ERROR_ON_CLONE</tt>, <tt class="docutils literal">OFFLINE</tt>, <tt class="docutils literal">RECLONE</tt>
git_clone remote dest-dir branch</p>
</pre></div></td></tr><tr><td class=docs>
<p>print out the results so we know what change was used in the logs</p>
</pre></div></td></tr><tr><td class=docs>
<p>If our branch name is a gerrit style refs/changes/...</p>
</pre></div></td></tr><tr><td class=docs>
<p>do a full clone only if the directory doesn't exist</p>
</pre></div></td></tr><tr><td class=docs>
<p>This checkout syntax works for both branches and tags</p>
</pre></div></td></tr><tr><td class=docs>
<p>if it does exist then simulate what clone does if asked to RECLONE</p>
</pre></div></td></tr><tr><td class=docs>
<p>set the url to pull from and fetch</p>
</pre></div></td></tr><tr><td class=docs>
<p>remove the existing ignored files (like pyc) as they cause breakage
(due to the py files having older timestamps than our pyc, so python
thinks the pyc files are correct using them)</p>
</pre></div></td></tr><tr><td class=docs>
<p>handle git_ref accordingly to type (tag, branch)</p>
</pre></div></td></tr><tr><td class=docs>
<p>print out the results so we know what change was used in the logs</p>
</pre></div></td></tr><tr><td class=docs>
<p>git can sometimes get itself infinitely stuck with transient network
errors or other issues with the remote end.  This wraps git in a
timeout/retry loop and is intended to watch over non-local git
processes that might hang.  GIT_TIMEOUT, if set, is passed directly
to timeout(1); otherwise the default value of 0 maintains the status
quo of waiting forever.
usage: git_timed &lt;git-command&gt;</p>
</pre></div></td></tr><tr><td class=docs>
<p>124 is timeout(1)'s special return code when it reached the
timeout; otherwise assume fatal failure</p>
</pre></div></td></tr><tr><td class=docs>
<p>git update using reference as a branch.
git_update_branch ref</p>
</pre></div></td></tr><tr><td class=docs>
<p>a local branch might not exist</p>
</pre></div></td></tr><tr><td class=docs>
<p>git update using reference as a branch.
git_update_remote_branch ref</p>
</pre></div></td></tr><tr><td class=docs>
<p>git update using reference as a tag. Be careful editing source at that repo
as working copy will be in a detached mode
git_update_tag ref</p>
</pre></div></td></tr><tr><td class=docs>
<p>fetching given tag only</p>
</pre></div></td></tr><tr><td class=docs>
<p>Fetch Base Devstack</p>
</pre></div></td></tr><tr><td class=docs>
<p>Get DevStack if it doesn't exist</p>
</pre></div></td></tr><tr><td class=docs>
<p>Fetch Target Devstack</p>
</pre></div></td></tr><tr><td class=docs>
<p>This depends on REQUIREMENTS_DIR being set in grenaderc, which
it needs to be to have gotten this far.</p>
</pre></div></td></tr><tr><td class=docs>
<p>Load up a copy of the downloaded images if not present</p>
</pre></div></td></tr><tr><td class=docs>
<p>Set up base localrc</p>
</pre></div></td></tr><tr><td class=docs>
<p>if there is a localrc, make that a local.conf.orig and get rid of the artifact</p>
</pre></div></td></tr><tr><td class=docs>
<p>Convert to a local.conf</p>
</pre></div></td></tr><tr><td class=docs>
<p>if a local.conf exists, merge that into local.conf.orig (which we're going to remerge later)</p>
</pre></div></td></tr><tr><td class=docs>
<p>put devstack.local.conf.target in place as local.conf</p>
</pre></div></td></tr><tr><td class=docs>
<p>if local.conf.orig or localrc.orig exists, append it to local.conf</p>
</pre></div></td></tr><tr><td class=docs>
<p>if devstack.local.conf exists append it to locarc</p>
</pre></div></td></tr><tr><td class=docs>
<p>... time for TARGET</p>
</pre></div></td></tr><tr><td class=docs>
<p>Set up target local.conf</p>
</pre></div></td></tr><tr><td class=docs>
<p>if there is a localrc, make that a local.conf.orig and get rid of the artifact</p>
</pre></div></td></tr><tr><td class=docs>
<p>Convert to a local.conf</p>
</pre></div></td></tr><tr><td class=docs>
<p>if a local.conf exists, merge that into local.conf.orig (which we're going to remerge later)</p>
</pre></div></td></tr><tr><td class=docs>
<p>put devstack.local.conf.target in place as local.conf</p>
</pre></div></td></tr><tr><td class=docs>
<p>if local.conf.orig or localrc.orig exists, append it to local.conf</p>
</pre></div></td></tr><tr><td class=docs>
<p>if devstack.local.conf exists append it to locarc</p>
</pre></div></td></tr><tr><td class=docs>
</pre></div></td></tr><tr><td class=docs>
</div>
</div>
</body>
</html></td><td class='code'></td></tr>
    </tbody>
    </table>
</div>
</body>
</html>
