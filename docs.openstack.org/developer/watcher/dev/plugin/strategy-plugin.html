<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Build a new optimization strategy &mdash; Watcher 1.0.1.dev10 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/toggle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0.1.dev10',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/toggle.js"></script>
    <link rel="top" title="Watcher 1.0.1.dev10 documentation" href="../../index.html" />
    <link rel="next" title="Build a new cluster data model collector" href="cdmc-plugin.html" />
    <link rel="prev" title="Build a new scoring engine" href="scoring-engine-plugin.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="build-a-new-optimization-strategy">
<span id="implement-strategy-plugin"></span><h1>Build a new optimization strategy<a class="headerlink" href="#build-a-new-optimization-strategy" title="Permalink to this headline">¶</a></h1>
<p>Watcher Decision Engine has an external <a class="reference internal" href="../../glossary.html#strategy-definition"><span>strategy</span></a>
plugin interface which gives anyone the ability to integrate an external
strategy in order to make use of placement algorithms.</p>
<p>This section gives some guidelines on how to implement and integrate custom
strategies with Watcher. If you wish to create a third-party package for your
plugin, you can refer to our <a class="reference internal" href="base-setup.html#plugin-base-setup"><span>documentation for third-party package
creation</span></a>.</p>
<div class="section" id="pre-requisites">
<h2>Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">¶</a></h2>
<p>Before using any strategy, you should make sure you have your Telemetry service
configured so that it would provide you all the metrics you need to be able to
use your strategy.</p>
</div>
<div class="section" id="create-a-new-strategy-plugin">
<h2>Create a new strategy plugin<a class="headerlink" href="#create-a-new-strategy-plugin" title="Permalink to this headline">¶</a></h2>
<p>In order to create a new strategy, you have to:</p>
<ul class="simple">
<li>Extend the <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.UnclassifiedStrategy" title="watcher.decision_engine.strategy.strategies.base.UnclassifiedStrategy"><code class="xref py py-class docutils literal"><span class="pre">UnclassifiedStrategy</span></code></a> class</li>
<li>Implement its <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_name" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_name"><code class="xref py py-meth docutils literal"><span class="pre">get_name()</span></code></a> class method to return the
<strong>unique</strong> ID of the new strategy you want to create. This unique ID should
be the same as the name of <a class="reference internal" href="#strategy-plugin-add-entrypoint"><span>the entry point we will declare later on</span></a>.</li>
<li>Implement its <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_display_name" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_display_name"><code class="xref py py-meth docutils literal"><span class="pre">get_display_name()</span></code></a> class method to
return the translated display name of the strategy you want to create.
Note: Do not use a variable to return the translated string so it can be
automatically collected by the translation tool.</li>
<li>Implement its <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_translatable_display_name" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_translatable_display_name"><code class="xref py py-meth docutils literal"><span class="pre">get_translatable_display_name()</span></code></a>
class method to return the translation key (actually the English display
name) of your new strategy. The value return should be the same as the
string translated in <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_display_name" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_display_name"><code class="xref py py-meth docutils literal"><span class="pre">get_display_name()</span></code></a>.</li>
<li>Implement its <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy.execute" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy.execute"><code class="xref py py-meth docutils literal"><span class="pre">execute()</span></code></a> method to return the
solution you computed within your strategy.</li>
</ul>
<p>Here is an example showing how you can write a plugin called <code class="docutils literal"><span class="pre">NewStrategy</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># filepath: thirdparty/new.py</span>
<span class="c1"># import path: thirdparty.new</span>
<span class="kn">import</span> <span class="nn">abc</span>

<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">watcher._i18n</span> <span class="kn">import</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">watcher.decision_engine.strategy.strategies</span> <span class="kn">import</span> <span class="n">base</span>


<span class="k">class</span> <span class="nc">NewStrategy</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">UnclassifiedStrategy</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">osc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NewStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">osc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span><span class="n">action_type</span><span class="o">=</span><span class="s2">&quot;nop&quot;</span><span class="p">,</span>
                                 <span class="n">input_parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
        <span class="c1"># Do some more stuff here ...</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;new_strategy&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_display_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;New strategy&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_translatable_display_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;New strategy&quot;</span>
</pre></div>
</div>
<p>As you can see in the above example, the <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy.execute" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy.execute"><code class="xref py py-meth docutils literal"><span class="pre">execute()</span></code></a>
method returns a <a class="reference internal" href="../../api/watcher.decision_engine.solution.base.html#watcher.decision_engine.solution.base.BaseSolution" title="watcher.decision_engine.solution.base.BaseSolution"><code class="xref py py-class docutils literal"><span class="pre">BaseSolution</span></code></a> instance as required. This solution
is what wraps the abstract set of actions the strategy recommends to you. This
solution is then processed by a <a class="reference internal" href="../../glossary.html#watcher-planner-definition"><span>planner</span></a> to
produce an action plan which contains the sequenced flow of actions to be
executed by the <a class="reference internal" href="../../glossary.html#watcher-applier-definition"><span>Watcher Applier</span></a>. This
solution also contains the various <a class="reference internal" href="../../glossary.html#efficacy-indicator-definition"><span>efficacy indicators</span></a> alongside its computed <a class="reference internal" href="../../glossary.html#efficacy-definition"><span>global efficacy</span></a>.</p>
<p>Please note that your strategy class will expect to find the same constructor
signature as BaseStrategy to instantiate you strategy. Therefore, you should
ensure that your <code class="docutils literal"><span class="pre">__init__</span></code> signature is identical to the
<a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy"><code class="xref py py-class docutils literal"><span class="pre">BaseStrategy</span></code></a> one.</p>
</div>
<div class="section" id="strategy-efficacy">
<h2>Strategy efficacy<a class="headerlink" href="#strategy-efficacy" title="Permalink to this headline">¶</a></h2>
<p>As stated before, the <code class="docutils literal"><span class="pre">NewStrategy</span></code> class extends a class called
<a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.UnclassifiedStrategy" title="watcher.decision_engine.strategy.strategies.base.UnclassifiedStrategy"><code class="xref py py-class docutils literal"><span class="pre">UnclassifiedStrategy</span></code></a>. This class actually implements a set of
abstract methods which are defined within the <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy"><code class="xref py py-class docutils literal"><span class="pre">BaseStrategy</span></code></a> parent
class.</p>
<p>One thing this <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.UnclassifiedStrategy" title="watcher.decision_engine.strategy.strategies.base.UnclassifiedStrategy"><code class="xref py py-class docutils literal"><span class="pre">UnclassifiedStrategy</span></code></a> class defines is that our
<code class="docutils literal"><span class="pre">NewStrategy</span></code> achieves the <code class="docutils literal"><span class="pre">unclassified</span></code> goal. This goal is a peculiar one
as it does not contain any indicator nor does it calculate a global efficacy.
This proves itself to be quite useful during the development of a new strategy
for which the goal has yet to be defined or in case a <a class="reference internal" href="goal-plugin.html#implement-goal-plugin"><span>new goal</span></a> has yet to be implemented.</p>
</div>
<div class="section" id="define-strategy-parameters">
<h2>Define Strategy Parameters<a class="headerlink" href="#define-strategy-parameters" title="Permalink to this headline">¶</a></h2>
<p>For each new added strategy, you can add parameters spec so that an operator
can input strategy parameters when creating an audit to control the
<a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy.execute" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy.execute"><code class="xref py py-meth docutils literal"><span class="pre">execute()</span></code></a> behavior of strategy. This is useful to
define some threshold for your strategy, and tune them at runtime.</p>
<p>To define parameters, just implements <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_schema" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_schema"><code class="xref py py-meth docutils literal"><span class="pre">get_schema()</span></code></a> to
return parameters spec with <a class="reference external" href="http://json-schema.org/">jsonschema</a> format.
It is strongly encouraged that provide default value for each parameter, or
else reference fails if operator specify no parameters.</p>
<p>Here is an example showing how you can define 2 parameters for
<code class="docutils literal"><span class="pre">DummyStrategy</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DummyStrategy</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">DummyBaseStrategy</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;para1&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;number parameter example&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mf">3.2</span><span class="p">,</span>
                    <span class="s2">&quot;minimum&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="s2">&quot;maximum&quot;</span><span class="p">:</span> <span class="mf">10.2</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;para2&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;string parameter example&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>You can reference parameters in <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy.execute" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy.execute"><code class="xref py py-meth docutils literal"><span class="pre">execute()</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DummyStrategy</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">DummyBaseStrategy</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">para1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_parameters</span><span class="o">.</span><span class="n">para1</span>
        <span class="n">para2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_parameters</span><span class="o">.</span><span class="n">para2</span>

        <span class="k">if</span> <span class="n">para1</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="o">...</span>
</pre></div>
</div>
<p>Operator can specify parameters with following commands:</p>
<div class="code bash highlight-python"><div class="highlight"><pre><span></span>$ watcher audit create -a &lt;your_audit_template&gt; -p para1=6.0 -p para2=hi
</pre></div>
</div>
<p>Pls. check user-guide for details.</p>
</div>
<div class="section" id="abstract-plugin-class">
<h2>Abstract Plugin Class<a class="headerlink" href="#abstract-plugin-class" title="Permalink to this headline">¶</a></h2>
<p>Here below is the abstract <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy"><code class="xref py py-class docutils literal"><span class="pre">BaseStrategy</span></code></a> class:</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">watcher.decision_engine.strategy.strategies.base.</code><code class="descname">BaseStrategy</code><span class="sig-paren">(</span><em>config</em>, <em>osc=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>A base class for all the strategies</p>
<p>A Strategy is an algorithm implementation which is able to find a
Solution for a given Goal.</p>
<dl class="method">
<dt>
<code class="descname">__init__</code><span class="sig-paren">(</span><em>config</em>, <em>osc=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.__init__"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Constructor: the signature should be identical within the subclasses</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>config</strong> (<a class="reference internal" href="../../api/watcher.common.utils.html#watcher.common.utils.Struct" title="watcher.common.utils.Struct"><code class="xref py py-class docutils literal"><span class="pre">Struct</span></code></a>) &#8211; Configuration related to this plugin</li>
<li><strong>osc</strong> (<a class="reference internal" href="../../api/watcher.common.clients.html#watcher.common.clients.OpenStackClients" title="watcher.common.clients.OpenStackClients"><code class="xref py py-class docutils literal"><span class="pre">OpenStackClients</span></code></a> instance) &#8211; An OpenStackClients instance</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">do_execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.do_execute"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Strategy execution phase</p>
<p>This phase is where you should put the main logic of your strategy.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.execute"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Execute a strategy</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A computed solution (via a placement algorithm)</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="../../api/watcher.decision_engine.solution.base.html#watcher.decision_engine.solution.base.BaseSolution" title="watcher.decision_engine.solution.base.BaseSolution"><code class="xref py py-class docutils literal"><span class="pre">BaseSolution</span></code></a> instance</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt>
<em class="property">classmethod </em><code class="descname">get_config_opts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.get_config_opts"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Defines the configuration options to be associated to this loadable</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A list of configuration options relative to this Loadable</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list of <code class="xref py py-class docutils literal"><span class="pre">oslo_config.cfg.Opt</span></code> instances</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt>
<em class="property">classmethod </em><code class="descname">get_display_name</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.get_display_name"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>The goal display name for the strategy</p>
</dd></dl>

<dl class="classmethod">
<dt>
<em class="property">classmethod </em><code class="descname">get_goal</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.get_goal"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>The goal the strategy achieves</p>
</dd></dl>

<dl class="classmethod">
<dt>
<em class="property">classmethod </em><code class="descname">get_goal_name</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.get_goal_name"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>The goal name the strategy achieves</p>
</dd></dl>

<dl class="classmethod">
<dt>
<em class="property">classmethod </em><code class="descname">get_name</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.get_name"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>The name of the strategy</p>
</dd></dl>

<dl class="classmethod">
<dt>
<em class="property">classmethod </em><code class="descname">get_schema</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.get_schema"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Defines a Schema that the input parameters shall comply to</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A jsonschema format (mandatory default setting)</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt>
<em class="property">classmethod </em><code class="descname">get_translatable_display_name</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.get_translatable_display_name"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>The translatable msgid of the strategy</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">post_execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.post_execute"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Post-execution phase</p>
<p>This can be used to compute the global efficacy</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">pre_execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/watcher/decision_engine/strategy/strategies/base.html#BaseStrategy.pre_execute"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Pre-execution phase</p>
<p>This can be used to fetch some pre-requisites or data.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="add-a-new-entry-point">
<span id="strategy-plugin-add-entrypoint"></span><h2>Add a new entry point<a class="headerlink" href="#add-a-new-entry-point" title="Permalink to this headline">¶</a></h2>
<p>In order for the Watcher Decision Engine to load your new strategy, the
strategy must be registered as a named entry point under the
<code class="docutils literal"><span class="pre">watcher_strategies</span></code> entry point of your <code class="docutils literal"><span class="pre">setup.py</span></code> file. If you are using
<a class="reference external" href="http://docs.openstack.org/developer/pbr/">pbr</a>, this entry point should be placed in your <code class="docutils literal"><span class="pre">setup.cfg</span></code> file.</p>
<p>The name you give to your entry point has to be unique and should be the same
as the value returned by the <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.base.html#watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_name" title="watcher.decision_engine.strategy.strategies.base.BaseStrategy.get_name"><code class="xref py py-meth docutils literal"><span class="pre">get_name()</span></code></a> class method of
your strategy.</p>
<p>Here below is how you would proceed to register <code class="docutils literal"><span class="pre">NewStrategy</span></code> using <a class="reference external" href="http://docs.openstack.org/developer/pbr/">pbr</a>:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[entry_points]</span>
<span class="na">watcher_strategies</span> <span class="o">=</span><span class="s"></span>
<span class="s">    new_strategy = thirdparty.new:NewStrategy</span>
</pre></div>
</div>
<p>To get a better understanding on how to implement a more advanced strategy,
have a look at the <a class="reference internal" href="../../api/watcher.decision_engine.strategy.strategies.basic_consolidation.html#watcher.decision_engine.strategy.strategies.basic_consolidation.BasicConsolidation" title="watcher.decision_engine.strategy.strategies.basic_consolidation.BasicConsolidation"><code class="xref py py-class docutils literal"><span class="pre">BasicConsolidation</span></code></a> class.</p>
</div>
<div class="section" id="using-strategy-plugins">
<h2>Using strategy plugins<a class="headerlink" href="#using-strategy-plugins" title="Permalink to this headline">¶</a></h2>
<p>The Watcher Decision Engine service will automatically discover any installed
plugins when it is restarted. If a Python package containing a custom plugin is
installed within the same environment as Watcher, Watcher will automatically
make that plugin available for use.</p>
<p>At this point, Watcher will scan and register inside the <a class="reference internal" href="../../glossary.html#watcher-database-definition"><span>Watcher Database</span></a> all the strategies (alongside the goals they
should satisfy) you implemented upon restarting the <a class="reference internal" href="../../glossary.html#watcher-decision-engine-definition"><span>Watcher Decision
Engine</span></a>.</p>
<p>You should take care when installing strategy plugins. By their very nature,
there are no guarantees that utilizing them as is will be supported, as
they may require a set of metrics which is not yet available within the
Telemetry service. In such a case, please do make sure that you first
check/configure the latter so your new strategy can be fully functional.</p>
<div class="section" id="querying-metrics">
<h3>Querying metrics<a class="headerlink" href="#querying-metrics" title="Permalink to this headline">¶</a></h3>
<p>A large set of metrics, generated by OpenStack modules, can be used in your
strategy implementation. To collect these metrics, Watcher provides a
<a class="reference external" href="https://github.com/openstack/watcher/blob/master/watcher/decision_engine/cluster/history/ceilometer.py">Helper</a> for two data sources which are <a class="reference external" href="http://docs.openstack.org/developer/ceilometer/">Ceilometer</a> and <a class="reference external" href="https://github.com/openstack/monasca-api/blob/master/docs/monasca-api-spec.md">Monasca</a>. If you
wish to query metrics from a different data source, you can implement your own
and directly use it from within your new strategy. Indeed, strategies in
Watcher have the cluster data models decoupled from the data sources which
means that you may keep the former while changing the latter.
The recommended way for you to support a new data source is to implement a new
helper that would encapsulate within separate methods the queries you need to
perform. To then use it, you would just have to instantiate it within your
strategy.</p>
<p>If you want to use Ceilometer but with your own metrics database backend,
please refer to the <a class="reference external" href="http://docs.openstack.org/developer/ceilometer/architecture.html#storing-the-data">Ceilometer developer guide</a>. The list of the available
Ceilometer backends is located <a class="reference external" href="http://docs.openstack.org/developer/ceilometer/install/dbreco.html#choosing-a-database-backend">here</a>. The <a class="reference external" href="https://github.com/openstack/monasca-ceilometer/blob/master/ceilosca/ceilometer/storage/impl_monasca.py">Ceilosca</a> project is a good example
of how to create your own pluggable backend. Moreover, if your strategy
requires new metrics not covered by Ceilometer, you can add them through a
<a class="reference external" href="http://docs.openstack.org/developer/ceilometer/plugins.html">Ceilometer plugin</a>.</p>
</div>
<div class="section" id="read-usage-metrics-using-the-watcher-datasource-helper">
<h3>Read usage metrics using the Watcher Datasource Helper<a class="headerlink" href="#read-usage-metrics-using-the-watcher-datasource-helper" title="Permalink to this headline">¶</a></h3>
<p>The following code snippet shows how to invoke a Datasource Helper class:</p>
<div class="highlight-py"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">watcher.datasource</span> <span class="kn">import</span> <span class="n">ceilometer</span> <span class="k">as</span> <span class="n">ceil</span>
<span class="kn">from</span> <span class="nn">watcher.datasource</span> <span class="kn">import</span> <span class="n">monasca</span> <span class="k">as</span> <span class="n">mon</span>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">ceilometer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ceilometer</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ceilometer</span> <span class="o">=</span> <span class="n">ceil</span><span class="o">.</span><span class="n">CeilometerHelper</span><span class="p">(</span><span class="n">osc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">osc</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ceilometer</span>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">monasca</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_monasca</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_monasca</span> <span class="o">=</span> <span class="n">mon</span><span class="o">.</span><span class="n">MonascaHelper</span><span class="p">(</span><span class="n">osc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">osc</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_monasca</span>
</pre></div>
</div>
<p>Using that you can now query the values for that specific metric:</p>
<div class="highlight-py"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">datasource</span> <span class="o">==</span> <span class="s2">&quot;ceilometer&quot;</span><span class="p">:</span>
    <span class="n">resource_id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">hostname</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ceilometer</span><span class="o">.</span><span class="n">statistic_aggregation</span><span class="p">(</span>
        <span class="n">resource_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">,</span>
        <span class="n">meter_name</span><span class="o">=</span><span class="s1">&#39;compute.node.cpu.percent&#39;</span><span class="p">,</span>
        <span class="n">period</span><span class="o">=</span><span class="s2">&quot;7200&quot;</span><span class="p">,</span>
        <span class="n">aggregate</span><span class="o">=</span><span class="s1">&#39;avg&#39;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">datasource</span> <span class="o">==</span> <span class="s2">&quot;monasca&quot;</span><span class="p">:</span>
    <span class="n">statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monasca</span><span class="o">.</span><span class="n">statistic_aggregation</span><span class="p">(</span>
        <span class="n">meter_name</span><span class="o">=</span><span class="s1">&#39;compute.node.cpu.percent&#39;</span><span class="p">,</span>
        <span class="n">dimensions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">uuid</span><span class="p">),</span>
        <span class="n">period</span><span class="o">=</span><span class="mi">7200</span><span class="p">,</span>
        <span class="n">aggregate</span><span class="o">=</span><span class="s1">&#39;avg&#39;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Build a new optimization strategy</a><ul>
<li><a class="reference internal" href="#pre-requisites">Pre-requisites</a></li>
<li><a class="reference internal" href="#create-a-new-strategy-plugin">Create a new strategy plugin</a></li>
<li><a class="reference internal" href="#strategy-efficacy">Strategy efficacy</a></li>
<li><a class="reference internal" href="#define-strategy-parameters">Define Strategy Parameters</a></li>
<li><a class="reference internal" href="#abstract-plugin-class">Abstract Plugin Class</a></li>
<li><a class="reference internal" href="#add-a-new-entry-point">Add a new entry point</a></li>
<li><a class="reference internal" href="#using-strategy-plugins">Using strategy plugins</a><ul>
<li><a class="reference internal" href="#querying-metrics">Querying metrics</a></li>
<li><a class="reference internal" href="#read-usage-metrics-using-the-watcher-datasource-helper">Read usage metrics using the Watcher Datasource Helper</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="scoring-engine-plugin.html"
                                  title="previous chapter">Build a new scoring engine</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="cdmc-plugin.html"
                                  title="next chapter">Build a new cluster data model collector</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/watcher
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/dev/plugin/strategy-plugin.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../http-routingtable.html" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cdmc-plugin.html" title="Build a new cluster data model collector"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="scoring-engine-plugin.html" title="Build a new scoring engine"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Watcher 1.0.1.dev10 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright OpenStack Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/Watcher");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>