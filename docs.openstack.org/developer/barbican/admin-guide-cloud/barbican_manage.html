<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Barbican Service Management Utility &mdash; barbican 4.0.0.0rc2.dev3 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.0.0.0rc2.dev3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="barbican 4.0.0.0rc2.dev3 documentation" href="../index.html" />
    <link rel="up" title="Cloud Administrator Guide - Key Manager service" href="index.html" />
    <link rel="next" title="Database Cleaning" href="database_cleaning.html" />
    <link rel="prev" title="Access Control" href="access_control.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="barbican-service-management-utility">
<h1>Barbican Service Management Utility<a class="headerlink" href="#barbican-service-management-utility" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">barbican-manage</span></code> is a utility that is used to control the barbican key
manager service database and Hardware Secure Module (HSM) plugin device. Use
cases include migrating the secret database or generating a Master Key
Encryption Key (MKEK) in the HSM. This command set should only be executed by
a user with admin privileges.</p>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<p>The standard pattern for executing a barbican-manage command is:</p>
<p><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">&lt;category&gt;</span> <span class="pre">&lt;command&gt;</span> <span class="pre">[&lt;args&gt;]</span></code></p>
<p>Running <code class="docutils literal"><span class="pre">barbican-manage</span></code> without arguments shows a list of available command
categories. Currently, there are 2 supported categories: <em>db</em> and <em>hsm</em>.</p>
<p>Running with a category argument shows a list of commands in that category:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">db</span> <span class="pre">--help</span></code></li>
<li><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">hsm</span> <span class="pre">--help</span></code></li>
<li><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">--version</span></code> shows the version number of barbican service.</li>
</ul>
<p>The following sections describe the available categories and arguments for
barbican-manage.</p>
<div class="section" id="barbican-database">
<h3>Barbican Database<a class="headerlink" href="#barbican-database" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Before executing <strong>barbican-manage db</strong> commands, make sure you are
familiar with <a class="reference external" href="http://docs.openstack.org/developer/barbican/contribute/database_migrations.html">Database Migration</a> first.</p>
</div>
<p><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">db</span> <span class="pre">revision</span> <span class="pre">[--db-url]</span> <span class="pre">[--message]</span> <span class="pre">[--autogenerate]</span></code></p>
<blockquote>
<div>Create a new database version file.</div></blockquote>
<p><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">db</span> <span class="pre">upgrade</span> <span class="pre">[--db-url]</span> <span class="pre">[--version]</span></code></p>
<blockquote>
<div>Upgrade to a future version database.</div></blockquote>
<p><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">db</span> <span class="pre">history</span> <span class="pre">[--db-url]</span> <span class="pre">[--verbose]</span></code></p>
<blockquote>
<div>Show database changeset history.</div></blockquote>
<p><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">db</span> <span class="pre">current</span> <span class="pre">[--db-url]</span> <span class="pre">[--verbose]</span></code></p>
<blockquote>
<div>Show current revision of database.</div></blockquote>
<p><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">db</span> <span class="pre">clean</span> <span class="pre">[--db-url]</span> <span class="pre">[--verbose]</span> <span class="pre">[--min-days]</span> <span class="pre">[--clean-unassociated-projects]</span> <span class="pre">[--soft-delete-expired-secrets]</span> <span class="pre">[--log-file]</span></code></p>
<blockquote>
<div>Clean up soft deletions in the database. More documentation can be
found here: <a class="reference internal" href="database_cleaning.html"><em>Database Cleaning</em></a></div></blockquote>
</div>
<div class="section" id="barbican-pkcs11-hsm">
<h3>Barbican PKCS11/HSM<a class="headerlink" href="#barbican-pkcs11-hsm" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">hsm</span> <span class="pre">gen_mkek</span> <span class="pre">[--library-path]</span> <span class="pre">[--passphrase]</span> <span class="pre">[--slot-id]</span> <span class="pre">[--label]</span> <span class="pre">[--length]</span></code></p>
<blockquote>
<div>Create a new Master key encryption key in HSM.
This MKEK will be used to encrypt all project key encryption keys.
Its label must be unique.</div></blockquote>
<p><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">hsm</span> <span class="pre">gen_hmac</span> <span class="pre">[--library-path]</span> <span class="pre">[--passphrase]</span> <span class="pre">[--slot-id]</span> <span class="pre">[--label]</span> <span class="pre">[--length]</span></code></p>
<blockquote>
<div>Create a new Master HMAC key in HSM.
This HMAC key will be used to generate an authentication tag of encrypted
project key encryption keys. Its label must be unique.</div></blockquote>
<p><code class="docutils literal"><span class="pre">barbican-manage</span> <span class="pre">hsm</span> <span class="pre">rewrap_pkek</span> <span class="pre">[--dry-run]</span></code></p>
<blockquote>
<div>Rewrap project key encryption keys after rotating to new MKEK and/or HMAC
key(s) in HSM. The new MKEK and HMAC key should have already been generated
using the above commands. The user will have to configure new MKEK and HMAC
key labels in /etc/barbican.conf and restart barbican server before
executing this command.</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Barbican Service Management Utility</a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#options">Options</a><ul>
<li><a class="reference internal" href="#barbican-database">Barbican Database</a></li>
<li><a class="reference internal" href="#barbican-pkcs11-hsm">Barbican PKCS11/HSM</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="access_control.html"
                                  title="previous chapter">Access Control</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="database_cleaning.html"
                                  title="next chapter">Database Cleaning</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/barbican
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/admin-guide-cloud/barbican_manage.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="database_cleaning.html" title="Database Cleaning"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="access_control.html" title="Access Control"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">barbican 4.0.0.0rc2.dev3 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Cloud Administrator Guide - Key Manager service</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, OpenStack Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/barbican");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>