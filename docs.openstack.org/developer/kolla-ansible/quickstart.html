<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Quick Start &mdash; kolla-ansible 4.0.0.0b4.dev153 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '4.0.0.0b4.dev153',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="kolla-ansible 4.0.0.0b4.dev153 documentation" href="index.html" />
    <link rel="next" title="Multinode Deployment of Kolla" href="multinode.html" />
    <link rel="prev" title="Production architecture guide" href="production-architecture-guide.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="quick-start">
<h1>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h1>
<p>This guide provides step by step instructions to deploy OpenStack using Kolla
and Kolla-Ansible on bare metal servers or virtual machines.</p>
<div class="section" id="host-machine-requirements">
<h2>Host machine requirements<a class="headerlink" href="#host-machine-requirements" title="Permalink to this headline">¶</a></h2>
<p>The host machine must satisfy the following minimum requirements:</p>
<ul class="simple">
<li>2 network interfaces</li>
<li>8GB main memory</li>
<li>40GB disk space</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Root access to the deployment host machine is required.</p>
</div>
</div>
<div class="section" id="recommended-environment">
<h2>Recommended environment<a class="headerlink" href="#recommended-environment" title="Permalink to this headline">¶</a></h2>
<p>This guide recommends using a bare metal server or a virtual machine. Follow
the instructions in this document to get started with deploying OpenStack on
bare metal or a virtual machine with Kolla.</p>
<p>If developing Kolla on a system that provides VirtualBox or Libvirt in addition
to Vagrant, use the Vagrant virtual environment documented in
<a class="reference internal" href="vagrant-dev-env.html"><em>Development Environment with Vagrant</em></a>.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Verify the state of network interfaces. If using a VM spawned on
OpenStack as the host machine, the state of the second interface will be DOWN
on booting the VM.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ip addr show
</pre></div>
</div>
<p>Bring up the second network interface if it is down.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ip link set ens4 up
</pre></div>
</div>
<p>Verify if the second interface has an IP address.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ip addr show
</pre></div>
</div>
</div>
<div class="section" id="install-dependencies">
<h2>Install dependencies<a class="headerlink" href="#install-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Kolla builds images which are used by Kolla-Ansible to deploy OpenStack. The
deployment is tested on CentOS, Oracle Linux and Ubuntu as both container OS
platforms and bare metal deployment targets.</p>
<p>Ubuntu: For Ubuntu based systems where Docker is used it is recommended to use
the latest available LTS kernel. While all kernels should work for Docker, some
older kernels may have issues with some of the different Docker back ends such
as AUFS and OverlayFS. In order to update kernel in Ubuntu 14.04 LTS to 4.2,
run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>apt-get install linux-image-generic-lts-wily
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Install is <em>very</em> sensitive about version of components. Please
review carefully because default Operating System repos are likely out of
date.</p>
</div>
<p>Dependencies for the stable/mitaka branch are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="16%" />
<col width="16%" />
<col width="37%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Component</th>
<th class="head">Min Version</th>
<th class="head">Max Version</th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Ansible</td>
<td>1.9.4</td>
<td>&lt;2.0.0</td>
<td>On deployment host</td>
</tr>
<tr class="row-odd"><td>Docker</td>
<td>1.10.0</td>
<td>none</td>
<td>On target nodes</td>
</tr>
<tr class="row-even"><td>Docker Python</td>
<td>1.6.0</td>
<td>none</td>
<td>On target nodes</td>
</tr>
<tr class="row-odd"><td>Python Jinja2</td>
<td>2.6.0</td>
<td>none</td>
<td>On deployment host</td>
</tr>
</tbody>
</table>
<p>Dependencies for the stable/newton branch and later (including master branch)
are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="16%" />
<col width="16%" />
<col width="37%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Component</th>
<th class="head">Min Version</th>
<th class="head">Max Version</th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Ansible</td>
<td>2.0.0</td>
<td>none</td>
<td>On deployment host</td>
</tr>
<tr class="row-odd"><td>Docker</td>
<td>1.10.0</td>
<td>none</td>
<td>On target nodes</td>
</tr>
<tr class="row-even"><td>Docker Python</td>
<td>1.6.0</td>
<td>none</td>
<td>On target nodes</td>
</tr>
<tr class="row-odd"><td>Python Jinja2</td>
<td>2.8.0</td>
<td>none</td>
<td>On deployment host</td>
</tr>
</tbody>
</table>
<p>Make sure the <code class="docutils literal"><span class="pre">pip</span></code> package manager is installed and upgraded to the latest
before proceeding:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>#CentOS
yum install epel-release
yum install python-pip
pip install -U pip

#Ubuntu
apt-get update
apt-get install python-pip
pip install -U pip
</pre></div>
</div>
<p>Install dependencies needed to build the code with <code class="docutils literal"><span class="pre">pip</span></code> package manager.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>#CentOS
yum install python-devel libffi-devel gcc openssl-devel

#Ubuntu
apt-get install python-dev libffi-dev gcc libssl-dev
</pre></div>
</div>
<p>Kolla deploys OpenStack using <a class="reference external" href="http://www.ansible.com">Ansible</a>. Install
Ansible from distribution packaging if the distro packaging has recommended
version available.</p>
<p>Some implemented distro versions of Ansible are too old to use distro
packaging. Currently, CentOS and RHEL package Ansible &gt;2.0 which is suitable
for use with Kolla. Note that you will need to enable access to the EPEL
repository to install via yum &#8211; to do so, take a look at Fedora&#8217;s EPEL <a class="reference external" href="https://fedoraproject.org/wiki/EPEL">docs</a> and <a class="reference external" href="https://fedoraproject.org/wiki/EPEL/FAQ">FAQ</a>.</p>
<p>On CentOS or RHEL systems, this can be done using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>yum install ansible
</pre></div>
</div>
<p>Many DEB based systems do not meet Kolla&#8217;s Ansible version requirements. It is
recommended to use pip to install Ansible &gt;2.0. Finally Ansible &gt;2.0 may be
installed using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>pip install -U ansible
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is recommended to use virtualenv to install non-system packages.</p>
</div>
<p>If DEB based systems include a version of Ansible that meets Kolla&#8217;s version
requirements it can be installed by:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>apt-get install ansible
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Kolla uses PBR in its implementation. PBR provides version information
to Kolla about the package in use. This information is later used when
building images to specify the Docker tag used in the image built. When
installing the Kolla package via pip, PBR will always use the PBR version
information. When obtaining a copy of the software via git, PBR will use
the git version information, but <strong>ONLY</strong> if Kolla has not been pip
installed via the pip package manager. This is why there is an operator
workflow and a developer workflow.</p>
</div>
<p>The following dependencies can be installed by bootstraping the host machine
as described in the <a class="reference internal" href="#automatic-host-bootstrap">Automatic host bootstrap</a> section. For manual
installation, follow the instructions below:</p>
<p>Since Docker is required to build images as well as be present on all deployed
targets, the Kolla community recommends installing the official Docker, Inc.
packaged version of Docker for maximum stability and compatibility with the
following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>curl -sSL https://get.docker.io | bash
</pre></div>
</div>
<p>This command will install the most recent stable version of Docker, but please
note that Kolla releases are not in sync with Docker in any way, so some things
could stop working with new version. The latest release of Kolla is tested to
work with docker-engine&gt;=1.10.0,!=1.13.0. To check your Docker version run this
command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p>When running with systemd, setup docker-engine with the appropriate information
in the Docker daemon to launch with. This means setting up the following
information in the <code class="docutils literal"><span class="pre">docker.service</span></code> file. If you do not set the MountFlags
option correctly then <code class="docutils literal"><span class="pre">kolla-ansible</span></code> will fail to deploy the
<code class="docutils literal"><span class="pre">neutron-dhcp-agent</span></code> container and throws APIError/HTTPError. After adding
the drop-in unit file as follows, reload and restart the Docker service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Create the drop-in unit directory for docker.service</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">d</span>

<span class="c1"># Create the drop-in unit file</span>
<span class="n">tee</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">kolla</span><span class="o">.</span><span class="n">conf</span> <span class="o">&lt;&lt;-</span><span class="s1">&#39;EOF&#39;</span>
<span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<span class="n">MountFlags</span><span class="o">=</span><span class="n">shared</span>
<span class="n">EOF</span>
</pre></div>
</div>
<p>Restart Docker by executing the following commands:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># Run these commands to reload the daemon
systemctl daemon-reload
systemctl restart docker
</pre></div>
</div>
<p>On the target hosts you also need an updated version of the Docker python
libraries:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The old docker-python is obsoleted by python-docker-py.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>yum install python-docker-py
</pre></div>
</div>
<p>Or using <code class="docutils literal"><span class="pre">pip</span></code> to install the latest version:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>pip install -U docker-py
</pre></div>
</div>
<p>OpenStack, RabbitMQ, and Ceph require all hosts to have matching times to
ensure proper message delivery. In the case of Ceph, it will complain if the
hosts differ by more than 0.05 seconds. Some OpenStack services have timers as
low as 2 seconds by default. For these reasons it is highly recommended to
setup an NTP service of some kind. While <code class="docutils literal"><span class="pre">ntpd</span></code> will achieve more accurate
time for the deployment if the NTP servers are running in the local deployment
environment, <a class="reference external" href="http://chrony.tuxfamily.org">chrony</a> is more accurate when
syncing the time across a WAN connection. When running Ceph it is recommended
to setup <code class="docutils literal"><span class="pre">ntpd</span></code> to sync time locally due to the tight time constraints.</p>
<p>To install, start, and enable ntp on CentOS execute the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># CentOS 7
yum install ntp
systemctl enable ntpd.service
systemctl start ntpd.service
</pre></div>
</div>
<p>To install and start on Debian based systems execute the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>apt-get install ntp
</pre></div>
</div>
<p>Libvirt is started by default on many operating systems. Please disable
<code class="docutils literal"><span class="pre">libvirt</span></code> on any machines that will be deployment targets. Only one copy of
libvirt may be running at a time.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># CentOS 7
systemctl stop libvirtd.service
systemctl disable libvirtd.service

# Ubuntu
service libvirt-bin stop
update-rc.d libvirt-bin disable
</pre></div>
</div>
<p>On Ubuntu, apparmor will sometimes prevent libvirt from working.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/usr/sbin/libvirtd: error while loading shared libraries:
libvirt-admin.so.0: cannot open shared object file: Permission denied
</pre></div>
</div>
<p>If you are seeing the libvirt container fail with the error above, disable the
libvirt profile.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo apparmor_parser -R /etc/apparmor.d/usr.sbin.libvirtd
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On Ubuntu 16.04, please uninstall lxd and lxc packages. (An issue exists
with cgroup mounts, mounts exponentially increasing when restarting
container).</p>
</div>
</div>
<div class="section" id="additional-steps-for-upstart-and-other-non-systemd-distros">
<h2>Additional steps for upstart and other non-systemd distros<a class="headerlink" href="#additional-steps-for-upstart-and-other-non-systemd-distros" title="Permalink to this headline">¶</a></h2>
<p>For Ubuntu 14.04 which uses upstart and other non-systemd distros, run the
following.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="o">--</span><span class="n">make</span><span class="o">-</span><span class="n">shared</span> <span class="o">/</span><span class="n">run</span>
<span class="n">mount</span> <span class="o">--</span><span class="n">make</span><span class="o">-</span><span class="n">shared</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nova</span><span class="o">/</span><span class="n">mnt</span>
</pre></div>
</div>
<p>If /var/lib/nova/mnt is not present, can do below work around.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nova</span><span class="o">/</span><span class="n">mnt</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nova</span><span class="o">/</span><span class="n">mnt1</span>
<span class="n">mount</span> <span class="o">--</span><span class="n">bind</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nova</span><span class="o">/</span><span class="n">mnt1</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nova</span><span class="o">/</span><span class="n">mnt</span>
<span class="n">mount</span> <span class="o">--</span><span class="n">make</span><span class="o">-</span><span class="n">shared</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nova</span><span class="o">/</span><span class="n">mnt</span>
</pre></div>
</div>
<p>For mounting /run and /var/lib/nova/mnt as shared upon startup, edit
/etc/rc.local to add the following.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="o">--</span><span class="n">make</span><span class="o">-</span><span class="n">shared</span> <span class="o">/</span><span class="n">run</span>
<span class="n">mount</span> <span class="o">--</span><span class="n">make</span><span class="o">-</span><span class="n">shared</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nova</span><span class="o">/</span><span class="n">mnt</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If CentOS/Fedora/OracleLinux container images are built on an Ubuntu host,
the back-end storage driver must not be AUFS (see the known issues in
<a class="reference external" href="http://docs.openstack.org/developer/kolla/image-building.html">Building Container Images</a>).</p>
</div>
</div>
<div class="section" id="install-kolla-for-deployment-or-evaluation">
<h2>Install Kolla for deployment or evaluation<a class="headerlink" href="#install-kolla-for-deployment-or-evaluation" title="Permalink to this headline">¶</a></h2>
<p>Install kolla-ansible and its dependencies using pip.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>pip install kolla-ansible
</pre></div>
</div>
<p>Copy the configuration files globals.yml and passwords.yml to /etc directory.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>#CentOS
cp -r /usr/share/kolla/etc_examples/kolla /etc/kolla/

#Ubuntu
cp -r /usr/local/share/kolla/etc_examples/kolla /etc/kolla/
</pre></div>
</div>
<p>The inventory files (all-in-one and multinode) are located in
/usr/local/share/kolla/ansible/inventory. Copy the configuration files to the
current directory.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>#CentOS
cp /usr/share/kolla/ansible/inventory/* .

#Ubuntu
cp /usr/local/share/kolla/ansible/inventory/* .
</pre></div>
</div>
</div>
<div class="section" id="install-kolla-for-development">
<h2>Install Kolla for development<a class="headerlink" href="#install-kolla-for-development" title="Permalink to this headline">¶</a></h2>
<p>Clone the Kolla and Kolla-Ansible repositories from git.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>git clone https://github.com/openstack/kolla
git clone https://github.com/openstack/kolla-ansible
</pre></div>
</div>
<p>Kolla-ansible holds configuration files (globals.yml and passwords.yml) in
etc/kolla.  Copy the configuration files to /etc directory.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cp -r kolla-ansible/etc/kolla /etc/kolla/
</pre></div>
</div>
<p>Kolla-ansible holds the inventory files (all-in-one and multinode) in
ansible/inventory. Copy the configuration files to the current directory.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cp kolla-ansible/ansible/inventory/* .
</pre></div>
</div>
</div>
<div class="section" id="local-registry">
<h2>Local Registry<a class="headerlink" href="#local-registry" title="Permalink to this headline">¶</a></h2>
<p>A local registry is recommended but not required for an <code class="docutils literal"><span class="pre">all-in-one</span></code>
installation when developing for master. Since no master images are available
on docker hub, the docker cache may be used for all-in-one deployments.  When
deploying multinode, a registry is strongly recommended to serve as a single
source of images. Reference the <a class="reference internal" href="multinode.html"><em>Multinode Deployment of Kolla</em></a> for more information on using
a local Docker registry. Otherwise, the Docker Hub Image Registry contains all
images from each of Kolla’s major releases. The latest release tag is 3.0.2 for
Newton.</p>
</div>
<div class="section" id="automatic-host-bootstrap">
<h2>Automatic host bootstrap<a class="headerlink" href="#automatic-host-bootstrap" title="Permalink to this headline">¶</a></h2>
<p>Edit the <code class="docutils literal"><span class="pre">/etc/kolla/globals.yml</span></code> file to configure interfaces.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>network_interface: &quot;ens3&quot;
neutron_external_interface: &quot;ens4&quot;
</pre></div>
</div>
<p>Generate passwords. This will populate all empty fields in the
<code class="docutils literal"><span class="pre">/etc/kolla/passwords.yml</span></code> file using randomly generated values to secure the
deployment. Optionally, the passwords may be populated in the file by hand.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">kolla</span><span class="o">-</span><span class="n">genpwd</span>
</pre></div>
</div>
<p>To quickly prepare hosts, playbook bootstrap-servers can be used.This is an
Ansible playbook which works on Ubuntu 14.04, 16.04 and CentOS 7 hosts to
install and prepare the cluster for OpenStack installation.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>kolla-ansible -i &lt;&lt;inventory file&gt;&gt; bootstrap-servers
</pre></div>
</div>
</div>
<div class="section" id="build-container-images">
<h2>Build container images<a class="headerlink" href="#build-container-images" title="Permalink to this headline">¶</a></h2>
<p>When running with systemd, edit the file
<code class="docutils literal"><span class="pre">/etc/systemd/system/docker.service.d/kolla.conf</span></code>
to include the MTU size to be used for Docker containers.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[Service]
MountFlags=shared
ExecStart=
ExecStart=/usr/bin/docker daemon \
 -H fd:// \
 --mtu 1400
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The MTU size should be less than or equal to the MTU size allowed on the
network interfaces of the host machine. If the MTU size allowed on the
network interfaces of the host machine is 1500 then this step can be
skipped. This step is relevant for building containers. Actual openstack
services won&#8217;t be affected.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Verify that the MountFlags parameter is configured as shared. If you do not
set the MountFlags option correctly then kolla-ansible will fail to deploy the
neutron-dhcp-agent container and throws APIError/HTTPError.</p>
</div>
<p>Restart Docker and ensure that Docker is running.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>systemctl daemon-reload
systemctl restart docker
</pre></div>
</div>
<p>The Kolla community builds and pushes tested images for each tagged release of
Kolla.  Pull required images with appropriate tags.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>kolla-ansible pull
</pre></div>
</div>
<p>View the images.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>docker images
</pre></div>
</div>
<p>Developers running from master are required to build container images as
the Docker Hub does not contain built images for the master branch.
Reference the <a class="reference external" href="http://docs.openstack.org/developer/kolla/image-building.html">Building Container Images</a> for more advanced build configuration.</p>
<p>To build images using default parameters run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">kolla</span><span class="o">-</span><span class="n">build</span>
</pre></div>
</div>
<p>By default kolla-build will build all containers using CentOS as the base image
and binary installation as base installation method. To change this behavior,
please use the following parameters with kolla-build:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">base</span> <span class="p">[</span><span class="n">ubuntu</span><span class="o">|</span><span class="n">centos</span><span class="o">|</span><span class="n">oraclelinux</span><span class="p">]</span>
<span class="o">--</span><span class="nb">type</span> <span class="p">[</span><span class="n">binary</span><span class="o">|</span><span class="n">source</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">&#8211;base and &#8211;type can be added to the above kolla-build command if
different distributions or types are desired.</p>
</div>
<p>It is also possible to build individual container images. As an example, if the
glance images failed to build, all glance related images can be rebuilt as
follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>kolla-build glance
</pre></div>
</div>
<p>In order to see all available parameters, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">kolla</span><span class="o">-</span><span class="n">build</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>View the images.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>docker images
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Mixing of OpenStack releases with Kolla releases (example, updating
kolla-build.conf to build Mitaka Keystone to be deployed with Newton Kolla) is
not recommended and will likely cause issues.</p>
</div>
</div>
<div class="section" id="deploy-kolla">
<h2>Deploy Kolla<a class="headerlink" href="#deploy-kolla" title="Permalink to this headline">¶</a></h2>
<p>Kolla-Ansible is used to deploy containers by using images built by Kolla.
There are two methods of deployment: <em>all-in-one</em> and <em>multinode</em>.  The
<em>all-in-one</em> deployment is similar to <a class="reference external" href="http://docs.openstack.org/developer/devstack/">devstack</a> deploy which installs all
OpenStack services on a single host. In the <em>multinode</em> deployment, OpenStack
services can be run on specific hosts. This documentation describes deploying
an <em>all-in-one</em> setup. To setup <em>multinode</em> see the <a class="reference internal" href="multinode.html"><em>Multinode Deployment of Kolla</em></a>.</p>
<p>Each method is represented as an Ansible inventory file. More information on
the Ansible inventory file can be found in the Ansible <a class="reference external" href="https://docs.ansible.com/intro_inventory.html">inventory introduction</a>.</p>
<p>All variables for the environment can be specified in the files:
<code class="docutils literal"><span class="pre">/etc/kolla/globals.yml</span></code> and <code class="docutils literal"><span class="pre">/etc/kolla/passwords.yml</span></code>.</p>
<p>Generate passwords for <code class="docutils literal"><span class="pre">/etc/kolla/passwords.yml</span></code> using the provided
<code class="docutils literal"><span class="pre">kolla-genpwd</span></code> tool. The tool will populate all empty fields in the
<code class="docutils literal"><span class="pre">/etc/kolla/passwords.yml</span></code> file using randomly generated values to secure the
deployment. Optionally, the passwords may be populate in the file by hand.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">kolla</span><span class="o">-</span><span class="n">genpwd</span>
</pre></div>
</div>
<p>Start by editing <code class="docutils literal"><span class="pre">/etc/kolla/globals.yml</span></code>. Check and edit, if needed, these
parameters: <code class="docutils literal"><span class="pre">kolla_base_distro</span></code>, <code class="docutils literal"><span class="pre">kolla_install_type</span></code>. The default for
<code class="docutils literal"><span class="pre">kolla_base_distro</span></code> is <code class="docutils literal"><span class="pre">centos</span></code> and for <code class="docutils literal"><span class="pre">kolla_install_type</span></code> is
<code class="docutils literal"><span class="pre">binary</span></code>. If you want to use ubuntu with source type, then you should make
sure globals.yml has the following entries:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>kolla_base_distro: &quot;ubuntu&quot;
kolla_install_type: &quot;source&quot;
</pre></div>
</div>
<p>Please specify an unused IP address in the network to act as a VIP for
<code class="docutils literal"><span class="pre">kolla_internal_vip_address</span></code>. The VIP will be used with keepalived and added
to the <code class="docutils literal"><span class="pre">api_interface</span></code> as specified in the <code class="docutils literal"><span class="pre">globals.yml</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>kolla_internal_vip_address: “192.168.137.79”
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The kolla_internal_vip_address must be unique and should belong to the same
network to which the first network interface belongs to.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The kolla_base_distro and kolla_install_type should be same as base and
install_type used in kolla-build command line.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">network_interface</span></code> variable is the interface to which Kolla binds API
services. For example, when starting Mariadb, it will bind to the IP on the
interface list in the <code class="docutils literal"><span class="pre">network_interface</span></code> variable.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>network_interface: &quot;ens3&quot;
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">neutron_external_interface</span></code> variable is the interface that will be used
for the external bridge in Neutron. Without this bridge the deployment instance
traffic will be unable to access the rest of the Internet.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>neutron_external_interface: &quot;ens4&quot;
</pre></div>
</div>
<p>In case of deployment using the <strong>nested</strong> environment (eg. Using Virtualbox
VM’s, KVM VM’s), verify if your compute node supports hardware acceleration for
virtual machines by executing the following command in the <em>compute node</em>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>egrep -c &#39;(vmx|svm)&#39; /proc/cpuinfo
</pre></div>
</div>
<p>If this command returns a value of <strong>zero</strong>, your compute node does not support
hardware acceleration and you <strong>must</strong> configure libvirt to use <strong>QEMU</strong>
instead of KVM. Create a file /etc/kolla/config/nova/nova-compute.conf and add
the content shown below.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>mkdir /etc/kolla/config/nova
cat &lt;&lt; EOF &gt; /etc/kolla/config/nova/nova-compute.conf
[libvirt]
virt_type=qemu
EOF
</pre></div>
</div>
<p>For <em>all-in-one</em> deployments, the following commands can be run. These will
setup all of the containers on the localhost. These commands will be
wrapped in the kolla-script in the future.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even for all-in-one installs it is possible to use the Docker
registry for deployment, although not strictly required.</p>
</div>
<p>First, validate that the deployment targets are in a state where Kolla may
deploy to them. Provide the correct path to inventory file in the following
commands.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>kolla-ansible prechecks -i /path/to/all-in-one
</pre></div>
</div>
<p>Deploy OpenStack.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>kolla-ansible deploy -i /path/to/all-in-one
</pre></div>
</div>
<p>List the running containers.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>docker ps -a
</pre></div>
</div>
<p>Generate the <code class="docutils literal"><span class="pre">admin-openrc.sh</span></code> file. The file will be created in
<code class="docutils literal"><span class="pre">/etc/kolla/</span></code> directory.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>kolla-ansible post-deploy
</pre></div>
</div>
<p>To test your deployment, run the following commands to initialize the network
with a glance image and neutron networks.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>source /etc/kolla/admin-openrc.sh

#centOS
cd /usr/share/kolla
./init-runonce

#ubuntu
cd /usr/local/share/kolla
./init-runonce
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Different hardware results in results in variance with deployment times.</p>
</div>
<p>After successful deployment of OpenStack, the Horizon dashboard will be
available by entering IP address or hostname from <code class="docutils literal"><span class="pre">kolla_external_fqdn</span></code>, or
<code class="docutils literal"><span class="pre">kolla_internal_fqdn</span></code>. If these variables were not set during deploy they
default to <code class="docutils literal"><span class="pre">kolla_internal_vip_address</span></code>.</p>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Quick Start</a><ul>
<li><a class="reference internal" href="#host-machine-requirements">Host machine requirements</a></li>
<li><a class="reference internal" href="#recommended-environment">Recommended environment</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#install-dependencies">Install dependencies</a></li>
<li><a class="reference internal" href="#additional-steps-for-upstart-and-other-non-systemd-distros">Additional steps for upstart and other non-systemd distros</a></li>
<li><a class="reference internal" href="#install-kolla-for-deployment-or-evaluation">Install Kolla for deployment or evaluation</a></li>
<li><a class="reference internal" href="#install-kolla-for-development">Install Kolla for development</a></li>
<li><a class="reference internal" href="#local-registry">Local Registry</a></li>
<li><a class="reference internal" href="#automatic-host-bootstrap">Automatic host bootstrap</a></li>
<li><a class="reference internal" href="#build-container-images">Build container images</a></li>
<li><a class="reference internal" href="#deploy-kolla">Deploy Kolla</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="production-architecture-guide.html"
                                  title="previous chapter">Production architecture guide</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="multinode.html"
                                  title="next chapter">Multinode Deployment of Kolla</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/kolla-ansible
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/quickstart.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="multinode.html" title="Multinode Deployment of Kolla"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="production-architecture-guide.html" title="Production architecture guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">kolla-ansible 4.0.0.0b4.dev153 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, OpenStack Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/kolla-ansible");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>