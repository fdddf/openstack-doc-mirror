<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Software configuration &mdash; heat 8.0.0.0rc2.dev38 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '8.0.0.0rc2.dev38',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="heat 8.0.0.0rc2.dev38 documentation" href="../index.html" />
    <link rel="up" title="Template Guide" href="index.html" />
    <link rel="next" title="Environments" href="environment.html" />
    <link rel="prev" title="Instances" href="basic_resources.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="software-configuration">
<span id="software-deployment"></span><h1>Software configuration<a class="headerlink" href="#software-configuration" title="Permalink to this headline">¶</a></h1>
<p>There are a variety of options to configure the software which runs on the
servers in your stack. These can be broadly divided into the following:</p>
<ul class="simple">
<li>Custom image building</li>
<li>User-data boot scripts and cloud-init</li>
<li>Software deployment resources</li>
</ul>
<p>This section will describe each of these options and provide examples for
using them together in your stacks.</p>
<div class="section" id="image-building">
<h2>Image building<a class="headerlink" href="#image-building" title="Permalink to this headline">¶</a></h2>
<p>The first opportunity to influence what software is configured on your servers
is by booting them with a custom-built image. There are a number of reasons
you might want to do this, including:</p>
<ul class="simple">
<li><strong>Boot speed</strong> - since the required software is already on the image there
is no need to download and install anything at boot time.</li>
<li><strong>Boot reliability</strong> - software downloads can fail for a number of reasons
including transient network failures and inconsistent software repositories.</li>
<li><strong>Test verification</strong> - custom built images can be verified in test
environments before being promoted to production.</li>
<li><strong>Configuration dependencies</strong> - post-boot configuration may depend on
agents already being installed and enabled</li>
</ul>
<p>A number of tools are available for building custom images, including:</p>
<ul class="simple">
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack/diskimage-builder">diskimage-builder</a> image building tools for OpenStack</li>
<li><a class="reference external" href="http://imgfac.org/">imagefactory</a> builds images for a variety of operating system/cloud
combinations</li>
</ul>
<p>Examples in this guide which require custom images will use <a class="reference external" href="https://git.openstack.org/cgit/openstack/diskimage-builder">diskimage-builder</a>.</p>
</div>
<div class="section" id="user-data-boot-scripts-and-cloud-init">
<h2>User-data boot scripts and cloud-init<a class="headerlink" href="#user-data-boot-scripts-and-cloud-init" title="Permalink to this headline">¶</a></h2>
<p>When booting a server it is possible to specify the contents of the user-data
to be passed to that server. This user-data is made available either from
configured config-drive or from the <a class="reference external" href="http://docs.openstack.org/admin-guide/compute-networking-nova.html#metadata-service">Metadata service</a>.</p>
<p>How this user-data is consumed depends on the image being booted, but the most
commonly used tool for default cloud images is <a class="reference external" href="http://cloudinit.readthedocs.org/en/latest/">Cloud-init</a>.</p>
<p>Whether the image is using <a class="reference external" href="http://cloudinit.readthedocs.org/en/latest/">Cloud-init</a> or not, it should be possible to
specify a shell script in the <code class="docutils literal"><span class="pre">user_data</span></code> property and have it be executed by
the server during boot:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>

  <span class="l l-Scalar l-Scalar-Plain">the_server</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="c1"># flavor, image etc</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">#!/bin/bash</span>
        <span class="no">echo &quot;Running boot script&quot;</span>
        <span class="no"># ...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Debugging these scripts it is often useful to view the boot
log using <code class="code docutils literal"><span class="pre">nova</span> <span class="pre">console-log</span> <span class="pre">&lt;server-id&gt;</span></code> to view the progress of boot
script execution.</p>
</div>
<p>Often there is a need to set variable values based on parameters or resources
in the stack. This can be done with the <code class="code docutils literal"><span class="pre">str_replace</span></code> intrinsic function:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">foo</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">default</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>

<span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>

  <span class="l l-Scalar l-Scalar-Plain">the_server</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="c1"># flavor, image etc</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">str_replace</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
            <span class="no">#!/bin/bash</span>
            <span class="no">echo &quot;Running boot script with $FOO&quot;</span>
            <span class="no"># ...</span>
          <span class="l l-Scalar l-Scalar-Plain">params</span><span class="p p-Indicator">:</span>
           <span class="l l-Scalar l-Scalar-Plain">$FOO</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_param</span><span class="p p-Indicator">:</span> <span class="nv">foo</span><span class="p p-Indicator">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If a stack-update is performed and there are any changes
at all to the content of user_data then the server will be replaced
(deleted and recreated) so that the modified boot configuration can be
run on a new server.</p>
</div>
<p>When these scripts grow it can become difficult to maintain them inside the
template, so the <code class="docutils literal"><span class="pre">get_file</span></code> intrinsic function can be used to maintain the
script in a separate file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">foo</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">default</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>

<span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>

  <span class="l l-Scalar l-Scalar-Plain">the_server</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="c1"># flavor, image etc</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">str_replace</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_file</span><span class="p p-Indicator">:</span> <span class="nv">the_server_boot.sh</span><span class="p p-Indicator">}</span>
          <span class="l l-Scalar l-Scalar-Plain">params</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">$FOO</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_param</span><span class="p p-Indicator">:</span> <span class="nv">foo</span><span class="p p-Indicator">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">str_replace</span></code> can replace any strings, not just strings
starting with <code class="docutils literal"><span class="pre">$</span></code>. However doing this for the above example is useful
because the script file can be executed for testing by passing in
environment variables.</p>
</div>
<div class="section" id="choosing-the-user-data-format">
<h3>Choosing the user_data_format<a class="headerlink" href="#choosing-the-user-data-format" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="openstack.html#OS::Nova::Server" title="OS::Nova::Server"><span class="xref std std-ref">OS::Nova::Server</span></a> <code class="docutils literal"><span class="pre">user_data_format</span></code> property determines how the
<code class="docutils literal"><span class="pre">user_data</span></code> should be formatted for the server. For the default value
<code class="docutils literal"><span class="pre">HEAT_CFNTOOLS</span></code>, the <code class="docutils literal"><span class="pre">user_data</span></code> is bundled as part of the heat-cfntools
cloud-init boot configuration data. While <code class="docutils literal"><span class="pre">HEAT_CFNTOOLS</span></code> is the default
for <code class="docutils literal"><span class="pre">user_data_format</span></code>, it is considered legacy and <code class="docutils literal"><span class="pre">RAW</span></code> or
<code class="docutils literal"><span class="pre">SOFTWARE_CONFIG</span></code> will generally be more appropriate.</p>
<p>For <code class="docutils literal"><span class="pre">RAW</span></code> the user_data is passed to Nova unmodified. For a <a class="reference external" href="http://cloudinit.readthedocs.org/en/latest/">Cloud-init</a>
enabled image, the following are both valid <code class="docutils literal"><span class="pre">RAW</span></code> user-data:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>

  <span class="l l-Scalar l-Scalar-Plain">server_with_boot_script</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="c1"># flavor, image etc</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">RAW</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">#!/bin/bash</span>
        <span class="no">echo &quot;Running boot script&quot;</span>
        <span class="no"># ...</span>

  <span class="l l-Scalar l-Scalar-Plain">server_with_cloud_config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="c1"># flavor, image etc</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">RAW</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">#cloud-config</span>
        <span class="no">final_message: &quot;The system is finally up, after $UPTIME seconds&quot;</span>
</pre></div>
</div>
<p>For <code class="docutils literal"><span class="pre">SOFTWARE_CONFIG</span></code> <code class="docutils literal"><span class="pre">user_data</span></code> is bundled as part of the software config
data, and metadata is derived from any associated
<a class="reference internal" href="#software-deployment-resources">Software deployment resources</a>.</p>
</div>
<div class="section" id="signals-and-wait-conditions">
<h3>Signals and wait conditions<a class="headerlink" href="#signals-and-wait-conditions" title="Permalink to this headline">¶</a></h3>
<p>Often it is necessary to pause further creation of stack resources until the
boot configuration script has notified that it has reached a certain state.
This is usually either to notify that a service is now active, or to pass out
some generated data which is needed by another resource. The resources
<a class="reference internal" href="openstack.html#OS::Heat::WaitCondition" title="OS::Heat::WaitCondition"><span class="xref std std-ref">OS::Heat::WaitCondition</span></a> and <a class="reference internal" href="openstack.html#OS::Heat::SwiftSignal" title="OS::Heat::SwiftSignal"><span class="xref std std-ref">OS::Heat::SwiftSignal</span></a> both perform
this function using different techniques and tradeoffs.</p>
<p><a class="reference internal" href="openstack.html#OS::Heat::WaitCondition" title="OS::Heat::WaitCondition"><span class="xref std std-ref">OS::Heat::WaitCondition</span></a> is implemented as a call to the
<a class="reference external" href="http://developer.openstack.org/api-ref/orchestration/v1/">Orchestration API</a> resource signal. The token is created using credentials
for a user account which is scoped only to the wait condition handle
resource. This user is created when the handle is created, and is associated
to a project which belongs to the stack, in an identity domain which is
dedicated to the orchestration service.</p>
<p>Sending the signal is a simple HTTP request, as with this example using <a class="reference external" href="http://curl.haxx.se/">curl</a>:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>curl -i -X POST -H <span class="s1">&#39;X-Auth-Token: &lt;token&gt;&#39;</span> <span class="se">\</span>
     -H <span class="s1">&#39;Content-Type: application/json&#39;</span> -H <span class="s1">&#39;Accept: application/json&#39;</span> <span class="se">\</span>
     <span class="s1">&#39;&lt;wait condition URL&gt;&#39;</span> --data-binary <span class="s1">&#39;&lt;json containing signal data&gt;&#39;</span>
</pre></div>
</div>
<p>The JSON containing the signal data is expected to be of the following format:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
  <span class="nt">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;The reason which will appear in the &#39;heat event-list&#39; output&quot;</span><span class="p">,</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;Data to be used elsewhere in the template via get_attr&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;Optional unique ID of signal&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>All of these values are optional, and if not specified will be set to the
following defaults:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
  <span class="nt">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Signal &lt;id&gt; received&quot;</span><span class="p">,</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;sequential number starting from 1 for each signal received&gt;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If <code class="docutils literal"><span class="pre">status</span></code> is set to <code class="docutils literal"><span class="pre">FAILURE</span></code> then the resource (and the stack) will go
into a <code class="docutils literal"><span class="pre">FAILED</span></code> state using the <code class="docutils literal"><span class="pre">reason</span></code> as failure reason.</p>
<p>The following template example uses the convenience attribute <code class="docutils literal"><span class="pre">curl_cli</span></code>
which builds a curl command with a valid token:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">wait_condition</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::WaitCondition</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">handle</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_resource</span><span class="p p-Indicator">:</span> <span class="nv">wait_handle</span><span class="p p-Indicator">}</span>
      <span class="c1"># Note, count of 5 vs 6 is due to duplicate signal ID 5 sent below</span>
      <span class="l l-Scalar l-Scalar-Plain">count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
      <span class="l l-Scalar l-Scalar-Plain">timeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>

  <span class="l l-Scalar l-Scalar-Plain">wait_handle</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::WaitConditionHandle</span>

  <span class="l l-Scalar l-Scalar-Plain">the_server</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="c1"># flavor, image etc</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">RAW</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">str_replace</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
            <span class="no">#!/bin/sh</span>
            <span class="no"># Below are some examples of the various ways signals</span>
            <span class="no"># can be sent to the Handle resource</span>

            <span class="no"># Simple success signal</span>
            <span class="no">wc_notify --data-binary &#39;{&quot;status&quot;: &quot;SUCCESS&quot;}&#39;</span>

            <span class="no"># Or you optionally can specify any of the additional fields</span>
            <span class="no">wc_notify --data-binary &#39;{&quot;status&quot;: &quot;SUCCESS&quot;, &quot;reason&quot;: &quot;signal2&quot;}&#39;</span>
            <span class="no">wc_notify --data-binary &#39;{&quot;status&quot;: &quot;SUCCESS&quot;, &quot;reason&quot;: &quot;signal3&quot;, &quot;data&quot;: &quot;data3&quot;}&#39;</span>
            <span class="no">wc_notify --data-binary &#39;{&quot;status&quot;: &quot;SUCCESS&quot;, &quot;reason&quot;: &quot;signal4&quot;, &quot;id&quot;: &quot;id4&quot;, &quot;data&quot;: &quot;data4&quot;}&#39;</span>

            <span class="no"># If you require control of the ID, you can pass it.</span>
            <span class="no"># The ID should be unique, unless you intend for duplicate</span>
            <span class="no"># signals to overwrite each other.  The following two calls</span>
            <span class="no"># do the exact same thing, and will be treated as one signal</span>
            <span class="no"># (You can prove this by changing count above to 7)</span>
            <span class="no">wc_notify --data-binary &#39;{&quot;status&quot;: &quot;SUCCESS&quot;, &quot;id&quot;: &quot;id5&quot;}&#39;</span>
            <span class="no">wc_notify --data-binary &#39;{&quot;status&quot;: &quot;SUCCESS&quot;, &quot;id&quot;: &quot;id5&quot;}&#39;</span>

            <span class="no"># Example of sending a failure signal, optionally</span>
            <span class="no"># reason, id, and data can be specified as above</span>
            <span class="no"># wc_notify --data-binary &#39;{&quot;status&quot;: &quot;FAILURE&quot;}&#39;</span>
          <span class="l l-Scalar l-Scalar-Plain">params</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">wc_notify</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">get_attr</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">wait_handle</span><span class="p p-Indicator">,</span> <span class="nv">curl_cli</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">}</span>

<span class="l l-Scalar l-Scalar-Plain">outputs</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">wc_data</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">get_attr</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">wait_condition</span><span class="p p-Indicator">,</span> <span class="nv">data</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">}</span>
    <span class="c1"># this would return the following json</span>
    <span class="c1"># {&quot;1&quot;: null, &quot;2&quot;: null, &quot;3&quot;: &quot;data3&quot;, &quot;id4&quot;: &quot;data4&quot;, &quot;id5&quot;: null}</span>

  <span class="l l-Scalar l-Scalar-Plain">wc_data_4</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="s">&#39;Fn::Select&#39;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;id4&#39;</span><span class="p p-Indicator">,</span> <span class="p p-Indicator">{</span> <span class="nv">get_attr</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">wait_condition</span><span class="p p-Indicator">,</span> <span class="nv">data</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">}]</span> <span class="p p-Indicator">}</span>
    <span class="c1"># this would return &quot;data4&quot;</span>
</pre></div>
</div>
<p><a class="reference internal" href="openstack.html#OS::Heat::SwiftSignal" title="OS::Heat::SwiftSignal"><span class="xref std std-ref">OS::Heat::SwiftSignal</span></a> is implemented by creating an Object Storage
API temporary URL which is populated with signal data with an HTTP PUT. The
orchestration service will poll this object until the signal data is available.
Object versioning is used to store multiple signals.</p>
<p>Sending the signal is a simple HTTP request, as with this example using <a class="reference external" href="http://curl.haxx.se/">curl</a>:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>curl -i -X PUT <span class="s1">&#39;&lt;object URL&gt;&#39;</span> --data-binary <span class="s1">&#39;&lt;json containing signal data&gt;&#39;</span>
</pre></div>
</div>
<p>The above template example only needs to have the <code class="docutils literal"><span class="pre">type</span></code> changed to the
swift signal resources:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">signal</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::SwiftSignal</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">handle</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_resource</span><span class="p p-Indicator">:</span> <span class="nv">wait_handle</span><span class="p p-Indicator">}</span>
      <span class="l l-Scalar l-Scalar-Plain">timeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>

  <span class="l l-Scalar l-Scalar-Plain">signal_handle</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::SwiftSignalHandle</span>
  <span class="c1"># ...</span>
</pre></div>
</div>
<p>The decision to use <a class="reference internal" href="openstack.html#OS::Heat::WaitCondition" title="OS::Heat::WaitCondition"><span class="xref std std-ref">OS::Heat::WaitCondition</span></a> or
<a class="reference internal" href="openstack.html#OS::Heat::SwiftSignal" title="OS::Heat::SwiftSignal"><span class="xref std std-ref">OS::Heat::SwiftSignal</span></a> will depend on a few factors:</p>
<ul class="simple">
<li><a class="reference internal" href="openstack.html#OS::Heat::SwiftSignal" title="OS::Heat::SwiftSignal"><span class="xref std std-ref">OS::Heat::SwiftSignal</span></a> depends on the availability of an Object
Storage API</li>
<li><a class="reference internal" href="openstack.html#OS::Heat::WaitCondition" title="OS::Heat::WaitCondition"><span class="xref std std-ref">OS::Heat::WaitCondition</span></a> depends on whether the orchestration
service has been configured with a dedicated stack domain (which may depend
on the availability of an Identity V3 API).</li>
<li>The preference to protect signal URLs with token authentication or a
secret webhook URL.</li>
</ul>
</div>
<div class="section" id="software-config-resources">
<h3>Software config resources<a class="headerlink" href="#software-config-resources" title="Permalink to this headline">¶</a></h3>
<p>Boot configuration scripts can also be managed as their own resources. This
allows configuration to be defined once and run on multiple server resources.
These software-config resources are stored and retrieved via dedicated calls
to the <a class="reference external" href="http://developer.openstack.org/api-ref/orchestration/v1/">Orchestration API</a>. It is not possible to modify the contents of an
existing software-config resource, so a stack-update which changes any
existing software-config resource will result in API calls to create a new
config and delete the old one.</p>
<p>The resource <a class="reference internal" href="openstack.html#OS::Heat::SoftwareConfig" title="OS::Heat::SoftwareConfig"><span class="xref std std-ref">OS::Heat::SoftwareConfig</span></a> is used for storing configs
represented by text scripts, for example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">boot_script</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::SoftwareConfig</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ungrouped</span>
      <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">#!/bin/bash</span>
        <span class="no">echo &quot;Running boot script&quot;</span>
        <span class="no"># ...</span>

  <span class="l l-Scalar l-Scalar-Plain">server_with_boot_script</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="c1"># flavor, image etc</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">SOFTWARE_CONFIG</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_resource</span><span class="p p-Indicator">:</span> <span class="nv">boot_script</span><span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>The resource <a class="reference internal" href="openstack.html#OS::Heat::CloudConfig" title="OS::Heat::CloudConfig"><span class="xref std std-ref">OS::Heat::CloudConfig</span></a> allows <a class="reference external" href="http://cloudinit.readthedocs.org/en/latest/">Cloud-init</a> cloud-config to
be represented as template YAML rather than a block string. This allows
intrinsic functions to be included when building the cloud-config. This also
ensures that the cloud-config is valid YAML, although no further checks for
valid cloud-config are done.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">file_content</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">The contents of the file /tmp/file</span>

<span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">boot_config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::CloudConfig</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">cloud_config</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">write_files</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/file</span>
          <span class="l l-Scalar l-Scalar-Plain">content</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_param</span><span class="p p-Indicator">:</span> <span class="nv">file_content</span><span class="p p-Indicator">}</span>

  <span class="l l-Scalar l-Scalar-Plain">server_with_cloud_config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="c1"># flavor, image etc</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">SOFTWARE_CONFIG</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_resource</span><span class="p p-Indicator">:</span> <span class="nv">boot_config</span><span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>The resource <a class="reference internal" href="openstack.html#OS::Heat::MultipartMime" title="OS::Heat::MultipartMime"><span class="xref std std-ref">OS::Heat::MultipartMime</span></a> allows multiple
<a class="reference internal" href="openstack.html#OS::Heat::SoftwareConfig" title="OS::Heat::SoftwareConfig"><span class="xref std std-ref">OS::Heat::SoftwareConfig</span></a> and <a class="reference internal" href="openstack.html#OS::Heat::CloudConfig" title="OS::Heat::CloudConfig"><span class="xref std std-ref">OS::Heat::CloudConfig</span></a>
resources to be combined into a single <a class="reference external" href="http://cloudinit.readthedocs.org/en/latest/">Cloud-init</a> multi-part message:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">parameters</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">file_content</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">The contents of the file /tmp/file</span>

  <span class="l l-Scalar l-Scalar-Plain">other_config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">The ID of a software-config resource created elsewhere</span>

<span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">boot_config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::CloudConfig</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">cloud_config</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">write_files</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/file</span>
          <span class="l l-Scalar l-Scalar-Plain">content</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_param</span><span class="p p-Indicator">:</span> <span class="nv">file_content</span><span class="p p-Indicator">}</span>

  <span class="l l-Scalar l-Scalar-Plain">boot_script</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::SoftwareConfig</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ungrouped</span>
      <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">#!/bin/bash</span>
        <span class="no">echo &quot;Running boot script&quot;</span>
        <span class="no"># ...</span>

  <span class="l l-Scalar l-Scalar-Plain">server_init</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::MultipartMime</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">parts</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_resource</span><span class="p p-Indicator">:</span> <span class="nv">boot_config</span><span class="p p-Indicator">}</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_resource</span><span class="p p-Indicator">:</span> <span class="nv">boot_script</span><span class="p p-Indicator">}</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_param</span><span class="p p-Indicator">:</span> <span class="nv">other_config</span><span class="p p-Indicator">}</span>

  <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="c1"># flavor, image etc</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">SOFTWARE_CONFIG</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_resource</span><span class="p p-Indicator">:</span> <span class="nv">server_init</span><span class="p p-Indicator">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="software-deployment-resources">
<h2>Software deployment resources<a class="headerlink" href="#software-deployment-resources" title="Permalink to this headline">¶</a></h2>
<p>There are many situations where it is not desirable to replace the server
whenever there is a configuration change. The
<a class="reference internal" href="openstack.html#OS::Heat::SoftwareDeployment" title="OS::Heat::SoftwareDeployment"><span class="xref std std-ref">OS::Heat::SoftwareDeployment</span></a> resource allows any number of software
configurations to be added or removed from a server throughout its life-cycle.</p>
<div class="section" id="building-custom-image-for-software-deployments">
<h3>Building custom image for software deployments<a class="headerlink" href="#building-custom-image-for-software-deployments" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="openstack.html#OS::Heat::SoftwareConfig" title="OS::Heat::SoftwareConfig"><span class="xref std std-ref">OS::Heat::SoftwareConfig</span></a> resources are used to store software
configuration, and a <a class="reference internal" href="openstack.html#OS::Heat::SoftwareDeployment" title="OS::Heat::SoftwareDeployment"><span class="xref std std-ref">OS::Heat::SoftwareDeployment</span></a> resource is used
to associate a config resource with one server. The <code class="docutils literal"><span class="pre">group</span></code> attribute on
<a class="reference internal" href="openstack.html#OS::Heat::SoftwareConfig" title="OS::Heat::SoftwareConfig"><span class="xref std std-ref">OS::Heat::SoftwareConfig</span></a> specifies what tool will consume the
config content.</p>
<p><a class="reference internal" href="openstack.html#OS::Heat::SoftwareConfig" title="OS::Heat::SoftwareConfig"><span class="xref std std-ref">OS::Heat::SoftwareConfig</span></a> has the ability to define a schema of
<code class="docutils literal"><span class="pre">inputs</span></code> and which the configuration script supports. Inputs are mapped to
whatever concept the configuration tool has for assigning
variables/parameters.</p>
<p>Likewise, <code class="docutils literal"><span class="pre">outputs</span></code> are mapped to the tool&#8217;s capability to export structured
data after configuration execution. For tools which do not support this,
outputs can always be written to a known file path for the hook to read.</p>
<p>The <a class="reference internal" href="openstack.html#OS::Heat::SoftwareDeployment" title="OS::Heat::SoftwareDeployment"><span class="xref std std-ref">OS::Heat::SoftwareDeployment</span></a> resource allows values to be
assigned to the config inputs, and the resource remains in an <code class="docutils literal"><span class="pre">IN_PROGRESS</span></code>
state until the server signals to heat what (if any) output values were
generated by the config script.</p>
</div>
<div class="section" id="custom-image-script">
<h3>Custom image script<a class="headerlink" href="#custom-image-script" title="Permalink to this headline">¶</a></h3>
<p>Each of the following examples requires that the servers be booted with a
custom image. The following script uses diskimage-builder to create an image
required in later examples:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="c1"># Clone the required repositories. Some of these are also available</span>
<span class="c1"># via pypi or as distro packages.</span>
git clone https://git.openstack.org/openstack/diskimage-builder.git
git clone https://git.openstack.org/openstack/tripleo-image-elements.git
git clone https://git.openstack.org/openstack/heat-agents.git

<span class="c1"># Required by diskimage-builder to discover element collections</span>
<span class="nb">export</span> <span class="nv">ELEMENTS_PATH</span><span class="o">=</span>tripleo-image-elements/elements:heat-agents/

<span class="c1"># The base operating system element(s) provided by the diskimage-builder</span>
<span class="c1"># elements collection. Other values which may work include:</span>
<span class="c1"># centos7, debian, opensuse, rhel, rhel7, or ubuntu</span>
<span class="nb">export</span> <span class="nv">BASE_ELEMENTS</span><span class="o">=</span><span class="s2">&quot;fedora selinux-permissive&quot;</span>
<span class="c1"># Install and configure the os-collect-config agent to poll the metadata</span>
<span class="c1"># server (heat service or zaqar message queue and so on) for configuration</span>
<span class="c1"># changes to execute</span>
<span class="nb">export</span> <span class="nv">AGENT_ELEMENTS</span><span class="o">=</span><span class="s2">&quot;os-collect-config os-refresh-config os-apply-config&quot;</span>


<span class="c1"># heat-config installs an os-refresh-config script which will invoke the</span>
<span class="c1"># appropriate hook to perform configuration. The element heat-config-script</span>
<span class="c1"># installs a hook to perform configuration with shell scripts</span>
<span class="nb">export</span> <span class="nv">DEPLOYMENT_BASE_ELEMENTS</span><span class="o">=</span><span class="s2">&quot;heat-config heat-config-script&quot;</span>

<span class="c1"># Install a hook for any other chosen configuration tool(s).</span>
<span class="c1"># Elements which install hooks include:</span>
<span class="c1"># heat-config-cfn-init, heat-config-puppet, or heat-config-salt</span>
<span class="nb">export</span> <span class="nv">DEPLOYMENT_TOOL</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="c1"># The name of the qcow2 image to create, and the name of the image</span>
<span class="c1"># uploaded to the OpenStack image registry.</span>
<span class="nb">export</span> <span class="nv">IMAGE_NAME</span><span class="o">=</span>fedora-software-config

<span class="c1"># Create the image</span>
diskimage-builder/bin/disk-image-create vm <span class="nv">$BASE_ELEMENTS</span> <span class="nv">$AGENT_ELEMENTS</span> <span class="se">\</span>
     <span class="nv">$DEPLOYMENT_BASE_ELEMENTS</span> <span class="nv">$DEPLOYMENT_TOOL</span> -o <span class="nv">$IMAGE_NAME</span>.qcow2

<span class="c1"># Upload the image, assuming valid credentials are already sourced</span>
openstack image create --disk-format qcow2 --container-format bare <span class="se">\</span>
    <span class="nv">$IMAGE_NAME</span> &lt; <span class="nv">$IMAGE_NAME</span>.qcow2
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Above script uses diskimage-builder, make sure the environment
already fulfill all requirements in requirements.txt of
diskimage-builder.</p>
</div>
</div>
<div class="section" id="configuring-with-scripts">
<h3>Configuring with scripts<a class="headerlink" href="#configuring-with-scripts" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#custom-image-script">Custom image script</a> already includes the <code class="docutils literal"><span class="pre">heat-config-script</span></code> element
so the built image will already have the ability to configure using shell
scripts.</p>
<p>Config inputs are mapped to shell environment variables. The script can
communicate outputs to heat by writing to the <code class="file docutils literal"><span class="pre">$heat_outputs_path.</span><em><span class="pre">output</span> <span class="pre">name</span></em></code>
file. See the following example for a script
which expects inputs <code class="docutils literal"><span class="pre">foo</span></code>, <code class="docutils literal"><span class="pre">bar</span></code> and generates an output <code class="docutils literal"><span class="pre">result</span></code>.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::SoftwareConfig</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">script</span>
      <span class="l l-Scalar l-Scalar-Plain">inputs</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
      <span class="l l-Scalar l-Scalar-Plain">outputs</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
      <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">#!/bin/sh -x</span>
        <span class="no">echo &quot;Writing to /tmp/$bar&quot;</span>
        <span class="no">echo $foo &gt; /tmp/$bar</span>
        <span class="no">echo -n &quot;The file /tmp/$bar contains `cat /tmp/$bar` for server $deploy_server_id during $deploy_action&quot; &gt; $heat_outputs_path.result</span>
        <span class="no">echo &quot;Written to /tmp/$bar&quot;</span>
        <span class="no">echo &quot;Output to stderr&quot; 1&gt;&amp;2</span>

  <span class="l l-Scalar l-Scalar-Plain">deployment</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::SoftwareDeployment</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">get_resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span>
      <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">get_resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>
      <span class="l l-Scalar l-Scalar-Plain">input_values</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">foo</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fooooo</span>
        <span class="l l-Scalar l-Scalar-Plain">bar</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">baaaaa</span>

  <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="c1"># flavor, image etc</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">SOFTWARE_CONFIG</span>

<span class="l l-Scalar l-Scalar-Plain">outputs</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">result</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">get_attr</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">deployment</span><span class="p p-Indicator">,</span> <span class="nv">result</span><span class="p p-Indicator">]</span>
  <span class="l l-Scalar l-Scalar-Plain">stdout</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">get_attr</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">deployment</span><span class="p p-Indicator">,</span> <span class="nv">deploy_stdout</span><span class="p p-Indicator">]</span>
  <span class="l l-Scalar l-Scalar-Plain">stderr</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">get_attr</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">deployment</span><span class="p p-Indicator">,</span> <span class="nv">deploy_stderr</span><span class="p p-Indicator">]</span>
  <span class="l l-Scalar l-Scalar-Plain">status_code</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">get_attr</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">deployment</span><span class="p p-Indicator">,</span> <span class="nv">deploy_status_code</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A config resource can be associated with multiple deployment
resources, and each deployment can specify the same or different values
for the <code class="docutils literal"><span class="pre">server</span></code> and <code class="docutils literal"><span class="pre">input_values</span></code> properties.</p>
</div>
<p>As can be seen in the <code class="docutils literal"><span class="pre">outputs</span></code> section of the above template, the
<code class="docutils literal"><span class="pre">result</span></code> config output value is available as an attribute on the
<code class="docutils literal"><span class="pre">deployment</span></code> resource. Likewise the captured stdout, stderr and status_code
are also available as attributes.</p>
</div>
<div class="section" id="configuring-with-os-apply-config">
<h3>Configuring with os-apply-config<a class="headerlink" href="#configuring-with-os-apply-config" title="Permalink to this headline">¶</a></h3>
<p>The agent toolchain of <code class="docutils literal"><span class="pre">os-collect-config</span></code>, <code class="docutils literal"><span class="pre">os-refresh-config</span></code> and
<code class="docutils literal"><span class="pre">os-apply-config</span></code> can actually be used on their own to inject heat stack
configuration data into a server running a custom image.</p>
<p>The custom image needs to have the following to use this approach:</p>
<ul class="simple">
<li>All software dependencies installed</li>
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack/os-refresh-config">os-refresh-config</a> scripts to be executed on configuration changes</li>
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack/os-apply-config">os-apply-config</a> templates to transform the heat-provided config data into
service configuration files</li>
</ul>
<p>The projects <a class="reference external" href="https://git.openstack.org/cgit/openstack/tripleo-image-elements">tripleo-image-elements</a> and <a class="reference external" href="https://git.openstack.org/cgit/openstack/tripleo-heat-templates">tripleo-heat-templates</a> demonstrate
this approach.</p>
</div>
<div class="section" id="configuring-with-cfn-init">
<h3>Configuring with cfn-init<a class="headerlink" href="#configuring-with-cfn-init" title="Permalink to this headline">¶</a></h3>
<p>Likely the only reason to use the <code class="docutils literal"><span class="pre">cfn-init</span></code> hook is to migrate templates
which contain <a class="reference external" href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-init.html">AWS::CloudFormation::Init</a> metadata without needing a
complete rewrite of the config metadata. It is included here as it introduces
a number of new concepts.</p>
<p>To use the <code class="docutils literal"><span class="pre">cfn-init</span></code> tool the <code class="docutils literal"><span class="pre">heat-config-cfn-init</span></code> element is required
to be on the built image, so <a class="reference internal" href="#custom-image-script">Custom image script</a> needs to be modified with
the following:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">DEPLOYMENT_TOOL</span><span class="o">=</span><span class="s2">&quot;heat-config-cfn-init&quot;</span>
</pre></div>
</div>
<p>Configuration data which used to be included in the
<code class="docutils literal"><span class="pre">AWS::CloudFormation::Init</span></code> section of resource metadata is instead moved
to the <code class="docutils literal"><span class="pre">config</span></code> property of the config resource, as in the following
example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>

  <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::StructuredConfig</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cfn-init</span>
      <span class="l l-Scalar l-Scalar-Plain">inputs</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
      <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">files</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">/tmp/foo</span><span class="p p-Indicator">:</span>
              <span class="l l-Scalar l-Scalar-Plain">content</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">get_input</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
              <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span> <span class="s">&#39;000644&#39;</span>

  <span class="l l-Scalar l-Scalar-Plain">deployment</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::StructuredDeployment</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10_deployment</span>
      <span class="l l-Scalar l-Scalar-Plain">signal_transport</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NO_SIGNAL</span>
      <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">get_resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span>
      <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">get_resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>
      <span class="l l-Scalar l-Scalar-Plain">input_values</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">bar</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">baaaaa</span>

  <span class="l l-Scalar l-Scalar-Plain">other_deployment</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::StructuredDeployment</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">20_other_deployment</span>
      <span class="l l-Scalar l-Scalar-Plain">signal_transport</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NO_SIGNAL</span>
      <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">get_resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span>
      <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">get_resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>
      <span class="l l-Scalar l-Scalar-Plain">input_values</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">bar</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">barmy</span>

  <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_param</span><span class="p p-Indicator">:</span> <span class="nv">image</span><span class="p p-Indicator">}</span>
      <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_param</span><span class="p p-Indicator">:</span> <span class="nv">flavor</span><span class="p p-Indicator">}</span>
      <span class="l l-Scalar l-Scalar-Plain">key_name</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_param</span><span class="p p-Indicator">:</span> <span class="nv">key_name</span><span class="p p-Indicator">}</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">SOFTWARE_CONFIG</span>
</pre></div>
</div>
<p>There are a number of things to note about this template example:</p>
<ul class="simple">
<li><a class="reference internal" href="openstack.html#OS::Heat::StructuredConfig" title="OS::Heat::StructuredConfig"><span class="xref std std-ref">OS::Heat::StructuredConfig</span></a> is like
<a class="reference internal" href="openstack.html#OS::Heat::SoftwareConfig" title="OS::Heat::SoftwareConfig"><span class="xref std std-ref">OS::Heat::SoftwareConfig</span></a> except that the <code class="docutils literal"><span class="pre">config</span></code> property
contains structured YAML instead of text script. This is useful for a
number of other configuration tools including ansible, salt and
os-apply-config.</li>
<li><code class="docutils literal"><span class="pre">cfn-init</span></code> has no concept of inputs, so <code class="docutils literal"><span class="pre">{get_input:</span> <span class="pre">bar}</span></code> acts as a
placeholder which gets replaced with the
<a class="reference internal" href="openstack.html#OS::Heat::StructuredDeployment" title="OS::Heat::StructuredDeployment"><span class="xref std std-ref">OS::Heat::StructuredDeployment</span></a> <code class="docutils literal"><span class="pre">input_values</span></code> value when the
deployment resource is created.</li>
<li><code class="docutils literal"><span class="pre">cfn-init</span></code> has no concept of outputs, so specifying
<code class="docutils literal"><span class="pre">signal_transport:</span> <span class="pre">NO_SIGNAL</span></code> will mean that the deployment resource will
immediately go into the <code class="docutils literal"><span class="pre">CREATED</span></code> state instead of waiting for a
completed signal from the server.</li>
<li>The template has 2 deployment resources deploying the same config with
different <code class="docutils literal"><span class="pre">input_values</span></code>. The order these are deployed in on the server
is determined by sorting the values of the <code class="docutils literal"><span class="pre">name</span></code> property for each
resource (10_deployment, 20_other_deployment)</li>
</ul>
</div>
<div class="section" id="configuring-with-puppet">
<h3>Configuring with puppet<a class="headerlink" href="#configuring-with-puppet" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://puppetlabs.com/">puppet</a> hook makes it possible to write configuration as puppet manifests
which are deployed and run in a masterless environment.</p>
<p>To specify configuration as puppet manifests the <code class="docutils literal"><span class="pre">heat-config-puppet</span></code>
element is required to be on the built image, so <a class="reference internal" href="#custom-image-script">Custom image script</a> needs
to be modified with the following:</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">DEPLOYMENT_TOOL</span><span class="o">=</span><span class="s2">&quot;heat-config-puppet&quot;</span>
</pre></div>
</div>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>

  <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::SoftwareConfig</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">puppet</span>
      <span class="l l-Scalar l-Scalar-Plain">inputs</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
      <span class="l l-Scalar l-Scalar-Plain">outputs</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
      <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">get_file</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">example-puppet-manifest.pp</span>

  <span class="l l-Scalar l-Scalar-Plain">deployment</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Heat::SoftwareDeployment</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">get_resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config</span>
      <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">get_resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>
      <span class="l l-Scalar l-Scalar-Plain">input_values</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">foo</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">fooooo</span>
        <span class="l l-Scalar l-Scalar-Plain">bar</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">baaaaa</span>

  <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
    <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_param</span><span class="p p-Indicator">:</span> <span class="nv">image</span><span class="p p-Indicator">}</span>
      <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_param</span><span class="p p-Indicator">:</span> <span class="nv">flavor</span><span class="p p-Indicator">}</span>
      <span class="l l-Scalar l-Scalar-Plain">key_name</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">get_param</span><span class="p p-Indicator">:</span> <span class="nv">key_name</span><span class="p p-Indicator">}</span>
      <span class="l l-Scalar l-Scalar-Plain">user_data_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">SOFTWARE_CONFIG</span>

<span class="l l-Scalar l-Scalar-Plain">outputs</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">result</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">get_attr</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">deployment</span><span class="p p-Indicator">,</span> <span class="nv">result</span><span class="p p-Indicator">]</span>
  <span class="l l-Scalar l-Scalar-Plain">stdout</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">get_attr</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">deployment</span><span class="p p-Indicator">,</span> <span class="nv">deploy_stdout</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>This demonstrates the use of the <code class="docutils literal"><span class="pre">get_file</span></code> function, which will attach the
contents of the file <code class="docutils literal"><span class="pre">example-puppet-manifest.pp</span></code>, containing:</p>
<div class="highlight-puppet"><div class="highlight"><pre><span></span><span class="k">file</span> <span class="p">{</span> <span class="s">&#39;barfile&#39;</span><span class="p">:</span>
    <span class="na">ensure</span>  <span class="o">=&gt;</span> <span class="k">file</span><span class="p">,</span>
    <span class="na">mode</span>    <span class="o">=&gt;</span> <span class="s">&#39;0644&#39;</span><span class="p">,</span>
    <span class="na">path</span>    <span class="o">=&gt;</span> <span class="s">&#39;/tmp/$::bar&#39;</span><span class="p">,</span>
    <span class="na">content</span> <span class="o">=&gt;</span> <span class="s">&#39;$::foo&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">file</span> <span class="p">{</span> <span class="s">&#39;output_result&#39;</span><span class="p">:</span>
    <span class="na">ensure</span>  <span class="o">=&gt;</span> <span class="k">file</span><span class="p">,</span>
    <span class="na">path</span>    <span class="o">=&gt;</span> <span class="s">&#39;$::heat_outputs_path.result&#39;</span><span class="p">,</span>
    <span class="na">mode</span>    <span class="o">=&gt;</span> <span class="s">&#39;0644&#39;</span><span class="p">,</span>
    <span class="na">content</span> <span class="o">=&gt;</span> <span class="s">&#39;The file /tmp/$::bar contains $::foo&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Software configuration</a><ul>
<li><a class="reference internal" href="#image-building">Image building</a></li>
<li><a class="reference internal" href="#user-data-boot-scripts-and-cloud-init">User-data boot scripts and cloud-init</a><ul>
<li><a class="reference internal" href="#choosing-the-user-data-format">Choosing the user_data_format</a></li>
<li><a class="reference internal" href="#signals-and-wait-conditions">Signals and wait conditions</a></li>
<li><a class="reference internal" href="#software-config-resources">Software config resources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#software-deployment-resources">Software deployment resources</a><ul>
<li><a class="reference internal" href="#building-custom-image-for-software-deployments">Building custom image for software deployments</a></li>
<li><a class="reference internal" href="#custom-image-script">Custom image script</a></li>
<li><a class="reference internal" href="#configuring-with-scripts">Configuring with scripts</a></li>
<li><a class="reference internal" href="#configuring-with-os-apply-config">Configuring with os-apply-config</a></li>
<li><a class="reference internal" href="#configuring-with-cfn-init">Configuring with cfn-init</a></li>
<li><a class="reference internal" href="#configuring-with-puppet">Configuring with puppet</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="basic_resources.html"
                                  title="previous chapter">Instances</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="environment.html"
                                  title="next chapter">Environments</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/heat
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/template_guide/software_deployment.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="environment.html" title="Environments"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="basic_resources.html" title="Instances"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">heat 8.0.0.0rc2.dev38 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Template Guide</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2012,2013 Heat Developers.
      Last updated on &#39;Tue Feb 14 11:42:51 2017, commit 3ffc97c&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/heat");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>