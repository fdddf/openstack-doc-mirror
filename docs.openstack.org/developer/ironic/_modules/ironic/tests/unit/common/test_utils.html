<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ironic.tests.unit.common.test_utils &mdash; Ironic 7.0.1.dev7 documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/toggle.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '7.0.1.dev7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../_static/toggle.js"></script>
    <link rel="top" title="Ironic 7.0.1.dev7 documentation" href="../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../index.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ironic.tests.unit.common.test_utils</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2011 Justin Santa Barbara</span>
<span class="c1"># Copyright 2012 Hewlett-Packard Development Company, L.P.</span>
<span class="c1">#</span>
<span class="c1">#    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may</span>
<span class="c1">#    not use this file except in compliance with the License. You may obtain</span>
<span class="c1">#    a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#         http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1">#    Unless required by applicable law or agreed to in writing, software</span>
<span class="c1">#    distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span>
<span class="c1">#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span>
<span class="c1">#    License for the specific language governing permissions and limitations</span>
<span class="c1">#    under the License.</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="kn">import</span> <span class="nn">jinja2</span>
<span class="kn">import</span> <span class="nn">mock</span>
<span class="kn">from</span> <span class="nn">oslo_concurrency</span> <span class="kn">import</span> <span class="n">processutils</span>
<span class="kn">from</span> <span class="nn">oslo_config</span> <span class="kn">import</span> <span class="n">cfg</span>
<span class="kn">from</span> <span class="nn">oslo_utils</span> <span class="kn">import</span> <span class="n">netutils</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">ironic.common</span> <span class="kn">import</span> <span class="n">exception</span>
<span class="kn">from</span> <span class="nn">ironic.common</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">ironic.tests</span> <span class="kn">import</span> <span class="n">base</span>

<span class="n">CONF</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">CONF</span>


<div class="viewcode-block" id="BareMetalUtilsTestCase"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.BareMetalUtilsTestCase">[docs]</a><span class="k">class</span> <span class="nc">BareMetalUtilsTestCase</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="BareMetalUtilsTestCase.test_create_link"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.BareMetalUtilsTestCase.test_create_link">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s2">&quot;symlink&quot;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">symlink_mock</span><span class="p">:</span>
            <span class="n">symlink_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">create_link_without_raise</span><span class="p">(</span><span class="s2">&quot;/fake/source&quot;</span><span class="p">,</span> <span class="s2">&quot;/fake/link&quot;</span><span class="p">)</span>
            <span class="n">symlink_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">&quot;/fake/source&quot;</span><span class="p">,</span> <span class="s2">&quot;/fake/link&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BareMetalUtilsTestCase.test_create_link_EEXIST"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.BareMetalUtilsTestCase.test_create_link_EEXIST">[docs]</a>    <span class="k">def</span> <span class="nf">test_create_link_EEXIST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s2">&quot;symlink&quot;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">symlink_mock</span><span class="p">:</span>
            <span class="n">symlink_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">errno</span><span class="o">.</span><span class="n">EEXIST</span><span class="p">)</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">create_link_without_raise</span><span class="p">(</span><span class="s2">&quot;/fake/source&quot;</span><span class="p">,</span> <span class="s2">&quot;/fake/link&quot;</span><span class="p">)</span>
            <span class="n">symlink_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">&quot;/fake/source&quot;</span><span class="p">,</span> <span class="s2">&quot;/fake/link&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ExecuteTestCase"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.ExecuteTestCase">[docs]</a><span class="k">class</span> <span class="nc">ExecuteTestCase</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="ExecuteTestCase.test_retry_on_failure"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.ExecuteTestCase.test_retry_on_failure">[docs]</a>    <span class="k">def</span> <span class="nf">test_retry_on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fd</span><span class="p">,</span> <span class="n">tmpfilename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">tmpfilename2</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;#!/bin/sh</span>
<span class="s1"># If stdin fails to get passed during one of the runs, make a note.</span>
<span class="s1">if ! grep -q foo</span>
<span class="s1">then</span>
<span class="s1">    echo &#39;failure&#39; &gt; &quot;$1&quot;</span>
<span class="s1">fi</span>
<span class="s1"># If stdin has failed to get passed during this or a previous run, exit early.</span>
<span class="s1">if grep failure &quot;$1&quot;</span>
<span class="s1">then</span>
<span class="s1">    exit 1</span>
<span class="s1">fi</span>
<span class="s1">runs=&quot;$(cat $1)&quot;</span>
<span class="s1">if [ -z &quot;$runs&quot; ]</span>
<span class="s1">then</span>
<span class="s1">    runs=0</span>
<span class="s1">fi</span>
<span class="s1">runs=$(($runs + 1))</span>
<span class="s1">echo $runs &gt; &quot;$1&quot;</span>
<span class="s1">exit 1</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">tmpfilename</span><span class="p">,</span> <span class="mi">0</span><span class="n">o755</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">processutils</span><span class="o">.</span><span class="n">ProcessExecutionError</span><span class="p">,</span>
                                  <span class="n">utils</span><span class="o">.</span><span class="n">execute</span><span class="p">,</span>
                                  <span class="n">tmpfilename</span><span class="p">,</span> <span class="n">tmpfilename2</span><span class="p">,</span> <span class="n">attempts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                  <span class="n">process_input</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span>
                                  <span class="n">delay_on_retry</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EACCES</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s2">&quot;Permissions error detected. &quot;</span>
                                  <span class="s2">&quot;Are you running with a noexec /tmp?&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmpfilename2</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">runs</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">runs</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;failure&#39;</span><span class="p">,</span> <span class="s1">&#39;stdin did not &#39;</span>
                                <span class="s1">&#39;always get passed &#39;</span>
                                <span class="s1">&#39;correctly&#39;</span><span class="p">)</span>
            <span class="n">runs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">runs</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">runs</span><span class="p">,</span>
                             <span class="s1">&#39;Ran </span><span class="si">%d</span><span class="s1"> times instead of 10.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">runs</span><span class="p">,))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmpfilename</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmpfilename2</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExecuteTestCase.test_unknown_kwargs_raises_error"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.ExecuteTestCase.test_unknown_kwargs_raises_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_unknown_kwargs_raises_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">processutils</span><span class="o">.</span><span class="n">UnknownArgumentError</span><span class="p">,</span>
                          <span class="n">utils</span><span class="o">.</span><span class="n">execute</span><span class="p">,</span>
                          <span class="s1">&#39;/usr/bin/env&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span>
                          <span class="n">this_is_not_a_valid_kwarg</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExecuteTestCase.test_check_exit_code_boolean"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.ExecuteTestCase.test_check_exit_code_boolean">[docs]</a>    <span class="k">def</span> <span class="nf">test_check_exit_code_boolean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;/usr/bin/env&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="n">check_exit_code</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">processutils</span><span class="o">.</span><span class="n">ProcessExecutionError</span><span class="p">,</span>
                          <span class="n">utils</span><span class="o">.</span><span class="n">execute</span><span class="p">,</span>
                          <span class="s1">&#39;/usr/bin/env&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="n">check_exit_code</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExecuteTestCase.test_no_retry_on_success"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.ExecuteTestCase.test_no_retry_on_success">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_retry_on_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fd</span><span class="p">,</span> <span class="n">tmpfilename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">tmpfilename2</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;#!/bin/sh</span>
<span class="s1"># If we&#39;ve already run, bail out.</span>
<span class="s1">grep -q foo &quot;$1&quot; &amp;&amp; exit 1</span>
<span class="s1"># Mark that we&#39;ve run before.</span>
<span class="s1">echo foo &gt; &quot;$1&quot;</span>
<span class="s1"># Check that stdin gets passed correctly.</span>
<span class="s1">grep foo</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">tmpfilename</span><span class="p">,</span> <span class="mi">0</span><span class="n">o755</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">tmpfilename</span><span class="p">,</span>
                              <span class="n">tmpfilename2</span><span class="p">,</span>
                              <span class="n">process_input</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span>
                              <span class="n">attempts</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EACCES</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">skipTest</span><span class="p">(</span><span class="s2">&quot;Permissions error detected. &quot;</span>
                                  <span class="s2">&quot;Are you running with a noexec /tmp?&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmpfilename</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmpfilename2</span><span class="p">)</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">processutils</span><span class="p">,</span> <span class="s1">&#39;execute&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span> <span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="p">{},</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="ExecuteTestCase.test_execute_use_standard_locale_no_env_variables"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.ExecuteTestCase.test_execute_use_standard_locale_no_env_variables">[docs]</a>    <span class="k">def</span> <span class="nf">test_execute_use_standard_locale_no_env_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_mock</span><span class="p">,</span>
                                                          <span class="n">execute_mock</span><span class="p">):</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">use_standard_locale</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">execute_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span>
                                             <span class="n">env_variables</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;LC_ALL&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">})</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">processutils</span><span class="p">,</span> <span class="s1">&#39;execute&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="ExecuteTestCase.test_execute_use_standard_locale_with_env_variables"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.ExecuteTestCase.test_execute_use_standard_locale_with_env_variables">[docs]</a>    <span class="k">def</span> <span class="nf">test_execute_use_standard_locale_with_env_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                            <span class="n">execute_mock</span><span class="p">):</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">use_standard_locale</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                      <span class="n">env_variables</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">})</span>
        <span class="n">execute_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span>
                                             <span class="n">env_variables</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;LC_ALL&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">})</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">processutils</span><span class="p">,</span> <span class="s1">&#39;execute&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="ExecuteTestCase.test_execute_not_use_standard_locale"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.ExecuteTestCase.test_execute_not_use_standard_locale">[docs]</a>    <span class="k">def</span> <span class="nf">test_execute_not_use_standard_locale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">execute_mock</span><span class="p">):</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">use_standard_locale</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">env_variables</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">})</span>
        <span class="n">execute_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span>
                                             <span class="n">env_variables</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">})</span></div>

<div class="viewcode-block" id="ExecuteTestCase.test_execute_get_root_helper"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.ExecuteTestCase.test_execute_get_root_helper">[docs]</a>    <span class="k">def</span> <span class="nf">test_execute_get_root_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span>
                <span class="n">processutils</span><span class="p">,</span> <span class="s1">&#39;execute&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">execute_mock</span><span class="p">:</span>
            <span class="n">helper</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_get_root_helper</span><span class="p">()</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">run_as_root</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">execute_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">run_as_root</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                                 <span class="n">root_helper</span><span class="o">=</span><span class="n">helper</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExecuteTestCase.test_execute_without_root_helper"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.ExecuteTestCase.test_execute_without_root_helper">[docs]</a>    <span class="k">def</span> <span class="nf">test_execute_without_root_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span>
                <span class="n">processutils</span><span class="p">,</span> <span class="s1">&#39;execute&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">execute_mock</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">run_as_root</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">execute_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">run_as_root</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GenericUtilsTestCase"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase">[docs]</a><span class="k">class</span> <span class="nc">GenericUtilsTestCase</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">utils</span><span class="p">,</span> <span class="s1">&#39;hashlib&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="GenericUtilsTestCase.test__get_hash_object"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test__get_hash_object">[docs]</a>    <span class="k">def</span> <span class="nf">test__get_hash_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hashlib_mock</span><span class="p">):</span>
        <span class="n">algorithms_available</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">,</span> <span class="s1">&#39;sha1&#39;</span><span class="p">,</span> <span class="s1">&#39;sha224&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="s1">&#39;sha384&#39;</span><span class="p">,</span> <span class="s1">&#39;sha512&#39;</span><span class="p">)</span>
        <span class="n">hashlib_mock</span><span class="o">.</span><span class="n">algorithms_guaranteed</span> <span class="o">=</span> <span class="n">algorithms_available</span>
        <span class="n">hashlib_mock</span><span class="o">.</span><span class="n">algorithms</span> <span class="o">=</span> <span class="n">algorithms_available</span>
        <span class="c1"># | WHEN |</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">_get_hash_object</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">_get_hash_object</span><span class="p">(</span><span class="s1">&#39;sha1&#39;</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">_get_hash_object</span><span class="p">(</span><span class="s1">&#39;sha224&#39;</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">_get_hash_object</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">_get_hash_object</span><span class="p">(</span><span class="s1">&#39;sha384&#39;</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">_get_hash_object</span><span class="p">(</span><span class="s1">&#39;sha512&#39;</span><span class="p">)</span>
        <span class="c1"># | THEN |</span>
        <span class="n">calls</span> <span class="o">=</span> <span class="p">[</span><span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">md5</span><span class="p">(),</span> <span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">sha1</span><span class="p">(),</span> <span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">sha224</span><span class="p">(),</span>
                 <span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">sha256</span><span class="p">(),</span> <span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">sha384</span><span class="p">(),</span> <span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">sha512</span><span class="p">()]</span>
        <span class="n">hashlib_mock</span><span class="o">.</span><span class="n">assert_has_calls</span><span class="p">(</span><span class="n">calls</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test__get_hash_object_throws_for_invalid_or_unsupported_hash_name"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test__get_hash_object_throws_for_invalid_or_unsupported_hash_name">[docs]</a>    <span class="k">def</span> <span class="nf">test__get_hash_object_throws_for_invalid_or_unsupported_hash_name</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">):</span>
        <span class="c1"># | WHEN | &amp; | THEN |</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">exception</span><span class="o">.</span><span class="n">InvalidParameterValue</span><span class="p">,</span>
                          <span class="n">utils</span><span class="o">.</span><span class="n">_get_hash_object</span><span class="p">,</span>
                          <span class="s1">&#39;hickory-dickory-dock&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_hash_file_for_md5"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_hash_file_for_md5">[docs]</a>    <span class="k">def</span> <span class="nf">test_hash_file_for_md5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># | GIVEN |</span>
        <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Mary had a little lamb, its fleece as white as snow&#39;</span>
        <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="c1"># | WHEN |</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">hash_file</span><span class="p">(</span><span class="n">file_like_object</span><span class="p">)</span>  <span class="c1"># using default, &#39;md5&#39;</span>
        <span class="c1"># | THEN |</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_hash_file_for_sha1"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_hash_file_for_sha1">[docs]</a>    <span class="k">def</span> <span class="nf">test_hash_file_for_sha1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># | GIVEN |</span>
        <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Mary had a little lamb, its fleece as white as snow&#39;</span>
        <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="c1"># | WHEN |</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">hash_file</span><span class="p">(</span><span class="n">file_like_object</span><span class="p">,</span> <span class="s1">&#39;sha1&#39;</span><span class="p">)</span>
        <span class="c1"># | THEN |</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_hash_file_for_sha512"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_hash_file_for_sha512">[docs]</a>    <span class="k">def</span> <span class="nf">test_hash_file_for_sha512</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># | GIVEN |</span>
        <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Mary had a little lamb, its fleece as white as snow&#39;</span>
        <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="c1"># | WHEN |</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">hash_file</span><span class="p">(</span><span class="n">file_like_object</span><span class="p">,</span> <span class="s1">&#39;sha512&#39;</span><span class="p">)</span>
        <span class="c1"># | THEN |</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_hash_file_throws_for_invalid_or_unsupported_hash"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_hash_file_throws_for_invalid_or_unsupported_hash">[docs]</a>    <span class="k">def</span> <span class="nf">test_hash_file_throws_for_invalid_or_unsupported_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># | GIVEN |</span>
        <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Mary had a little lamb, its fleece as white as snow&#39;</span>
        <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># | WHEN | &amp; | THEN |</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">exception</span><span class="o">.</span><span class="n">InvalidParameterValue</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">hash_file</span><span class="p">,</span>
                          <span class="n">file_like_object</span><span class="p">,</span> <span class="s1">&#39;hickory-dickory-dock&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_file_has_content_equal"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_file_has_content_equal">[docs]</a>    <span class="k">def</span> <span class="nf">test_file_has_content_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Mary had a little lamb, its fleece as white as snow&#39;</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;ironic.common.utils.open&#39;</span><span class="p">,</span>
                        <span class="n">mock</span><span class="o">.</span><span class="n">mock_open</span><span class="p">(</span><span class="n">read_data</span><span class="o">=</span><span class="n">data</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">file_has_content</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">))</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_file_has_content_differ"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_file_has_content_differ">[docs]</a>    <span class="k">def</span> <span class="nf">test_file_has_content_differ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Mary had a little lamb, its fleece as white as snow&#39;</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;!&#39;</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;ironic.common.utils.open&#39;</span><span class="p">,</span>
                        <span class="n">mock</span><span class="o">.</span><span class="n">mock_open</span><span class="p">(</span><span class="n">read_data</span><span class="o">=</span><span class="n">data</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">file_has_content</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">))</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_is_valid_datapath_id"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_is_valid_datapath_id">[docs]</a>    <span class="k">def</span> <span class="nf">test_is_valid_datapath_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_valid_datapath_id</span><span class="p">(</span><span class="s2">&quot;525400cf2d319fdf&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_valid_datapath_id</span><span class="p">(</span><span class="s2">&quot;525400CF2D319FDF&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_valid_datapath_id</span><span class="p">(</span><span class="s2">&quot;52&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_valid_datapath_id</span><span class="p">(</span><span class="s2">&quot;52:54:00:cf:2d:31&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_valid_datapath_id</span><span class="p">(</span><span class="s2">&quot;notadatapathid00&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_valid_datapath_id</span><span class="p">(</span><span class="s2">&quot;5525400CF2D319FDF&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_is_hostname_safe"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_is_hostname_safe">[docs]</a>    <span class="k">def</span> <span class="nf">test_is_hostname_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;spam&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;spAm&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;SPAM&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;-spam&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;spam-&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;spam-eggs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;spam_eggs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;spam eggs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;spam.eggs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;9spam&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;spam7&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;br34kf4st&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;$pam&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;egg$&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;spam#eggs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39; eggs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;spam &#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;s&#39;</span> <span class="o">*</span> <span class="mi">63</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;s&#39;</span> <span class="o">*</span> <span class="mi">64</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
        <span class="c1"># Need to ensure a binary response for success or fail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;spam&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;-spam&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;www.rackspace.com&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;www.rackspace.com.&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;http._sctp.www.example.com&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;mail.pets_r_us.net&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;mail-server-15.my_host.org&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;www.nothere.com_&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;www.nothere_.com&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;www..nothere.com&#39;</span><span class="p">))</span>
        <span class="n">long_str</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">63</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;b&#39;</span> <span class="o">*</span> <span class="mi">63</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;c&#39;</span> <span class="o">*</span> <span class="mi">63</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span> <span class="o">*</span> <span class="mi">63</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="n">long_str</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="n">long_str</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_hostname_safe</span><span class="p">(</span><span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_is_valid_logical_name"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_is_valid_logical_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_is_valid_logical_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;spam&#39;</span><span class="p">,</span> <span class="s1">&#39;spAm&#39;</span><span class="p">,</span> <span class="s1">&#39;SPAM&#39;</span><span class="p">,</span> <span class="s1">&#39;spam-eggs&#39;</span><span class="p">,</span> <span class="s1">&#39;spam.eggs&#39;</span><span class="p">,</span> <span class="s1">&#39;spam_eggs&#39;</span><span class="p">,</span>
            <span class="s1">&#39;spam~eggs&#39;</span><span class="p">,</span> <span class="s1">&#39;9spam&#39;</span><span class="p">,</span> <span class="s1">&#39;spam7&#39;</span><span class="p">,</span> <span class="s1">&#39;~spam&#39;</span><span class="p">,</span> <span class="s1">&#39;.spam&#39;</span><span class="p">,</span> <span class="s1">&#39;.~-_&#39;</span><span class="p">,</span> <span class="s1">&#39;~&#39;</span><span class="p">,</span>
            <span class="s1">&#39;br34kf4st&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span> <span class="o">*</span> <span class="mi">63</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;spam eggs&#39;</span><span class="p">,</span> <span class="s1">&#39;$pam&#39;</span><span class="p">,</span> <span class="s1">&#39;egg$&#39;</span><span class="p">,</span> <span class="s1">&#39;spam#eggs&#39;</span><span class="p">,</span>
            <span class="s1">&#39; eggs&#39;</span><span class="p">,</span> <span class="s1">&#39;spam &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;spam%20&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">hostname</span> <span class="ow">in</span> <span class="n">valid</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_valid_logical_name</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
            <span class="c1"># Need to ensure a binary response for success. assertTrue</span>
            <span class="c1"># is too generous, and would pass this test if, for</span>
            <span class="c1"># instance, a regex Match object were returned.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span>
                          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is unexpectedly invalid&quot;</span> <span class="o">%</span> <span class="n">hostname</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">hostname</span> <span class="ow">in</span> <span class="n">invalid</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_valid_logical_name</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
            <span class="c1"># Need to ensure a binary response for</span>
            <span class="c1"># success. assertFalse is too generous and would pass this</span>
            <span class="c1"># test if None were returned.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
                          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is unexpectedly valid&quot;</span> <span class="o">%</span> <span class="n">hostname</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_validate_and_normalize_mac"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_validate_and_normalize_mac">[docs]</a>    <span class="k">def</span> <span class="nf">test_validate_and_normalize_mac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mac</span> <span class="o">=</span> <span class="s1">&#39;AA:BB:CC:DD:EE:FF&#39;</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">netutils</span><span class="p">,</span> <span class="s1">&#39;is_valid_mac&#39;</span><span class="p">,</span>
                               <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">m_mock</span><span class="p">:</span>
            <span class="n">m_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mac</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                             <span class="n">utils</span><span class="o">.</span><span class="n">validate_and_normalize_mac</span><span class="p">(</span><span class="n">mac</span><span class="p">))</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_validate_and_normalize_datapath_id"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_validate_and_normalize_datapath_id">[docs]</a>    <span class="k">def</span> <span class="nf">test_validate_and_normalize_datapath_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">datapath_id</span> <span class="o">=</span> <span class="s1">&#39;AA:BB:CC:DD:EE:FF&#39;</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">utils</span><span class="p">,</span> <span class="s1">&#39;is_valid_datapath_id&#39;</span><span class="p">,</span>
                               <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">m_mock</span><span class="p">:</span>
            <span class="n">m_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datapath_id</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                             <span class="n">utils</span><span class="o">.</span><span class="n">validate_and_normalize_datapath_id</span><span class="p">(</span>
                                 <span class="n">datapath_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_validate_and_normalize_mac_invalid_format"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_validate_and_normalize_mac_invalid_format">[docs]</a>    <span class="k">def</span> <span class="nf">test_validate_and_normalize_mac_invalid_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">netutils</span><span class="p">,</span> <span class="s1">&#39;is_valid_mac&#39;</span><span class="p">,</span>
                               <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">m_mock</span><span class="p">:</span>
            <span class="n">m_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">exception</span><span class="o">.</span><span class="n">InvalidMAC</span><span class="p">,</span>
                              <span class="n">utils</span><span class="o">.</span><span class="n">validate_and_normalize_mac</span><span class="p">,</span> <span class="s1">&#39;invalid-mac&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_safe_rstrip"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_safe_rstrip">[docs]</a>    <span class="k">def</span> <span class="nf">test_safe_rstrip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;/test/&#39;</span>
        <span class="n">rstripped_value</span> <span class="o">=</span> <span class="s1">&#39;/test&#39;</span>
        <span class="n">not_rstripped</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rstripped_value</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_rstrip</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">not_rstripped</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_rstrip</span><span class="p">(</span><span class="n">not_rstripped</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_safe_rstrip_not_raises_exceptions"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_safe_rstrip_not_raises_exceptions">[docs]</a>    <span class="k">def</span> <span class="nf">test_safe_rstrip_not_raises_exceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Supplying an integer should normally raise an exception because it</span>
        <span class="c1"># does not save the rstrip() method.</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="c1"># In the case of raising an exception safe_rstrip() should return the</span>
        <span class="c1"># original value.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_rstrip</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;getmtime&#39;</span><span class="p">,</span> <span class="n">return_value</span><span class="o">=</span><span class="mf">1439465889.4964755</span><span class="p">,</span>
                       <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="GenericUtilsTestCase.test_unix_file_modification_datetime"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_unix_file_modification_datetime">[docs]</a>    <span class="k">def</span> <span class="nf">test_unix_file_modification_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mtime_mock</span><span class="p">):</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">496475</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span>
                         <span class="n">utils</span><span class="o">.</span><span class="n">unix_file_modification_datetime</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">))</span>
        <span class="n">mtime_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericUtilsTestCase.test_is_valid_no_proxy"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_is_valid_no_proxy">[docs]</a>    <span class="k">def</span> <span class="nf">test_is_valid_no_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Valid values for &#39;no_proxy&#39;</span>
        <span class="n">valid_no_proxy</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">63</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="mi">63</span> <span class="o">+</span> <span class="s1">&#39;.c.&#39;</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span> <span class="o">*</span> <span class="mi">61</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;e&#39;</span> <span class="o">*</span> <span class="mi">61</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="mi">63</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="mi">63</span> <span class="o">+</span> <span class="s1">&#39;.C.&#39;</span> <span class="o">+</span> <span class="s1">&#39;D&#39;</span> <span class="o">*</span> <span class="mi">61</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span> <span class="o">*</span> <span class="mi">61</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">62</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="mi">62</span> <span class="o">+</span> <span class="s1">&#39;.c.&#39;</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span> <span class="o">*</span> <span class="mi">61</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span>
             <span class="s1">&#39;e&#39;</span> <span class="o">*</span> <span class="mi">61</span><span class="p">),</span>
            <span class="s1">&#39;,,example.com:3128,&#39;</span><span class="p">,</span>
            <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span>  <span class="c1"># IP should be valid</span>
        <span class="p">]</span>
        <span class="c1"># Test each one individually, so if failure easier to determine which</span>
        <span class="c1"># one failed.</span>
        <span class="k">for</span> <span class="n">no_proxy</span> <span class="ow">in</span> <span class="n">valid_no_proxy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">is_valid_no_proxy</span><span class="p">(</span><span class="n">no_proxy</span><span class="p">),</span>
                <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&#39;no_proxy&#39; value should be valid: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">no_proxy</span><span class="p">))</span>
        <span class="c1"># Test valid when joined together</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_valid_no_proxy</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_no_proxy</span><span class="p">)))</span>
        <span class="c1"># Test valid when joined together with whitespace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_valid_no_proxy</span><span class="p">(</span><span class="s1">&#39; , &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_no_proxy</span><span class="p">)))</span>
        <span class="c1"># empty string should also be valid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">is_valid_no_proxy</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>

        <span class="c1"># Invalid values for &#39;no_proxy&#39;</span>
        <span class="n">invalid_no_proxy</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="mi">63</span> <span class="o">+</span> <span class="s1">&#39;.C.&#39;</span> <span class="o">+</span> <span class="s1">&#39;D&#39;</span> <span class="o">*</span> <span class="mi">61</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span>
             <span class="s1">&#39;E&#39;</span> <span class="o">*</span> <span class="mi">61</span><span class="p">),</span>  <span class="c1"># too long (&gt; 253)</span>
            <span class="p">(</span><span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
            <span class="s1">&#39;a..com&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">63</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="mi">62</span> <span class="o">+</span> <span class="s1">&#39;.c.&#39;</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span> <span class="o">*</span> <span class="mi">61</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span>
             <span class="s1">&#39;e&#39;</span> <span class="o">*</span> <span class="mi">61</span><span class="p">),</span>  <span class="c1"># too long (&gt; 251 after deleting .)</span>
            <span class="p">(</span><span class="s1">&#39;*.&#39;</span> <span class="o">+</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s1">&#39;.c.&#39;</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span> <span class="o">*</span> <span class="mi">61</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span>
             <span class="s1">&#39;e&#39;</span> <span class="o">*</span> <span class="mi">61</span><span class="p">),</span>  <span class="c1"># starts with *.</span>
            <span class="s1">&#39;c.-a.com&#39;</span><span class="p">,</span>
            <span class="s1">&#39;c.a-.com&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">no_proxy</span> <span class="ow">in</span> <span class="n">invalid_no_proxy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">is_valid_no_proxy</span><span class="p">(</span><span class="n">no_proxy</span><span class="p">),</span>
                <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&#39;no_proxy&#39; value should be invalid: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">no_proxy</span><span class="p">))</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">utils</span><span class="p">,</span> <span class="s1">&#39;LOG&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="GenericUtilsTestCase.test_warn_about_deprecated_extra_vif_port_id"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GenericUtilsTestCase.test_warn_about_deprecated_extra_vif_port_id">[docs]</a>    <span class="k">def</span> <span class="nf">test_warn_about_deprecated_extra_vif_port_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_log</span><span class="p">):</span>
        <span class="c1"># Set variable to default value</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">warn_deprecated_extra_vif_port_id</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">warn_about_deprecated_extra_vif_port_id</span><span class="p">()</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">warn_about_deprecated_extra_vif_port_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mock_log</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">call_count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;extra[&#39;vif_port_id&#39;] is deprecated and will not&quot;</span><span class="p">,</span>
                      <span class="n">mock_log</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">call_args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="TempFilesTestCase"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.TempFilesTestCase">[docs]</a><span class="k">class</span> <span class="nc">TempFilesTestCase</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TempFilesTestCase.test_tempdir"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.TempFilesTestCase.test_tempdir">[docs]</a>    <span class="k">def</span> <span class="nf">test_tempdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">dirname</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">with</span> <span class="n">utils</span><span class="o">.</span><span class="n">tempdir</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempdir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tempdir</span><span class="p">))</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">tempdir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dirname</span><span class="p">))</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">shutil</span><span class="p">,</span> <span class="s1">&#39;rmtree&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">tempfile</span><span class="p">,</span> <span class="s1">&#39;mkdtemp&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="TempFilesTestCase.test_tempdir_mocked"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.TempFilesTestCase.test_tempdir_mocked">[docs]</a>    <span class="k">def</span> <span class="nf">test_tempdir_mocked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mkdtemp_mock</span><span class="p">,</span> <span class="n">rmtree_mock</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">tempdir</span><span class="o">=</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
        <span class="n">mkdtemp_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s1">&#39;temp-dir&#39;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">}</span>

        <span class="k">with</span> <span class="n">utils</span><span class="o">.</span><span class="n">tempdir</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">tempdir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s1">&#39;temp-dir&#39;</span><span class="p">,</span> <span class="n">tempdir</span><span class="p">)</span>
            <span class="n">tempdir_created</span> <span class="o">=</span> <span class="n">tempdir</span>

        <span class="n">mkdtemp_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rmtree_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">tempdir_created</span><span class="p">)</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">utils</span><span class="p">,</span> <span class="s1">&#39;LOG&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">shutil</span><span class="p">,</span> <span class="s1">&#39;rmtree&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">tempfile</span><span class="p">,</span> <span class="s1">&#39;mkdtemp&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="TempFilesTestCase.test_tempdir_mocked_error_on_rmtree"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.TempFilesTestCase.test_tempdir_mocked_error_on_rmtree">[docs]</a>    <span class="k">def</span> <span class="nf">test_tempdir_mocked_error_on_rmtree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mkdtemp_mock</span><span class="p">,</span> <span class="n">rmtree_mock</span><span class="p">,</span>
                                            <span class="n">log_mock</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">tempdir</span><span class="o">=</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
        <span class="n">mkdtemp_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s1">&#39;temp-dir&#39;</span>
        <span class="n">rmtree_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">OSError</span>

        <span class="k">with</span> <span class="n">utils</span><span class="o">.</span><span class="n">tempdir</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempdir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s1">&#39;temp-dir&#39;</span><span class="p">,</span> <span class="n">tempdir</span><span class="p">)</span>
            <span class="n">tempdir_created</span> <span class="o">=</span> <span class="n">tempdir</span>

        <span class="n">rmtree_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">tempdir_created</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">log_mock</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">called</span><span class="p">)</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;exists&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">utils</span><span class="p">,</span> <span class="s1">&#39;_check_dir_writable&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">utils</span><span class="p">,</span> <span class="s1">&#39;_check_dir_free_space&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="TempFilesTestCase.test_check_dir_with_pass_in"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.TempFilesTestCase.test_check_dir_with_pass_in">[docs]</a>    <span class="k">def</span> <span class="nf">test_check_dir_with_pass_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_free_space</span><span class="p">,</span> <span class="n">mock_dir_writable</span><span class="p">,</span>
                                    <span class="n">mock_exists</span><span class="p">):</span>
        <span class="n">mock_exists</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># test passing in a directory and size</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">check_dir</span><span class="p">(</span><span class="n">directory_to_check</span><span class="o">=</span><span class="s1">&#39;/fake/path&#39;</span><span class="p">,</span> <span class="n">required_space</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">mock_exists</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;/fake/path&#39;</span><span class="p">)</span>
        <span class="n">mock_dir_writable</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;/fake/path&#39;</span><span class="p">)</span>
        <span class="n">mock_free_space</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;/fake/path&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;exists&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">utils</span><span class="p">,</span> <span class="s1">&#39;_check_dir_writable&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">utils</span><span class="p">,</span> <span class="s1">&#39;_check_dir_free_space&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="TempFilesTestCase.test_check_dir_no_dir"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.TempFilesTestCase.test_check_dir_no_dir">[docs]</a>    <span class="k">def</span> <span class="nf">test_check_dir_no_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_free_space</span><span class="p">,</span> <span class="n">mock_dir_writable</span><span class="p">,</span>
                              <span class="n">mock_exists</span><span class="p">):</span>
        <span class="n">mock_exists</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">tempdir</span><span class="o">=</span><span class="s1">&#39;/fake/path&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">exception</span><span class="o">.</span><span class="n">PathNotFound</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">check_dir</span><span class="p">)</span>
        <span class="n">mock_exists</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">CONF</span><span class="o">.</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">mock_free_space</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">mock_dir_writable</span><span class="o">.</span><span class="n">called</span><span class="p">)</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;exists&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">utils</span><span class="p">,</span> <span class="s1">&#39;_check_dir_writable&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">utils</span><span class="p">,</span> <span class="s1">&#39;_check_dir_free_space&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="TempFilesTestCase.test_check_dir_ok"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.TempFilesTestCase.test_check_dir_ok">[docs]</a>    <span class="k">def</span> <span class="nf">test_check_dir_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_free_space</span><span class="p">,</span> <span class="n">mock_dir_writable</span><span class="p">,</span>
                          <span class="n">mock_exists</span><span class="p">):</span>
        <span class="n">mock_exists</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">tempdir</span><span class="o">=</span><span class="s1">&#39;/fake/path&#39;</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">check_dir</span><span class="p">()</span>
        <span class="n">mock_exists</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">CONF</span><span class="o">.</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="n">mock_dir_writable</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">CONF</span><span class="o">.</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="n">mock_free_space</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">CONF</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;access&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="TempFilesTestCase.test__check_dir_writable_ok"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.TempFilesTestCase.test__check_dir_writable_ok">[docs]</a>    <span class="k">def</span> <span class="nf">test__check_dir_writable_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_access</span><span class="p">):</span>
        <span class="n">mock_access</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">_check_dir_writable</span><span class="p">(</span><span class="s2">&quot;/fake/path&quot;</span><span class="p">))</span>
        <span class="n">mock_access</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">&quot;/fake/path&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">)</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;access&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="TempFilesTestCase.test__check_dir_writable_not_writable"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.TempFilesTestCase.test__check_dir_writable_not_writable">[docs]</a>    <span class="k">def</span> <span class="nf">test__check_dir_writable_not_writable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_access</span><span class="p">):</span>
        <span class="n">mock_access</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">exception</span><span class="o">.</span><span class="n">DirectoryNotWritable</span><span class="p">,</span>
                          <span class="n">utils</span><span class="o">.</span><span class="n">_check_dir_writable</span><span class="p">,</span> <span class="s2">&quot;/fake/path&quot;</span><span class="p">)</span>
        <span class="n">mock_access</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">&quot;/fake/path&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">)</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;statvfs&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="TempFilesTestCase.test__check_dir_free_space_ok"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.TempFilesTestCase.test__check_dir_free_space_ok">[docs]</a>    <span class="k">def</span> <span class="nf">test__check_dir_free_space_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_stat</span><span class="p">):</span>
        <span class="n">statvfs_mock_return</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_bsize</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_frsize</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_blocks</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_bfree</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_bavail</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_files</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_ffree</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_favail</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_namemax</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mock_stat</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">statvfs_mock_return</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">_check_dir_free_space</span><span class="p">(</span><span class="s2">&quot;/fake/path&quot;</span><span class="p">)</span>
        <span class="n">mock_stat</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">&quot;/fake/path&quot;</span><span class="p">)</span></div>

    <span class="nd">@mock.patch.object</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;statvfs&#39;</span><span class="p">,</span> <span class="n">autospec</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="TempFilesTestCase.test_check_dir_free_space_raises"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.TempFilesTestCase.test_check_dir_free_space_raises">[docs]</a>    <span class="k">def</span> <span class="nf">test_check_dir_free_space_raises</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_stat</span><span class="p">):</span>
        <span class="n">statvfs_mock_return</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_bsize</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_frsize</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_blocks</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_bfree</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_bavail</span> <span class="o">=</span> <span class="mi">1024</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_files</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_ffree</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_favail</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">statvfs_mock_return</span><span class="o">.</span><span class="n">f_namemax</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mock_stat</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">statvfs_mock_return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">exception</span><span class="o">.</span><span class="n">InsufficientDiskSpace</span><span class="p">,</span>
                          <span class="n">utils</span><span class="o">.</span><span class="n">_check_dir_free_space</span><span class="p">,</span> <span class="s2">&quot;/fake/path&quot;</span><span class="p">)</span>
        <span class="n">mock_stat</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">&quot;/fake/path&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GetUpdatedCapabilitiesTestCase"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GetUpdatedCapabilitiesTestCase">[docs]</a><span class="k">class</span> <span class="nc">GetUpdatedCapabilitiesTestCase</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_updated_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">capabilities</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ilo_firmware_version&#39;</span><span class="p">:</span> <span class="s1">&#39;xyz&#39;</span><span class="p">}</span>
        <span class="n">cap_string</span> <span class="o">=</span> <span class="s1">&#39;ilo_firmware_version:xyz&#39;</span>
        <span class="n">cap_returned</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_updated_capabilities</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">capabilities</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cap_string</span><span class="p">,</span> <span class="n">cap_returned</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">cap_returned</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span></div>

<div class="viewcode-block" id="GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities_multiple_keys"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities_multiple_keys">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_updated_capabilities_multiple_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">capabilities</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ilo_firmware_version&#39;</span><span class="p">:</span> <span class="s1">&#39;xyz&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;somekey&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">}</span>
        <span class="n">cap_string</span> <span class="o">=</span> <span class="s1">&#39;ilo_firmware_version:xyz,foo:bar,somekey:value&#39;</span>
        <span class="n">cap_returned</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_updated_capabilities</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">capabilities</span><span class="p">)</span>
        <span class="n">set1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cap_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="n">set2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cap_returned</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">set1</span><span class="p">,</span> <span class="n">set2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">cap_returned</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span></div>

<div class="viewcode-block" id="GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities_invalid_capabilities"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities_invalid_capabilities">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_updated_capabilities_invalid_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">capabilities</span> <span class="o">=</span> <span class="s1">&#39;ilo_firmware_version&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span>
                          <span class="n">utils</span><span class="o">.</span><span class="n">get_updated_capabilities</span><span class="p">,</span>
                          <span class="n">capabilities</span><span class="p">,</span> <span class="p">{})</span></div>

<div class="viewcode-block" id="GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities_capabilities_not_dict"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities_capabilities_not_dict">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_updated_capabilities_capabilities_not_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">capabilities</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ilo_firmware_version:xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;foo:bar&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span>
                          <span class="n">utils</span><span class="o">.</span><span class="n">get_updated_capabilities</span><span class="p">,</span>
                          <span class="bp">None</span><span class="p">,</span> <span class="n">capabilities</span><span class="p">)</span></div>

<div class="viewcode-block" id="GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities_add_to_existing_capabilities"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities_add_to_existing_capabilities">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_updated_capabilities_add_to_existing_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_capabilities</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;BootMode&#39;</span><span class="p">:</span> <span class="s1">&#39;uefi&#39;</span><span class="p">}</span>
        <span class="n">expected_capabilities</span> <span class="o">=</span> <span class="s1">&#39;BootMode:uefi,foo:bar&#39;</span>
        <span class="n">cap_returned</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_updated_capabilities</span><span class="p">(</span><span class="s1">&#39;foo:bar&#39;</span><span class="p">,</span>
                                                      <span class="n">new_capabilities</span><span class="p">)</span>
        <span class="n">set1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">expected_capabilities</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="n">set2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cap_returned</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">set1</span><span class="p">,</span> <span class="n">set2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">cap_returned</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span></div>

<div class="viewcode-block" id="GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities_replace_to_existing_capabilities"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GetUpdatedCapabilitiesTestCase.test_get_updated_capabilities_replace_to_existing_capabilities">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_updated_capabilities_replace_to_existing_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_capabilities</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;BootMode&#39;</span><span class="p">:</span> <span class="s1">&#39;bios&#39;</span><span class="p">}</span>
        <span class="n">expected_capabilities</span> <span class="o">=</span> <span class="s1">&#39;BootMode:bios&#39;</span>
        <span class="n">cap_returned</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_updated_capabilities</span><span class="p">(</span><span class="s1">&#39;BootMode:uefi&#39;</span><span class="p">,</span>
                                                      <span class="n">new_capabilities</span><span class="p">)</span>
        <span class="n">set1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">expected_capabilities</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="n">set2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cap_returned</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">set1</span><span class="p">,</span> <span class="n">set2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">cap_returned</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span></div>

<div class="viewcode-block" id="GetUpdatedCapabilitiesTestCase.test_validate_network_port"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GetUpdatedCapabilitiesTestCase.test_validate_network_port">[docs]</a>    <span class="k">def</span> <span class="nf">test_validate_network_port</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">validate_network_port</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">validate_network_port</span><span class="p">(</span><span class="s1">&#39;65535&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">65535</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span></div>

<div class="viewcode-block" id="GetUpdatedCapabilitiesTestCase.test_validate_network_port_fail"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.GetUpdatedCapabilitiesTestCase.test_validate_network_port_fail">[docs]</a>    <span class="k">def</span> <span class="nf">test_validate_network_port_fail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="n">exception</span><span class="o">.</span><span class="n">InvalidParameterValue</span><span class="p">,</span>
                               <span class="s1">&#39;Port &quot;65536&quot; is out of range.&#39;</span><span class="p">,</span>
                               <span class="n">utils</span><span class="o">.</span><span class="n">validate_network_port</span><span class="p">,</span>
                               <span class="s1">&#39;65536&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="n">exception</span><span class="o">.</span><span class="n">InvalidParameterValue</span><span class="p">,</span>
                               <span class="s1">&#39;fake_port &quot;-1&quot; is out of range.&#39;</span><span class="p">,</span>
                               <span class="n">utils</span><span class="o">.</span><span class="n">validate_network_port</span><span class="p">,</span>
                               <span class="s1">&#39;-1&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;fake_port&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="n">exception</span><span class="o">.</span><span class="n">InvalidParameterValue</span><span class="p">,</span>
                               <span class="s1">&#39;Port &quot;invalid&quot; is not a valid integer.&#39;</span><span class="p">,</span>
                               <span class="n">utils</span><span class="o">.</span><span class="n">validate_network_port</span><span class="p">,</span>
                               <span class="s1">&#39;invalid&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="JinjaTemplatingTestCase"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.JinjaTemplatingTestCase">[docs]</a><span class="k">class</span> <span class="nc">JinjaTemplatingTestCase</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="JinjaTemplatingTestCase.setUp"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.JinjaTemplatingTestCase.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">JinjaTemplatingTestCase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;{{ foo }} {{ bar }}&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;spam&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="s1">&#39;ham&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="s1">&#39;spam ham&#39;</span></div>

<div class="viewcode-block" id="JinjaTemplatingTestCase.test_render_string"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.JinjaTemplatingTestCase.test_render_string">[docs]</a>    <span class="k">def</span> <span class="nf">test_render_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected</span><span class="p">,</span>
                         <span class="n">utils</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                                               <span class="n">is_file</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span></div>

    <span class="nd">@mock.patch</span><span class="p">(</span><span class="s1">&#39;ironic.common.utils.jinja2.FileSystemLoader&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="JinjaTemplatingTestCase.test_render_file"><a class="viewcode-back" href="../../../../../api/ironic.tests.unit.common.test_utils.html#ironic.tests.unit.common.test_utils.JinjaTemplatingTestCase.test_render_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_render_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jinja_fsl_mock</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/path/to/template.j2&#39;</span>
        <span class="n">jinja_fsl_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">DictLoader</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;template.j2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected</span><span class="p">,</span>
                         <span class="n">utils</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span><span class="n">path</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
        <span class="n">jinja_fsl_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;/path/to&#39;</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/ironic
"
                     rel="nofollow">Project Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../../../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Ironic 7.0.1.dev7 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright OpenStack Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/Ironic");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>