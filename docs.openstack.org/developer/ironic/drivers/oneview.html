<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>OneView drivers &mdash; Ironic 7.0.1.dev5 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/toggle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.1.dev5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/toggle.js"></script>
    <link rel="top" title="Ironic 7.0.1.dev5 documentation" href="../index.html" />
    <link rel="up" title="Enabling drivers" href="../deploy/drivers.html" />
    <link rel="next" title="XenServer drivers" href="xenserver.html" />
    <link rel="prev" title="CIMC drivers" href="cimc.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="oneview-drivers">
<span id="oneview"></span><h1>OneView drivers<a class="headerlink" href="#oneview-drivers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>HP OneView <a class="footnote-reference" href="#id18" id="id1">[1]</a> is a single integrated platform, packaged as an appliance that
implements a software-defined approach to managing physical infrastructure.
The appliance supports scenarios such as deploying bare metal servers, for
instance. In this context, the <code class="docutils literal"><span class="pre">HP</span> <span class="pre">OneView</span> <span class="pre">driver</span></code> for ironic enables the
users of OneView to use ironic as a bare metal provider to their managed
physical hardware.</p>
<p>Currently there are two OneView drivers:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">iscsi_pxe_oneview</span></code></li>
<li><code class="docutils literal"><span class="pre">agent_pxe_oneview</span></code></li>
</ul>
<p>The <code class="docutils literal"><span class="pre">iscsi_pxe_oneview</span></code> and <code class="docutils literal"><span class="pre">agent_pxe_oneview</span></code> drivers implement the
core interfaces of an ironic Driver <a class="footnote-reference" href="#id19" id="id2">[2]</a>, and use the <code class="docutils literal"><span class="pre">python-oneviewclient</span></code>
<a class="footnote-reference" href="#id20" id="id3">[3]</a> to provide communication between ironic and OneView through OneView&#8217;s
REST API.</p>
<p>To provide a bare metal instance there are four components involved in the
process:</p>
<ul>
<li><p class="first">The ironic service</p>
</li>
<li><p class="first">The ironic-inspector service (if using hardware inspection)</p>
</li>
<li><dl class="first docutils">
<dt>The ironic driver for OneView, which can be:</dt>
<dd><ul class="first last simple">
<li><cite>iscsi_pxe_oneview</cite> or</li>
<li><cite>agent_pxe_oneview</cite></li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">The python-oneviewclient library</p>
</li>
<li><p class="first">The OneView appliance</p>
</li>
</ul>
<p>The role of ironic is to serve as a bare metal provider to OneView&#8217;s managed
physical hardware and to provide communication with other necessary OpenStack
services such as Nova and Glance. When ironic receives a boot request, it
works together with the ironic OneView driver to access a machine in OneView,
the <code class="docutils literal"><span class="pre">python-oneviewclient</span></code> being responsible for the communication with the
OneView appliance.</p>
<p>The Mitaka version of the ironic OneView drivers only supported what we call
<strong>pre-allocation</strong> of nodes, meaning that resources in OneView are allocated
prior to the node being made available in ironic. This model is deprecated and
will be supported until OpenStack&#8217;s Pike release. From the Newton release on,
OneView drivers enables a new feature called <strong>dynamic allocation</strong> of nodes
<a class="footnote-reference" href="#id23" id="id4">[6]</a>. In this model, the driver allocates resources in OneView only at boot
time, allowing idle resources in ironic to be used by OneView users, enabling
actual resource sharing among ironic and OneView users.</p>
<p>Since OneView can claim nodes in <code class="docutils literal"><span class="pre">available</span></code> state at any time, a set of
tasks runs periodically to detect nodes in use by OneView. A node in use by
OneView is placed in <code class="docutils literal"><span class="pre">manageable</span></code> state and has maintenance mode set. Once
the node is no longer in use, these tasks will make place them back in
<code class="docutils literal"><span class="pre">available</span></code> state and clear maintenance mode.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>The following requirements apply for both <code class="docutils literal"><span class="pre">iscsi_pxe_oneview</span></code> and
<code class="docutils literal"><span class="pre">agent_pxe_oneview</span></code> drivers:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">OneView</span> <span class="pre">appliance</span></code> is the HP physical infrastructure manager to be
integrated with the OneView drivers.</p>
<p>Minimum version supported is 2.0.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">python-oneviewclient</span></code> is a python package containing a client to manage
the communication between ironic and OneView.</p>
<p>Install the <code class="docutils literal"><span class="pre">python-oneviewclient</span></code> module to enable the communication.
Minimum version required is 2.4.0 but it is recommended to install the most
up-to-date version:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ pip install &quot;python-oneviewclient&lt;3.0.0,&gt;=2.4.0&quot;
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ironic-inspector</span></code> if using hardware inspection.</p>
</li>
</ul>
</div>
<div class="section" id="tested-platforms">
<h2>Tested platforms<a class="headerlink" href="#tested-platforms" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">The OneView appliance used for testing was the OneView 2.0.</p>
</li>
<li><p class="first">The Enclosure used for testing was the <code class="docutils literal"><span class="pre">BladeSystem</span> <span class="pre">c7000</span> <span class="pre">Enclosure</span> <span class="pre">G2</span></code>.</p>
</li>
<li><p class="first">The drivers should work on HP Proliant Gen8 and Gen9 Servers supported by
OneView 2.0 and above, or any hardware whose network can be managed by
OneView&#8217;s ServerProfile. It has been tested with the following servers:</p>
<ul class="simple">
<li>Proliant BL460c Gen8</li>
<li>Proliant BL460c Gen9</li>
<li>Proliant BL465c Gen8</li>
<li>Proliant DL360 Gen9 (starting with python-oneviewclient 2.1.0)</li>
</ul>
<p>Notice that for the driver to work correctly with Gen8 and Gen9 DL servers
in general, the hardware also needs to run version 4.2.3 of iLO, with
Redfish enabled.</p>
</li>
</ul>
</div>
<div class="section" id="drivers">
<h2>Drivers<a class="headerlink" href="#drivers" title="Permalink to this headline">¶</a></h2>
<div class="section" id="iscsi-pxe-oneview-driver">
<h3>iscsi_pxe_oneview driver<a class="headerlink" href="#iscsi-pxe-oneview-driver" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id5">
<h4>Overview<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">iscsi_pxe_oneview</span></code> driver uses PXEBoot for boot and ISCSIDeploy for deploy.</p>
</div>
<div class="section" id="configuring-and-enabling-the-driver">
<h4>Configuring and enabling the driver<a class="headerlink" href="#configuring-and-enabling-the-driver" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Add <code class="docutils literal"><span class="pre">iscsi_pxe_oneview</span></code> to the list of <code class="docutils literal"><span class="pre">enabled_drivers</span></code> in your
<code class="docutils literal"><span class="pre">ironic.conf</span></code> file. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">enabled_drivers</span> <span class="o">=</span> <span class="n">iscsi_pxe_oneview</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the [oneview] section of your <code class="docutils literal"><span class="pre">ironic.conf</span></code> file with your
OneView credentials and CA certificate files information.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are using the deprecated <code class="docutils literal"><span class="pre">pre-allocation</span></code> feature (i.e.:
<code class="docutils literal"><span class="pre">dynamic_allocation</span></code> is set to False on all nodes), you can disable the
driver periodic tasks by setting <code class="docutils literal"><span class="pre">enable_periodic_tasks=false</span></code> on the
[oneview] section of <code class="docutils literal"><span class="pre">ironic.conf</span></code></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An operator can set the <code class="docutils literal"><span class="pre">periodic_check_interval</span></code> option in the [oneview]
section to set the interval between running the periodic check. The default
value is 300 seconds (5 minutes). A lower value will reduce the likelihood
of races between ironic and OneView at the cost of being more resource
intensive.</p>
</div>
<ol class="arabic" start="3">
<li><p class="first">Restart the ironic conductor service. For Ubuntu users, do:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo service ironic-conductor restart
</pre></div>
</div>
</li>
</ol>
<p>See <a class="footnote-reference" href="#id22" id="id6">[5]</a> for more information.</p>
</div>
<div class="section" id="deploy-process">
<h4>Deploy process<a class="headerlink" href="#deploy-process" title="Permalink to this headline">¶</a></h4>
<p>Here is an overview of the deploy process for this driver:</p>
<ol class="arabic simple">
<li>Admin configures the Proliant baremetal node to use <code class="docutils literal"><span class="pre">iscsi_pxe_oneview</span></code>
driver.</li>
<li>ironic gets a request to deploy a Glance image on the baremetal node.</li>
<li>Driver sets the boot device to PXE.</li>
<li>Driver powers on the baremetal node.</li>
<li>ironic downloads the deploy and user images from a TFTP server.</li>
<li>Driver reboots the baremetal node.</li>
<li>User image is now deployed.</li>
<li>Driver powers off the machine.</li>
<li>Driver sets boot device to Disk.</li>
<li>Driver powers on the machine.</li>
<li>Baremetal node is active and ready to be used.</li>
</ol>
</div>
</div>
<div class="section" id="agent-pxe-oneview-driver">
<h3>agent_pxe_oneview driver<a class="headerlink" href="#agent-pxe-oneview-driver" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id7">
<h4>Overview<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">agent_pxe_oneview</span></code> driver uses PXEBoot for boot and AgentDeploy for deploy.</p>
</div>
<div class="section" id="id8">
<h4>Configuring and enabling the driver<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Add <code class="docutils literal"><span class="pre">agent_pxe_oneview</span></code> to the list of <code class="docutils literal"><span class="pre">enabled_drivers</span></code> in your
<code class="docutils literal"><span class="pre">ironic.conf</span></code>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">enabled_drivers</span> <span class="o">=</span> <span class="n">fake</span><span class="p">,</span><span class="n">pxe_ssh</span><span class="p">,</span><span class="n">pxe_ipmitool</span><span class="p">,</span><span class="n">agent_pxe_oneview</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the [oneview] section of your <code class="docutils literal"><span class="pre">ironic.conf</span></code> file with your
OneView credentials and CA certificate files information.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are using the deprecated <code class="docutils literal"><span class="pre">pre-allocation</span></code> feature (i.e.:
<code class="docutils literal"><span class="pre">dynamic_allocation</span></code> is set to False on all nodes), you can disable the
driver periodic tasks by setting <code class="docutils literal"><span class="pre">enable_periodic_tasks=false</span></code> on the
[oneview] section of <code class="docutils literal"><span class="pre">ironic.conf</span></code></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An operator can set the <code class="docutils literal"><span class="pre">periodic_check_interval</span></code> option in the [oneview]
section to set the interval between running the periodic check. The default
value is 300 seconds (5 minutes). A lower value will reduce the likelihood
of races between ironic and OneView at the cost of being more resource
intensive.</p>
</div>
<ol class="arabic" start="3">
<li><p class="first">Restart the ironic conductor service. For Ubuntu users, do:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ service ironic-conductor restart
</pre></div>
</div>
</li>
</ol>
<p>See <a class="footnote-reference" href="#id22" id="id9">[5]</a> for more information.</p>
</div>
<div class="section" id="id10">
<h4>Deploy process<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>Here is an overview of the deploy process for this driver:</p>
<ol class="arabic simple">
<li>Admin configures the Proliant baremetal node to use <code class="docutils literal"><span class="pre">agent_pxe_oneview</span></code>
driver.</li>
<li>ironic gets a request to deploy a Glance image on the baremetal node.</li>
<li>Driver sets the boot device to PXE.</li>
<li>Driver powers on the baremetal node.</li>
<li>Node downloads the agent deploy images.</li>
<li>Agent downloads the user images and writes it to disk.</li>
<li>Driver reboots the baremetal node.</li>
<li>User image is now deployed.</li>
<li>Driver powers off the machine.</li>
<li>Driver sets boot device to Disk.</li>
<li>Driver powers on the machine.</li>
<li>Baremetal node is active and ready to be used.</li>
</ol>
</div>
</div>
</div>
<div class="section" id="hardware-inspection">
<h2>Hardware inspection<a class="headerlink" href="#hardware-inspection" title="Permalink to this headline">¶</a></h2>
<p>OneView drivers for ironic have the ability to do hardware inspection.
Hardware inspection is the process of discovering hardware properties like
memory size, CPU cores, processor architecture and disk size, of a given
hardware. OneView drivers do in-band inspection, that involves booting a
ramdisk on the hardware and fetching information directly from it. For that,
your cloud controller needs to have the <code class="docutils literal"><span class="pre">ironic-inspector</span></code> component
<a class="footnote-reference" href="#id27" id="id11">[10]</a> running and properly enabled in ironic&#8217;s configuration file.</p>
<p>See <a class="footnote-reference" href="#id28" id="id12">[11]</a> for more information on how to install and configure
<code class="docutils literal"><span class="pre">ironic-inspector</span></code>.</p>
</div>
<div class="section" id="registering-a-oneview-node-in-ironic">
<h2>Registering a OneView node in ironic<a class="headerlink" href="#registering-a-oneview-node-in-ironic" title="Permalink to this headline">¶</a></h2>
<p>Nodes configured to use any of the OneView drivers should have the <code class="docutils literal"><span class="pre">driver</span></code>
property set to <code class="docutils literal"><span class="pre">iscsi_pxe_oneview</span></code> or <code class="docutils literal"><span class="pre">agent_pxe_oneview</span></code>. Considering
our context, a node is the representation of a <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code> in OneView,
and should be consistent with all its properties and related components, such
as <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span> <span class="pre">Type</span></code>, <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span> <span class="pre">Template</span></code>, <code class="docutils literal"><span class="pre">Enclosure</span> <span class="pre">Group</span></code>,
etc. In this case, to be enrolled, the node must have the following parameters:</p>
<ul class="simple">
<li>In <code class="docutils literal"><span class="pre">driver_info</span></code><ul>
<li><code class="docutils literal"><span class="pre">server_hardware_uri</span></code>: URI of the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code> on OneView.</li>
<li><code class="docutils literal"><span class="pre">dynamic_allocation</span></code>: Boolean value to enable or disable (True/False)
<code class="docutils literal"><span class="pre">dynamic</span> <span class="pre">allocation</span></code> for the given node. If this parameter is not set,
the driver will consider the <code class="docutils literal"><span class="pre">pre-allocation</span></code> model to maintain
compatibility on ironic upgrade. The support for this key will be dropped
in the Pike release, where only dynamic allocation will be used.</li>
</ul>
</li>
<li>In <code class="docutils literal"><span class="pre">properties/capabilities</span></code><ul>
<li><code class="docutils literal"><span class="pre">server_hardware_type_uri</span></code>: URI of the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span> <span class="pre">Type</span></code> of the
<code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code>.</li>
<li><code class="docutils literal"><span class="pre">server_profile_template_uri</span></code>: URI of the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span> <span class="pre">Template</span></code> used
to create the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span></code> of the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code>.</li>
<li><code class="docutils literal"><span class="pre">enclosure_group_uri</span></code> (optional): URI of the <code class="docutils literal"><span class="pre">Enclosure</span> <span class="pre">Group</span></code> of the
<code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code>.</li>
</ul>
</li>
</ul>
<p>To enroll a node with any of the OneView drivers, do:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-create -d $DRIVER_NAME
</pre></div>
</div>
<p>To update the <code class="docutils literal"><span class="pre">driver_info</span></code> field of a newly enrolled OneView node, do:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-update $NODE_UUID add \
  driver_info/server_hardware_uri=$SH_URI
</pre></div>
</div>
<p>To update the <code class="docutils literal"><span class="pre">properties/capabilities</span></code> namespace of a newly enrolled
OneView node, do:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-update $NODE_UUID add \
  properties/capabilities=server_hardware_type_uri:$SHT_URI,enclosure_group_uri:$EG_URI,server_profile_template_uri=$SPT_URI
</pre></div>
</div>
<p>In order to deploy, ironic will create and apply, at boot time, a <code class="docutils literal"><span class="pre">Server</span>
<span class="pre">Profile</span></code> based on the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span> <span class="pre">Template</span></code> specified on the node to the
<code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code> it represents on OneView. The URI of such <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span></code>
will be stored in <code class="docutils literal"><span class="pre">driver_info.applied_server_profile_uri</span></code> field while the
Server is allocated to ironic.</p>
<p>The <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span> <span class="pre">Templates</span></code> and, therefore, the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profiles</span></code> derived
from them MUST comply with the following requirements:</p>
<ul class="simple">
<li>The option <cite>MAC Address</cite> in the <cite>Advanced</cite> section of
<code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span></code>/<code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span> <span class="pre">Template</span></code> should be set to <cite>Physical</cite>
option;</li>
<li>Their first <cite>Connection</cite> interface should be:<ul>
<li>Connected to ironic&#8217;s provisioning network and;</li>
<li>The <cite>Boot</cite> option should be set to primary.</li>
</ul>
</li>
</ul>
<p>Node ports should be created considering the <strong>MAC address of the first
Interface</strong> of the given <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Old versions of ironic using <code class="docutils literal"><span class="pre">pre-allocation</span></code> model (before Newton
release) and nodes with <cite>dynamic_allocation</cite> flag disabled shall have their
<code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profiles</span></code> applied during node enrollment and can have their ports
created using the <cite>Virtual</cite> MAC addresses provided on <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span></code>
application.</p>
</div>
<p>To tell ironic which NIC should be connected to the provisioning network, do:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic port-create -n $NODE_UUID -a $MAC_ADDRESS
</pre></div>
</div>
<p>For more information on the enrollment process of an ironic node, see <a class="footnote-reference" href="#id21" id="id13">[4]</a>.</p>
<p>For more information on the definitions of <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code>, <code class="docutils literal"><span class="pre">Server</span>
<span class="pre">Profile</span></code>, <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span> <span class="pre">Template</span></code> and other OneView entities, refer to
<a class="footnote-reference" href="#id18" id="id14">[1]</a> or browse Help in your OneView appliance menu.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ironic manages OneView machines either when they have
a Server Profile applied by the driver or when they don&#8217;t have any Server
Profile. Trying to change the power state of the machine in OneView without
first assigning a Server Profile will lead to allowing Ironic to revert the
power state change. Ironic will NOT change the power state of machines
which the Server Profile was applied by another OneView user.</p>
</div>
</div>
<div class="section" id="migrating-from-pre-allocation-to-dynamic-allocation">
<h2>Migrating from pre-allocation to dynamic allocation<a class="headerlink" href="#migrating-from-pre-allocation-to-dynamic-allocation" title="Permalink to this headline">¶</a></h2>
<p>The migration of a node from an ironic deployment using <code class="docutils literal"><span class="pre">pre-allocation</span></code>
model to the new <code class="docutils literal"><span class="pre">dynamic</span> <span class="pre">allocation</span></code> model can be done by using
<code class="docutils literal"><span class="pre">ironic-oneview-cli</span></code> facilities to migrate nodes (further details on <a class="footnote-reference" href="#id25" id="id15">[8]</a>).
However, the same results can be achieved using the ironic CLI as explained
below.</p>
<div class="section" id="checking-if-a-node-can-be-migrated">
<h3>Checking if a node can be migrated<a class="headerlink" href="#checking-if-a-node-can-be-migrated" title="Permalink to this headline">¶</a></h3>
<p>It is recommended to migrate nodes which are in a stable <cite>provision state</cite>. That
means the conductor is not performing an operation with the node, what can
impact in the execution of a migration. The possible stable <cite>provision_state</cite>
values [<a class="reference internal" href="#id26">9</a>] are: <cite>enroll</cite>, <cite>manageable</cite>, <cite>available</cite>, <cite>active</cite>, <cite>error</cite>,
<cite>clean failed</cite> and <cite>inspect failed</cite>.</p>
<p>Dynamic allocation mode changes the way a <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span></code> is associated with
a node. In <code class="docutils literal"><span class="pre">pre-allocation</span></code> mode, when a node is registered in ironic, there
must be a <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span></code> applied to the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code> represented by
the given node what means, from the OneView point of view, the hardware is in
use. In the <code class="docutils literal"><span class="pre">dynamic</span> <span class="pre">allocation</span></code> mode a <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code> is associated only
when the node is in use by the Compute service or the OneView itself. As a
result, there are different steps to perform if the node has an instance
provisioned, in other words, when the <cite>provisioning_state</cite> is set to <cite>active</cite>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Verify if the node has not already been migrated checking if there is
a <cite>dynamic_allocation</cite> field set to <code class="docutils literal"><span class="pre">True</span></code> in the <cite>driver_info</cite> namespace
doing:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span>$ ironic node-show  --fields driver_info
</pre></div>
</div>
</div>
</div>
<div class="section" id="migrating-nodes-in-active-state">
<h3>Migrating nodes in <cite>active</cite> state<a class="headerlink" href="#migrating-nodes-in-active-state" title="Permalink to this headline">¶</a></h3>
<p>List nodes that are in <cite>active</cite> state doing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-list --provision-state active --fields uuid driver_info
</pre></div>
</div>
<p>Execute the following steps for each node:</p>
<ol class="arabic">
<li><p class="first">Identify the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code> UUID looking at <code class="docutils literal"><span class="pre">server_hardware_uri</span></code>
property (formatted as <code class="docutils literal"><span class="pre">/rest/server-hardware/&lt;server-hardware-uuid&gt;</span></code>) in
the node&#8217;s <code class="docutils literal"><span class="pre">driver_info</span></code> namespace doing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-show &lt;node-uuid&gt; --fields driver_info
</pre></div>
</div>
</li>
<li><p class="first">Log into OneView and find the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code> searching for the
<code class="docutils literal"><span class="pre">Server</span> <span class="pre">Hardware</span></code> UUID identified in step 1. On the overview section,
find the applied <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span></code> entry, click on it and copy the
<code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span></code> URI. The copied excerpt should look like
<code class="docutils literal"><span class="pre">/rest/server-profiles/&lt;server-profile-uuid&gt;</span></code>.</p>
</li>
<li><p class="first">Then, set the copied excerpt from the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span></code> URI to the property
<code class="docutils literal"><span class="pre">applied_server_profile_uri</span></code> in the <code class="docutils literal"><span class="pre">driver_info</span></code> namespace doing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-update &lt;node-uuid&gt; add driver_info/applied_server_profile_uri=&lt;server_profile_uri&gt;
</pre></div>
</div>
</li>
<li><p class="first">Finally, set the <cite>dynamic_allocation</cite> flag in the <code class="docutils literal"><span class="pre">driver_info</span></code> namespace
to <code class="docutils literal"><span class="pre">True</span></code> in order to finish the migration of the node doing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-update &lt;node-uuid&gt; add driver_info/dynamic_allocation=True
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="other-cases-for-migration">
<h3>Other cases for migration<a class="headerlink" href="#other-cases-for-migration" title="Permalink to this headline">¶</a></h3>
<p>Remember these steps are valid for nodes in the following states: <cite>enroll</cite>,
<cite>manageable</cite>, <cite>available</cite>, <cite>error</cite>, <cite>clean failed</cite> and <cite>inspect failed</cite>. So,
list the nodes in a given state, then execute the migration following steps for
each node:</p>
<ol class="arabic">
<li><p class="first">Place the node in maintenance mode to prevent ironic from working on the node
during the migration doing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-set-maintenance --reason &quot;Migrating node to dynamic allocation&quot; &lt;node_uuid&gt; true
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It&#8217;s recommended to check if the node&#8217;s state has not changed as there is no way
of locking the node between these commands.</p>
</div>
</li>
<li><p class="first">Identify which <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span></code> is associated by checking the property
<code class="docutils literal"><span class="pre">server_hardware_uri</span></code> in the <code class="docutils literal"><span class="pre">driver_info</span></code> namespace. Using the
<code class="docutils literal"><span class="pre">server_hardware_uri</span></code>, log into OneView and remove the <code class="docutils literal"><span class="pre">Server</span> <span class="pre">Profile</span></code>.</p>
</li>
<li><p class="first">Set the <cite>dynamic_allocation</cite> to <code class="docutils literal"><span class="pre">True</span></code> in the flag <code class="docutils literal"><span class="pre">driver_info</span></code>
namespace doing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-update $NODE_UUID add driver_info/dynamic_allocation=True
</pre></div>
</div>
</li>
<li><p class="first">Finally, in order to put the node back into the resource pool, remove the
node from maintenance mode doing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-set-maintenance &lt;node_uuid&gt; false
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="rd-party-tools">
<h2>3rd Party Tools<a class="headerlink" href="#rd-party-tools" title="Permalink to this headline">¶</a></h2>
<p>In order to ease user manual tasks, which are often time-consuming, we provide
useful tools that work nicely with the OneView drivers.</p>
<div class="section" id="ironic-oneview-cli">
<h3>ironic-oneview-cli<a class="headerlink" href="#ironic-oneview-cli" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">ironic-oneView</span></code> CLI is a command line interface for management tasks
involving OneView nodes. Its features include a facility to create of ironic
nodes with all required parameters for OneView nodes, creation of Nova flavors
for OneView nodes and, starting from version 0.3.0, the migration of nodes from
<code class="docutils literal"><span class="pre">pre-allocation</span></code> to the <code class="docutils literal"><span class="pre">dynamic</span> <span class="pre">allocation</span></code> model.</p>
<p>For more details on how Ironic-OneView CLI works and how to set it up, see
<a class="footnote-reference" href="#id25" id="id16">[8]</a>.</p>
</div>
<div class="section" id="ironic-oneviewd">
<h3>ironic-oneviewd<a class="headerlink" href="#ironic-oneviewd" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">ironic-oneviewd</span></code> daemon monitors the ironic inventory of resources and
providing facilities to operators managing OneView driver deployments. The
daemon supports both allocation models (dynamic and pre-allocation) as of
version 0.1.0.</p>
<p>For more details on how Ironic-OneViewd works and how to set it up, see <a class="footnote-reference" href="#id24" id="id17">[7]</a>.</p>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<table class="docutils footnote" frame="void" id="id18" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id14">2</a>)</em> HP OneView - <a class="reference external" href="https://www.hpe.com/us/en/integrated-systems/software.html">https://www.hpe.com/us/en/integrated-systems/software.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id19" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference internal" href="../dev/architecture.html#architecture-drivers"><span>Drivers</span></a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id20" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>python-oneviewclient - <a class="reference external" href="https://pypi.python.org/pypi/python-oneviewclient">https://pypi.python.org/pypi/python-oneviewclient</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id21" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13">[4]</a></td><td>Enrollment process of a node - <a class="reference external" href="http://docs.openstack.org/project-install-guide/baremetal/draft/enrollment.html">http://docs.openstack.org/project-install-guide/baremetal/draft/enrollment.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id22" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[5]</td><td><em>(<a class="fn-backref" href="#id6">1</a>, <a class="fn-backref" href="#id9">2</a>)</em> ironic install guide - <a class="reference external" href="http://docs.openstack.org/project-install-guide/baremetal/draft/">http://docs.openstack.org/project-install-guide/baremetal/draft/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id23" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[6]</a></td><td>Dynamic Allocation in OneView drivers - <a class="reference external" href="http://specs.openstack.org/openstack/ironic-specs/specs/not-implemented/oneview-drivers-dynamic-allocation.html">http://specs.openstack.org/openstack/ironic-specs/specs/not-implemented/oneview-drivers-dynamic-allocation.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id24" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id17">[7]</a></td><td>ironic-oneviewd - <a class="reference external" href="https://pypi.python.org/pypi/ironic-oneviewd/">https://pypi.python.org/pypi/ironic-oneviewd/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id25" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td><em>(<a class="fn-backref" href="#id15">1</a>, <a class="fn-backref" href="#id16">2</a>)</em> ironic-oneview-cli - <a class="reference external" href="https://pypi.python.org/pypi/ironic-oneview-cli/">https://pypi.python.org/pypi/ironic-oneview-cli/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id26" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[9]</td><td><a class="reference internal" href="../dev/states.html#states"><span>Ironic&#8217;s State Machine</span></a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id27" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[10]</a></td><td>ironic-inspector - <a class="reference external" href="http://docs.openstack.org/developer/ironic-inspector/">http://docs.openstack.org/developer/ironic-inspector/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id28" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id12">[11]</a></td><td>ironic-inspector install - <a class="reference external" href="http://docs.openstack.org/developer/ironic-inspector/install.html">http://docs.openstack.org/developer/ironic-inspector/install.html</a></td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">OneView drivers</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#tested-platforms">Tested platforms</a></li>
<li><a class="reference internal" href="#drivers">Drivers</a><ul>
<li><a class="reference internal" href="#iscsi-pxe-oneview-driver">iscsi_pxe_oneview driver</a><ul>
<li><a class="reference internal" href="#id5">Overview</a></li>
<li><a class="reference internal" href="#configuring-and-enabling-the-driver">Configuring and enabling the driver</a></li>
<li><a class="reference internal" href="#deploy-process">Deploy process</a></li>
</ul>
</li>
<li><a class="reference internal" href="#agent-pxe-oneview-driver">agent_pxe_oneview driver</a><ul>
<li><a class="reference internal" href="#id7">Overview</a></li>
<li><a class="reference internal" href="#id8">Configuring and enabling the driver</a></li>
<li><a class="reference internal" href="#id10">Deploy process</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#hardware-inspection">Hardware inspection</a></li>
<li><a class="reference internal" href="#registering-a-oneview-node-in-ironic">Registering a OneView node in ironic</a></li>
<li><a class="reference internal" href="#migrating-from-pre-allocation-to-dynamic-allocation">Migrating from pre-allocation to dynamic allocation</a><ul>
<li><a class="reference internal" href="#checking-if-a-node-can-be-migrated">Checking if a node can be migrated</a></li>
<li><a class="reference internal" href="#migrating-nodes-in-active-state">Migrating nodes in <cite>active</cite> state</a></li>
<li><a class="reference internal" href="#other-cases-for-migration">Other cases for migration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rd-party-tools">3rd Party Tools</a><ul>
<li><a class="reference internal" href="#ironic-oneview-cli">ironic-oneview-cli</a></li>
<li><a class="reference internal" href="#ironic-oneviewd">ironic-oneviewd</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="cimc.html"
                                  title="previous chapter">CIMC drivers</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="xenserver.html"
                                  title="next chapter">XenServer drivers</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/ironic
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/drivers/oneview.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="xenserver.html" title="XenServer drivers"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cimc.html" title="CIMC drivers"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Ironic 7.0.1.dev5 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../deploy/drivers.html" accesskey="U">Enabling drivers</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright OpenStack Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/Ironic");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>