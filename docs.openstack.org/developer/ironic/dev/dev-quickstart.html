<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Developer Quick-Start &mdash; Ironic 6.3.0.dev823 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/toggle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.3.0.dev823',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/toggle.js"></script>
    <link rel="top" title="Ironic 6.3.0.dev823 documentation" href="../index.html" />
    <link rel="next" title="Developer FAQ (frequently asked questions)" href="faq.html" />
    <link rel="prev" title="Code Contribution Guide" href="code-contribution-guide.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="developer-quick-start">
<span id="dev-quickstart"></span><h1>Developer Quick-Start<a class="headerlink" href="#developer-quick-start" title="Permalink to this headline">¶</a></h1>
<p>This is a quick walkthrough to get you started developing code for Ironic.
This assumes you are already familiar with submitting code reviews to
an OpenStack project.</p>
<p>The gate currently runs the unit tests under Python 2.7, Python 3.4
and Python 3.5. It is strongly encouraged to run the unit tests locally prior
to submitting a patch.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Do not run unit tests on the same environment as devstack due to
conflicting configuration with system dependencies.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This document is compatible with Python (3.5), Ubuntu (16.04) and Fedora (23).
When referring to different versions of Python and OS distributions, this
is explicitly stated.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://docs.openstack.org/infra/manual/developers.html#development-workflow">http://docs.openstack.org/infra/manual/developers.html#development-workflow</a></p>
</div>
<div class="section" id="prepare-development-system">
<h2>Prepare Development System<a class="headerlink" href="#prepare-development-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="system-prerequisites">
<h3>System Prerequisites<a class="headerlink" href="#system-prerequisites" title="Permalink to this headline">¶</a></h3>
<p>The following packages cover the prerequisites for a local development
environment on most current distributions. Instructions for getting set up with
non-default versions of Python and on older distributions are included below as
well.</p>
<ul>
<li><p class="first">Ubuntu/Debian:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo apt-get install build-essential python-dev libssl-dev python-pip libmysqlclient-dev libxml2-dev libxslt-dev libpq-dev git git-review libffi-dev gettext ipmitool psmisc graphviz libjpeg-dev
</pre></div>
</div>
</li>
<li><p class="first">Fedora 21/RHEL7/CentOS7:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo yum install python-devel openssl-devel python-pip mysql-devel libxml2-devel libxslt-devel postgresql-devel git git-review libffi-devel gettext ipmitool psmisc graphviz gcc libjpeg-turbo-devel
</pre></div>
</div>
<p>If using RHEL and yum reports &#8220;No package python-pip available&#8221; and &#8220;No
package git-review available&#8221;, use the EPEL software repository.
Instructions can be found at <a class="reference external" href="https://fedoraproject.org/wiki/EPEL/FAQ#howtouse">https://fedoraproject.org/wiki/EPEL/FAQ#howtouse</a>.</p>
</li>
<li><p class="first">Fedora 22 or higher:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo dnf install python-devel openssl-devel python-pip mysql-devel libxml2-devel libxslt-devel postgresql-devel git git-review libffi-devel gettext ipmitool psmisc graphviz gcc libjpeg-turbo-devel
</pre></div>
</div>
<p>Additionally, if using Fedora 23, <code class="docutils literal"><span class="pre">redhat-rpm-config</span></code> package should be
installed so that development virtualenv can be built successfully.</p>
</li>
<li><p class="first">openSUSE/SLE 12:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo zypper install git git-review libffi-devel libmysqlclient-devel libopenssl-devel libxml2-devel libxslt-devel postgresql-devel python-devel python-nose python-pip gettext-runtime psmisc
</pre></div>
</div>
<p>Graphviz is only needed for generating the state machine diagram. To install it
on openSUSE or SLE 12, see
<a class="reference external" href="https://software.opensuse.org/download.html?project=graphics&amp;package=graphviz-plugins">https://software.opensuse.org/download.html?project=graphics&amp;package=graphviz-plugins</a>.</p>
</li>
</ul>
</div>
<div class="section" id="optional-installing-py34-requirements">
<h3>(Optional) Installing Py34 requirements<a class="headerlink" href="#optional-installing-py34-requirements" title="Permalink to this headline">¶</a></h3>
<p>If you need Python 3.4, follow the instructions above to install prerequisites
and <em>additionally</em> install the following packages:</p>
<ul>
<li><p class="first">On Ubuntu 14.x/Debian:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo apt-get install python3-dev
</pre></div>
</div>
</li>
<li><p class="first">On Ubuntu 16.04:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>wget https://www.python.org/ftp/python/3.4.4/Python-3.4.4.tgz
sudo tar xzf Python-3.4.4.tgz
cd Python-3.4.4
sudo ./configure
sudo make altinstall

# This will install Python 3.4 without replacing 3.5. To check if 3.4 was installed properly
run this command:

python3.4 -V
</pre></div>
</div>
</li>
<li><p class="first">On Fedora 21/RHEL7/CentOS7:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo yum install python3-devel
</pre></div>
</div>
</li>
<li><p class="first">On Fedora 22 and higher:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo dnf install python3-devel
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="optional-installing-py35-requirements">
<h3>(Optional) Installing Py35 requirements<a class="headerlink" href="#optional-installing-py35-requirements" title="Permalink to this headline">¶</a></h3>
<p>If you need Python 3.5 support on an older distro that does not already have
it, follow the instructions for installing prerequisites above and
<em>additionally</em> run the following commands.</p>
<ul>
<li><p class="first">On Ubuntu 14.04:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>wget https://www.python.org/ftp/python/3.5.2/Python-3.5.2.tgz
sudo tar xzf Python-3.5.2.tgz
cd Python-3.5.2
sudo ./configure
sudo make altinstall

# This will install Python 3.5 without replacing 3.4. To check if 3.5 was installed properly
run this command:

python3.5 -V
</pre></div>
</div>
</li>
<li><p class="first">On Fedora 23:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo dnf install -y dnf-plugins-core
sudo dnf copr enable -y mstuchli/Python3.5
dnf install -y python35-python3
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="python-prerequisites">
<h3>Python Prerequisites<a class="headerlink" href="#python-prerequisites" title="Permalink to this headline">¶</a></h3>
<p>If your distro has at least tox 1.8, use similar command to install
<code class="docutils literal"><span class="pre">python-tox</span></code> package. Otherwise install this on all distros:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo pip install -U tox
</pre></div>
</div>
<p>You may need to explicitly upgrade virtualenv if you&#8217;ve installed the one
from your OS distribution and it is too old (tox will complain). You can
upgrade it individually, if you need to:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo pip install -U virtualenv
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-unit-tests-locally">
<h2>Running Unit Tests Locally<a class="headerlink" href="#running-unit-tests-locally" title="Permalink to this headline">¶</a></h2>
<p>If you haven&#8217;t already, Ironic source code should be pulled directly from git:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># from your home or source directory
cd ~
git clone https://git.openstack.org/openstack/ironic
cd ironic
</pre></div>
</div>
<div class="section" id="running-unit-and-style-tests">
<h3>Running Unit and Style Tests<a class="headerlink" href="#running-unit-and-style-tests" title="Permalink to this headline">¶</a></h3>
<p>All unit tests should be run using tox. To run Ironic&#8217;s entire test suite:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># to run the py27, py34, py35 unit tests, and the style tests</span>
<span class="n">tox</span>
</pre></div>
</div>
<p>To run a specific test or tests, use the &#8220;-e&#8221; option followed by the tox target
name. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># run the unit tests under py27 and also run the pep8 tests</span>
<span class="n">tox</span> <span class="o">-</span><span class="n">epy27</span> <span class="o">-</span><span class="n">epep8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If tests are run under py27 and then run under py34 or py35 the following error may occur:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>db type could not be determined
ERROR: InvocationError: &#39;/home/ubuntu/ironic/.tox/py35/bin/ostestr&#39;
</pre></div>
</div>
<p class="last">To overcome this error remove the file <cite>.testrepository/times.dbm</cite>
and then run the py34 or py35 test.</p>
</div>
<p>You may pass options to the test programs using positional arguments.
To run a specific unit test, this passes the -r option and desired test
(regex string) to <a class="reference external" href="https://pypi.python.org/pypi/os-testr">os-testr</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># run a specific test for Python 2.7
tox -epy27 -- -r test_conductor
</pre></div>
</div>
</div>
<div class="section" id="debugging-unit-tests">
<h3>Debugging unit tests<a class="headerlink" href="#debugging-unit-tests" title="Permalink to this headline">¶</a></h3>
<p>In order to break into the debugger from a unit test we need to insert
a breaking point to the code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pdb</span><span class="p">;</span> <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
</pre></div>
</div>
<p>Then run <code class="docutils literal"><span class="pre">tox</span></code> with the debug environment as one of the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>tox -e debug
tox -e debug test_file_name
tox -e debug test_file_name.TestClass
tox -e debug test_file_name.TestClass.test_name
</pre></div>
</div>
<p>For more information see the <a class="reference external" href="http://docs.openstack.org/developer/oslotest/features.html#debugging-with-oslo-debug-helper">oslotest documentation</a>.</p>
</div>
<div class="section" id="database-setup">
<h3>Database Setup<a class="headerlink" href="#database-setup" title="Permalink to this headline">¶</a></h3>
<p>The unit tests need a local database setup, you can use
<code class="docutils literal"><span class="pre">tools/test-setup.sh</span></code> to set up the database the same way as setup
in the OpenStack test systems.</p>
</div>
<div class="section" id="additional-tox-targets">
<h3>Additional Tox Targets<a class="headerlink" href="#additional-tox-targets" title="Permalink to this headline">¶</a></h3>
<p>There are several additional tox targets not included in the default list, such
as the target which builds the documentation site.   See the <code class="docutils literal"><span class="pre">tox.ini</span></code> file
for a complete listing of tox targets. These can be run directly by specifying
the target name:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># generate the documentation pages locally</span>
<span class="n">tox</span> <span class="o">-</span><span class="n">edocs</span>

<span class="c1"># generate the sample configuration file</span>
<span class="n">tox</span> <span class="o">-</span><span class="n">egenconfig</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="exercising-the-services-locally">
<h2>Exercising the Services Locally<a class="headerlink" href="#exercising-the-services-locally" title="Permalink to this headline">¶</a></h2>
<p>In addition to running automated tests, sometimes it can be helpful to actually
run the services locally, without needing a server in a remote datacenter.</p>
<p>If you would like to exercise the Ironic services in isolation within your local
environment, you can do this without starting any other OpenStack services. For
example, this is useful for rapidly prototyping and debugging interactions over
the RPC channel, testing database migrations, and so forth.</p>
<p>Here we describe two ways to install and configure the dependencies, either run
directly on your local machine or encapsulated in a virtual machine or
container.</p>
<div class="section" id="step-1-create-a-python-virtualenv">
<h3>Step 1: Create a Python virtualenv<a class="headerlink" href="#step-1-create-a-python-virtualenv" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">If you haven&#8217;t already downloaded the source code, do that first:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd ~
git clone https://git.openstack.org/openstack/ironic
cd ironic
</pre></div>
</div>
</li>
<li><p class="first">Create the Python virtualenv:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">tox</span> <span class="o">-</span><span class="n">evenv</span> <span class="o">--</span><span class="n">notest</span> <span class="o">--</span><span class="n">develop</span> <span class="o">-</span><span class="n">r</span>
</pre></div>
</div>
</li>
<li><p class="first">Activate the virtual environment:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">.</span><span class="n">tox</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
</li>
<li><p class="first">Install the ironic client:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>pip install python-ironicclient
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can install python-ironicclient from source by cloning the git
repository and running <cite>pip install .</cite> while in the root of the
cloned repository.</p>
</div>
</li>
<li><p class="first">Export some ENV vars so the client will connect to the local services
that you&#8217;ll start in the next section:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>export OS_AUTH_TOKEN=fake-token
export IRONIC_URL=http://localhost:6385/
</pre></div>
</div>
</li>
</ol>
<p>Next, install and configure system dependencies. Two different approaches are
described below; you should only do one of these.</p>
</div>
<div class="section" id="step-2a-system-dependencies-in-a-virtual-machine">
<h3>Step 2a: System Dependencies In A Virtual Machine<a class="headerlink" href="#step-2a-system-dependencies-in-a-virtual-machine" title="Permalink to this headline">¶</a></h3>
<p>This option requires <a class="reference external" href="https://www.virtualbox.org">virtualbox</a>,
<a class="reference external" href="https://www.vagrantup.com">vagrant</a>, and
<a class="reference external" href="https://www.ansible.com">ansible</a>. You may install these using your
favorite package manager, or by downloading from the provided links.</p>
<ol class="arabic">
<li><p class="first">Let vagrant do the work:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>vagrant up
</pre></div>
</div>
</li>
</ol>
<p>This will create a VM available to your local system at <cite>192.168.99.11</cite>,
will install all the necessary service dependencies,
and configure some default users. It will also generate
<cite>./etc/ironic/ironic.conf.local</cite> preconfigured for local dev work.
We recommend you compare and familiarize yourself with the settings in
<cite>./etc/ironic/ironic.conf.sample</cite> so you can adjust it to meet your own needs.</p>
</div>
<div class="section" id="step-2b-install-system-dependencies-locally">
<h3>Step 2b: Install System Dependencies Locally<a class="headerlink" href="#step-2b-install-system-dependencies-locally" title="Permalink to this headline">¶</a></h3>
<p>This option will install RabbitMQ and MySQL on your local system. This may not
be desirable in some situations (eg, you&#8217;re developing from a laptop and do not
want to run a MySQL server on it all the time).</p>
<ol class="arabic">
<li><p class="first">Install rabbitmq-server:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># install rabbit message broker
# Ubuntu/Debian:
sudo apt-get install rabbitmq-server

# Fedora 21/RHEL7/CentOS7:
sudo yum install rabbitmq-server
sudo systemctl start rabbitmq-server.service

# Fedora 22 or higher:
sudo dnf install rabbitmq-server
sudo systemctl start rabbitmq-server.service

# openSUSE/SLE 12:
sudo zypper install rabbitmq-server
sudo systemctl start rabbitmq-server.service
</pre></div>
</div>
</li>
<li><p class="first">Install mysql-server:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># Ubuntu/Debian:
# sudo apt-get install mysql-server

# Fedora 21/RHEL7/CentOS7:
# sudo yum install mariadb mariadb-server
# sudo systemctl start mariadb.service

# Fedora 22 or higher:
# sudo dnf install mariadb mariadb-server
# sudo systemctl start mariadb.service

# openSUSE/SLE 12:
# sudo zypper install mariadb
# sudo systemctl start mysql.service

# If using MySQL, you need to create the initial database
mysql -u root -pMYSQL_ROOT_PWD -e &quot;create schema ironic&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">if you choose not to install mysql-server, ironic will default to
using a local sqlite database.</p>
</div>
</li>
<li><p class="first">Create a configuration file within the ironic source directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># copy sample config and modify it as necessary
cp etc/ironic/ironic.conf.sample etc/ironic/ironic.conf.local

# disable auth since we are not running keystone here
sed -i &quot;s/#auth_strategy = keystone/auth_strategy = noauth/&quot; etc/ironic/ironic.conf.local

# Use the &#39;fake_ipmitool&#39; test driver
sed -i &quot;s/#enabled_drivers = pxe_ipmitool/enabled_drivers = fake_ipmitool/&quot; etc/ironic/ironic.conf.local

# set a fake host name [useful if you want to test multiple services on the same host]
sed -i &quot;s/#host = .*/host = test-host/&quot; etc/ironic/ironic.conf.local

# change the periodic sync_power_state_interval to a week, to avoid getting NodeLocked exceptions
sed -i &quot;s/#sync_power_state_interval = 60/sync_power_state_interval = 604800/&quot; etc/ironic/ironic.conf.local

# if you opted to install mysql-server, switch the DB connection from sqlite to mysql
sed -i &quot;s/#connection = .*/connection = mysql\+pymysql:\/\/root:MYSQL_ROOT_PWD@localhost\/ironic/&quot; etc/ironic/ironic.conf.local
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="step-3-start-the-services">
<h3>Step 3: Start the Services<a class="headerlink" href="#step-3-start-the-services" title="Permalink to this headline">¶</a></h3>
<p>From within the python virtualenv, run the following command to prepare the
database before you start the ironic services:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># initialize the database for ironic
ironic-dbsync --config-file etc/ironic/ironic.conf.local create_schema
</pre></div>
</div>
<p>Next, open two new terminals for this section, and run each of the examples
here in a separate terminal. In this way, the services will <em>not</em> be run as
daemons; you can observe their output and stop them with Ctrl-C at any time.</p>
<ol class="arabic">
<li><p class="first">Start the API service in debug mode and watch its output:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd ~/ironic
source .tox/venv/bin/activate
ironic-api -v -d --config-file etc/ironic/ironic.conf.local
</pre></div>
</div>
</li>
<li><p class="first">Start the Conductor service in debug mode and watch its output:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd ~/ironic
source .tox/venv/bin/activate
ironic-conductor -v -d --config-file etc/ironic/ironic.conf.local
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="step-4-interact-with-the-running-services">
<h3>Step 4: Interact with the running services<a class="headerlink" href="#step-4-interact-with-the-running-services" title="Permalink to this headline">¶</a></h3>
<p>You should now be able to interact with ironic via the python client, which is
present in the python virtualenv, and observe both services&#8217; debug outputs in
the other two windows. This is a good way to test new features or play with the
functionality without necessarily starting DevStack.</p>
<p>To get started, list the available commands and resources:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># get a list of available commands
ironic help

# get the list of drivers currently supported by the available conductor(s)
ironic driver-list

# get a list of nodes (should be empty at this point)
ironic node-list
</pre></div>
</div>
<p>Here is an example walkthrough of creating a node:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>MAC=&quot;aa:bb:cc:dd:ee:ff&quot;   # replace with the MAC of a data port on your node
IPMI_ADDR=&quot;1.2.3.4&quot;       # replace with a real IP of the node BMC
IPMI_USER=&quot;admin&quot;         # replace with the BMC&#39;s user name
IPMI_PASS=&quot;pass&quot;          # replace with the BMC&#39;s password

# enroll the node with the &quot;fake&quot; deploy driver and the &quot;ipmitool&quot; power driver
# Note that driver info may be added at node creation time with &quot;-i&quot;
NODE=$(ironic node-create -d fake_ipmitool -i ipmi_address=$IPMI_ADDR -i ipmi_username=$IPMI_USER | grep &#39; uuid &#39; | awk &#39;{print $4}&#39;)

# driver info may also be added or updated later on
ironic node-update $NODE add driver_info/ipmi_password=$IPMI_PASS

# add a network port
ironic port-create -n $NODE -a $MAC

# view the information for the node
ironic node-show $NODE

# request that the node&#39;s driver validate the supplied information
ironic node-validate $NODE

# you have now enrolled a node sufficiently to be able to control
# its power state from ironic!
ironic node-set-power-state $NODE on
</pre></div>
</div>
<p>If you make some code changes and want to test their effects, simply stop the
services with Ctrl-C and restart them.</p>
</div>
<div class="section" id="step-5-fixing-your-test-environment">
<h3>Step 5: Fixing your test environment<a class="headerlink" href="#step-5-fixing-your-test-environment" title="Permalink to this headline">¶</a></h3>
<p>If you are testing changes that add or remove python entrypoints, or making
significant changes to ironic&#8217;s python modules, or simply keep the virtualenv
around for a long time, your development environment may reach an inconsistent
state. It may help to delete cached &#8221;.pyc&#8221; files, update dependencies,
reinstall ironic, or even recreate the virtualenv. The following commands may
help with that, but are not an exhaustive troubleshooting guide:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># clear cached pyc files
cd ~/ironic/ironic
find ./ -name &#39;*.pyc&#39; | xargs rm

# reinstall ironic modules
cd ~/ironic
source .tox/venv/bin/activate
pip uninstall ironic
pip install -e .

# install and upgrade ironic and all python dependencies
cd ~/ironic
source .tox/venv/bin/activate
pip install -U -e .
</pre></div>
</div>
</div>
</div>
<div class="section" id="deploying-ironic-with-devstack">
<h2>Deploying Ironic with DevStack<a class="headerlink" href="#deploying-ironic-with-devstack" title="Permalink to this headline">¶</a></h2>
<p>DevStack may be configured to deploy Ironic, setup Nova to use the Ironic
driver and provide hardware resources (network, baremetal compute nodes)
using a combination of OpenVSwitch and libvirt.  It is highly recommended
to deploy on an expendable virtual machine and not on your personal work
station.  Deploying Ironic with DevStack requires a machine running Ubuntu
14.04 (or later) or Fedora 20 (or later). Make sure your machine is fully
up to date and has the latest packages installed before beginning this process.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://docs.openstack.org/developer/devstack/">http://docs.openstack.org/developer/devstack/</a></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The devstack &#8220;demo&#8221; tenant is now granted the &#8220;baremetal_observer&#8221; role
and thereby has read-only access to ironic&#8217;s API. This is sufficient for
all the examples below. Should you want to create or modify bare metal
resources directly (ie. through ironic rather than through nova) you will
need to use the devstack &#8220;admin&#8221; tenant.</p>
</div>
<p>Devstack will no longer create the user &#8216;stack&#8217; with the desired
permissions, but does provide a script to perform the task:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>git clone https://git.openstack.org/openstack-dev/devstack.git devstack
sudo ./devstack/tools/create-stack-user.sh
</pre></div>
</div>
<p>Switch to the stack user and clone DevStack:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo su - stack
git clone https://git.openstack.org/openstack-dev/devstack.git devstack
</pre></div>
</div>
<p>Create devstack/local.conf with minimal settings required to enable Ironic.
You can use either of two drivers for deploy: agent_* or pxe_*, see <a class="reference internal" href="../drivers/ipa.html#ipa"><span>Ironic Python Agent</span></a>
for explanation. An example local.conf that enables both types of drivers
and uses the <code class="docutils literal"><span class="pre">agent_ipmitool</span></code> driver by default:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd devstack
cat &gt;local.conf &lt;&lt;END
[[local|localrc]]
# Credentials
ADMIN_PASSWORD=password
DATABASE_PASSWORD=password
RABBIT_PASSWORD=password
SERVICE_PASSWORD=password
SERVICE_TOKEN=password
SWIFT_HASH=password
SWIFT_TEMPURL_KEY=password

# Enable Ironic plugin
enable_plugin ironic git://git.openstack.org/openstack/ironic

# Enable Neutron which is required by Ironic and disable nova-network.
disable_service n-net
disable_service n-novnc
enable_service q-svc
enable_service q-agt
enable_service q-dhcp
enable_service q-l3
enable_service q-meta
enable_service neutron

# Enable Swift for agent_* drivers
enable_service s-proxy
enable_service s-object
enable_service s-container
enable_service s-account

# Disable Horizon
disable_service horizon

# Disable Heat
disable_service heat h-api h-api-cfn h-api-cw h-eng

# Disable Cinder
disable_service cinder c-sch c-api c-vol

# Swift temp URL&#39;s are required for agent_* drivers.
SWIFT_ENABLE_TEMPURLS=True

# Create 3 virtual machines to pose as Ironic&#39;s baremetal nodes.
IRONIC_VM_COUNT=3
IRONIC_VM_SSH_PORT=22
IRONIC_BAREMETAL_BASIC_OPS=True
DEFAULT_INSTANCE_TYPE=baremetal

# Enable Ironic drivers.
IRONIC_ENABLED_DRIVERS=fake,agent_ssh,agent_ipmitool,pxe_ssh,pxe_ipmitool

# Change this to alter the default driver for nodes created by devstack.
# This driver should be in the enabled list above.
IRONIC_DEPLOY_DRIVER=agent_ipmitool

# The parameters below represent the minimum possible values to create
# functional nodes.
IRONIC_VM_SPECS_RAM=1280
IRONIC_VM_SPECS_DISK=10

# Size of the ephemeral partition in GB. Use 0 for no ephemeral partition.
IRONIC_VM_EPHEMERAL_DISK=0

# To build your own IPA ramdisk from source, set this to True
IRONIC_BUILD_DEPLOY_RAMDISK=False

VIRT_DRIVER=ironic

# By default, DevStack creates a 10.0.0.0/24 network for instances.
# If this overlaps with the hosts network, you may adjust with the
# following.
NETWORK_GATEWAY=10.1.0.1
FIXED_RANGE=10.1.0.0/24
FIXED_NETWORK_SIZE=256

# Log all output to files
LOGFILE=$HOME/devstack.log
LOGDIR=$HOME/logs
IRONIC_VM_LOG_DIR=$HOME/ironic-bm-logs

END
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Git protocol requires access to port 9418, which is not a standard port that
corporate firewalls always allow. If you are behind a firewall or on a proxy that
blocks Git protocol, modify the <code class="docutils literal"><span class="pre">enable_plugin</span></code> line to use <code class="docutils literal"><span class="pre">https://</span></code> instead
of <code class="docutils literal"><span class="pre">git://</span></code> and add <code class="docutils literal"><span class="pre">GIT_BASE=https://git.openstack.org</span></code> to the credentials:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span>GIT_BASE=https://git.openstack.org

# Enable Ironic plugin
enable_plugin ironic https://git.openstack.org/openstack/ironic
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The agent_ssh and pxe_ssh drivers are being deprecated in favor of the
more production-like agent_ipmitool and pxe_ipmitool drivers. When a
*_ipmitool driver is set and IRONIC_IS_HARDWARE variable is false devstack
will automatically set up <a class="reference external" href="https://github.com/openstack/virtualbmc">VirtualBMC</a>
to control the power state of the virtual baremetal nodes.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When running QEMU as non-root user (e.g. <code class="docutils literal"><span class="pre">qemu</span></code> on Fedora or <code class="docutils literal"><span class="pre">libvirt-qemu</span></code> on Ubuntu),
make sure <code class="docutils literal"><span class="pre">IRONIC_VM_LOG_DIR</span></code> points to a directory where QEMU will be able to write.
You can verify this with, for example:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span># on Fedora
sudo -u qemu touch $HOME/ironic-bm-logs/test.log
# on Ubuntu
sudo -u libvirt-qemu touch $HOME/ironic-bm-logs/test.log
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To check out an in-progress patch for testing, you can add a Git ref to the <code class="docutils literal"><span class="pre">enable_plugin</span></code> line. For instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>enable_plugin ironic git://git.openstack.org/openstack/ironic refs/changes/46/295946/15
</pre></div>
</div>
<p>For a patch in review, you can find the ref to use by clicking the
&#8220;Download&#8221; button in Gerrit. You can also specify a different git repo, or
a branch or tag:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>enable_plugin ironic https://github.com/openstack/ironic stable/kilo
</pre></div>
</div>
<p class="last">For more details, see the
<a class="reference external" href="http://docs.openstack.org/developer/devstack/plugins.html#plugin-interface">devstack plugin interface documentation</a>.</p>
</div>
<p>Run stack.sh:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./stack.sh
</pre></div>
</div>
<p>Source credentials, create a key, and spawn an instance as the <code class="docutils literal"><span class="pre">demo</span></code> user:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>source ~/devstack/openrc

# query the image id of the default cirros image
image=$(openstack image show $DEFAULT_IMAGE_NAME -f value -c id)

# create keypair
ssh-keygen
openstack keypair create --public-key ~/.ssh/id_rsa.pub default

# spawn instance
openstack server create --flavor baremetal --image $image --key-name default testing
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Because devstack create multiple networks, we need to pass an additional parameter
<code class="docutils literal"><span class="pre">--nic</span> <span class="pre">net-id</span></code> to the nova boot command when using the admin account, for example:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span>net_id=$(openstack network list | egrep &quot;$PRIVATE_NETWORK_NAME&quot;&#39;[^-]&#39; | awk &#39;{ print $2 }&#39;)

openstack server create --flavor baremetal --nic net-id=$net_id --image $image --key-name default testing
</pre></div>
</div>
</div>
<p>You should now see a Nova instance building:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>openstack server list
+--------------------------------------+---------+--------+------------+-------------+----------+
| ID                                   | Name    | Status | Task State | Power State | Networks |
+--------------------------------------+---------+--------+------------+-------------+----------+
| a2c7f812-e386-4a22-b393-fe1802abd56e | testing | BUILD  | spawning   | NOSTATE     |          |
+--------------------------------------+---------+--------+------------+-------------+----------+
</pre></div>
</div>
<p>Nova will be interfacing with Ironic conductor to spawn the node.  On the
Ironic side, you should see an Ironic node associated with this Nova instance.
It should be powered on and in a &#8216;wait call-back&#8217; provisioning state:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>openstack baremetal node list
+--------------------------------------+--------------------------------------+-------------+--------------------+
| UUID                                 | Instance UUID                        | Power State | Provisioning State |
+--------------------------------------+--------------------------------------+-------------+--------------------+
| 9e592cbe-e492-4e4f-bf8f-4c9e0ad1868f | None                                 | power off   | None               |
| ec0c6384-cc3a-4edf-b7db-abde1998be96 | None                                 | power off   | None               |
| 4099e31c-576c-48f8-b460-75e1b14e497f | a2c7f812-e386-4a22-b393-fe1802abd56e | power on    | wait call-back     |
+--------------------------------------+--------------------------------------+-------------+--------------------+
</pre></div>
</div>
<p>At this point, Ironic conductor has called to libvirt via SSH to power on a
virtual machine, which will PXE + TFTP boot from the conductor node and
progress through the Ironic provisioning workflow.  One libvirt domain should
be active now:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo virsh list --all
 Id    Name                           State
----------------------------------------------------
 2     baremetalbrbm_2                running
 -     baremetalbrbm_0                shut off
 -     baremetalbrbm_1                shut off
</pre></div>
</div>
<p>This provisioning process may take some time depending on the performance of
the host system, but Ironic should eventually show the node as having an
&#8216;active&#8217; provisioning state:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>openstack baremetal node list
+--------------------------------------+--------------------------------------+-------------+--------------------+
| UUID                                 | Instance UUID                        | Power State | Provisioning State |
+--------------------------------------+--------------------------------------+-------------+--------------------+
| 9e592cbe-e492-4e4f-bf8f-4c9e0ad1868f | None                                 | power off   | None               |
| ec0c6384-cc3a-4edf-b7db-abde1998be96 | None                                 | power off   | None               |
| 4099e31c-576c-48f8-b460-75e1b14e497f | a2c7f812-e386-4a22-b393-fe1802abd56e | power on    | active             |
+--------------------------------------+--------------------------------------+-------------+--------------------+
</pre></div>
</div>
<p>This should also be reflected in the Nova instance state, which at this point
should be ACTIVE, Running and an associated private IP:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>openstack server list
+--------------------------------------+---------+--------+------------+-------------+------------------+
| ID                                   | Name    | Status | Task State | Power State | Networks         |
+--------------------------------------+---------+--------+------------+-------------+------------------+
| a2c7f812-e386-4a22-b393-fe1802abd56e | testing | ACTIVE | -          | Running     | private=10.1.0.4 |
+--------------------------------------+---------+--------+------------+-------------+------------------+
</pre></div>
</div>
<p>The server should now be accessible via SSH:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ssh cirros@10.1.0.4
$
</pre></div>
</div>
</div>
<div class="section" id="running-tempest-tests">
<h2>Running Tempest tests<a class="headerlink" href="#running-tempest-tests" title="Permalink to this headline">¶</a></h2>
<p>After <a class="reference internal" href="#deploying-ironic-with-devstack">Deploying Ironic with DevStack</a> one might want to run integration
tests against the running cloud. The Tempest project is the project that
offers an integration test suite for OpenStack.</p>
<p>First, navigate to Tempest directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">stack</span><span class="o">/</span><span class="n">tempest</span>
</pre></div>
</div>
<p>To run all tests from the <a class="reference external" href="https://git.openstack.org/cgit/openstack/ironic/tree/ironic_tempest_plugin?h=master">Ironic plugin</a>,
execute the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>tox -e all-plugin -- ironic
</pre></div>
</div>
<p>To limit the amount of tests that you would like to run, you can use
a regex. For instance, to limit the run to a single test file, the
following command can be used:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>tox -e all-plugin -- ironic_tempest_plugin.tests.scenario.test_baremetal_basic_ops
</pre></div>
</div>
<div class="section" id="debugging-tempest-tests">
<h3>Debugging Tempest tests<a class="headerlink" href="#debugging-tempest-tests" title="Permalink to this headline">¶</a></h3>
<p>It is sometimes useful to step through the test code, line by line,
especially when the error output is vague. This can be done by
running the tests in debug mode and using a debugger such as <a class="reference external" href="https://docs.python.org/2/library/pdb.html">pdb</a>.</p>
<p>For example, after editing the <em>test_baremetal_basic_ops</em> file and
setting up the pdb traces you can invoke the <code class="docutils literal"><span class="pre">run_tempest.sh</span></code> script
in the Tempest directory with the following parameters:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./run_tempest.sh -N -d ironic_tempest_plugin.tests.scenario.test_baremetal_basic_ops
</pre></div>
</div>
<ul class="simple">
<li>The <em>-N</em> parameter tells the script to run the tests in the local
environment (without a virtualenv) so it can find the Ironic tempest
plugin.</li>
<li>The <em>-d</em> parameter enables the debug mode, allowing it to be used
with pdb.</li>
</ul>
<p>For more information about the supported parameters see:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./run_tempest.sh --help
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Always be careful when running debuggers in time sensitive code,
they may cause timeout errors that weren&#8217;t there before.</p>
</div>
</div>
</div>
<div class="section" id="building-developer-documentation">
<h2>Building developer documentation<a class="headerlink" href="#building-developer-documentation" title="Permalink to this headline">¶</a></h2>
<p>If you would like to build the documentation locally, eg. to test your
documentation changes before uploading them for review, run these
commands to build the documentation set:</p>
<ul>
<li><p class="first">On your local machine:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># activate your development virtualenv</span>
<span class="n">source</span> <span class="o">.</span><span class="n">tox</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>

<span class="c1"># build the docs</span>
<span class="n">tox</span> <span class="o">-</span><span class="n">edocs</span>

<span class="c1">#Now use your browser to open the top-level index.html located at:</span>

<span class="n">ironic</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
</li>
<li><p class="first">On a remote machine:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># Go to the directory that contains the docs
cd ~/ironic/doc/source/

# Build the docs
tox -edocs

# Change directory to the newly built HTML files
cd ~/ironic/doc/build/html/

# Create a server using python on port 8000
python -m SimpleHTTPServer 8000

#Now use your browser to open the top-level index.html located at:

http://your_ip:8000
</pre></div>
</div>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Developer Quick-Start</a><ul>
<li><a class="reference internal" href="#prepare-development-system">Prepare Development System</a><ul>
<li><a class="reference internal" href="#system-prerequisites">System Prerequisites</a></li>
<li><a class="reference internal" href="#optional-installing-py34-requirements">(Optional) Installing Py34 requirements</a></li>
<li><a class="reference internal" href="#optional-installing-py35-requirements">(Optional) Installing Py35 requirements</a></li>
<li><a class="reference internal" href="#python-prerequisites">Python Prerequisites</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-unit-tests-locally">Running Unit Tests Locally</a><ul>
<li><a class="reference internal" href="#running-unit-and-style-tests">Running Unit and Style Tests</a></li>
<li><a class="reference internal" href="#debugging-unit-tests">Debugging unit tests</a></li>
<li><a class="reference internal" href="#database-setup">Database Setup</a></li>
<li><a class="reference internal" href="#additional-tox-targets">Additional Tox Targets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercising-the-services-locally">Exercising the Services Locally</a><ul>
<li><a class="reference internal" href="#step-1-create-a-python-virtualenv">Step 1: Create a Python virtualenv</a></li>
<li><a class="reference internal" href="#step-2a-system-dependencies-in-a-virtual-machine">Step 2a: System Dependencies In A Virtual Machine</a></li>
<li><a class="reference internal" href="#step-2b-install-system-dependencies-locally">Step 2b: Install System Dependencies Locally</a></li>
<li><a class="reference internal" href="#step-3-start-the-services">Step 3: Start the Services</a></li>
<li><a class="reference internal" href="#step-4-interact-with-the-running-services">Step 4: Interact with the running services</a></li>
<li><a class="reference internal" href="#step-5-fixing-your-test-environment">Step 5: Fixing your test environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deploying-ironic-with-devstack">Deploying Ironic with DevStack</a></li>
<li><a class="reference internal" href="#running-tempest-tests">Running Tempest tests</a><ul>
<li><a class="reference internal" href="#debugging-tempest-tests">Debugging Tempest tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-developer-documentation">Building developer documentation</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="code-contribution-guide.html"
                                  title="previous chapter">Code Contribution Guide</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="faq.html"
                                  title="next chapter">Developer FAQ (frequently asked questions)</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/ironic
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/dev/dev-quickstart.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="faq.html" title="Developer FAQ (frequently asked questions)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="code-contribution-guide.html" title="Code Contribution Guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Ironic 6.3.0.dev823 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright OpenStack Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/Ironic");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>