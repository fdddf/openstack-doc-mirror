<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation Guide &mdash; ironic 5.1.3.dev21 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/toggle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.1.3.dev21',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/toggle.js"></script>
    <link rel="top" title="ironic 5.1.3.dev21 documentation" href="../index.html" />
    <link rel="next" title="Bare Metal Service Upgrade Guide" href="upgrade-guide.html" />
    <link rel="prev" title="Introduction to Ironic" href="user-guide.html" /> 
  </head>
  <body>
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="installation-guide">
<span id="install-guide"></span><h1>Installation Guide<a class="headerlink" href="#installation-guide" title="Permalink to this headline">¶</a></h1>
<p>This document is continually updated and reflects the latest
available code of the Bare Metal service (ironic).
Users of releases may encounter differences and are encouraged
to look at earlier versions of this document for guidance.</p>
<div class="section" id="service-overview">
<h2>Service overview<a class="headerlink" href="#service-overview" title="Permalink to this headline">¶</a></h2>
<p>The Bare Metal service is a collection of components that provides support to
manage and provision physical machines.</p>
<p>Also known as the <tt class="docutils literal"><span class="pre">ironic</span></tt> project, the Bare Metal service may, depending
upon configuration, interact with several other OpenStack services. This
includes:</p>
<ul class="simple">
<li>the OpenStack Telemetry module (ceilometer) for consuming the IPMI metrics</li>
<li>the OpenStack Identity service (keystone) for request authentication and to
locate other OpenStack services</li>
<li>the OpenStack Image service (glance) from which to retrieve images and image meta-data</li>
<li>the OpenStack Networking service (neutron) for DHCP and network configuration</li>
<li>the OpenStack Compute service (nova) works with the Bare Metal service and acts as
a user-facing API for instance management, while the Bare Metal service provides
the admin/operator API for hardware management.
The OpenStack Compute service also provides scheduling facilities (matching
flavors &lt;-&gt; images &lt;-&gt; hardware), tenant quotas, IP assignment, and other
services which the Bare Metal service does not, in and of itself, provide.</li>
<li>the OpenStack Block Storage (cinder) provides volumes, but this aspect is not yet available.</li>
</ul>
<p>The Bare Metal service includes the following components:</p>
<ul class="simple">
<li>ironic-api: A RESTful API that processes application requests by sending
them to the ironic-conductor over RPC.</li>
<li>ironic-conductor: Adds/edits/deletes nodes; powers on/off nodes with
ipmi or ssh; provisions/deploys/decommissions bare metal nodes.</li>
<li>ironic-python-agent: A python service which is run in a temporary ramdisk to
provide ironic-conductor service(s) with remote access and in-band hardware
control.</li>
<li>python-ironicclient: A command-line interface (CLI) for interacting with
the Bare Metal service.</li>
</ul>
<p>Additionally, the Bare Metal service has certain external dependencies, which are
very similar to other OpenStack services:</p>
<ul class="simple">
<li>A database to store hardware information and state. You can set the database
back-end type and location. A simple approach is to use the same database
back end as the Compute service. Another approach is to use a separate
database back-end to further isolate bare metal resources (and associated
metadata) from users.</li>
<li>A queue. A central hub for passing messages, such as RabbitMQ.
It should use the same implementation as that of the Compute service.</li>
</ul>
<p>Optionally, one may wish to utilize the following associated projects for
additional functionality:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/openstack/ironic-inspector">ironic-inspector</a>; An associated service which performs in-band hardware
introspection by PXE booting unregistered hardware into a &#8220;discovery ramdisk&#8221;.</li>
<li><a class="reference external" href="https://github.com/openstack/diskimage-builder">diskimage-builder</a>; May be used to customize machine images, create and
discovery deploy ramdisks, if necessary.</li>
<li><a class="reference external" href="https://github.com/openstack/bifrost">bifrost</a>; a set of Ansible playbooks that automates the task of deploying a
base image onto a set of known hardware using ironic.</li>
</ul>
</div>
<div class="section" id="install-and-configure-prerequisites">
<h2>Install and configure prerequisites<a class="headerlink" href="#install-and-configure-prerequisites" title="Permalink to this headline">¶</a></h2>
<p>The Bare Metal service is a collection of components that provides support to
manage and provision physical machines. You can configure these components to
run on separate nodes or the same node. In this guide, the components run on
one node, typically the Compute Service&#8217;s compute node.</p>
<p>This section shows you how to install and configure the components.</p>
<p>It assumes that the Identity, Image, Compute, and Networking services
have already been set up.</p>
<div class="section" id="configure-the-identity-service-for-the-bare-metal-service">
<h3>Configure the Identity service for the Bare Metal service<a class="headerlink" href="#configure-the-identity-service-for-the-bare-metal-service" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Create the Bare Metal service user (for example,``ironic``).
The service uses this to authenticate with the Identity service.
Use the <tt class="docutils literal"><span class="pre">service</span></tt> tenant and give the user the <tt class="docutils literal"><span class="pre">admin</span></tt> role:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>openstack user create --password IRONIC_PASSWORD \
--email ironic@example.com ironic
openstack role add --project service --user ironic admin
</pre></div>
</div>
</li>
<li><p class="first">You must register the Bare Metal service with the Identity service so that
other OpenStack services can locate it. To register the service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>openstack service create --name ironic --description \
&quot;Ironic baremetal provisioning service&quot; baremetal
</pre></div>
</div>
</li>
<li><p class="first">Use the <tt class="docutils literal"><span class="pre">id</span></tt> property that is returned from the Identity service when
registering the service (above), to create the endpoint,
and replace IRONIC_NODE with your Bare Metal service&#8217;s API node:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>openstack endpoint create --region RegionOne \
--publicurl http://IRONIC_NODE:6385 \
--internalurl http://IRONIC_NODE:6385 \
--adminurl http://IRONIC_NODE:6385 \
baremetal
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="set-up-the-database-for-bare-metal">
<h3>Set up the database for Bare Metal<a class="headerlink" href="#set-up-the-database-for-bare-metal" title="Permalink to this headline">¶</a></h3>
<p>The Bare Metal service stores information in a database. This guide uses the
MySQL database that is used by other OpenStack services.</p>
<ol class="arabic">
<li><p class="first">In MySQL, create an <tt class="docutils literal"><span class="pre">ironic</span></tt> database that is accessible by the
<tt class="docutils literal"><span class="pre">ironic</span></tt> user. Replace IRONIC_DBPASSWORD
with a suitable password:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># mysql -u root -p
mysql&gt; CREATE DATABASE ironic CHARACTER SET utf8;
mysql&gt; GRANT ALL PRIVILEGES ON ironic.* TO &#39;ironic&#39;@&#39;localhost&#39; \
IDENTIFIED BY &#39;IRONIC_DBPASSWORD&#39;;
mysql&gt; GRANT ALL PRIVILEGES ON ironic.* TO &#39;ironic&#39;@&#39;%&#39; \
IDENTIFIED BY &#39;IRONIC_DBPASSWORD&#39;;
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="install-the-bare-metal-service">
<h3>Install the Bare Metal service<a class="headerlink" href="#install-the-bare-metal-service" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Install from packages and configure services:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu 14.04 (trusty) or higher:
    sudo apt-get install ironic-api ironic-conductor python-ironicclient

Fedora 21/RHEL7/CentOS7:
    sudo yum install openstack-ironic-api openstack-ironic-conductor \
    python-ironicclient
    sudo systemctl enable openstack-ironic-api openstack-ironic-conductor
    sudo systemctl start openstack-ironic-api openstack-ironic-conductor

Fedora 22 or higher:
    sudo dnf install openstack-ironic-api openstack-ironic-conductor \
    python-ironicclient
    sudo systemctl enable openstack-ironic-api openstack-ironic-conductor
    sudo systemctl start openstack-ironic-api openstack-ironic-conductor
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="configure-the-bare-metal-service">
<h2>Configure the Bare Metal service<a class="headerlink" href="#configure-the-bare-metal-service" title="Permalink to this headline">¶</a></h2>
<p>The Bare Metal service is configured via its configuration file. This file
is typically located at <tt class="docutils literal"><span class="pre">/etc/ironic/ironic.conf</span></tt>.</p>
<p>Although some configuration options are mentioned here, it is recommended that
you review all the <a class="reference external" href="https://git.openstack.org/cgit/openstack/ironic/tree/etc/ironic/ironic.conf.sample">available options</a>
so that the Bare Metal service is configured for your needs.</p>
<p>It is possible to set up an ironic-api and an ironic-conductor services on the
same host or different hosts. Users also can add new ironic-conductor hosts
to deal with an increasing number of bare metal nodes. But the additional ironic-conductor
services should be at the same version as that of existing ironic-conductor services.</p>
<div class="section" id="configuring-ironic-api-service">
<h3>Configuring ironic-api service<a class="headerlink" href="#configuring-ironic-api-service" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">The Bare Metal service stores information in a database. This guide uses the
MySQL database that is used by other OpenStack services.</p>
<p>Configure the location of the database via the <tt class="docutils literal"><span class="pre">connection</span></tt> option. In the
following, replace IRONIC_DBPASSWORD with the password of your <tt class="docutils literal"><span class="pre">ironic</span></tt>
user, and replace DB_IP with the IP address where the DB server is located:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[database]
...
# The SQLAlchemy connection string used to connect to the
# database (string value)
connection = mysql+pymysql://ironic:IRONIC_DBPASSWORD@DB_IP/ironic?charset=utf8
</pre></div>
</div>
</li>
<li><p class="first">Configure the ironic-api service to use the RabbitMQ message broker by
setting one or more of these options. Replace RABBIT_HOST with the
address of the RabbitMQ server:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="o">...</span>
<span class="c1"># The messaging driver to use, defaults to rabbit. Other</span>
<span class="c1"># drivers include qpid and zmq. (string value)</span>
<span class="c1">#rpc_backend=rabbit</span>

<span class="p">[</span><span class="n">oslo_messaging_rabbit</span><span class="p">]</span>
<span class="o">...</span>
<span class="c1"># The RabbitMQ broker address where a single node is used</span>
<span class="c1"># (string value)</span>
<span class="n">rabbit_host</span><span class="o">=</span><span class="n">RABBIT_HOST</span>

<span class="c1"># The RabbitMQ userid (string value)</span>
<span class="c1">#rabbit_userid=guest</span>

<span class="c1"># The RabbitMQ password (string value)</span>
<span class="c1">#rabbit_password=guest</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the ironic-api service to use these credentials with the Identity
service. Replace IDENTITY_IP with the IP of the Identity server, and
replace IRONIC_PASSWORD with the password you chose for the <tt class="docutils literal"><span class="pre">ironic</span></tt>
user in the Identity service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
...
# Authentication strategy used by ironic-api: one of
# &quot;keystone&quot; or &quot;noauth&quot;. &quot;noauth&quot; should not be used in a
# production environment because all authentication will be
# disabled. (string value)
#auth_strategy=keystone

[keystone_authtoken]
...
# Complete public Identity API endpoint (string value)
auth_uri=http://IDENTITY_IP:5000/

# Complete admin Identity API endpoint. This should specify
# the unversioned root endpoint e.g. https://localhost:35357/
# (string value)
identity_uri=http://IDENTITY_IP:35357/

# Service username. (string value)
admin_user=ironic

# Service account password. (string value)
admin_password=IRONIC_PASSWORD

# Service tenant name. (string value)
admin_tenant_name=service
</pre></div>
</div>
</li>
<li><p class="first">Create the Bare Metal service database tables:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic-dbsync --config-file /etc/ironic/ironic.conf create_schema
</pre></div>
</div>
</li>
<li><p class="first">Restart the ironic-api service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fedora/RHEL7/CentOS7:
  sudo systemctl restart openstack-ironic-api

Ubuntu:
  sudo service ironic-api restart
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="configuring-ironic-conductor-service">
<h3>Configuring ironic-conductor service<a class="headerlink" href="#configuring-ironic-conductor-service" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Replace HOST_IP with IP of the conductor host, and replace DRIVERS with a
comma-separated list of drivers you chose for the conductor service as
follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="o">...</span>
<span class="c1"># IP address of this host. If unset, will determine the IP</span>
<span class="c1"># programmatically. If unable to do so, will use &quot;127.0.0.1&quot;.</span>
<span class="c1"># (string value)</span>
<span class="n">my_ip</span> <span class="o">=</span> <span class="n">HOST_IP</span>

<span class="c1"># Specify the list of drivers to load during service</span>
<span class="c1"># initialization. Missing drivers, or drivers which fail to</span>
<span class="c1"># initialize, will prevent the conductor service from</span>
<span class="c1"># starting. The option default is a recommended set of</span>
<span class="c1"># production-oriented drivers. A complete list of drivers</span>
<span class="c1"># present on your system may be found by enumerating the</span>
<span class="c1"># &quot;ironic.drivers&quot; entrypoint. An example may be found in the</span>
<span class="c1"># developer documentation online. (list value)</span>
<span class="n">enabled_drivers</span><span class="o">=</span><span class="n">DRIVERS</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a conductor host has multiple IPs, <tt class="docutils literal"><span class="pre">my_ip</span></tt> should
be set to the IP which is on the same network as the bare metal nodes.</p>
</div>
</li>
<li><p class="first">Configure the ironic-api service URL. Replace IRONIC_API_IP with IP of
ironic-api service as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[conductor]
...
# URL of Ironic API service. If not set ironic can get the
# current value from the keystone service catalog. (string
# value)
api_url=http://IRONIC_API_IP:6385
</pre></div>
</div>
</li>
<li><p class="first">Configure the location of the database. Ironic-conductor should use the same
configuration as ironic-api. Replace IRONIC_DBPASSWORD with the password of
your <tt class="docutils literal"><span class="pre">ironic</span></tt> user, and replace DB_IP with the IP address where the DB server
is located:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[database]
...
# The SQLAlchemy connection string to use to connect to the
# database. (string value)
connection = mysql+pymysql://ironic:IRONIC_DBPASSWORD@DB_IP/ironic?charset=utf8
</pre></div>
</div>
</li>
<li><p class="first">Configure the ironic-conductor service to use the RabbitMQ message broker by
setting one or more of these options. Ironic-conductor should use the same
configuration as ironic-api. Replace RABBIT_HOST with the address of the RabbitMQ
server:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="o">...</span>
<span class="c1"># The messaging driver to use, defaults to rabbit. Other</span>
<span class="c1"># drivers include qpid and zmq. (string value)</span>
<span class="c1">#rpc_backend=rabbit</span>

<span class="p">[</span><span class="n">oslo_messaging_rabbit</span><span class="p">]</span>
<span class="o">...</span>
<span class="c1"># The RabbitMQ broker address where a single node is used.</span>
<span class="c1"># (string value)</span>
<span class="n">rabbit_host</span><span class="o">=</span><span class="n">RABBIT_HOST</span>

<span class="c1"># The RabbitMQ userid. (string value)</span>
<span class="c1">#rabbit_userid=guest</span>

<span class="c1"># The RabbitMQ password. (string value)</span>
<span class="c1">#rabbit_password=guest</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the ironic-conductor service so that it can communicate with the
Image service. Replace GLANCE_IP with the hostname or IP address of
the Image service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">glance</span><span class="p">]</span>
<span class="o">...</span>
<span class="c1"># Default glance hostname or IP address. (string value)</span>
<span class="n">glance_host</span><span class="o">=</span><span class="n">GLANCE_IP</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Swift backend for the Image service should be installed and configured
for <tt class="docutils literal"><span class="pre">agent_*</span></tt> drivers. Starting with Mitaka the Bare Metal service also
supports Ceph Object Gateway (RADOS Gateway) as the Image service&#8217;s backend
(<a class="reference internal" href="radosgw.html#radosgw-support"><em>Ceph Object Gateway support</em></a>).</p>
</div>
</li>
<li><p class="first">Set the URL (replace NEUTRON_IP) for connecting to the Networking service,
to be the Networking service endpoint:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[neutron]
...
# URL for connecting to neutron. (string value)
url=http://NEUTRON_IP:9696
</pre></div>
</div>
<p>To configure the network for ironic-conductor service to perform node cleaning, see
<a class="reference internal" href="#cleaningnetworksetup">CleaningNetworkSetup</a>.</p>
</li>
<li><p class="first">Configure the ironic-conductor service to use these credentials with the Identity
service. Ironic-conductor should use the same configuration as ironic-api.
Replace IDENTITY_IP with the IP of the Identity server, and replace IRONIC_PASSWORD
with the password you chose for the <tt class="docutils literal"><span class="pre">ironic</span></tt> user in the Identity service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[keystone_authtoken]
...
# Complete public Identity API endpoint (string value)
auth_uri=http://IDENTITY_IP:5000/

# Complete admin Identity API endpoint. This should specify
# the unversioned root endpoint e.g. https://localhost:35357/
# (string value)
identity_uri=http://IDENTITY_IP:35357/

# Service username. (string value)
admin_user=ironic

# Service account password. (string value)
admin_password=IRONIC_PASSWORD

# Service tenant name. (string value)
admin_tenant_name=service
</pre></div>
</div>
</li>
<li><p class="first">Make sure that <tt class="docutils literal"><span class="pre">qemu-img</span></tt> and <tt class="docutils literal"><span class="pre">iscsiadm</span></tt> (in the case of using iscsi-deploy driver)
binaries are installed and prepare the host system as described at
<a class="reference internal" href="#setup-the-drivers-for-the-bare-metal-service">Setup the drivers for the Bare Metal service</a></p>
</li>
<li><p class="first">Restart the ironic-conductor service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fedora/RHEL7/CentOS7:
  sudo systemctl restart openstack-ironic-conductor

Ubuntu:
  sudo service ironic-conductor restart
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="configuring-ironic-api-behind-mod-wsgi">
<h3>Configuring ironic-api behind mod_wsgi<a class="headerlink" href="#configuring-ironic-api-behind-mod-wsgi" title="Permalink to this headline">¶</a></h3>
<p>Bare Metal service comes with an example file for configuring the
<tt class="docutils literal"><span class="pre">ironic-api</span></tt> service to run behind Apache with mod_wsgi.</p>
<ol class="arabic">
<li><p class="first">Install the apache service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fedora 21/RHEL7/CentOS7:
  sudo yum install httpd

Fedora 22 (or higher):
  sudo dnf install httpd

Debian/Ubuntu:
  apt-get install apache2
</pre></div>
</div>
</li>
<li><p class="first">Copy the <tt class="docutils literal"><span class="pre">etc/apache2/ironic</span></tt> file under the apache sites:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fedora/RHEL7/CentOS7:
  sudo cp etc/apache2/ironic /etc/httpd/conf.d/ironic.conf

Debian/Ubuntu:
  sudo cp etc/apache2/ironic /etc/apache2/sites-available/ironic.conf
</pre></div>
</div>
</li>
<li><p class="first">Edit the recently copied <tt class="docutils literal"><span class="pre">&lt;apache-configuration-dir&gt;/ironic.conf</span></tt>:</p>
</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>Modify the <tt class="docutils literal"><span class="pre">WSGIDaemonProcess</span></tt>, <tt class="docutils literal"><span class="pre">APACHE_RUN_USER</span></tt> and
<tt class="docutils literal"><span class="pre">APACHE_RUN_GROUP</span></tt> directives to set the user and group values to
an appropriate user on your server.</li>
<li>Modify the <tt class="docutils literal"><span class="pre">WSGIScriptAlias</span></tt> directive to point to the
<em>ironic/api/app.wsgi</em> script.</li>
<li>Modify the <tt class="docutils literal"><span class="pre">Directory</span></tt> directive to set the path to the Ironic API code.</li>
</ul>
</div></blockquote>
<ol class="arabic" start="4">
<li><p class="first">Enable the apache <tt class="docutils literal"><span class="pre">ironic</span></tt> in site and reload:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fedora/RHEL7/CentOS7:
  sudo systemctl reload httpd

Debian/Ubuntu:
  sudo a2ensite ironic
  sudo service apache2 reload
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The file ironic/api/app.wsgi is installed with the rest of the Bare Metal
service application code, and should not need to be modified.</p>
</div>
</div>
</div>
<div class="section" id="configure-compute-to-use-the-bare-metal-service">
<h2>Configure Compute to use the Bare Metal service<a class="headerlink" href="#configure-compute-to-use-the-bare-metal-service" title="Permalink to this headline">¶</a></h2>
<p>The Compute service needs to be configured to use the Bare Metal service&#8217;s
driver.  The configuration file for the Compute service is typically located at
<tt class="docutils literal"><span class="pre">/etc/nova/nova.conf</span></tt>. <em>This configuration file must be modified on the
Compute service&#8217;s controller nodes and compute nodes.</em></p>
<ol class="arabic">
<li><p class="first">Change these configuration options in the <tt class="docutils literal"><span class="pre">default</span></tt> section, as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">default</span><span class="p">]</span>

<span class="c1"># Driver to use for controlling virtualization. Options</span>
<span class="c1"># include: libvirt.LibvirtDriver, xenapi.XenAPIDriver,</span>
<span class="c1"># fake.FakeDriver, baremetal.BareMetalDriver,</span>
<span class="c1"># vmwareapi.VMwareESXDriver, vmwareapi.VMwareVCDriver (string</span>
<span class="c1"># value)</span>
<span class="c1">#compute_driver=&lt;None&gt;</span>
<span class="n">compute_driver</span><span class="o">=</span><span class="n">ironic</span><span class="o">.</span><span class="n">IronicDriver</span>

<span class="c1"># Firewall driver (defaults to hypervisor specific iptables</span>
<span class="c1"># driver) (string value)</span>
<span class="c1">#firewall_driver=&lt;None&gt;</span>
<span class="n">firewall_driver</span><span class="o">=</span><span class="n">nova</span><span class="o">.</span><span class="n">virt</span><span class="o">.</span><span class="n">firewall</span><span class="o">.</span><span class="n">NoopFirewallDriver</span>

<span class="c1"># The scheduler host manager class to use (string value)</span>
<span class="c1">#scheduler_host_manager=nova.scheduler.host_manager.HostManager</span>
<span class="n">scheduler_host_manager</span><span class="o">=</span><span class="n">nova</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">ironic_host_manager</span><span class="o">.</span><span class="n">IronicHostManager</span>

<span class="c1"># Virtual ram to physical ram allocation ratio which affects</span>
<span class="c1"># all ram filters. This configuration specifies a global ratio</span>
<span class="c1"># for RamFilter. For AggregateRamFilter, it will fall back to</span>
<span class="c1"># this configuration value if no per-aggregate setting found.</span>
<span class="c1"># (floating point value)</span>
<span class="c1">#ram_allocation_ratio=1.5</span>
<span class="n">ram_allocation_ratio</span><span class="o">=</span><span class="mf">1.0</span>

<span class="c1"># Amount of disk in MB to reserve for the host (integer value)</span>
<span class="c1">#reserved_host_disk_mb=0</span>
<span class="n">reserved_host_memory_mb</span><span class="o">=</span><span class="mi">0</span>

<span class="c1"># Full class name for the Manager for compute (string value)</span>
<span class="c1">#compute_manager=nova.compute.manager.ComputeManager</span>
<span class="n">compute_manager</span><span class="o">=</span><span class="n">ironic</span><span class="o">.</span><span class="n">nova</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">ClusteredComputeManager</span>

<span class="c1"># Flag to decide whether to use baremetal_scheduler_default_filters or not.</span>
<span class="c1"># (boolean value)</span>
<span class="c1">#scheduler_use_baremetal_filters=False</span>
<span class="n">scheduler_use_baremetal_filters</span><span class="o">=</span><span class="bp">True</span>

<span class="c1"># Determines if the Scheduler tracks changes to instances to help with</span>
<span class="c1"># its filtering decisions (boolean value)</span>
<span class="c1">#scheduler_tracks_instance_changes=True</span>
<span class="n">scheduler_tracks_instance_changes</span><span class="o">=</span><span class="bp">False</span>
</pre></div>
</div>
</li>
<li><p class="first">Change these configuration options in the <tt class="docutils literal"><span class="pre">ironic</span></tt> section.
Replace:</p>
<ul class="simple">
<li>IRONIC_PASSWORD with the password you chose for the <tt class="docutils literal"><span class="pre">ironic</span></tt>
user in the Identity Service</li>
<li>IRONIC_NODE with the hostname or IP address of the ironic-api node</li>
<li>IDENTITY_IP with the IP of the Identity server</li>
</ul>
</li>
</ol>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span>[ironic]

# Ironic keystone admin name
admin_username=ironic

#Ironic keystone admin password.
admin_password=IRONIC_PASSWORD

# keystone API endpoint
admin_url=http://IDENTITY_IP:35357/v2.0

# Ironic keystone tenant name.
admin_tenant_name=service

# URL for Ironic API endpoint.
api_endpoint=http://IRONIC_NODE:6385/v1
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="3">
<li><p class="first">On the Compute service&#8217;s controller nodes, restart the <tt class="docutils literal"><span class="pre">nova-scheduler</span></tt> process:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fedora/RHEL7/CentOS7:
  sudo systemctl restart openstack-nova-scheduler

Ubuntu:
  sudo service nova-scheduler restart
</pre></div>
</div>
</li>
<li><p class="first">On the Compute service&#8217;s compute nodes, restart the <tt class="docutils literal"><span class="pre">nova-compute</span></tt> process:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fedora/RHEL7/CentOS7:
  sudo systemctl restart openstack-nova-compute

Ubuntu:
  sudo service nova-compute restart
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="configure-networking-to-communicate-with-the-bare-metal-server">
<span id="neutronflatnetworking"></span><h2>Configure Networking to communicate with the bare metal server<a class="headerlink" href="#configure-networking-to-communicate-with-the-bare-metal-server" title="Permalink to this headline">¶</a></h2>
<p>You need to configure Networking so that the bare metal server can communicate
with the Networking service for DHCP, PXE boot and other requirements.
This section covers configuring Networking for a single flat
network for bare metal provisioning.</p>
<p>You will also need to provide Bare Metal service with the MAC address(es) of
each node that it is provisioning; Bare Metal service in turn will pass this
information to Networking service for DHCP and PXE boot configuration.
An example of this is shown in the <a class="reference internal" href="#enrollment">Enrollment</a> section.</p>
<ol class="arabic">
<li><p class="first">Edit <tt class="docutils literal"><span class="pre">/etc/neutron/plugins/ml2/ml2_conf.ini</span></tt> and modify these:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[ml2]
type_drivers = flat
tenant_network_types = flat
mechanism_drivers = openvswitch

[ml2_type_flat]
flat_networks = physnet1

[ml2_type_vlan]
network_vlan_ranges = physnet1

[securitygroup]
firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver
enable_security_group = True

[ovs]
bridge_mappings = physnet1:br-eth2
# Replace eth2 with the interface on the neutron node which you
# are using to connect to the bare metal server
</pre></div>
</div>
</li>
<li><p class="first">If neutron-openvswitch-agent runs with <tt class="docutils literal"><span class="pre">ovs_neutron_plugin.ini</span></tt> as the input
config-file, edit <tt class="docutils literal"><span class="pre">ovs_neutron_plugin.ini</span></tt> to configure the bridge mappings
by adding the [ovs] section described in the previous step, and restart the
neutron-openvswitch-agent.</p>
</li>
<li><p class="first">Add the integration bridge to Open vSwitch:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ovs-vsctl add-br br-int
</pre></div>
</div>
</li>
<li><p class="first">Create the br-eth2 network bridge to handle communication between the
OpenStack services (and the Bare Metal services) and the bare metal nodes
using eth2.
Replace eth2 with the interface on the network node which you are
using to connect to the Bare Metal service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ovs-vsctl add-br br-eth2
ovs-vsctl add-port br-eth2 eth2
</pre></div>
</div>
</li>
<li><p class="first">Restart the Open vSwitch agent:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>service neutron-plugin-openvswitch-agent restart
</pre></div>
</div>
</li>
<li><p class="first">On restarting the Networking service Open vSwitch agent, the veth pair
between the bridges br-int and br-eth2 is automatically created.</p>
<p>Your Open vSwitch bridges should look something like this after
following the above steps:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ovs-vsctl show

    Bridge br-int
        fail_mode: secure
        Port &quot;int-br-eth2&quot;
            Interface &quot;int-br-eth2&quot;
                type: patch
                options: {peer=&quot;phy-br-eth2&quot;}
        Port br-int
            Interface br-int
                type: internal
    Bridge &quot;br-eth2&quot;
        Port &quot;phy-br-eth2&quot;
            Interface &quot;phy-br-eth2&quot;
                type: patch
                options: {peer=&quot;int-br-eth2&quot;}
        Port &quot;eth2&quot;
            Interface &quot;eth2&quot;
        Port &quot;br-eth2&quot;
            Interface &quot;br-eth2&quot;
                type: internal
    ovs_version: &quot;2.3.0&quot;
</pre></div>
</div>
</li>
<li><p class="first">Create the flat network on which you are going to launch the
instances:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>neutron net-create --tenant-id $TENANT_ID sharednet1 --shared \
--provider:network_type flat --provider:physical_network physnet1
</pre></div>
</div>
</li>
<li><p class="first">Create the subnet on the newly created network:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>neutron subnet-create sharednet1 $NETWORK_CIDR --name $SUBNET_NAME \
--ip-version=4 --gateway=$GATEWAY_IP --allocation-pool \
start=$START_IP,end=$END_IP --enable-dhcp
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="configure-the-bare-metal-service-for-cleaning">
<span id="cleaningnetworksetup"></span><h2>Configure the Bare Metal service for cleaning<a class="headerlink" href="#configure-the-bare-metal-service-for-cleaning" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">If you configure Bare Metal service to use <a class="reference internal" href="cleaning.html#cleaning"><em>Node cleaning</em></a> (which is enabled by
default), you will need to set the <tt class="docutils literal"><span class="pre">cleaning_network_uuid</span></tt> configuration
option. Note the network UUID (the <cite>id</cite> field) of the network you created in
<a class="reference internal" href="#neutronflatnetworking"><em>Configure Networking to communicate with the bare metal server</em></a> or another network you created for cleaning:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>neutron net-list
</pre></div>
</div>
</li>
<li><p class="first">Configure the cleaning network UUID via the <tt class="docutils literal"><span class="pre">cleaning_network_uuid</span></tt>
option in the Bare Metal service configuration file (/etc/ironic/ironic.conf).
In the following, replace NETWORK_UUID with the UUID you noted in the
previous step:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">neutron</span><span class="p">]</span>
<span class="o">...</span>

<span class="c1"># UUID of the network to create Neutron ports on, when booting</span>
<span class="c1"># to a ramdisk for cleaning using Neutron DHCP. (string value)</span>
<span class="c1">#cleaning_network_uuid=&lt;None&gt;</span>
<span class="n">cleaning_network_uuid</span> <span class="o">=</span> <span class="n">NETWORK_UUID</span>
</pre></div>
</div>
</li>
<li><p class="first">Restart the Bare Metal service&#8217;s ironic-conductor:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fedora/RHEL7/CentOS7:
  sudo systemctl restart openstack-ironic-conductor

Ubuntu:
  sudo service ironic-conductor restart
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="image-requirements">
<span id="imagerequirement"></span><h2>Image requirements<a class="headerlink" href="#image-requirements" title="Permalink to this headline">¶</a></h2>
<p>Bare Metal provisioning requires two sets of images: the deploy images
and the user images. The deploy images are used by the Bare Metal service
to prepare the bare metal server for actual OS deployment. Whereas the
user images are installed on the bare metal server to be used by the
end user. Below are the steps to create the required images and add
them to the Image service:</p>
<ol class="arabic simple">
<li>The <a class="reference external" href="https://github.com/openstack/diskimage-builder">disk-image-builder</a> can be used to create images required for
deployment and the actual OS which the user is going to run.</li>
</ol>
<blockquote>
<div><em>Note:</em> <a class="reference external" href="https://github.com/openstack/tripleo-incubator">tripleo-incubator</a> provides a <a class="reference external" href="https://github.com/openstack/tripleo-incubator/blob/master/scripts/install-dependencies">script</a> to install all the
dependencies for the disk-image-builder.</div></blockquote>
<blockquote>
<div><ul>
<li><p class="first">Install diskimage-builder package (use virtualenv, if you don&#8217;t
want to install anything globally):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo pip install diskimage-builder
</pre></div>
</div>
</li>
<li><p class="first">Build the image your users will run (Ubuntu image has been taken as
an example):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Partition images:
    disk-image-create ubuntu baremetal dhcp-all-interfaces grub2 -o my-image

Whole disk images:
    disk-image-create ubuntu vm dhcp-all-interfaces -o my-image
</pre></div>
</div>
<p>The partition image command creates <em>my-image.qcow2</em>, <em>my-image.vmlinuz</em> and
<em>my-image.initrd</em> files. The <em>grub2</em> element in the partition image creation
command is only needed if local boot will be used to deploy <em>my-image.qcow2</em>,
otherwise the images <em>my-image.vmlinuz</em> and <em>my-image.initrd</em> will be used for
PXE booting after deploying the bare metal with <em>my-image.qcow2</em>.</p>
<p>If you want to use Fedora image, replace <em>ubuntu</em> with <em>fedora</em> in the chosen
command.</p>
</li>
<li><p class="first">To build the deploy image take a look at the <a class="reference internal" href="#building-or-downloading-a-deploy-ramdisk-image">Building or
downloading a deploy ramdisk image</a> section.</p>
</li>
</ul>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">Add the user images to the Image service</p>
<p>Load all the images created in the below steps into the Image service,
and note the image UUIDs in the Image service for each one as it is
generated.</p>
<ul>
<li><p class="first">Add the kernel and ramdisk images to the Image service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>glance image-create --name my-kernel --visibility public \
--disk-format aki --container-format aki  &lt; my-image.vmlinuz
</pre></div>
</div>
<p>Store the image uuid obtained from the above step as
<em>$MY_VMLINUZ_UUID</em>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>glance image-create --name my-image.initrd --visibility public \
--disk-format ari --container-format ari  &lt; my-image.initrd
</pre></div>
</div>
<p>Store the image UUID obtained from the above step as
<em>$MY_INITRD_UUID</em>.</p>
</li>
<li><p class="first">Add the <em>my-image</em> to the Image service which is going to be the OS
that the user is going to run. Also associate the above created
images with this OS image. These two operations can be done by
executing the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>glance image-create --name my-image --visibility public \
--disk-format qcow2 --container-format bare --property \
kernel_id=$MY_VMLINUZ_UUID --property \
ramdisk_id=$MY_INITRD_UUID &lt; my-image.qcow2
</pre></div>
</div>
</li>
<li><p class="first"><em>Note:</em> To deploy a whole disk image, a kernel_id and a ramdisk_id
shouldn&#8217;t be associated with the image. An example is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>glance image-create --name my-whole-disk-image --visibility public \
--disk-format qcow2 \
--container-format bare &lt; my-whole-disk-image.qcow2
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Add the deploy images to the Image service</p>
<p>Add the <em>my-deploy-ramdisk.kernel</em> and
<em>my-deploy-ramdisk.initramfs</em> images to the Image service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>glance image-create --name deploy-vmlinuz --visibility public \
--disk-format aki --container-format aki &lt; my-deploy-ramdisk.kernel
</pre></div>
</div>
<p>Store the image UUID obtained from the above step as
<em>$DEPLOY_VMLINUZ_UUID</em>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>glance image-create --name deploy-initrd --visibility public \
--disk-format ari --container-format ari &lt; my-deploy-ramdisk.initramfs
</pre></div>
</div>
<p>Store the image UUID obtained from the above step as
<em>$DEPLOY_INITRD_UUID</em>.</p>
</li>
</ol>
</div>
<div class="section" id="flavor-creation">
<h2>Flavor creation<a class="headerlink" href="#flavor-creation" title="Permalink to this headline">¶</a></h2>
<p>You&#8217;ll need to create a special bare metal flavor in the Compute service.
The flavor is mapped to the bare metal node through the hardware specifications.</p>
<ol class="arabic">
<li><p class="first">Change these to match your hardware:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">RAM_MB</span><span class="o">=</span><span class="mi">1024</span>
<span class="n">CPU</span><span class="o">=</span><span class="mi">2</span>
<span class="n">DISK_GB</span><span class="o">=</span><span class="mi">100</span>
<span class="n">ARCH</span><span class="o">=</span><span class="p">{</span><span class="n">i686</span><span class="o">|</span><span class="n">x86_64</span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Create the bare metal flavor by executing the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>nova flavor-create my-baremetal-flavor auto $RAM_MB $DISK_GB $CPU
</pre></div>
</div>
<p><em>Note: You can replace auto with your own flavor id.</em></p>
</li>
<li><p class="first">Set the architecture as extra_specs information of the flavor. This
will be used to match against the properties of bare metal nodes:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>nova flavor-key my-baremetal-flavor set cpu_arch=$ARCH
</pre></div>
</div>
</li>
<li><p class="first">Associate the deploy ramdisk and kernel images with the ironic node:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update $NODE_UUID add \
driver_info/deploy_kernel=$DEPLOY_VMLINUZ_UUID \
driver_info/deploy_ramdisk=$DEPLOY_INITRD_UUID
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="setup-the-drivers-for-the-bare-metal-service">
<h2>Setup the drivers for the Bare Metal service<a class="headerlink" href="#setup-the-drivers-for-the-bare-metal-service" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pxe-setup">
<h3>PXE setup<a class="headerlink" href="#pxe-setup" title="Permalink to this headline">¶</a></h3>
<p>If you will be using PXE, it needs to be set up on the Bare Metal service
node(s) where <tt class="docutils literal"><span class="pre">ironic-conductor</span></tt> is running.</p>
<ol class="arabic">
<li><p class="first">Make sure the tftp root directory exist and can be written to by the
user the <tt class="docutils literal"><span class="pre">ironic-conductor</span></tt> is running as. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo mkdir -p /tftpboot
sudo chown -R ironic /tftpboot
</pre></div>
</div>
</li>
<li><p class="first">Install tftp server and the syslinux package with the PXE boot images:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu: (Up to and including 14.04)
    sudo apt-get install tftpd-hpa syslinux-common syslinux

Ubuntu: (14.10 and after)
    sudo apt-get install tftpd-hpa syslinux-common pxelinux

Fedora 21/RHEL7/CentOS7:
    sudo yum install tftp-server syslinux-tftpboot

Fedora 22 or higher:
     sudo dnf install tftp-server syslinux-tftpboot
</pre></div>
</div>
</li>
<li><p class="first">Setup tftp server to serve <tt class="docutils literal"><span class="pre">/tftpboot</span></tt>.</p>
</li>
<li><p class="first">Copy the PXE image to <tt class="docutils literal"><span class="pre">/tftpboot</span></tt>. The PXE image might be found at <a class="footnote-reference" href="#id4" id="id1">[1]</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu (Up to and including 14.04):
    sudo cp /usr/lib/syslinux/pxelinux.0 /tftpboot

Ubuntu (14.10 and after):
    sudo cp /usr/lib/PXELINUX/pxelinux.0 /tftpboot
</pre></div>
</div>
</li>
<li><p class="first">If whole disk images need to be deployed via PXE-netboot, copy the
chain.c32 image to <tt class="docutils literal"><span class="pre">/tftpboot</span></tt> to support it. The chain.c32 image
might be found at:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu (Up to and including 14.04):
    sudo cp /usr/lib/syslinux/chain.c32 /tftpboot

Ubuntu (14.10 and after):
    sudo cp /usr/lib/syslinux/modules/bios/chain.c32 /tftpboot

Fedora/RHEL7/CentOS7:
    sudo cp /boot/extlinux/chain.c32 /tftpboot
</pre></div>
</div>
</li>
<li><p class="first">If the version of syslinux is <strong>greater than</strong> 4 we also need to make sure
that we copy the library modules into the <tt class="docutils literal"><span class="pre">/tftpboot</span></tt> directory <a class="footnote-reference" href="#id5" id="id2">[2]</a>
<a class="footnote-reference" href="#id4" id="id3">[1]</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu:
    sudo cp /usr/lib/syslinux/modules/*/ldlinux.* /tftpboot
</pre></div>
</div>
</li>
<li><p class="first">Create a map file in the tftp boot directory (<tt class="docutils literal"><span class="pre">/tftpboot</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>echo &#39;re ^(/tftpboot/) /tftpboot/\2&#39; &gt; /tftpboot/map-file
echo &#39;re ^/tftpboot/ /tftpboot/&#39; &gt;&gt; /tftpboot/map-file
echo &#39;re ^(^/) /tftpboot/\1&#39; &gt;&gt; /tftpboot/map-file
echo &#39;re ^([^/]) /tftpboot/\1&#39; &gt;&gt; /tftpboot/map-file
</pre></div>
</div>
</li>
<li><p class="first">Enable tftp map file, modify <tt class="docutils literal"><span class="pre">/etc/xinetd.d/tftp</span></tt> as below and restart xinetd
service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">server_args</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="nb">map</span><span class="o">-</span><span class="nb">file</span> <span class="o">/</span><span class="n">tftpboot</span><span class="o">/</span><span class="nb">map</span><span class="o">-</span><span class="nb">file</span> <span class="o">/</span><span class="n">tftpboot</span>
</pre></div>
</div>
</li>
</ol>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id3">2</a>)</em> On <strong>Fedora/RHEL</strong> the <tt class="docutils literal"><span class="pre">syslinux-tftpboot</span></tt> package already install
the library modules and PXE image at <tt class="docutils literal"><span class="pre">/tftpboot</span></tt>. If the TFTP server
is configured to listen to a different directory you should copy the
contents of <tt class="docutils literal"><span class="pre">/tftpboot</span></tt> to the configured directory</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://www.syslinux.org/wiki/index.php/Library_modules">http://www.syslinux.org/wiki/index.php/Library_modules</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="pxe-uefi-setup">
<h3>PXE UEFI setup<a class="headerlink" href="#pxe-uefi-setup" title="Permalink to this headline">¶</a></h3>
<p>If you want to deploy on a UEFI supported bare metal, perform these additional
steps on the ironic conductor node to configure the PXE UEFI environment.</p>
<ol class="arabic">
<li><p class="first">Download and untar the elilo bootloader version &gt;= 3.16 from
<a class="reference external" href="http://sourceforge.net/projects/elilo/">http://sourceforge.net/projects/elilo/</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo tar zxvf elilo-3.16-all.tar.gz
</pre></div>
</div>
</li>
<li><p class="first">Copy the elilo boot loader image to <tt class="docutils literal"><span class="pre">/tftpboot</span></tt> directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo cp ./elilo-3.16-x86_64.efi /tftpboot/elilo.efi
</pre></div>
</div>
</li>
<li><p class="first">Grub2 is an alternate UEFI bootloader supported in Bare Metal service.
Install grub2 and shim packages:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu: (14.04LTS and later)
    sudo apt-get install grub-efi-amd64-signed shim-signed

Fedora 21/RHEL7/CentOS7:
    sudo yum install grub2-efi shim

Fedora 22 or higher:
    sudo dnf install grub2-efi shim
</pre></div>
</div>
</li>
<li><p class="first">Copy grub and shim boot loader images to <tt class="docutils literal"><span class="pre">/tftpboot</span></tt> directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu: (14.04LTS and later)
    sudo cp /usr/lib/shim/shim.efi.signed /tftpboot/bootx64.efi
    sudo cp /usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed  \
    /tftpboot/grubx64.efi

Fedora: (21 and later)
    sudo cp /boot/efi/EFI/fedora/shim.efi /tftpboot/bootx64.efi
    sudo cp /boot/efi/EFI/fedora/grubx64.efi /tftpboot/grubx64.efi

CentOS: (7 and later)
    sudo cp /boot/efi/EFI/centos/shim.efi /tftpboot/bootx64.efi
    sudo cp /boot/efi/EFI/centos/grubx64.efi /tftpboot/grubx64.efi
</pre></div>
</div>
</li>
<li><p class="first">Create master grub.cfg:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu: Create grub.cfg under ``/tftpboot/grub`` directory.
    GRUB_DIR=/tftpboot/grub

Fedora: Create grub.cfg under ``/tftpboot/EFI/fedora`` directory.
     GRUB_DIR=/tftpboot/EFI/fedora

CentOS: Create grub.cfg under ``/tftpboot/EFI/centos`` directory.
    GRUB_DIR=/tftpboot/EFI/centos

Create directory GRUB_DIR
  sudo mkdir -p $GRUB_DIR
</pre></div>
</div>
<p>This file is used to redirect grub to baremetal node specific config file.
It redirects it to specific grub config file based on DHCP IP assigned to
baremetal node.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>set default=master
set timeout=5
set hidden_timeout_quiet=false

menuentry &quot;master&quot;  {
configfile /tftpboot/$net_default_ip.conf
}
</pre></div>
</div>
<p>Change the permission of grub.cfg:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo chmod 644 $GRUB_DIR/grub.cfg
</pre></div>
</div>
</li>
<li><p class="first">Update bootfile and template file configuration parameters for UEFI PXE boot
in the Bare Metal Service&#8217;s configuration file (/etc/ironic/ironic.conf):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[pxe]

# Bootfile DHCP parameter for UEFI boot mode. (string value)
uefi_pxe_bootfile_name=bootx64.efi

# Template file for PXE configuration for UEFI boot loader.
# (string value)
uefi_pxe_config_template=$pybasedir/drivers/modules/pxe_grub_config.template
</pre></div>
</div>
</li>
<li><p class="first">Update the bare metal node with <tt class="docutils literal"><span class="pre">boot_mode</span></tt> capability in node&#8217;s properties
field:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update &lt;node-uuid&gt; add properties/capabilities=&#39;boot_mode:uefi&#39;
</pre></div>
</div>
</li>
<li><p class="first">Make sure that bare metal node is configured to boot in UEFI boot mode and
boot device is set to network/pxe.</p>
<p>NOTE: <tt class="docutils literal"><span class="pre">pxe_ilo</span></tt> driver supports automatic setting of UEFI boot mode and
boot device on the bare metal node. So this step is not required for
<tt class="docutils literal"><span class="pre">pxe_ilo</span></tt> driver.</p>
</li>
</ol>
<p>For more information on configuring boot modes, refer <a class="reference internal" href="#boot-mode-support">boot_mode_support</a>.</p>
</div>
<div class="section" id="ipxe-setup">
<h3>iPXE setup<a class="headerlink" href="#ipxe-setup" title="Permalink to this headline">¶</a></h3>
<p>An alternative to PXE boot, iPXE was introduced in the Juno release
(2014.2.0) of Bare Metal service.</p>
<p>If you will be using iPXE to boot instead of PXE, iPXE needs to be set up
on the Bare Metal service node(s) where <tt class="docutils literal"><span class="pre">ironic-conductor</span></tt> is running.</p>
<ol class="arabic">
<li><p class="first">Make sure these directories exist and can be written to by the user
the <tt class="docutils literal"><span class="pre">ironic-conductor</span></tt> is running as. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo mkdir -p /tftpboot
sudo mkdir -p /httpboot
sudo chown -R ironic /tftpboot
sudo chown -R ironic /httpboot
</pre></div>
</div>
</li>
<li><p class="first">Create a map file in the tftp boot directory (<tt class="docutils literal"><span class="pre">/tftpboot</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>echo &#39;r ^([^/]) /tftpboot/\1&#39; &gt; /tftpboot/map-file
echo &#39;r ^(/tftpboot/) /tftpboot/\2&#39; &gt;&gt; /tftpboot/map-file
</pre></div>
</div>
</li>
<li><p class="first">Set up TFTP and HTTP servers.</p>
<p>These servers should be running and configured to use the local
/tftpboot and /httpboot directories respectively, as their root
directories. (Setting up these servers is outside the scope of this
install guide.)</p>
<p>These root directories need to be mounted locally to the
<tt class="docutils literal"><span class="pre">ironic-conductor</span></tt> services, so that the services can access them.</p>
<p>The Bare Metal service&#8217;s configuration file (/etc/ironic/ironic.conf)
should be edited accordingly to specify the TFTP and HTTP root
directories and server addresses. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[pxe]

# Ironic compute node&#39;s tftp root path. (string value)
tftp_root=/tftpboot

# IP address of Ironic compute node&#39;s tftp server. (string
# value)
tftp_server=192.168.0.2

[deploy]
# Ironic compute node&#39;s http root path. (string value)
http_root=/httpboot

# Ironic compute node&#39;s HTTP server URL. Example:
# http://192.1.2.3:8080 (string value)
http_url=http://192.168.0.2:8080
</pre></div>
</div>
</li>
<li><p class="first">Install the iPXE package with the boot images:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu:
    apt-get install ipxe

Fedora 21/RHEL7/CentOS7:
    yum install ipxe-bootimgs

Fedora 22 or higher:
    dnf install ipxe-bootimgs
</pre></div>
</div>
</li>
<li><p class="first">Copy the iPXE boot image (<tt class="docutils literal"><span class="pre">undionly.kpxe</span></tt> for <strong>BIOS</strong> and
<tt class="docutils literal"><span class="pre">ipxe.efi</span></tt> for <strong>UEFI</strong>) to <tt class="docutils literal"><span class="pre">/tftpboot</span></tt>. The binary might
be found at:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu:
    cp /usr/lib/ipxe/{undionly.kpxe,ipxe.efi} /tftpboot

Fedora/RHEL7/CentOS7:
    cp /usr/share/ipxe/{undionly.kpxe,ipxe.efi} /tftpboot
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the packaged version of the iPXE boot image doesn&#8217;t work, you can
download a prebuilt one from <a class="reference external" href="http://boot.ipxe.org">http://boot.ipxe.org</a> or build one image
from source, see <a class="reference external" href="http://ipxe.org/download">http://ipxe.org/download</a> for more information.</p>
</div>
</li>
<li><p class="first">Enable/Configure iPXE in the Bare Metal Service&#8217;s configuration file
(/etc/ironic/ironic.conf):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[pxe]

# Enable iPXE boot. (boolean value)
ipxe_enabled=True

# Neutron bootfile DHCP parameter. (string value)
pxe_bootfile_name=undionly.kpxe

# Bootfile DHCP parameter for UEFI boot mode. (string value)
uefi_pxe_bootfile_name=ipxe.efi

# Template file for PXE configuration. (string value)
pxe_config_template=$pybasedir/drivers/modules/ipxe_config.template

# Template file for PXE configuration for UEFI boot loader.
# (string value)
uefi_pxe_config_template=$pybasedir/drivers/modules/ipxe_config.template
</pre></div>
</div>
</li>
<li><p class="first">Restart the <tt class="docutils literal"><span class="pre">ironic-conductor</span></tt> process:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fedora/RHEL7/CentOS7:
  sudo systemctl restart openstack-ironic-conductor

Ubuntu:
  sudo service ironic-conductor restart
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="networking-service-configuration">
<h3>Networking service configuration<a class="headerlink" href="#networking-service-configuration" title="Permalink to this headline">¶</a></h3>
<p>DHCP requests from iPXE need to have a DHCP tag called <tt class="docutils literal"><span class="pre">ipxe</span></tt>, in order
for the DHCP server to tell the client to get the boot.ipxe script via
HTTP. Otherwise, if the tag isn&#8217;t there, the DHCP server will tell the
DHCP client to chainload the iPXE image (undionly.kpxe).
The Networking service needs to be configured to create this DHCP tag,
since it isn&#8217;t created by default.</p>
<ol class="arabic">
<li><p class="first">Create a custom <tt class="docutils literal"><span class="pre">dnsmasq.conf</span></tt> file with a setting for the ipxe tag. For
example, create the file <tt class="docutils literal"><span class="pre">/etc/dnsmasq-ironic.conf</span></tt> with the content:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># Create the &quot;ipxe&quot; tag if request comes from iPXE user class
dhcp-userclass=set:ipxe,iPXE

# Alternatively, create the &quot;ipxe&quot; tag if request comes from DHCP option 175
# dhcp-match=set:ipxe,175
</pre></div>
</div>
</li>
<li><p class="first">In the Networking service DHCP Agent configuration file (typically located at
/etc/neutron/dhcp_agent.ini), set the custom <tt class="docutils literal"><span class="pre">/etc/dnsmasq-ironic.conf</span></tt>
file as the dnsmasq configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
dnsmasq_config_file = /etc/dnsmasq-ironic.conf
</pre></div>
</div>
</li>
<li><p class="first">Restart the <tt class="docutils literal"><span class="pre">neutron-dhcp-agent</span></tt> process:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>service neutron-dhcp-agent restart
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="ipmi-support">
<h3>IPMI support<a class="headerlink" href="#ipmi-support" title="Permalink to this headline">¶</a></h3>
<p>If using the IPMITool driver, the <tt class="docutils literal"><span class="pre">ipmitool</span></tt> command must be present on the
service node(s) where <tt class="docutils literal"><span class="pre">ironic-conductor</span></tt> is running. On most distros, this
is provided as part of the <tt class="docutils literal"><span class="pre">ipmitool</span></tt> package. Source code is available at
<a class="reference external" href="http://ipmitool.sourceforge.net/">http://ipmitool.sourceforge.net/</a></p>
<p>Note that certain distros, notably Mac OS X and SLES, install <tt class="docutils literal"><span class="pre">openipmi</span></tt>
instead of <tt class="docutils literal"><span class="pre">ipmitool</span></tt> by default. THIS DRIVER IS NOT COMPATIBLE WITH
<tt class="docutils literal"><span class="pre">openipmi</span></tt> AS IT RELIES ON ERROR HANDLING OPTIONS NOT PROVIDED BY THIS TOOL.</p>
<p>Check that you can connect to and authenticate with the IPMI
controller in your bare metal server by using <tt class="docutils literal"><span class="pre">ipmitool</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ipmitool -I lanplus -H &lt;ip-address&gt; -U &lt;username&gt; -P &lt;password&gt; chassis power status
</pre></div>
</div>
<p>&lt;ip-address&gt; = The IP of the IPMI controller you want to access</p>
<p><em>Note:</em></p>
<ol class="arabic simple">
<li>This is not the bare metal node&#8217;s main IP. The IPMI controller
should have its own unique IP.</li>
<li>In case the above command doesn&#8217;t return the power status of the
bare metal server, check for these:<ul>
<li><tt class="docutils literal"><span class="pre">ipmitool</span></tt> is installed.</li>
<li>The IPMI controller on your bare metal server is turned on.</li>
<li>The IPMI controller credentials passed in the command are right.</li>
<li>The conductor node has a route to the IPMI controller. This can be
checked by just pinging the IPMI controller IP from the conductor
node.</li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If there are slow or unresponsive BMCs in the environment, the retry_timeout
configuration option in the [ipmi] section may need to be lowered. The
default is fairly conservative, as setting this timeout too low can cause
older BMCs to crash and require a hard-reset.</p>
</div>
<p>Bare Metal service supports sending IPMI sensor data to Telemetry with pxe_ipmitool,
pxe_ipminative, agent_ipmitool, agent_pyghmi, agent_ilo, iscsi_ilo, pxe_ilo,
and with pxe_irmc driver starting from Kilo release. By default, support for
sending IPMI sensor data to Telemetry is disabled. If you want to enable it,
you should make the following two changes in <tt class="docutils literal"><span class="pre">ironic.conf</span></tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">notification_driver</span> <span class="pre">=</span> <span class="pre">messaging</span></tt> in the <tt class="docutils literal"><span class="pre">DEFAULT</span></tt> section</li>
<li><tt class="docutils literal"><span class="pre">send_sensor_data</span> <span class="pre">=</span> <span class="pre">true</span></tt> in the <tt class="docutils literal"><span class="pre">conductor</span></tt> section</li>
</ul>
<p>If you want to customize the sensor types which will be sent to Telemetry,
change the <tt class="docutils literal"><span class="pre">send_sensor_data_types</span></tt> option. For example, the below
settings will send temperature, fan, voltage and these three sensor types
of data to Telemetry:</p>
<ul class="simple">
<li>send_sensor_data_types=Temperature,Fan,Voltage</li>
</ul>
<p>If we use default value &#8216;All&#8217; for all the sensor types which are supported by
Telemetry, they are:</p>
<ul class="simple">
<li>Temperature, Fan, Voltage, Current</li>
</ul>
</div>
<div class="section" id="configure-node-web-console">
<h3>Configure node web console<a class="headerlink" href="#configure-node-web-console" title="Permalink to this headline">¶</a></h3>
<p>The web console can be configured in Bare Metal service in the following way:</p>
<ul>
<li><p class="first">Install shellinabox in ironic conductor node. For RHEL/CentOS, shellinabox package
is not present in base repositories, user must enable EPEL repository, you can find
more from <a class="reference external" href="https://fedoraproject.org/wiki/Infrastructure/Mirroring">FedoraProject page</a>.</p>
<p>Installation example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu:
    sudo apt-get install shellinabox

Fedora 21/RHEL7/CentOS7:
    sudo yum install shellinabox

Fedora 22 or higher:
     sudo dnf install shellinabox
</pre></div>
</div>
<p>You can find more about shellinabox on the <a class="reference external" href="https://code.google.com/p/shellinabox/">shellinabox page</a>.</p>
<p>You can optionally use the SSL certificate in shellinabox. If you want to use the SSL
certificate in shellinabox, you should install openssl and generate the SSL certificate.</p>
<ol class="arabic">
<li><p class="first">Install openssl, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu:
     sudo apt-get install openssl

Fedora 21/RHEL7/CentOS7:
     sudo yum install openssl

Fedora 22 or higher:
     sudo dnf install openssl
</pre></div>
</div>
</li>
<li><p class="first">Generate the SSL certificate, here is an example, you can find more about openssl on
the <a class="reference external" href="https://www.openssl.org/">openssl page</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd /tmp/ca
openssl genrsa -des3 -out my.key 1024
openssl req -new -key my.key  -out my.csr
cp my.key my.key.org
openssl rsa -in my.key.org -out my.key
openssl x509 -req -days 3650 -in my.csr -signkey my.key -out my.crt
cat my.crt my.key &gt; certificate.pem
</pre></div>
</div>
</li>
</ol>
</li>
<li><p class="first">Customize the console section in the Bare Metal service configuration
file (/etc/ironic/ironic.conf), if you want to use SSL certificate in
shellinabox, you should specify <tt class="docutils literal"><span class="pre">terminal_cert_dir</span></tt>.
for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[console]

#
# Options defined in ironic.drivers.modules.console_utils
#

# Path to serial console terminal program (string value)
#terminal=shellinaboxd

# Directory containing the terminal SSL cert(PEM) for serial
# console access (string value)
terminal_cert_dir=/tmp/ca

# Directory for holding terminal pid files. If not specified,
# the temporary directory will be used. (string value)
#terminal_pid_dir=&lt;None&gt;

# Time interval (in seconds) for checking the status of
# console subprocess. (integer value)
#subprocess_checking_interval=1

# Time (in seconds) to wait for the console subprocess to
# start. (integer value)
#subprocess_timeout=10
</pre></div>
</div>
</li>
<li><p class="first">Append console parameters for bare metal PXE boot in the Bare Metal service
configuration file (/etc/ironic/ironic.conf), including right serial port
terminal and serial speed, serial speed should be same serial configuration
with BIOS settings, so that os boot process can be seen in web console,
for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>pxe_* driver:

     [pxe]

     #Additional append parameters for bare metal PXE boot. (string value)
     pxe_append_params = nofb nomodeset vga=normal console=tty0 console=ttyS0,115200n8

agent_* driver:

     [agent]

     #Additional append parameters for bare metal PXE boot. (string value)
     agent_pxe_append_params = nofb nomodeset vga=normal console=tty0 console=ttyS0,115200n8
</pre></div>
</div>
</li>
<li><p class="first">Configure node web console.</p>
<p>Enable the web console, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update &lt;node-uuid&gt; add driver_info/&lt;terminal_port&gt;=&lt;customized_port&gt;
ironic node-set-console-mode &lt;node-uuid&gt; true
</pre></div>
</div>
<p>Check whether the console is enabled, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-validate &lt;node-uuid&gt;
</pre></div>
</div>
<p>Disable the web console, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-set-console-mode &lt;node-uuid&gt; false
ironic node-update &lt;node-uuid&gt; remove driver_info/&lt;terminal_port&gt;
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">&lt;terminal_port&gt;</span></tt> is driver dependent. The actual name of this field can be
checked in driver properties, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic driver-properties &lt;driver&gt;
</pre></div>
</div>
<p>For <tt class="docutils literal"><span class="pre">*_ipmitool</span></tt> and <tt class="docutils literal"><span class="pre">*_ipminative</span></tt> drivers, this option is <tt class="docutils literal"><span class="pre">ipmi_terminal_port</span></tt>.
For <tt class="docutils literal"><span class="pre">seamicro</span></tt> driver, this option is <tt class="docutils literal"><span class="pre">seamicro_terminal_port</span></tt>. Give a customized port
number to <tt class="docutils literal"><span class="pre">&lt;customized_port&gt;</span></tt>, for example <tt class="docutils literal"><span class="pre">8023</span></tt>, this customized port is used in
web console url.</p>
</li>
<li><p class="first">Get web console information:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-get-console &lt;node-uuid&gt;
+-----------------+----------------------------------------------------------------------+
| Property        | Value                                                                |
+-----------------+----------------------------------------------------------------------+
| console_enabled | True                                                                 |
| console_info    | {u&#39;url&#39;: u&#39;http://&lt;url&gt;:&lt;customized_port&gt;&#39;, u&#39;type&#39;: u&#39;shellinabox&#39;} |
+-----------------+----------------------------------------------------------------------+
</pre></div>
</div>
<p>You can open web console using above <tt class="docutils literal"><span class="pre">url</span></tt> through web browser. If <tt class="docutils literal"><span class="pre">console_enabled</span></tt> is
<tt class="docutils literal"><span class="pre">false</span></tt>, <tt class="docutils literal"><span class="pre">console_info</span></tt> is <tt class="docutils literal"><span class="pre">None</span></tt>, web console is disabled. If you want to launch web
console, refer to <tt class="docutils literal"><span class="pre">Enable</span> <span class="pre">web</span> <span class="pre">console</span></tt> part.</p>
</li>
</ul>
</div>
<div class="section" id="boot-mode-support">
<span id="id6"></span><h3>Boot mode support<a class="headerlink" href="#boot-mode-support" title="Permalink to this headline">¶</a></h3>
<p>The following drivers support setting of boot mode (Legacy BIOS or UEFI).</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">pxe_ipmitool</span></tt></li>
</ul>
<p>The boot modes can be configured in Bare Metal service in the following way:</p>
<ul>
<li><p class="first">When no boot mode setting is provided, these drivers default the boot_mode
to Legacy BIOS.</p>
</li>
<li><p class="first">Only one boot mode (either <tt class="docutils literal"><span class="pre">uefi</span></tt> or <tt class="docutils literal"><span class="pre">bios</span></tt>) can be configured for
the node.</p>
</li>
<li><p class="first">If the operator wants a node to boot always in <tt class="docutils literal"><span class="pre">uefi</span></tt> mode or <tt class="docutils literal"><span class="pre">bios</span></tt>
mode, then they may use <tt class="docutils literal"><span class="pre">capabilities</span></tt> parameter within <tt class="docutils literal"><span class="pre">properties</span></tt>
field of an bare metal node.  The operator must manually set the appropriate
boot mode on the bare metal node.</p>
<p>To configure a node in <tt class="docutils literal"><span class="pre">uefi</span></tt> mode, then set <tt class="docutils literal"><span class="pre">capabilities</span></tt> as below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update &lt;node-uuid&gt; add properties/capabilities=&#39;boot_mode:uefi&#39;
</pre></div>
</div>
<p>Nodes having <tt class="docutils literal"><span class="pre">boot_mode</span></tt> set to <tt class="docutils literal"><span class="pre">uefi</span></tt> may be requested by adding an
<tt class="docutils literal"><span class="pre">extra_spec</span></tt> to the Compute service flavor:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>nova flavor-key ironic-test-3 set capabilities:boot_mode=&quot;uefi&quot;
nova boot --flavor ironic-test-3 --image test-image instance-1
</pre></div>
</div>
<p>If <tt class="docutils literal"><span class="pre">capabilities</span></tt> is used in <tt class="docutils literal"><span class="pre">extra_spec</span></tt> as above, nova scheduler
(<tt class="docutils literal"><span class="pre">ComputeCapabilitiesFilter</span></tt>) will match only bare metal nodes which have
the <tt class="docutils literal"><span class="pre">boot_mode</span></tt> set appropriately in <tt class="docutils literal"><span class="pre">properties/capabilities</span></tt>. It will
filter out rest of the nodes.</p>
<p>The above facility for matching in the Compute service can be used in
heterogeneous environments where there is a mix of <tt class="docutils literal"><span class="pre">uefi</span></tt> and <tt class="docutils literal"><span class="pre">bios</span></tt>
machines, and operator wants to provide a choice to the user regarding
boot modes. If the flavor doesn&#8217;t contain <tt class="docutils literal"><span class="pre">boot_mode</span></tt> and <tt class="docutils literal"><span class="pre">boot_mode</span></tt>
is configured for bare metal nodes, then nova scheduler will consider all
nodes and user may get either <tt class="docutils literal"><span class="pre">bios</span></tt> or <tt class="docutils literal"><span class="pre">uefi</span></tt> machine.</p>
</li>
</ul>
</div>
<div class="section" id="choosing-the-disk-label">
<span id="id7"></span><h3>Choosing the disk label<a class="headerlink" href="#choosing-the-disk-label" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The term <tt class="docutils literal"><span class="pre">disk</span> <span class="pre">label</span></tt> is historically used in Ironic and was taken
from <a class="reference external" href="https://www.gnu.org/software/parted">parted</a>. Apparently
everyone seems to have a different word for <tt class="docutils literal"><span class="pre">disk</span> <span class="pre">label</span></tt> - these
are all the same thing: disk type, partition table, partition map
and so on...</p>
</div>
<p>Ironic allows operators to choose which disk label they want their
bare metal node to be deployed with when Ironic is responsible for
partitioning the disk; therefore choosing the disk label does not apply
when the image being deployed is a <tt class="docutils literal"><span class="pre">whole</span> <span class="pre">disk</span> <span class="pre">image</span></tt>.</p>
<p>There are some edge cases where someone may want to choose a specific
disk label for the images being deployed, including but not limited to:</p>
<ul class="simple">
<li>For machines in <tt class="docutils literal"><span class="pre">bios</span></tt> boot mode with disks larger than 2 terabytes
it&#8217;s recommended to use a <tt class="docutils literal"><span class="pre">gpt</span></tt> disk label. That&#8217;s because
a capacity beyond 2 terabytes is not addressable by using the
MBR partitioning type. But, although GPT claims to be backward
compatible with legacy BIOS systems <a class="reference external" href="http://www.rodsbooks.com/gdisk/bios.html">that&#8217;s not always the case</a>.</li>
<li>Operators may want to force the partitioning to be always MBR (even
if the machine is deployed with boot mode <tt class="docutils literal"><span class="pre">uefi</span></tt>) to avoid breakage
of applications and tools running on those instances.</li>
</ul>
<p>The disk label can be configured in two ways; when Ironic is used with
the Compute service or in standalone mode. The following bullet points
and sections will describe both methods:</p>
<ul class="simple">
<li>When no disk label is provided Ironic will configure it according
to the <a class="reference internal" href="#boot-mode-support">boot mode</a>; <tt class="docutils literal"><span class="pre">bios</span></tt> boot mode will use
<tt class="docutils literal"><span class="pre">msdos</span></tt> and <tt class="docutils literal"><span class="pre">uefi</span></tt> boot mode will use <tt class="docutils literal"><span class="pre">gpt</span></tt>.</li>
<li>Only one disk label - either <tt class="docutils literal"><span class="pre">msdos</span></tt> or <tt class="docutils literal"><span class="pre">gpt</span></tt> - can be configured
for the node.</li>
</ul>
<div class="section" id="when-used-with-compute-service">
<h4>When used with Compute service<a class="headerlink" href="#when-used-with-compute-service" title="Permalink to this headline">¶</a></h4>
<p>When Ironic is used with the Compute service the disk label should be
set to node&#8217;s <tt class="docutils literal"><span class="pre">properties/capabilities</span></tt> field and also to the flavor
which will request such capability, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update &lt;node-uuid&gt; add properties/capabilities=&#39;disk_label:gpt&#39;
</pre></div>
</div>
<p>As for the flavor:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>nova flavor-key baremetal set capabilities:disk_label=&quot;gpt&quot;
</pre></div>
</div>
</div>
<div class="section" id="when-used-in-standalone-mode">
<h4>When used in standalone mode<a class="headerlink" href="#when-used-in-standalone-mode" title="Permalink to this headline">¶</a></h4>
<p>When used without the Compute service, the disk label should be set
directly to the node&#8217;s <tt class="docutils literal"><span class="pre">instance_info</span></tt> field, as below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update &lt;node-uuid&gt; add instance_info/capabilities=&#39;{&quot;disk_label&quot;: &quot;gpt&quot;}&#39;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="local-boot-with-partition-images">
<h2>Local boot with partition images<a class="headerlink" href="#local-boot-with-partition-images" title="Permalink to this headline">¶</a></h2>
<p>Starting with the Kilo release, Bare Metal service supports local boot with
partition images, meaning that after the deployment the node&#8217;s subsequent
reboots won&#8217;t happen via PXE or Virtual Media. Instead, it will boot from a
local boot loader installed on the disk.</p>
<p>It&#8217;s important to note that in order for this to work the image being
deployed with Bare Metal serivce <strong>must</strong> contain <tt class="docutils literal"><span class="pre">grub2</span></tt> installed within it.</p>
<p>Enabling the local boot is different when Bare Metal service is used with
Compute service and without it.
The following sections will describe both methods.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The local boot feature is dependent upon a updated deploy ramdisk built
with <a class="reference external" href="https://github.com/openstack/diskimage-builder">diskimage-builder</a> <strong>version &gt;= 0.1.42</strong> or <a class="reference external" href="https://github.com/openstack/ironic-python-agent">ironic-python-agent</a>
in the kilo-era.</p>
</div>
<div class="section" id="enabling-local-boot-with-compute-service">
<h3>Enabling local boot with Compute service<a class="headerlink" href="#enabling-local-boot-with-compute-service" title="Permalink to this headline">¶</a></h3>
<p>To enable local boot we need to set a capability on the bare metal node,
for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update &lt;node-uuid&gt; add properties/capabilities=&quot;boot_option:local&quot;
</pre></div>
</div>
<p>Nodes having <tt class="docutils literal"><span class="pre">boot_option</span></tt> set to <tt class="docutils literal"><span class="pre">local</span></tt> may be requested by adding
an <tt class="docutils literal"><span class="pre">extra_spec</span></tt> to the Compute service flavor, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>nova flavor-key baremetal set capabilities:boot_option=&quot;local&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the node is configured to use <tt class="docutils literal"><span class="pre">UEFI</span></tt>, Bare Metal service will create
an <tt class="docutils literal"><span class="pre">EFI</span> <span class="pre">partition</span></tt> on the disk and switch the partition table format to
<tt class="docutils literal"><span class="pre">gpt</span></tt>. The <tt class="docutils literal"><span class="pre">EFI</span> <span class="pre">partition</span></tt> will be used later by the boot loader
(which is installed from the deploy ramdisk).</p>
</div>
</div>
<div class="section" id="enabling-local-boot-without-compute">
<h3>Enabling local boot without Compute<a class="headerlink" href="#enabling-local-boot-without-compute" title="Permalink to this headline">¶</a></h3>
<p>Since adding <tt class="docutils literal"><span class="pre">capabilities</span></tt> to the node&#8217;s properties is only used by
the nova scheduler to perform more advanced scheduling of instances,
we need a way to enable local boot when Compute is not present. To do that
we can simply specify the capability via the <tt class="docutils literal"><span class="pre">instance_info</span></tt> attribute
of the node, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update &lt;node-uuid&gt; add instance_info/capabilities=&#39;{&quot;boot_option&quot;: &quot;local&quot;}&#39;
</pre></div>
</div>
</div>
</div>
<div class="section" id="enrollment">
<h2>Enrollment<a class="headerlink" href="#enrollment" title="Permalink to this headline">¶</a></h2>
<p>After all the services have been properly configured, you should enroll your
hardware with the Bare Metal service, and confirm that the Compute service sees
the available hardware. The nodes will be visible to the Compute service once
they are in the <tt class="docutils literal"><span class="pre">available</span></tt> provision state.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">After enrolling nodes with the Bare Metal service, the Compute service
will not be immediately notified of the new resources. The Compute service&#8217;s
resource tracker syncs periodically, and so any changes made directly to the
Bare Metal service&#8217;s resources will become visible in the Compute service
only after the next run of that periodic task.
More information is in the <a class="reference internal" href="#troubleshooting">Troubleshooting</a> section below.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any bare metal node that is visible to the Compute service may have a
workload scheduled to it, if both the <tt class="docutils literal"><span class="pre">power</span></tt> and <tt class="docutils literal"><span class="pre">deploy</span></tt> interfaces
pass the <tt class="docutils literal"><span class="pre">validate</span></tt> check.
If you wish to exclude a node from the Compute service&#8217;s scheduler, for
instance so that you can perform maintenance on it, you can set the node to
&#8220;maintenance&#8221; mode.
For more information see the <a class="reference internal" href="#maintenance-mode">Maintenance Mode</a> section below.</p>
</div>
<div class="section" id="enrollment-process">
<h3>Enrollment process<a class="headerlink" href="#enrollment-process" title="Permalink to this headline">¶</a></h3>
<p>This section describes the main steps to enroll a node and make it available
for provisioning. Some steps are shown separately for illustration purposes,
and may be combined if desired.</p>
<ol class="arabic">
<li><p class="first">Create a node in the Bare Metal service. At a minimum, you must
specify the driver name (for example, &#8220;pxe_ipmitool&#8221;).
This will return the node UUID along with other information
about the node. The node&#8217;s provision state will be <tt class="docutils literal"><span class="pre">available</span></tt>. (The
example assumes that the client is using the default API version.):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-create -d pxe_ipmitool
+--------------+--------------------------------------+
| Property     | Value                                |
+--------------+--------------------------------------+
| uuid         | dfc6189f-ad83-4261-9bda-b27258eb1987 |
| driver_info  | {}                                   |
| extra        | {}                                   |
| driver       | pxe_ipmitool                         |
| chassis_uuid |                                      |
| properties   | {}                                   |
| name         | None                                 |
+--------------+--------------------------------------+

ironic node-show dfc6189f-ad83-4261-9bda-b27258eb1987
+------------------------+--------------------------------------+
| Property               | Value                                |
+------------------------+--------------------------------------+
| target_power_state     | None                                 |
| extra                  | {}                                   |
| last_error             | None                                 |
| maintenance_reason     | None                                 |
| provision_state        | available                            |
| uuid                   | dfc6189f-ad83-4261-9bda-b27258eb1987 |
| console_enabled        | False                                |
| target_provision_state | None                                 |
| provision_updated_at   | None                                 |
| maintenance            | False                                |
| power_state            | None                                 |
| driver                 | pxe_ipmitool                         |
| properties             | {}                                   |
| instance_uuid          | None                                 |
| name                   | None                                 |
| driver_info            | {}                                   |
| ...                    | ...                                  |
+------------------------+--------------------------------------+
</pre></div>
</div>
<p>Beginning with the Kilo release a node may also be referred to by a logical
name as well as its UUID. To utilize this new feature a name must be
assigned to the node. This can be done when the node is created by
adding the <tt class="docutils literal"><span class="pre">-n</span></tt> option to the <tt class="docutils literal"><span class="pre">node-create</span></tt> command or by updating an
existing node with the <tt class="docutils literal"><span class="pre">node-update</span></tt> command. See <a class="reference internal" href="#logical-names">Logical Names</a> for
examples.</p>
<p>Beginning with the Liberty release, with API version 1.11 and above, a newly
created node will have an initial provision state of <tt class="docutils literal"><span class="pre">enroll</span></tt> as opposed to
<tt class="docutils literal"><span class="pre">available</span></tt>. See <a class="reference internal" href="#enrolling-a-node">Enrolling a node</a> for more details.</p>
</li>
<li><p class="first">Update the node <tt class="docutils literal"><span class="pre">driver_info</span></tt> so that Bare Metal service can manage the
node. Different drivers may require different information about the node.
You can determine this with the <tt class="docutils literal"><span class="pre">driver-properties</span></tt> command, as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic driver-properties pxe_ipmitool
+----------------------+-------------------------------------------------------------------------------------------------------------+
| Property             | Description                                                                                                 |
+----------------------+-------------------------------------------------------------------------------------------------------------+
| ipmi_address         | IP address or hostname of the node. Required.                                                               |
| ipmi_password        | password. Optional.                                                                                         |
| ipmi_username        | username; default is NULL user. Optional.                                                                   |
| ...                  | ...                                                                                                         |
| deploy_kernel        | UUID (from Glance) of the deployment kernel. Required.                                                      |
| deploy_ramdisk       | UUID (from Glance) of the ramdisk that is mounted at boot time. Required.                                   |
+----------------------+-------------------------------------------------------------------------------------------------------------+

ironic node-update $NODE_UUID add \
driver_info/ipmi_username=$USER \
driver_info/ipmi_password=$PASS \
driver_info/ipmi_address=$ADDRESS
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If IPMI is running on a port other than 623 (the default). The port must
be added to <tt class="docutils literal"><span class="pre">driver_info</span></tt> by specifying the <tt class="docutils literal"><span class="pre">ipmi_port</span></tt> value.
Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update $NODE_UUID add driver_info/ipmi_port=$PORT_NUMBER
</pre></div>
</div>
<p class="last">Note that you may also specify all <tt class="docutils literal"><span class="pre">driver_info</span></tt> parameters during
<tt class="docutils literal"><span class="pre">node-create</span></tt> by passing the <strong>-i</strong> option multiple times.</p>
</div>
</li>
<li><p class="first">Update the node&#8217;s properties to match the bare metal flavor you created
earlier:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update $NODE_UUID add \
properties/cpus=$CPU \
properties/memory_mb=$RAM_MB \
properties/local_gb=$DISK_GB \
properties/cpu_arch=$ARCH
</pre></div>
</div>
<p>As above, these can also be specified at node creation by passing the <strong>-p</strong>
option to <tt class="docutils literal"><span class="pre">node-create</span></tt> multiple times.</p>
</li>
<li><p class="first">If you wish to perform more advanced scheduling of the instances based on
hardware capabilities, you may add metadata to each node that will be
exposed to the nova scheduler (see: <a class="reference external" href="http://docs.openstack.org/developer/nova/devref/filter_scheduler.html?highlight=computecapabilitiesfilter">ComputeCapabilitiesFilter</a>).  A full
explanation of this is outside of the scope of this document. It can be done
through the special <tt class="docutils literal"><span class="pre">capabilities</span></tt> member of node properties:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update $NODE_UUID add \
properties/capabilities=key1:val1,key2:val2
</pre></div>
</div>
</li>
<li><p class="first">As mentioned in the <a class="reference internal" href="#flavor-creation">Flavor Creation</a> section, if using the Kilo or later
release of Bare Metal service, you should specify a deploy kernel and
ramdisk which correspond to the node&#8217;s driver, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update $NODE_UUID add \
driver_info/deploy_kernel=$DEPLOY_VMLINUZ_UUID \
driver_info/deploy_ramdisk=$DEPLOY_INITRD_UUID
</pre></div>
</div>
</li>
<li><p class="first">You must also inform Bare Metal service of the network interface cards which
are part of the node by creating a port with each NIC&#8217;s MAC address.
These MAC addresses are passed to the Networking service during instance
provisioning and used to configure the network appropriately:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic port-create -n $NODE_UUID -a $MAC_ADDRESS
</pre></div>
</div>
</li>
<li><p class="first">To check if Bare Metal service has the minimum information necessary for
a node&#8217;s driver to function, you may <tt class="docutils literal"><span class="pre">validate</span></tt> it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-validate $NODE_UUID

+------------+--------+--------+
| Interface  | Result | Reason |
+------------+--------+--------+
| console    | True   |        |
| deploy     | True   |        |
| management | True   |        |
| power      | True   |        |
+------------+--------+--------+
</pre></div>
</div>
<p>If the node fails validation, each driver will return information as to why
it failed:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-validate $NODE_UUID

+------------+--------+-------------------------------------------------------------------------------------------------------------------------------------+
| Interface  | Result | Reason                                                                                                                              |
+------------+--------+-------------------------------------------------------------------------------------------------------------------------------------+
| console    | None   | not supported                                                                                                                       |
| deploy     | False  | Cannot validate iSCSI deploy. Some parameters were missing in node&#39;s instance_info. Missing are: [&#39;root_gb&#39;, &#39;image_source&#39;]        |
| management | False  | Missing the following IPMI credentials in node&#39;s driver_info: [&#39;ipmi_address&#39;].                                                     |
| power      | False  | Missing the following IPMI credentials in node&#39;s driver_info: [&#39;ipmi_address&#39;].                                                     |
+------------+--------+-------------------------------------------------------------------------------------------------------------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">If using API version 1.11 or above, the node was created in the <tt class="docutils literal"><span class="pre">enroll</span></tt>
provision state. In order for the node to be available for deploying a
workload (for example, by the Compute service), it needs to be in the
<tt class="docutils literal"><span class="pre">available</span></tt> provision state. To do this, it must be moved into the
<tt class="docutils literal"><span class="pre">manageable</span></tt> state and then moved into the <tt class="docutils literal"><span class="pre">available</span></tt> state. The
<a class="reference internal" href="#api-version-1-11-and-above">API version 1.11 and above</a> section describes the commands for this.</p>
</li>
</ol>
</div>
<div class="section" id="enrolling-a-node">
<h3>Enrolling a node<a class="headerlink" href="#enrolling-a-node" title="Permalink to this headline">¶</a></h3>
<p>In the Liberty cycle, starting with API version 1.11, the Bare Metal service
added a new initial provision state of <tt class="docutils literal"><span class="pre">enroll</span></tt> to its state machine.</p>
<p>Existing automation tooling that use an API version lower than 1.11 are not
affected, since the initial provision state is still <tt class="docutils literal"><span class="pre">available</span></tt>.
However, using API version 1.11 or above may break existing automation tooling
with respect to node creation.</p>
<p>The default API version used by (the most recent) python-ironicclient is 1.9.</p>
<p>The examples below set the API version for each command. To set the
API version for all commands, you can set the environment variable
<tt class="docutils literal"><span class="pre">IRONIC_API_VERSION</span></tt>.</p>
<div class="section" id="api-version-1-10-and-below">
<h4>API version 1.10 and below<a class="headerlink" href="#api-version-1-10-and-below" title="Permalink to this headline">¶</a></h4>
<p>Below is an example of creating a node with API version 1.10. After creation,
the node will be in the <tt class="docutils literal"><span class="pre">available</span></tt> provision state.
Other API versions below 1.10 may be substituted in place of 1.10.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic --ironic-api-version 1.10 node-create -d agent_ilo -n pre11

+--------------+--------------------------------------+
| Property     | Value                                |
+--------------+--------------------------------------+
| uuid         | cc4998a0-f726-4927-9473-0582458c6789 |
| driver_info  | {}                                   |
| extra        | {}                                   |
| driver       | agent_ilo                            |
| chassis_uuid |                                      |
| properties   | {}                                   |
| name         | pre11                                |
+--------------+--------------------------------------+


ironic --ironic-api-version 1.10 node-list

+--------------------------------------+-------+---------------+-------------+--------------------+-------------+
| UUID                                 | Name  | Instance UUID | Power State | Provisioning State | Maintenance |
+--------------------------------------+-------+---------------+-------------+--------------------+-------------+
| cc4998a0-f726-4927-9473-0582458c6789 | pre11 | None          | None        | available          | False       |
+--------------------------------------+-------+---------------+-------------+--------------------+-------------+
</pre></div>
</div>
</div>
<div class="section" id="api-version-1-11-and-above">
<h4>API version 1.11 and above<a class="headerlink" href="#api-version-1-11-and-above" title="Permalink to this headline">¶</a></h4>
<p>Beginning with API version 1.11, the initial provision state for newly created
nodes is <tt class="docutils literal"><span class="pre">enroll</span></tt>. In the examples below, other API versions above 1.11 may be
substituted in place of 1.11.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic --ironic-api-version 1.11 node-create -d agent_ilo -n post11

+--------------+--------------------------------------+
| Property     | Value                                |
+--------------+--------------------------------------+
| uuid         | 0eb013bb-1e4b-4f4c-94b5-2e7468242611 |
| driver_info  | {}                                   |
| extra        | {}                                   |
| driver       | agent_ilo                            |
| chassis_uuid |                                      |
| properties   | {}                                   |
| name         | post11                               |
+--------------+--------------------------------------+


ironic --ironic-api-version 1.11 node-list

+--------------------------------------+--------+---------------+-------------+--------------------+-------------+
| UUID                                 | Name   | Instance UUID | Power State | Provisioning State | Maintenance |
+--------------------------------------+--------+---------------+-------------+--------------------+-------------+
| 0eb013bb-1e4b-4f4c-94b5-2e7468242611 | post11 | None          | None        | enroll             | False       |
+--------------------------------------+--------+---------------+-------------+--------------------+-------------+
</pre></div>
</div>
<p>In order for nodes to be available for deploying workloads on them, nodes
must be in the <tt class="docutils literal"><span class="pre">available</span></tt> provision state. To do this, nodes
created with API version 1.11 and above must be moved from the <tt class="docutils literal"><span class="pre">enroll</span></tt> state
to the <tt class="docutils literal"><span class="pre">manageable</span></tt> state and then to the <tt class="docutils literal"><span class="pre">available</span></tt> state.</p>
<p>To move a node to a different provision state, use the
<tt class="docutils literal"><span class="pre">node-set-provision-state</span></tt> command.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since it is an asychronous call, the response for
<tt class="docutils literal"><span class="pre">ironic</span> <span class="pre">node-set-provision-state</span></tt> will not indicate whether the
transition succeeded or not. You can check the status of the
operation via <tt class="docutils literal"><span class="pre">ironic</span> <span class="pre">node-show</span></tt>. If it was successful,
<tt class="docutils literal"><span class="pre">provision_state</span></tt> will be in the desired state. If it failed,
there will be information in the node&#8217;s <tt class="docutils literal"><span class="pre">last_error</span></tt>.</p>
</div>
<p>After creating a node and before moving it from its initial provision state of
<tt class="docutils literal"><span class="pre">enroll</span></tt>, basic power and port information needs to be configured on the node.
The Bare Metal service needs this information because it verifies that it is
capable of controlling the node when transitioning the node from <tt class="docutils literal"><span class="pre">enroll</span></tt> to
<tt class="docutils literal"><span class="pre">manageable</span></tt> state.</p>
<p>To move a node from <tt class="docutils literal"><span class="pre">enroll</span></tt> to <tt class="docutils literal"><span class="pre">manageable</span></tt> provision state:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic --ironic-api-version 1.11 node-set-provision-state $NODE_UUID manage

ironic node-show $NODE_UUID

+------------------------+--------------------------------------------------------------------+
| Property               | Value                                                              |
+------------------------+--------------------------------------------------------------------+
| ...                    | ...                                                                |
| provision_state        | manageable                                                         | &lt;- verify correct state
| uuid                   | 0eb013bb-1e4b-4f4c-94b5-2e7468242611                               |
| ...                    | ...                                                                |
+------------------------+--------------------------------------------------------------------+
</pre></div>
</div>
<p>When a node is moved from the <tt class="docutils literal"><span class="pre">manageable</span></tt> to <tt class="docutils literal"><span class="pre">available</span></tt> provision
state, the node will go through automated cleaning if configured to do so (see
<a class="reference internal" href="#cleaningnetworksetup"><em>Configure the Bare Metal service for cleaning</em></a>).
To move a node from <tt class="docutils literal"><span class="pre">manageable</span></tt> to <tt class="docutils literal"><span class="pre">available</span></tt> provision state:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic --ironic-api-version 1.11 node-set-provision-state $NODE_UUID provide

ironic node-show $NODE_UUID

+------------------------+--------------------------------------------------------------------+
| Property               | Value                                                              |
+------------------------+--------------------------------------------------------------------+
| ...                    | ...                                                                |
| provision_state        | available                                                          | &lt; - verify correct state
| uuid                   | 0eb013bb-1e4b-4f4c-94b5-2e7468242611                               |
| ...                    | ...                                                                |
+------------------------+--------------------------------------------------------------------+
</pre></div>
</div>
<p>For more details on the Bare Metal service&#8217;s state machine, see the
<a class="reference external" href="http://docs.openstack.org/developer/ironic/dev/states.html">state machine</a>
documentation.</p>
</div>
</div>
<div class="section" id="logical-names">
<h3>Logical names<a class="headerlink" href="#logical-names" title="Permalink to this headline">¶</a></h3>
<p>Beginning with the Kilo release a Node may also be referred to by a
logical name as well as its UUID. Names can be assigned either when
creating the node by adding the <tt class="docutils literal"><span class="pre">-n</span></tt> option to the <tt class="docutils literal"><span class="pre">node-create</span></tt> command or
by updating an existing node with the <tt class="docutils literal"><span class="pre">node-update</span></tt> command.</p>
<p>Node names must be unique, and conform to:</p>
<ul class="simple">
<li><a class="reference external" href="http://tools.ietf.org/html/rfc952">rfc952</a></li>
<li><a class="reference external" href="http://tools.ietf.org/html/rfc1123">rfc1123</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Hostname">wiki_hostname</a></li>
</ul>
<p>The node is named &#8216;example&#8217; in the following examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-create -d agent_ipmitool -n example
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update $NODE_UUID add name=example
</pre></div>
</div>
<p>Once assigned a logical name, a node can then be referred to by name or
UUID interchangeably.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-create -d agent_ipmitool -n example

+--------------+--------------------------------------+
| Property     | Value                                |
+--------------+--------------------------------------+
| uuid         | 71e01002-8662-434d-aafd-f068f69bb85e |
| driver_info  | {}                                   |
| extra        | {}                                   |
| driver       | agent_ipmitool                       |
| chassis_uuid |                                      |
| properties   | {}                                   |
| name         | example                              |
+--------------+--------------------------------------+


ironic node-show example

+------------------------+--------------------------------------+
| Property               | Value                                |
+------------------------+--------------------------------------+
| target_power_state     | None                                 |
| extra                  | {}                                   |
| last_error             | None                                 |
| updated_at             | 2015-04-24T16:23:46+00:00            |
| ...                    | ...                                  |
| instance_info          | {}                                   |
+------------------------+--------------------------------------+
</pre></div>
</div>
</div>
<div class="section" id="hardware-inspection">
<span id="inspection"></span><h3>Hardware Inspection<a class="headerlink" href="#hardware-inspection" title="Permalink to this headline">¶</a></h3>
<p>Starting with the Kilo release, Bare Metal service supports hardware inspection
that simplifies enrolling nodes.
Inspection allows Bare Metal service to discover required node properties
once required <tt class="docutils literal"><span class="pre">driver_info</span></tt> fields (for example, IPMI credentials) are set
by an operator. Inspection will also create the Bare Metal service ports for the
discovered ethernet MACs. Operators will have to manually delete the Bare Metal
service ports for which physical media is not connected. This is required due
to the <a class="reference external" href="https://bugs.launchpad.net/ironic/+bug/1405131">bug 1405131</a>.</p>
<p>There are two kinds of inspection supported by Bare Metal service:</p>
<ol class="arabic">
<li><p class="first">Out-of-band inspection is currently implemented by iLO drivers, listed at
<a class="reference internal" href="../drivers/ilo.html#ilo"><em>iLO drivers</em></a>.</p>
</li>
<li><p class="first">In-band inspection is performed by utilizing the <a class="reference external" href="https://github.com/openstack/ironic-inspector">ironic-inspector</a> project.
This is supported by the following drivers:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">pxe_drac</span>
<span class="n">pxe_ipmitool</span>
<span class="n">pxe_ipminative</span>
<span class="n">pxe_ssh</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>This feature needs to be explicitly enabled in the configuration
by setting <tt class="docutils literal"><span class="pre">enabled</span> <span class="pre">=</span> <span class="pre">True</span></tt> in <tt class="docutils literal"><span class="pre">[inspector]</span></tt> section.
You must additionally install <a class="reference external" href="https://pypi.python.org/pypi/python-ironic-inspector-client">python-ironic-inspector-client</a> to use
this functionality.
You must set <tt class="docutils literal"><span class="pre">service_url</span></tt> if the ironic-inspector service is
being run on a separate host from the ironic-conductor service, or is using
non-standard port.</p>
<p>In order to ensure that ports in Bare Metal service are synchronized with
NIC ports on the node, the following settings in the ironic-inspector
configuration file must be set:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">processing</span><span class="p">]</span>
<span class="n">add_ports</span> <span class="o">=</span> <span class="nb">all</span>
<span class="n">keep_ports</span> <span class="o">=</span> <span class="n">present</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>During Kilo cycle we used on older verions of Inspector called
<a class="reference external" href="https://pypi.python.org/pypi/ironic-discoverd">ironic-discoverd</a>. Inspector is expected to be a mostly drop-in
replacement, and the same client library should be used to connect to both.</p>
<p class="last">For Kilo, install <a class="reference external" href="https://pypi.python.org/pypi/ironic-discoverd">ironic-discoverd</a> of version 1.1.0 or higher
instead of python-ironic-inspector-client and use <tt class="docutils literal"><span class="pre">[discoverd]</span></tt> option
group in both Bare Metal service and ironic-discoverd configuration
files instead of ones provided above.</p>
</div>
</div></blockquote>
<p>Inspection can be initiated using node-set-provision-state.
The node should be in MANAGEABLE state before inspection is initiated.</p>
<ul>
<li><p class="first">Move node to manageable state:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-set-provision-state &lt;node_UUID&gt; manage
</pre></div>
</div>
</li>
<li><p class="first">Initiate inspection:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-set-provision-state &lt;node_UUID&gt; inspect
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above commands require the <a class="reference external" href="https://pypi.python.org/pypi/python-ironicclient">python-ironicclient</a> to be version 0.5.0 or greater.</p>
</div>
</div>
</div>
<div class="section" id="specifying-the-disk-for-deployment">
<h2>Specifying the disk for deployment<a class="headerlink" href="#specifying-the-disk-for-deployment" title="Permalink to this headline">¶</a></h2>
<p>Starting with the Kilo release, Bare Metal service supports passing
hints to the deploy ramdisk about which disk it should pick for the
deployment. The list of support hints is:</p>
<ul>
<li><p class="first">model (STRING): device identifier</p>
</li>
<li><p class="first">vendor (STRING): device vendor</p>
</li>
<li><p class="first">serial (STRING): disk serial number</p>
</li>
<li><p class="first">size (INT): size of the device in GiB</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A node&#8217;s &#8216;local_gb&#8217; property is often set to a value 1 GiB less than the
actual disk size to account for partitioning (this is how DevStack, TripleO
and Ironic Inspector work, to name a few). However, in this case <tt class="docutils literal"><span class="pre">size</span></tt>
should be the actual size. For example, for a 128 GiB disk <tt class="docutils literal"><span class="pre">local_gb</span></tt>
will be 127, but size hint will be 128.</p>
</div>
</li>
<li><p class="first">wwn (STRING): unique storage identifier</p>
</li>
<li><p class="first">wwn_with_extension (STRING): unique storage identifier with the vendor extension appended</p>
</li>
<li><p class="first">wwn_vendor_extension (STRING): unique vendor storage identifier</p>
</li>
<li><p class="first">name (STRING): the device name, e.g /dev/md0</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The root device hint name should only be used for devices with
constant names (e.g RAID volumes). For SATA, SCSI and IDE disk
controllers this hint is not recommended because the order in which
the device nodes are added in Linux is arbitrary, resulting in
devices like /dev/sda and /dev/sdb <a class="reference external" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/persistent_naming.html">switching around at boot time</a>.</p>
</div>
</li>
</ul>
<p>To associate one or more hints with a node, update the node&#8217;s properties
with a <tt class="docutils literal"><span class="pre">root_device</span></tt> key, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update &lt;node-uuid&gt; add properties/root_device=&#39;{&quot;wwn&quot;: &quot;0x4000cca77fc4dba1&quot;}&#39;
</pre></div>
</div>
<p>That will guarantee that Bare Metal service will pick the disk device that
has the <tt class="docutils literal"><span class="pre">wwn</span></tt> equal to the specified wwn value, or fail the deployment if it
can not be found.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If multiple hints are specified, a device must satisfy all the hints.</p>
</div>
</div>
<div class="section" id="enabling-https-in-swift">
<span id="enablehttpsinswift"></span><h2>Enabling HTTPS in Swift<a class="headerlink" href="#enabling-https-in-swift" title="Permalink to this headline">¶</a></h2>
<p>The drivers using virtual media use swift for storing boot images
and node configuration information (contains sensitive information for Ironic
conductor to provision bare metal hardware).  By default, HTTPS is not enabled
in swift. HTTPS is required to encrypt all communication between swift and Ironic
conductor and swift and bare metal (via virtual media).  It can be enabled in one
of the following ways:</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.openstack.org/security-guide/secure-communication/tls-proxies-and-http-services.html">Using an SSL termination proxy</a></li>
<li><a class="reference external" href="http://docs.openstack.org/developer/swift/deployment_guide.html">Using native SSL support in swift</a>
(recommended only for testing purpose by swift).</li>
</ul>
</div>
<div class="section" id="using-bare-metal-service-as-a-standalone-service">
<h2>Using Bare Metal service as a standalone service<a class="headerlink" href="#using-bare-metal-service-as-a-standalone-service" title="Permalink to this headline">¶</a></h2>
<p>Starting with the Kilo release, it&#8217;s possible to use Bare Metal service without
other OpenStack services.</p>
<p>You should make the following changes to <tt class="docutils literal"><span class="pre">/etc/ironic/ironic.conf</span></tt>:</p>
<ol class="arabic">
<li><p class="first">To disable usage of Identity service tokens:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="o">...</span>
<span class="n">auth_strategy</span><span class="o">=</span><span class="n">none</span>
</pre></div>
</div>
</li>
<li><p class="first">If you want to disable the Networking service, you should have your network
pre-configured to serve DHCP and TFTP for machines that you&#8217;re deploying.
To disable it, change the following lines:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">dhcp</span><span class="p">]</span>
<span class="o">...</span>
<span class="n">dhcp_provider</span><span class="o">=</span><span class="n">none</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you disabled the Networking service and the driver that you use is
supported by at most one conductor, PXE boot will still work for your
nodes without any manual config editing. This is because you know all
the DHCP options that will be used for deployment and can set up your
DHCP server appropriately.</p>
<p class="last">If you have multiple conductors per driver, it would be better to use
Networking since it will do all the dynamically changing configurations
for you.</p>
</div>
</li>
</ol>
<p>If you don&#8217;t use Image service, it&#8217;s possible to provide images to Bare Metal
service via hrefs.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At the moment, only two types of hrefs are acceptable instead of Image
service UUIDs: HTTP(S) hrefs (for example, &#8220;<a class="reference external" href="http://my.server.net/images/img">http://my.server.net/images/img</a>&#8221;)
and file hrefs (<a class="reference external" href="file:///images/img">file:///images/img</a>).</p>
</div>
<p>There are however some limitations for different drivers:</p>
<ul>
<li><p class="first">If you&#8217;re using one of the drivers that use agent deploy method (namely,
<tt class="docutils literal"><span class="pre">agent_ilo</span></tt>, <tt class="docutils literal"><span class="pre">agent_ipmitool</span></tt>, <tt class="docutils literal"><span class="pre">agent_pyghmi</span></tt>, <tt class="docutils literal"><span class="pre">agent_ssh</span></tt> or
<tt class="docutils literal"><span class="pre">agent_vbox</span></tt>) you have to know MD5 checksum for your instance image. To
compute it, you can use the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>md5sum image.qcow2
ed82def8730f394fb85aef8a208635f6  image.qcow2
</pre></div>
</div>
<p>Apart from that, because of the way the agent deploy method works, image
hrefs can use only HTTP(S) protocol.</p>
</li>
<li><p class="first">If you&#8217;re using <tt class="docutils literal"><span class="pre">iscsi_ilo</span></tt> or <tt class="docutils literal"><span class="pre">agent_ilo</span></tt> driver, Object Storage service
is required, as these drivers need to store floppy image that is used to pass
parameters to deployment iso. For this method also only HTTP(S) hrefs are
acceptable, as HP iLO servers cannot attach other types of hrefs as virtual
media.</p>
</li>
<li><p class="first">Other drivers use PXE deploy method and there are no special requirements
in this case.</p>
</li>
</ul>
<p>Steps to start a deployment are pretty similar to those when using Compute:</p>
<ol class="arabic">
<li><p class="first">To use the <a class="reference external" href="http://docs.openstack.org/developer/python-ironicclient/cli.html">ironic CLI</a>,
set up these environment variables. Since no authentication strategy is
being used, the value can be any string for OS_AUTH_TOKEN. IRONIC_URL is
the URL of the ironic-api process.
For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>export OS_AUTH_TOKEN=fake-token
export IRONIC_URL=http://localhost:6385/
</pre></div>
</div>
</li>
<li><p class="first">Create a node in Bare Metal service. At minimum, you must specify the driver
name (for example, &#8220;pxe_ipmitool&#8221;). You can also specify all the required
driver parameters in one command. This will return the node UUID:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-create -d pxe_ipmitool -i ipmi_address=ipmi.server.net \
-i ipmi_username=user -i ipmi_password=pass \
-i deploy_kernel=file:///images/deploy.vmlinuz \
-i deploy_ramdisk=http://my.server.net/images/deploy.ramdisk

+--------------+--------------------------------------------------------------------------+
| Property     | Value                                                                    |
+--------------+--------------------------------------------------------------------------+
| uuid         | be94df40-b80a-4f63-b92b-e9368ee8d14c                                     |
| driver_info  | {u&#39;deploy_ramdisk&#39;: u&#39;http://my.server.net/images/deploy.ramdisk&#39;,       |
|              | u&#39;deploy_kernel&#39;: u&#39;file:///images/deploy.vmlinuz&#39;, u&#39;ipmi_address&#39;:     |
|              | u&#39;ipmi.server.net&#39;, u&#39;ipmi_username&#39;: u&#39;user&#39;, u&#39;ipmi_password&#39;:         |
|              | u&#39;******&#39;}                                                               |
| extra        | {}                                                                       |
| driver       | pxe_ipmitool                                                             |
| chassis_uuid |                                                                          |
| properties   | {}                                                                       |
+--------------+--------------------------------------------------------------------------+
</pre></div>
</div>
<p>Note that here deploy_kernel and deploy_ramdisk contain links to
images instead of Image service UUIDs.</p>
</li>
<li><p class="first">As in case of Compute service, you can also provide <tt class="docutils literal"><span class="pre">capabilities</span></tt> to node
properties, but they will be used only by Bare Metal service (for example,
boot mode). Although you don&#8217;t need to add properties like <tt class="docutils literal"><span class="pre">memory_mb</span></tt>,
<tt class="docutils literal"><span class="pre">cpus</span></tt> etc. as Bare Metal service will require UUID of a node you&#8217;re
going to deploy.</p>
</li>
<li><p class="first">Then create a port to inform Bare Metal service of the network interface
cards which are part of the node by creating a port with each NIC&#8217;s MAC
address. In this case, they&#8217;re used for naming of PXE configs for a node:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic port-create -n $NODE_UUID -a $MAC_ADDRESS
</pre></div>
</div>
</li>
<li><p class="first">As there is no Compute service flavor and instance image is not provided with
nova boot command, you also need to specify some fields in <tt class="docutils literal"><span class="pre">instance_info</span></tt>.
For PXE deployment, they are <tt class="docutils literal"><span class="pre">image_source</span></tt>, <tt class="docutils literal"><span class="pre">kernel</span></tt>, <tt class="docutils literal"><span class="pre">ramdisk</span></tt>,
<tt class="docutils literal"><span class="pre">root_gb</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update $NODE_UUID add instance_info/image_source=$IMG \
instance_info/kernel=$KERNEL instance_info/ramdisk=$RAMDISK \
instance_info/root_gb=10
</pre></div>
</div>
<p>Here $IMG, $KERNEL, $RAMDISK can also be HTTP(S) or file hrefs. For agent
drivers, you don&#8217;t need to specify kernel and ramdisk, but MD5 checksum of
instance image is required:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-update $NODE_UUID add instance_info/image_checksum=$MD5HASH
</pre></div>
</div>
</li>
<li><p class="first">Validate that all parameters are correct:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-validate $NODE_UUID

+------------+--------+----------------------------------------------------------------+
| Interface  | Result | Reason                                                         |
+------------+--------+----------------------------------------------------------------+
| console    | False  | Missing &#39;ipmi_terminal_port&#39; parameter in node&#39;s driver_info.  |
| deploy     | True   |                                                                |
| management | True   |                                                                |
| power      | True   |                                                                |
+------------+--------+----------------------------------------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">Now you can start the deployment, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-set-provision-state $NODE_UUID active
</pre></div>
</div>
<p>You can manage provisioning by issuing this command. Valid provision states
are <tt class="docutils literal"><span class="pre">active</span></tt>, <tt class="docutils literal"><span class="pre">rebuild</span></tt> and <tt class="docutils literal"><span class="pre">deleted</span></tt>.</p>
</li>
</ol>
<p>For iLO drivers, fields that should be provided are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ilo_deploy_iso</span></tt> under <tt class="docutils literal"><span class="pre">driver_info</span></tt>;</li>
<li><tt class="docutils literal"><span class="pre">ilo_boot_iso</span></tt>, <tt class="docutils literal"><span class="pre">image_source</span></tt>, <tt class="docutils literal"><span class="pre">root_gb</span></tt> under <tt class="docutils literal"><span class="pre">instance_info</span></tt>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before Liberty release Ironic was not able to track non-Glance images&#8217;
content changes. Starting with Liberty, it is possible to do so using image
modification date. For example, for HTTP image, if &#8216;Last-Modified&#8217; header
value from response to a HEAD request to
&#8220;<a class="reference external" href="http://my.server.net/images/deploy.ramdisk">http://my.server.net/images/deploy.ramdisk</a>&#8221; is greater than cached image
modification time, Ironic will re-download the content. For &#8220;<a class="reference external" href="file://">file://</a>&#8221;
images, the file system modification time is used.</p>
</div>
<div class="section" id="other-references">
<h3>Other references<a class="headerlink" href="#other-references" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="#enabling-local-boot-without-compute">Enabling local boot without Compute</a></li>
</ul>
</div>
</div>
<div class="section" id="enabling-the-configuration-drive-configdrive">
<h2>Enabling the configuration drive (configdrive)<a class="headerlink" href="#enabling-the-configuration-drive-configdrive" title="Permalink to this headline">¶</a></h2>
<p>Starting with the Kilo release, the Bare Metal service supports exposing
a configuration drive image to the instances.</p>
<p>The configuration drive is usually used in conjunction with the Compute
service, but the Bare Metal service also offers a standalone way of using it.
The following sections will describe both methods.</p>
<div class="section" id="id8">
<h3>When used with Compute service<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>To enable the configuration drive when deploying an instance, pass
<tt class="docutils literal"><span class="pre">--config-drive</span> <span class="pre">true</span></tt> parameter to the <tt class="docutils literal"><span class="pre">nova</span> <span class="pre">boot</span></tt> command, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>nova boot --config-drive true --flavor baremetal --image test-image instance-1
</pre></div>
</div>
<p>It&#8217;s also possible to enable the configuration drive automatically on
all instances by configuring the <tt class="docutils literal"><span class="pre">OpenStack</span> <span class="pre">Compute</span> <span class="pre">service</span></tt> to always
create a configuration drive by setting the following option in the
<tt class="docutils literal"><span class="pre">/etc/nova/nova.conf</span></tt> file, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="o">...</span>

<span class="n">force_config_drive</span><span class="o">=</span><span class="bp">True</span>
</pre></div>
</div>
</div>
<div class="section" id="when-used-standalone">
<h3>When used standalone<a class="headerlink" href="#when-used-standalone" title="Permalink to this headline">¶</a></h3>
<p>When used without the Compute service, the operator needs to create a configuration drive
and provide the file or HTTP URL to the Bare Metal service.</p>
<p>For the format of the configuration drive, Bare Metal service expects a
<tt class="docutils literal"><span class="pre">gzipped</span></tt> and <tt class="docutils literal"><span class="pre">base64</span></tt> encoded ISO 9660 <a class="footnote-reference" href="#id10" id="id9">[*]</a> file with a <tt class="docutils literal"><span class="pre">config-2</span></tt>
label. The
<a class="reference external" href="https://github.com/openstack/python-ironicclient">ironic client</a>
can generate a configuration drive in the <a class="reference external" href="http://docs.openstack.org/user-guide/cli_config_drive.html#openstack-metadata-format">expected format</a>. Just pass a
directory path containing the files that will be injected into it via the
<tt class="docutils literal"><span class="pre">--config-drive</span></tt> parameter of the <tt class="docutils literal"><span class="pre">node-set-provision-state</span></tt> command,
for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-set-provision-state --config-drive /dir/configdrive_files $node_identifier active
</pre></div>
</div>
</div>
<div class="section" id="accessing-the-configuration-drive-data">
<h3>Accessing the configuration drive data<a class="headerlink" href="#accessing-the-configuration-drive-data" title="Permalink to this headline">¶</a></h3>
<p>When the configuration drive is enabled, the Bare Metal service will create a partition on the
instance disk and write the configuration drive image onto it. The
configuration drive must be mounted before use. This is performed
automatically by many tools, such as cloud-init and cloudbase-init. To mount
it manually on a Linux distribution that supports accessing devices by labels,
simply run the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">config</span>
<span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">disk</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">label</span><span class="o">/</span><span class="n">config</span><span class="o">-</span><span class="mi">2</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">config</span>
</pre></div>
</div>
<p>If the guest OS doesn&#8217;t support accessing devices by labels, you can use
other tools such as <tt class="docutils literal"><span class="pre">blkid</span></tt> to identify which device corresponds to
the configuration drive and mount it, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>CONFIG_DEV=$(blkid -t LABEL=&quot;config-2&quot; -odevice)
mkdir -p /mnt/config
mount $CONFIG_DEV /mnt/config
</pre></div>
</div>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[*]</a></td><td>A config drive could also be a data block with a VFAT filesystem
on it instead of ISO 9660. But it&#8217;s unlikely that it would be needed
since ISO 9660 is widely supported across operating systems.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="cloud-init-integration">
<h3>Cloud-init integration<a class="headerlink" href="#cloud-init-integration" title="Permalink to this headline">¶</a></h3>
<p>The configuration drive can be
especially useful when used with <a class="reference external" href="http://cloudinit.readthedocs.org/en/latest/topics/datasources.html#config-drive">cloud-init</a>,
but in order to use it we should follow some rules:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">Cloud-init</span></tt> data should be organized in the <a class="reference external" href="http://docs.openstack.org/user-guide/cli_config_drive.html#openstack-metadata-format">expected format</a>.</p>
</li>
<li><p class="first">Since the Bare Metal service uses a disk partition as the configuration drive,
it will only work with
<a class="reference external" href="http://bazaar.launchpad.net/~cloud-init-dev/cloud-init/trunk/view/head:/ChangeLog">cloud-init version &gt;= 0.7.5</a>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Cloud-init</span></tt> has a collection of data source modules, so when
building the image with <a class="reference external" href="https://github.com/openstack/diskimage-builder">disk-image-builder</a> we have to define
<tt class="docutils literal"><span class="pre">DIB_CLOUD_INIT_DATASOURCES</span></tt> environment variable and set the
appropriate sources to enable the configuration drive, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>DIB_CLOUD_INIT_DATASOURCES=&quot;ConfigDrive, OpenStack&quot; disk-image-create -o fedora-cloud-image fedora baremetal
</pre></div>
</div>
<p>For more information see <a class="reference external" href="http://docs.openstack.org/developer/diskimage-builder/elements/cloud-init-datasources/README.html">how to configure cloud-init data sources</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="building-or-downloading-a-deploy-ramdisk-image">
<span id="buildingdeployramdisk"></span><h2>Building or downloading a deploy ramdisk image<a class="headerlink" href="#building-or-downloading-a-deploy-ramdisk-image" title="Permalink to this headline">¶</a></h2>
<p>Ironic depends on having an image with the <a class="reference external" href="https://github.com/openstack/ironic-python-agent">ironic-python-agent</a> (IPA)
service running on it for controlling and deploying bare metal nodes.</p>
<p>You can download a pre-built version of the deploy ramdisk built with
the <a class="reference internal" href="#coreos-tools">CoreOS tools</a> at:</p>
<ul class="simple">
<li><a class="reference external" href="http://tarballs.openstack.org/ironic-python-agent/coreos/files/coreos_production_pxe.vmlinuz">CoreOS deploy kernel</a></li>
<li><a class="reference external" href="http://tarballs.openstack.org/ironic-python-agent/coreos/files/coreos_production_pxe_image-oem.cpio.gz">CoreOS deploy ramdisk</a></li>
</ul>
<div class="section" id="building-from-source">
<h3>Building from source<a class="headerlink" href="#building-from-source" title="Permalink to this headline">¶</a></h3>
<p>There are two known methods for creating the deployment image with the
IPA service:</p>
<div class="section" id="coreos-tools">
<span id="buildingcoreosdeployramdisk"></span><h4>CoreOS tools<a class="headerlink" href="#coreos-tools" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Clone the <a class="reference external" href="https://github.com/openstack/ironic-python-agent">ironic-python-agent</a> project:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>git clone https://github.com/openstack/ironic-python-agent
</pre></div>
</div>
</li>
<li><p class="first">Install the requirements:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fedora 21/RHEL7/CentOS7:
    sudo yum install docker gzip util-linux cpio findutils grep gpg

Fedora 22 or higher:
    sudo dnf install docker gzip util-linux cpio findutils grep gpg

Ubuntu 14.04 (trusty) or higher:
    sudo apt-get install docker.io gzip uuid-runtime cpio findutils grep gnupg
</pre></div>
</div>
</li>
<li><p class="first">Change directory to <tt class="docutils literal"><span class="pre">imagebuild/coreos</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd ironic-python-agent/imagebuild/coreos
</pre></div>
</div>
</li>
<li><p class="first">Start the docker daemon:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Fedora/RHEL7/CentOS7:
    sudo systemctl start docker

Ubuntu:
    sudo service docker start
</pre></div>
</div>
</li>
<li><p class="first">Create the image:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo make
</pre></div>
</div>
</li>
<li><p class="first">Or, create an ISO image to boot with virtual media:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo make iso
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Once built the deploy ramdisk and kernel will appear inside of a
directory called <tt class="docutils literal"><span class="pre">UPLOAD</span></tt>.</p>
</div>
</div>
<div class="section" id="buildingdibbaseddeployramdisk">
<span id="id11"></span><h4>disk-image-builder<a class="headerlink" href="#buildingdibbaseddeployramdisk" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Install <a class="reference external" href="https://github.com/openstack/diskimage-builder">disk-image-builder</a> from pip or from your distro&#8217;s packages:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo pip install diskimage-builder
</pre></div>
</div>
</li>
<li><p class="first">Create the image:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>disk-image-create ironic-agent fedora -o ironic-deploy
</pre></div>
</div>
<p>The above command creates the deploy ramdisk and kernel named
<tt class="docutils literal"><span class="pre">ironic-deploy.vmlinuz</span></tt> and <tt class="docutils literal"><span class="pre">ironic-deploy.initramfs</span></tt> in your
current directory.</p>
</li>
<li><p class="first">Or, create an ISO image to boot with virtual media:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>disk-image-create ironic-agent fedora iso -o ironic-deploy
</pre></div>
</div>
<p>The above command creates the deploy ISO named <tt class="docutils literal"><span class="pre">ironic-deploy.iso</span></tt>
in your current directory.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Fedora was used as an example for the base operational system. Please
check the <a class="reference external" href="http://docs.openstack.org/developer/diskimage-builder">diskimage-builder documentation</a> for other supported
operational systems.</p>
</div>
</div>
</div>
</div>
<div class="section" id="trusted-boot-with-partition-image">
<h2>Trusted boot with partition image<a class="headerlink" href="#trusted-boot-with-partition-image" title="Permalink to this headline">¶</a></h2>
<p>Starting with the Liberty release, Ironic supports trusted boot with partition
image. This means at the end of the deployment process, when the node is
rebooted with the new user image, <tt class="docutils literal"><span class="pre">trusted</span> <span class="pre">boot</span></tt> will be performed. It will
measure the node&#8217;s BIOS, boot loader, Option ROM and the Kernel/Ramdisk, to
determine whether a bare metal node deployed by Ironic should be trusted.</p>
<p>It&#8217;s important to note that in order for this to work the node being deployed
<strong>must</strong> have Intel <a class="reference external" href="http://en.wikipedia.org/wiki/Trusted_Execution_Technology">TXT</a> hardware support. The image being deployed with
Ironic must have <tt class="docutils literal"><span class="pre">oat-client</span></tt> installed within it.</p>
<p>The following will describe how to enable <tt class="docutils literal"><span class="pre">trusted</span> <span class="pre">boot</span></tt> and boot
with PXE and Nova:</p>
<ol class="arabic">
<li><p class="first">Create a customized user image with <tt class="docutils literal"><span class="pre">oat-client</span></tt> installed:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>disk-image-create -u fedora baremetal oat-client -o $TRUST_IMG
</pre></div>
</div>
<p>For more information on creating customized images, see <a class="reference internal" href="#imagerequirement">ImageRequirement</a>.</p>
</li>
<li><p class="first">Enable VT-x, VT-d, TXT and TPM on the node. This can be done manually through
the BIOS. Depending on the platform, several reboots may be needed.</p>
</li>
<li><p class="first">Enroll the node and update the node capability value:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ironic node-create -d pxe_ipmitool

ironic node-update $NODE_UUID add properties/capabilities={&#39;trusted_boot&#39;:true}
</pre></div>
</div>
</li>
<li><p class="first">Create a special flavor:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>nova flavor-key $TRUST_FLAVOR_UUID set &#39;capabilities:trusted_boot&#39;=true
</pre></div>
</div>
</li>
<li><p class="first">Prepare <a class="reference external" href="https://sourceforge.net/projects/tboot">tboot</a> and mboot.c32 and put them into tftp_root or http_root
directory on all nodes with the ironic-conductor processes:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Ubuntu:
    cp /usr/lib/syslinux/mboot.c32 /tftpboot/

Fedora:
    cp /usr/share/syslinux/mboot.c32 /tftpboot/
</pre></div>
</div>
<p><em>Note: The actual location of mboot.c32 varies among different distribution versions.</em></p>
<p>tboot can be downloaded from
<a class="reference external" href="https://sourceforge.net/projects/tboot/files/latest/download">https://sourceforge.net/projects/tboot/files/latest/download</a></p>
</li>
<li><p class="first">Install an OAT Server. An <a class="reference external" href="https://github.com/OpenAttestation/OpenAttestation/wiki">OAT Server</a> should be running and configured correctly.</p>
</li>
<li><p class="first">Boot an instance with Nova:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>nova boot --flavor $TRUST_FLAVOR_UUID --image $TRUST_IMG --user-data $TRUST_SCRIPT trusted_instance
</pre></div>
</div>
<p><em>Note</em> that the node will be measured during <tt class="docutils literal"><span class="pre">trusted</span> <span class="pre">boot</span></tt> and the hash values saved
into <a class="reference external" href="http://en.wikipedia.org/wiki/Trusted_Platform_Module">TPM</a>. An example of TRUST_SCRIPT can be found in <a class="reference external" href="https://wiki.openstack.org/wiki/Bare-metal-trust#Trust_Script_Example">trust script example</a>.</p>
</li>
<li><p class="first">Verify the result via OAT Server.</p>
<p>This is outside the scope of Ironic. At the moment, users can manually verify the result
by following the <a class="reference external" href="https://wiki.openstack.org/wiki/Bare-metal-trust#Manual_verify_result">manual verify steps</a>.</p>
</li>
</ol>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>Once all the services are running and configured properly, and a node has been
enrolled with the Bare Metal service and is in the <tt class="docutils literal"><span class="pre">available</span></tt> provision
state, the Compute service should detect the node
as an available resource and expose it to the scheduler.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is a delay, and it may take up to a minute (one periodic task cycle)
for the Compute service to recognize any changes in the Bare Metal service&#8217;s
resources (both additions and deletions).</p>
</div>
<p>In addition to watching <tt class="docutils literal"><span class="pre">nova-compute</span></tt> log files, you can see the available
resources by looking at the list of Compute hypervisors. The resources reported
therein should match the bare metal node properties, and the Compute service flavor.</p>
<p>Here is an example set of commands to compare the resources in Compute
service and Bare Metal service:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-list
+--------------------------------------+---------------+-------------+--------------------+-------------+
| UUID                                 | Instance UUID | Power State | Provisioning State | Maintenance |
+--------------------------------------+---------------+-------------+--------------------+-------------+
| 86a2b1bb-8b29-4964-a817-f90031debddb | None          | power off   | available          | False       |
+--------------------------------------+---------------+-------------+--------------------+-------------+

$ ironic node-show 86a2b1bb-8b29-4964-a817-f90031debddb
+------------------------+----------------------------------------------------------------------+
| Property               | Value                                                                |
+------------------------+----------------------------------------------------------------------+
| instance_uuid          | None                                                                 |
| properties             | {u&#39;memory_mb&#39;: u&#39;1024&#39;, u&#39;cpu_arch&#39;: u&#39;x86_64&#39;, u&#39;local_gb&#39;: u&#39;10&#39;,  |
|                        | u&#39;cpus&#39;: u&#39;1&#39;}                                                       |
| maintenance            | False                                                                |
| driver_info            | { [SNIP] }                                                           |
| extra                  | {}                                                                   |
| last_error             | None                                                                 |
| created_at             | 2014-11-20T23:57:03+00:00                                            |
| target_provision_state | None                                                                 |
| driver                 | pxe_ipmitool                                                         |
| updated_at             | 2014-11-21T00:47:34+00:00                                            |
| instance_info          | {}                                                                   |
| chassis_uuid           | 7b49bbc5-2eb7-4269-b6ea-3f1a51448a59                                 |
| provision_state        | available                                                            |
| reservation            | None                                                                 |
| power_state            | power off                                                            |
| console_enabled        | False                                                                |
| uuid                   | 86a2b1bb-8b29-4964-a817-f90031debddb                                 |
+------------------------+----------------------------------------------------------------------+

$ nova hypervisor-show 1
+-------------------------+--------------------------------------+
| Property                | Value                                |
+-------------------------+--------------------------------------+
| cpu_info                | baremetal cpu                        |
| current_workload        | 0                                    |
| disk_available_least    | -                                    |
| free_disk_gb            | 10                                   |
| free_ram_mb             | 1024                                 |
| host_ip                 | [ SNIP ]                             |
| hypervisor_hostname     | 86a2b1bb-8b29-4964-a817-f90031debddb |
| hypervisor_type         | ironic                               |
| hypervisor_version      | 1                                    |
| id                      | 1                                    |
| local_gb                | 10                                   |
| local_gb_used           | 0                                    |
| memory_mb               | 1024                                 |
| memory_mb_used          | 0                                    |
| running_vms             | 0                                    |
| service_disabled_reason | -                                    |
| service_host            | my-test-host                         |
| service_id              | 6                                    |
| state                   | up                                   |
| status                  | enabled                              |
| vcpus                   | 1                                    |
| vcpus_used              | 0                                    |
+-------------------------+--------------------------------------+
</pre></div>
</div>
<div class="section" id="maintenance-mode">
<h3>Maintenance mode<a class="headerlink" href="#maintenance-mode" title="Permalink to this headline">¶</a></h3>
<p>Maintenance mode may be used if you need to take a node out of the resource
pool. Putting a node in maintenance mode will prevent Bare Metal service from
executing periodic tasks associated with the node. This will also prevent
Compute service from placing a tenant instance on the node by not exposing
the node to the nova scheduler. Nodes can be placed into maintenance mode
with the following command.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-set-maintenance $NODE_UUID on
</pre></div>
</div>
<p>As of the Kilo release, a maintenance reason may be included with the optional
<tt class="docutils literal"><span class="pre">--reason</span></tt> command line option. This is a free form text field that will be
displayed in the <tt class="docutils literal"><span class="pre">maintenance_reason</span></tt> section of the <tt class="docutils literal"><span class="pre">node-show</span></tt> command.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-set-maintenance $UUID on --reason &quot;Need to add ram.&quot;

$ ironic node-show $UUID

+------------------------+--------------------------------------+
| Property               | Value                                |
+------------------------+--------------------------------------+
| target_power_state     | None                                 |
| extra                  | {}                                   |
| last_error             | None                                 |
| updated_at             | 2015-04-27T15:43:58+00:00            |
| maintenance_reason     | Need to add ram.                     |
| ...                    | ...                                  |
| maintenance            | True                                 |
| ...                    | ...                                  |
+------------------------+--------------------------------------+
</pre></div>
</div>
<p>To remove maintenance mode and clear any <tt class="docutils literal"><span class="pre">maintenance_reason</span></tt> use the
following command.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ ironic node-set-maintenance $NODE_UUID off
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Installation Guide</a><ul>
<li><a class="reference internal" href="#service-overview">Service overview</a></li>
<li><a class="reference internal" href="#install-and-configure-prerequisites">Install and configure prerequisites</a><ul>
<li><a class="reference internal" href="#configure-the-identity-service-for-the-bare-metal-service">Configure the Identity service for the Bare Metal service</a></li>
<li><a class="reference internal" href="#set-up-the-database-for-bare-metal">Set up the database for Bare Metal</a></li>
<li><a class="reference internal" href="#install-the-bare-metal-service">Install the Bare Metal service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-the-bare-metal-service">Configure the Bare Metal service</a><ul>
<li><a class="reference internal" href="#configuring-ironic-api-service">Configuring ironic-api service</a></li>
<li><a class="reference internal" href="#configuring-ironic-conductor-service">Configuring ironic-conductor service</a></li>
<li><a class="reference internal" href="#configuring-ironic-api-behind-mod-wsgi">Configuring ironic-api behind mod_wsgi</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-compute-to-use-the-bare-metal-service">Configure Compute to use the Bare Metal service</a></li>
<li><a class="reference internal" href="#configure-networking-to-communicate-with-the-bare-metal-server">Configure Networking to communicate with the bare metal server</a></li>
<li><a class="reference internal" href="#configure-the-bare-metal-service-for-cleaning">Configure the Bare Metal service for cleaning</a></li>
<li><a class="reference internal" href="#image-requirements">Image requirements</a></li>
<li><a class="reference internal" href="#flavor-creation">Flavor creation</a></li>
<li><a class="reference internal" href="#setup-the-drivers-for-the-bare-metal-service">Setup the drivers for the Bare Metal service</a><ul>
<li><a class="reference internal" href="#pxe-setup">PXE setup</a></li>
<li><a class="reference internal" href="#pxe-uefi-setup">PXE UEFI setup</a></li>
<li><a class="reference internal" href="#ipxe-setup">iPXE setup</a></li>
<li><a class="reference internal" href="#networking-service-configuration">Networking service configuration</a></li>
<li><a class="reference internal" href="#ipmi-support">IPMI support</a></li>
<li><a class="reference internal" href="#configure-node-web-console">Configure node web console</a></li>
<li><a class="reference internal" href="#boot-mode-support">Boot mode support</a></li>
<li><a class="reference internal" href="#choosing-the-disk-label">Choosing the disk label</a><ul>
<li><a class="reference internal" href="#when-used-with-compute-service">When used with Compute service</a></li>
<li><a class="reference internal" href="#when-used-in-standalone-mode">When used in standalone mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#local-boot-with-partition-images">Local boot with partition images</a><ul>
<li><a class="reference internal" href="#enabling-local-boot-with-compute-service">Enabling local boot with Compute service</a></li>
<li><a class="reference internal" href="#enabling-local-boot-without-compute">Enabling local boot without Compute</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enrollment">Enrollment</a><ul>
<li><a class="reference internal" href="#enrollment-process">Enrollment process</a></li>
<li><a class="reference internal" href="#enrolling-a-node">Enrolling a node</a><ul>
<li><a class="reference internal" href="#api-version-1-10-and-below">API version 1.10 and below</a></li>
<li><a class="reference internal" href="#api-version-1-11-and-above">API version 1.11 and above</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logical-names">Logical names</a></li>
<li><a class="reference internal" href="#hardware-inspection">Hardware Inspection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specifying-the-disk-for-deployment">Specifying the disk for deployment</a></li>
<li><a class="reference internal" href="#enabling-https-in-swift">Enabling HTTPS in Swift</a></li>
<li><a class="reference internal" href="#using-bare-metal-service-as-a-standalone-service">Using Bare Metal service as a standalone service</a><ul>
<li><a class="reference internal" href="#other-references">Other references</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enabling-the-configuration-drive-configdrive">Enabling the configuration drive (configdrive)</a><ul>
<li><a class="reference internal" href="#id8">When used with Compute service</a></li>
<li><a class="reference internal" href="#when-used-standalone">When used standalone</a></li>
<li><a class="reference internal" href="#accessing-the-configuration-drive-data">Accessing the configuration drive data</a></li>
<li><a class="reference internal" href="#cloud-init-integration">Cloud-init integration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-or-downloading-a-deploy-ramdisk-image">Building or downloading a deploy ramdisk image</a><ul>
<li><a class="reference internal" href="#building-from-source">Building from source</a><ul>
<li><a class="reference internal" href="#coreos-tools">CoreOS tools</a></li>
<li><a class="reference internal" href="#buildingdibbaseddeployramdisk">disk-image-builder</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#trusted-boot-with-partition-image">Trusted boot with partition image</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#maintenance-mode">Maintenance mode</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="user-guide.html"
                                  title="previous chapter">Introduction to Ironic</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="upgrade-guide.html"
                                  title="next chapter">Bare Metal Service Upgrade Guide</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/ironic
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/deploy/install-guide.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../http-routingtable.html" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="upgrade-guide.html" title="Bare Metal Service Upgrade Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="user-guide.html" title="Introduction to Ironic"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">ironic 5.1.3.dev21 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright OpenStack Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/ironic");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>