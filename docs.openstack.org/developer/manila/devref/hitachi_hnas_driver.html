<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Hitachi NAS Platform File Services Driver for OpenStack</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../_static/css/combined.css" rel="stylesheet">
<link href="../_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Hitachi NAS Platform File Services Driver for OpenStack</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="hdfs_native_driver.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: HDFS native driver"></i></a>
    
    
    <a href="hpe_3par_driver.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: HPE 3PAR Driver"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 'Tue Feb 14 14:25:27 2017, commit 610baa2'</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Hitachi NAS Platform File Services Driver for OpenStack</a><ul>
<li><a class="reference internal" href="#driver-version-3-0">Driver Version 3.0</a><ul>
<li><a class="reference internal" href="#hitachi-nas-platform-storage-requirements">Hitachi NAS Platform Storage Requirements</a></li>
<li><a class="reference internal" href="#supported-operations">Supported Operations</a></li>
<li><a class="reference internal" href="#driver-configuration">Driver Configuration</a><ul>
<li><a class="reference internal" href="#step-1-hnas-parameters-configuration">Step 1 - HNAS Parameters Configuration</a></li>
<li><a class="reference internal" href="#step-2-prepare-the-network">Step 2 - Prepare the Network</a></li>
<li><a class="reference internal" href="#step-3-share-type-configuration">Step 3 - Share Type Configuration</a></li>
<li><a class="reference internal" href="#step-4-restart-the-services">Step 4 - Restart the Services</a></li>
<li><a class="reference internal" href="#step-5-configure-openstack-networks">Step 5 - Configure OpenStack Networks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#manage-and-unmanage-shares">Manage and Unmanage Shares</a></li>
<li><a class="reference internal" href="#additional-notes">Additional Notes</a></li>
<li><a class="reference internal" href="#the-manila-share-drivers-hitachi-hnas-driver-module">The <code class="docutils literal"><span class="pre">manila.share.drivers.hitachi.hnas.driver</span></code> Module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="hitachi-nas-platform-file-services-driver-for-openstack">
<h1>Hitachi NAS Platform File Services Driver for OpenStack<a class="headerlink" href="#hitachi-nas-platform-file-services-driver-for-openstack" title="Permalink to this headline">¶</a></h1>
<div class="section" id="driver-version-3-0">
<h2>Driver Version 3.0<a class="headerlink" href="#driver-version-3-0" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hitachi-nas-platform-storage-requirements">
<h3>Hitachi NAS Platform Storage Requirements<a class="headerlink" href="#hitachi-nas-platform-storage-requirements" title="Permalink to this headline">¶</a></h3>
<p>This Hitachi NAS Platform File Services Driver for OpenStack provides support
for Hitachi NAS Platform (HNAS) models 3080, 3090, 4040, 4060, 4080 and 4100
with NAS OS 12.2 or higher.
Before configuring the driver, ensure the HNAS has at least:</p>
<ul class="simple">
<li>1 storage pool (span) configured.</li>
<li>1 EVS configured.</li>
<li>1 file system in this EVS, created without replication target option and
should be in mounted state. It is recommended to disable auto-expansion,
because the scheduler uses the current free space reported by the file
system when creating shares.</li>
<li>1 Management User configured with &#8220;supervisor&#8221; permission level.</li>
<li>Hitachi NAS Management interface should be reachable from manila-share
node.</li>
</ul>
<p>Also, if the driver is going to create CIFS shares, either LDAP servers or
domains must be configured previously in HNAS to provide the users and groups.</p>
</div>
<div class="section" id="supported-operations">
<h3>Supported Operations<a class="headerlink" href="#supported-operations" title="Permalink to this headline">¶</a></h3>
<p>The following operations are supported in this version of Hitachi NAS Platform
File Services Driver for OpenStack:</p>
<ul class="simple">
<li>Create and delete CIFS and NFS shares;</li>
<li>Extend and shrink shares;</li>
<li>Manage rules to shares (allow/deny access);</li>
<li>Allow and deny share access;<ul>
<li><code class="docutils literal"><span class="pre">IP</span></code> access type supported for <code class="docutils literal"><span class="pre">NFS</span></code> shares;</li>
<li><code class="docutils literal"><span class="pre">User</span></code> access type supported for <code class="docutils literal"><span class="pre">CIFS</span></code> shares;</li>
<li>Both <code class="docutils literal"><span class="pre">RW</span></code> and <code class="docutils literal"><span class="pre">RO</span></code> access level are supported for NFS and CIFS shares;</li>
</ul>
</li>
<li>Manage and unmanage shares;</li>
<li>Create and delete snapshots;</li>
<li>Create shares from snapshots.</li>
</ul>
</div>
<div class="section" id="driver-configuration">
<h3>Driver Configuration<a class="headerlink" href="#driver-configuration" title="Permalink to this headline">¶</a></h3>
<p>This document contains the installation and user guide of the Hitachi NAS
Platform File Services Driver for OpenStack. Although mentioning some Shared
File Systems service operations and HNAS commands, both are not in the scope of
this document. Please refer to their own guides for details.</p>
<p>Before configuring the driver, make sure that the nodes running the
manila-share service have access to the HNAS management port, and compute and
network nodes have access to the data ports (EVS IPs or aggregations).</p>
<p>The driver configuration can be summarized in the following steps:</p>
<ol class="arabic simple">
<li>Configure HNAS parameters on <code class="docutils literal"><span class="pre">manila.conf</span></code>;</li>
<li>Prepare the network ensuring all OpenStack-HNAS connections mentioned above;</li>
<li>Configure/create share type;</li>
<li>Restart the services;</li>
<li>Configure OpenStack networks.</li>
</ol>
<div class="section" id="step-1-hnas-parameters-configuration">
<h4>Step 1 - HNAS Parameters Configuration<a class="headerlink" href="#step-1-hnas-parameters-configuration" title="Permalink to this headline">¶</a></h4>
<p>The following parameters need to be configured in the [DEFAULT] section
of <code class="docutils literal"><span class="pre">/etc/manila/manila.conf</span></code>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Option</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>enabled_share_backends</td>
<td>Name of the section on <code class="docutils literal"><span class="pre">manila.conf</span></code> used to
specify a backend. For example:
<em>enabled_share_backends = hnas1</em></td>
</tr>
<tr class="row-odd"><td>enabled_share_protocols</td>
<td>Specify a list of protocols to be allowed for
share creation. This driver version supports
NFS and/or CIFS.</td>
</tr>
</tbody>
</table>
<p>The following parameters need to be configured in the [backend] section
of <code class="docutils literal"><span class="pre">/etc/manila/manila.conf</span></code>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Option</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>share_backend_name</td>
<td>A name for the backend.</td>
</tr>
<tr class="row-odd"><td>share_driver</td>
<td>Python module path. For this driver <strong>this must be</strong>:
<em>manila.share.drivers.hitachi.hnas.driver.HitachiHNASDriver</em></td>
</tr>
<tr class="row-even"><td>driver_handles_share_servers</td>
<td>Driver working mode. For this driver <strong>this must be</strong>:
<em>False</em>.</td>
</tr>
<tr class="row-odd"><td>hitachi_hnas_ip</td>
<td>HNAS management interface IP for communication between manila-share node and HNAS.</td>
</tr>
<tr class="row-even"><td>hitachi_hnas_user</td>
<td>This field is used to provide user credential to HNAS. Provided management user must have
&#8220;supervisor&#8221; level.</td>
</tr>
<tr class="row-odd"><td>hitachi_hnas_password</td>
<td>This field is used to provide password credential to HNAS.
Either hitachi_hnas_password or hitachi_hnas_ssh_private_key must be set.</td>
</tr>
<tr class="row-even"><td>hitachi_hnas_ssh_private_key</td>
<td>Set this parameter with RSA/DSA private key path to allow the driver to connect into HNAS.</td>
</tr>
<tr class="row-odd"><td>hitachi_hnas_evs_id</td>
<td>ID from EVS which this backend is assigned to (ID can be listed by CLI &#8220;evs list&#8221;
or EVS Management in HNAS Interface).</td>
</tr>
<tr class="row-even"><td>hitachi_hnas_evs_ip</td>
<td>EVS IP for mounting shares (this can be listed by CLI &#8220;evs list&#8221; or EVS Management in HNAS
interface).</td>
</tr>
<tr class="row-odd"><td>hitachi_hnas_file_system_name</td>
<td>Name of the file system in HNAS, located in the specified EVS.</td>
</tr>
<tr class="row-even"><td>hitachi_hnas_cluster_admin_ip0*</td>
<td>If HNAS is in a multi-farm (one SMU managing multiple HNAS) configuration, set this parameter with
the IP of the cluster&#8217;s admin node.</td>
</tr>
<tr class="row-odd"><td>hitachi_hnas_stalled_job_timeout*</td>
<td>Tree-clone-job commands are used to create snapshots and create shares from snapshots.
This parameter sets a timeout (in seconds) to wait for jobs to complete. Default value is
30 seconds.</td>
</tr>
<tr class="row-even"><td>hitachi_hnas_driver_helper*</td>
<td>Python module path for the driver helper. For this driver, it should use (default value):
<em>manila.share.drivers.hitachi.hnas.ssh.HNASSSHBackend</em></td>
</tr>
<tr class="row-odd"><td>hitachi_hnas_allow_cifs_snapshot_while_mounted*</td>
<td>By default, CIFS snapshots are not allowed to be taken while the share has clients connected
because point-in-time replica cannot be guaranteed for all files. This parameter can be set
to <em>True</em> to allow snapshots to be taken while the share has clients connected. <strong>WARNING</strong>:
Setting this parameter to <em>True</em> might cause inconsistent snapshots on CIFS shares. Default
value is <em>False</em>.</td>
</tr>
</tbody>
</table>
<p>* Non mandatory parameters.</p>
<p>Below is an example of a valid configuration of HNAS driver:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="na">[DEFAULT]``</span>
<span class="na">...</span>
<span class="na">enabled_share_backends</span> <span class="o">=</span> <span class="s">hitachi1</span>
<span class="na">enabled_share_protocols</span> <span class="o">=</span> <span class="s">CIFS,NFS</span>
<span class="na">...</span>

<span class="k">[hitachi1]</span>
<span class="na">share_backend_name</span> <span class="o">=</span> <span class="s">HITACHI1</span>
<span class="na">share_driver</span> <span class="o">=</span> <span class="s">manila.share.drivers.hitachi.hnas.driver.HitachiHNASDriver</span>
<span class="na">driver_handles_share_servers</span> <span class="o">=</span> <span class="s">False</span>
<span class="na">hitachi_hnas_ip</span> <span class="o">=</span> <span class="s">172.24.44.15</span>
<span class="na">hitachi_hnas_user</span> <span class="o">=</span> <span class="s">supervisor</span>
<span class="na">hitachi_hnas_password</span> <span class="o">=</span> <span class="s">supervisor</span>
<span class="na">hitachi_hnas_evs_id</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">hitachi_hnas_evs_ip</span> <span class="o">=</span> <span class="s">10.0.1.20</span>
<span class="na">hitachi_hnas_file_system_name</span> <span class="o">=</span> <span class="s">FS-Manila</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-prepare-the-network">
<h4>Step 2 - Prepare the Network<a class="headerlink" href="#step-2-prepare-the-network" title="Permalink to this headline">¶</a></h4>
<p>In the driver mode used by Hitachi NAS Platform File Services Driver for
OpenStack, driver_handles_share_servers (DHSS) as False, the driver does not
handle network configuration, it is up to the administrator to configure it.
It is mandatory that HNAS management interface is reachable from a manila-share
node through admin network, while the selected EVS data interface is reachable
from OpenStack Cloud, such as through neutron flat networking. Here is a
step-by-step of an example configuration:</p>
<div class="line-block">
<div class="line"><strong>Manila-Share Node:</strong></div>
<div class="line"><strong>eth0</strong>: Admin Network, can ping HNAS management interface.</div>
<div class="line"><strong>eth1</strong>: Data Network, can ping HNAS EVS IP (data interface). This interface
is only required if you plan to use Share Migration.</div>
</div>
<div class="line-block">
<div class="line"><strong>Network Node and Compute Nodes:</strong></div>
<div class="line"><strong>eth0</strong>: Admin Network, can ping HNAS management interface.</div>
<div class="line"><strong>eth1</strong>: Data Network, can ping HNAS EVS IP (data interface).</div>
</div>
<p>The following image represents the described scenario:</p>
<a class="reference internal image-reference" href="../_images/hds_network.jpg"><img alt="../_images/hds_network.jpg" src="../_images/hds_network.jpg" style="width: 60%;" /></a>
<p>Run in <strong>Network Node</strong>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo ifconfig eth1 <span class="m">0</span>
<span class="gp">$</span> sudo ovs-vsctl add-br br-eth1
<span class="gp">$</span> sudo ovs-vsctl add-port br-eth1 eth1
<span class="gp">$</span> sudo ifconfig eth1 up
</pre></div>
</div>
<p>Edit <em>/etc/neutron/plugins/ml2/ml2_conf.ini</em> (default directory), change the
following settings as follows in their respective tags:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[ml2]</span>
<span class="na">type_drivers</span> <span class="o">=</span> <span class="s">flat,vlan,vxlan,gre</span>
<span class="na">mechanism_drivers</span> <span class="o">=</span> <span class="s">openvswitch</span>

<span class="k">[ml2_type_flat]</span>
<span class="na">flat_networks</span> <span class="o">=</span> <span class="s">physnet1,physnet2</span>

<span class="k">[ml2_type_vlan]</span>
<span class="na">network_vlan_ranges</span> <span class="o">=</span> <span class="s">physnet1:1000:1500,physnet2:2000:2500</span>

<span class="k">[ovs]</span>
<span class="na">bridge_mappings</span> <span class="o">=</span> <span class="s">physnet1:br-ex,physnet2:br-eth1</span>
</pre></div>
</div>
<p>You may have to repeat the last line above in another file in the Compute Node,
if it exists is located in: <em>/etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini</em>.</p>
<p>Create a route in HNAS to the tenant network. Please make sure
multi-tenancy is enabled and routes are configured per EVS. Use the command
“route-net-add” in HNAS console, where the network parameter should be the
tenant&#8217;s private network, while the gateway parameter should be the flat
network gateway and the “console-context &#8211;evs” parameter should be the ID of
EVS in use, such as in the following example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> console-context --evs <span class="m">3</span> route-net-add --gateway <span class="m">192</span>.168.1.1 <span class="m">10</span>.0.0.0/24
</pre></div>
</div>
</div>
<div class="section" id="step-3-share-type-configuration">
<h4>Step 3 - Share Type Configuration<a class="headerlink" href="#step-3-share-type-configuration" title="Permalink to this headline">¶</a></h4>
<p>Shared File Systems service requires that the share type includes the
driver_handles_share_servers extra-spec. This ensures that the share will be
created on a backend that supports the requested driver_handles_share_servers
capability. For the Hitachi NAS Platform File Services Driver for OpenStack
this must be set to False.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> manila type-create hitachi False
</pre></div>
</div>
<p>Additionally, the driver also reports the following common capabilities that
can be specified in the share type:</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Capability</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>thin_provisioning = True</td>
<td>All shares created on HNAS are always thin
provisioned. So, if you set it, the value
<strong>must be</strong>: <em>True</em>.</td>
</tr>
<tr class="row-odd"><td>dedupe = True/False</td>
<td>HNAS supports deduplication on its file
systems and the driver will report
<em>dedupe=True</em> if it is enabled on the file
system being used. To use it, go to HNAS and
enable the feature on the file system used.</td>
</tr>
</tbody>
</table>
<p>To specify a common capability on the share type, use the <em>type-key</em> command,
for example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> manila type-key hitachi <span class="nb">set</span> <span class="nv">dedupe</span><span class="o">=</span>True
</pre></div>
</div>
</div>
<div class="section" id="step-4-restart-the-services">
<h4>Step 4 - Restart the Services<a class="headerlink" href="#step-4-restart-the-services" title="Permalink to this headline">¶</a></h4>
<p>Restart all Shared File Systems services (manila-share, manila-scheduler and
manila-api) and neutron services (neutron-*). This step is specific to your
environment. If you are running in devstack for example, you have to log into
screen (<code class="docutils literal"><span class="pre">screen</span> <span class="pre">-r</span></code>), stop the process (<code class="docutils literal"><span class="pre">Ctrl^C</span></code>) and run it again. If you
are running it in a distro like RHEL or SUSE, a service command (for example
<em>service manila-api restart</em>) is used to restart the service.</p>
</div>
<div class="section" id="step-5-configure-openstack-networks">
<h4>Step 5 - Configure OpenStack Networks<a class="headerlink" href="#step-5-configure-openstack-networks" title="Permalink to this headline">¶</a></h4>
<p>In Neutron Controller it is necessary to create a network, a subnet and to add
this subnet interface to a router:</p>
<p>Create a network to the given tenant (demo), providing the DEMO_ID (this can be
fetched using <em>keystone tenant-list</em>), a name for the network, the name of the
physical network over which the virtual network is implemented and the type of
the physical mechanism by which the virtual network is implemented:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron net-create --tenant-id &lt;DEMO_ID&gt; hnas_network
<span class="go">--provider:physical_network=physnet2 --provider:network_type=flat</span>
</pre></div>
</div>
<p>Create a subnet to same tenant (demo), providing the DEMO_ID (this can be fetched
using <em>keystone tenant-list</em>), the gateway IP of this subnet, a name for the
subnet, the network ID created on previously step (this can be fetched using
<em>neutron net-list</em>) and CIDR of subnet:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron subnet-create --tenant-id &lt;DEMO_ID&gt; --gateway &lt;GATEWAY&gt;
<span class="go">--name hnas_subnet &lt;NETWORK_ID&gt; &lt;SUBNET_CIDR&gt;</span>
</pre></div>
</div>
<p>Finally, add the subnet interface to a router, providing the router ID and
subnet ID created on previously step (can be fetched using <em>neutron subnet-list</em>):</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron router-interface-add &lt;ROUTER_ID&gt; &lt;SUBNET_ID&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="manage-and-unmanage-shares">
<h3>Manage and Unmanage Shares<a class="headerlink" href="#manage-and-unmanage-shares" title="Permalink to this headline">¶</a></h3>
<p>Manila has the ability to manage and unmanage shares. If there is a share in
the storage and it is not in OpenStack, you can manage that share and use it
as a manila share. Hitachi NAS Platform File Services Driver for OpenStack use
virtual-volumes (V-VOLs) to create shares. Only V-VOLs with a quota limit
can be used by the driver, also, they must be created or moved inside the
directory &#8216;/shares/&#8217; and exported (as NFS or CIFS shares). The unmanage
operation only unlinks the share from OpenStack, preserving all data in the
share.</p>
<p>To <strong>manage</strong> shares use:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> manila manage <span class="o">[</span>--name &lt;name&gt;<span class="o">]</span> <span class="o">[</span>--description &lt;description&gt;<span class="o">]</span>
<span class="go">[--share_type &lt;share_type&gt;] [--driver_options [&lt;key=value&gt; [&lt;key=value&gt; ...]]]</span>
<span class="go">&lt;service_host&gt; &lt;protocol&gt; &lt;export_path&gt;</span>
</pre></div>
</div>
<p>Where:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="28%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head" colspan="2">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>service_host</td>
<td colspan="2">Manila host, backend and share name. For example
ubuntu&#64;hitachi1#HITACHI1. The available hosts can be
listed with the command: <em>manila pool-list</em> (admin only).</td>
</tr>
<tr class="row-odd"><td>protocol</td>
<td colspan="2">NFS or CIFS protocols are currently supported.</td>
</tr>
<tr class="row-even"><td>export_path</td>
<td colspan="2">The export path of the share.
For example: <em>172.24.44.31:/shares/some_share_id</em></td>
</tr>
</tbody>
</table>
<p>To <strong>unmanage</strong> a share use:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> manila unmanage &lt;share_id&gt;
</pre></div>
</div>
<p>Where:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="28%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head" colspan="2">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>share_id</td>
<td colspan="2">Manila ID of the share to be unmanaged. This list can
be fetched with: <em>manila list</em>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="additional-notes">
<h3>Additional Notes<a class="headerlink" href="#additional-notes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>HNAS has some restrictions about the number of EVSs, file systems,
virtual-volumes and simultaneous SSC connections. Check the manual
specification for your system.</li>
<li>Shares and snapshots are thin provisioned. It is reported to manila only the
real used space in HNAS. Also, a snapshot does not initially take any space in
HNAS, it only stores the difference between the share and the snapshot, so it
grows when share data is changed.</li>
<li>Admins should manage the tenant’s quota (<em>manila quota-update</em>) to control
the backend usage.</li>
<li>By default, CIFS snapshots are disabled when the share is mounted, since it
uses tree-clone to create snapshots and does not guarantee point-in-time
replicas when the source directory tree is changing, also, changing
permissions to <em>read-only</em> does not affect already mounted shares. So,
enable it if your source directory can be static while taking snapshots.
Currently, it affects only CIFS protocol. For more information check the
tree-clone feature in HNAS with <em>man tree-clone</em>.</li>
</ul>
</div>
<div class="section" id="the-manila-share-drivers-hitachi-hnas-driver-module">
<h3>The <code class="xref py py-mod docutils literal"><span class="pre">manila.share.drivers.hitachi.hnas.driver</span></code> Module<a class="headerlink" href="#the-manila-share-drivers-hitachi-hnas-driver-module" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt>
<em class="property">class </em><code class="descname">HitachiHNASDriver</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="share_replication.html#manila.share.driver.ShareDriver" title="manila.share.driver.ShareDriver"><code class="xref py py-class docutils literal"><span class="pre">manila.share.driver.ShareDriver</span></code></a></p>
<p>Manila HNAS Driver implementation.</p>
<p>1.0.0 - Initial Version.
2.0.0 - Refactoring, bugfixes, implemented Share Shrink and Update Access.
3.0.0 - New driver location, implemented support for CIFS protocol.
3.1.0 - Added admin network export location support.</p>
<dl class="method">
<dt>
<code class="descname">create_share</code><span class="sig-paren">(</span><em>context</em>, <em>share</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Creates share.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>context</strong> &#8211; The <cite>context.RequestContext</cite> object for the request</li>
<li><strong>share</strong> &#8211; Share that will be created.</li>
<li><strong>share_server</strong> &#8211; Data structure with share server information.
Not used by this driver.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>Returns a list of dicts containing the EVS IP concatenated
with the path of share in the filesystem.</p>
<p>Example for NFS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[
</pre></div>
</div>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first last">&#8216;path&#8217;: &#8216;172.24.44.10:/shares/id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: False</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>&#8216;path&#8217;: &#8216;192.168.0.10:/shares/id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: True</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
<p>Example for CIFS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[
</pre></div>
</div>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first last">&#8216;path&#8217;: &#8216;172.24.44.10id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: False</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>&#8216;path&#8217;: &#8216;192.168.0.10id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: True</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">create_share_from_snapshot</code><span class="sig-paren">(</span><em>context</em>, <em>share</em>, <em>snapshot</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Creates a new share from snapshot.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>context</strong> &#8211; The <cite>context.RequestContext</cite> object for the request</li>
<li><strong>share</strong> &#8211; Information about the new share.</li>
<li><strong>snapshot</strong> &#8211; Information about the snapshot that will be copied
to new share.</li>
<li><strong>share_server</strong> &#8211; Data structure with share server information.
Not used by this driver.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>Returns a list of dicts containing the EVS IP concatenated
with the path of share in the filesystem.</p>
<p>Example for NFS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[
</pre></div>
</div>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first last">&#8216;path&#8217;: &#8216;172.24.44.10:/shares/id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: False</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>&#8216;path&#8217;: &#8216;192.168.0.10:/shares/id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: True</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
<p>Example for CIFS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[
</pre></div>
</div>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first last">&#8216;path&#8217;: &#8216;172.24.44.10id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: False</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>&#8216;path&#8217;: &#8216;192.168.0.10id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: True</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">create_snapshot</code><span class="sig-paren">(</span><em>context</em>, <em>snapshot</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Creates snapshot.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The <cite>context.RequestContext</cite> object for the request</li>
<li><strong>snapshot</strong> &#8211; Snapshot that will be created.</li>
<li><strong>share_server</strong> &#8211; Data structure with share server information.
Not used by this driver.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">delete_share</code><span class="sig-paren">(</span><em>context</em>, <em>share</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Deletes share.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The <cite>context.RequestContext</cite> object for the request</li>
<li><strong>share</strong> &#8211; Share that will be deleted.</li>
<li><strong>share_server</strong> &#8211; Data structure with share server information.
Not used by this driver.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">delete_snapshot</code><span class="sig-paren">(</span><em>context</em>, <em>snapshot</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Deletes snapshot.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The <cite>context.RequestContext</cite> object for the request</li>
<li><strong>snapshot</strong> &#8211; Snapshot that will be deleted.</li>
<li><strong>share_server</strong> &#8211; Data structure with share server information.
Not used by this driver.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">ensure_share</code><span class="sig-paren">(</span><em>context</em>, <em>share</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Ensure that share is exported.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>context</strong> &#8211; The <cite>context.RequestContext</cite> object for the request</li>
<li><strong>share</strong> &#8211; Share that will be checked.</li>
<li><strong>share_server</strong> &#8211; Data structure with share server information.
Not used by this driver.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>Returns a list of dicts containing the EVS IP concatenated
with the path of share in the filesystem.</p>
<p>Example for NFS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[
</pre></div>
</div>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first last">&#8216;path&#8217;: &#8216;172.24.44.10:/shares/id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: False</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>&#8216;path&#8217;: &#8216;192.168.0.10:/shares/id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: True</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
<p>Example for CIFS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[
</pre></div>
</div>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first last">&#8216;path&#8217;: &#8216;172.24.44.10id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: False</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>&#8216;path&#8217;: &#8216;192.168.0.10id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: True</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">ensure_snapshot</code><span class="sig-paren">(</span><em>context</em>, <em>snapshot</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Ensure that snapshot is exported.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>context</strong> &#8211; The <cite>context.RequestContext</cite> object for the request.</li>
<li><strong>snapshot</strong> &#8211; Snapshot that will be checked.</li>
<li><strong>share_server</strong> &#8211; Data structure with share server information.
Not used by this driver.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>Returns a list of dicts containing the EVS IP concatenated
with the path of snapshot in the filesystem or None if
mount_snapshot_support is False.</p>
<p>Example for NFS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[
</pre></div>
</div>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first last">&#8216;path&#8217;: &#8216;172.24.44.10:/snapshots/id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: False</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>&#8216;path&#8217;: &#8216;192.168.0.10:/snapshots/id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: True</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
<p>Example for CIFS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[
</pre></div>
</div>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first last">&#8216;path&#8217;: &#8216;172.24.44.10id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: False</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>&#8216;path&#8217;: &#8216;192.168.0.10id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: True</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">extend_share</code><span class="sig-paren">(</span><em>share</em>, <em>new_size</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Extends a share to new size.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>share</strong> &#8211; Share that will be extended.</li>
<li><strong>new_size</strong> &#8211; New size of share.</li>
<li><strong>share_server</strong> &#8211; Data structure with share server information.
Not used by this driver.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_network_allocations_number</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Track allocations_number in DHSS = true.</p>
<p>When using the setting driver_handles_share_server = false
does not require to track allocations_number because we do not handle
network stuff.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">manage_existing</code><span class="sig-paren">(</span><em>share</em>, <em>driver_options</em><span class="sig-paren">)</span></dt>
<dd><p>Manages a share that exists on backend.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>share</strong> &#8211; Share that will be managed.</li>
<li><strong>driver_options</strong> &#8211; Empty dict or dict with &#8216;volume_id&#8217; option.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>Returns a dict with size of the share managed and a list of
dicts containing its export locations.</p>
<p>Example for NFS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>{
</pre></div>
</div>
<blockquote>
<div><p>&#8216;size&#8217;: 10,
&#8216;export_locations&#8217;: [</p>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first last">&#8216;path&#8217;: &#8216;172.24.44.10:/shares/id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: False</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>&#8216;path&#8217;: &#8216;192.168.0.10:/shares/id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: True</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>}</p>
<p>Example for CIFS:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>{
</pre></div>
</div>
<blockquote>
<div><p>&#8216;size&#8217;: 10,
&#8216;export_locations&#8217;: [</p>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first last">&#8216;path&#8217;: &#8216;172.24.44.10id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: False</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>&#8216;path&#8217;: &#8216;192.168.0.10id&#8217;,
&#8216;metadata&#8217;: {},
&#8216;is_admin_only&#8217;: True</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>}</p>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">manage_existing_snapshot</code><span class="sig-paren">(</span><em>snapshot</em>, <em>driver_options</em><span class="sig-paren">)</span></dt>
<dd><p>Manages a snapshot that exists only in HNAS.</p>
<p>The snapshot to be managed should be in the path
/snapshots/SHARE_ID/SNAPSHOT_ID. Also, the size of snapshot should be
provided as &#8211;driver_options size=&lt;size&gt;.
:param snapshot: snapshot that will be managed.
:param driver_options: expects only one key &#8216;size&#8217;. It must be
provided in order to manage a snapshot.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Returns a dict with size of snapshot managed</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">revert_to_snapshot</code><span class="sig-paren">(</span><em>context</em>, <em>snapshot</em>, <em>access_rules</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Reverts a share to a given snapshot.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The <cite>context.RequestContext</cite> object for the request</li>
<li><strong>snapshot</strong> &#8211; The snapshot to which the share is to be reverted to.</li>
<li><strong>access_rules</strong> &#8211; List of all access rules for the affected share.
Not used by this driver.</li>
<li><strong>share_server</strong> &#8211; Data structure with share server information.
Not used by this driver.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">shrink_share</code><span class="sig-paren">(</span><em>share</em>, <em>new_size</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Shrinks a share to new size.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>share</strong> &#8211; Share that will be shrunk.</li>
<li><strong>new_size</strong> &#8211; New size of share.</li>
<li><strong>share_server</strong> &#8211; Data structure with share server information.
Not used by this driver.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">snapshot_update_access</code><span class="sig-paren">(</span><em>context</em>, <em>snapshot</em>, <em>access_rules</em>, <em>add_rules</em>, <em>delete_rules</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Update access rules for given snapshot.</p>
<p>Drivers should support 2 different cases in this method:
1. Recovery after error - &#8216;access_rules&#8217; contains all access rules,
&#8216;add_rules&#8217; and &#8216;delete_rules&#8217; shall be empty. Driver should clear any
existent access rules and apply all access rules for given snapshot.
This recovery is made at driver start up.</p>
<p>2. Adding/Deleting of several access rules - &#8216;access_rules&#8217; contains
all access rules, &#8216;add_rules&#8217; and &#8216;delete_rules&#8217; contain rules which
should be added/deleted. Driver can ignore rules in &#8216;access_rules&#8217; and
apply only rules from &#8216;add_rules&#8217; and &#8216;delete_rules&#8217;. All snapshots
rules should be read only.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; Current context</li>
<li><strong>snapshot</strong> &#8211; Snapshot model with snapshot data.</li>
<li><strong>access_rules</strong> &#8211; All access rules for given snapshot</li>
<li><strong>add_rules</strong> &#8211; Empty List or List of access rules which should be
added. access_rules already contains these rules.</li>
<li><strong>delete_rules</strong> &#8211; Empty List or List of access rules which should be
removed. access_rules doesn&#8217;t contain these rules.</li>
<li><strong>share_server</strong> &#8211; None or Share server model</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">unmanage</code><span class="sig-paren">(</span><em>share</em><span class="sig-paren">)</span></dt>
<dd><p>Unmanages a share.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>share</strong> &#8211; Share that will be unmanaged.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">unmanage_snapshot</code><span class="sig-paren">(</span><em>snapshot</em><span class="sig-paren">)</span></dt>
<dd><p>Unmanage a share snapshot</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>snapshot</strong> &#8211; Snapshot that will be unmanaged.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">update_access</code><span class="sig-paren">(</span><em>context</em>, <em>share</em>, <em>access_rules</em>, <em>add_rules</em>, <em>delete_rules</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Update access rules for given share.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The <cite>context.RequestContext</cite> object for the request</li>
<li><strong>share</strong> &#8211; Share that will have its access rules updated.</li>
<li><strong>access_rules</strong> &#8211; All access rules for given share.</li>
<li><strong>add_rules</strong> &#8211; Empty List or List of access rules which should be
added. access_rules already contains these rules.</li>
<li><strong>delete_rules</strong> &#8211; Empty List or List of access rules which should be
removed. access_rules doesn&#8217;t contain these rules.</li>
<li><strong>share_server</strong> &#8211; Data structure with share server information.
Not used by this driver.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="hdfs_native_driver.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: HDFS native driver"></i></a>
          
          
            <a href="hpe_3par_driver.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: HPE 3PAR Driver"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 'Tue Feb 14 14:25:27 2017, commit 610baa2'</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="../_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="../index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#programming-howtos-and-tutorials">Programming HowTos and Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#background-concepts-for-manila">Background Concepts for manila</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#other-resources">Other Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#api-reference">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#module-reference">Module Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#capabilities-and-extra-specs">Capabilities and Extra-Specs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#share-backends-feature-support-mapping">Share backends feature support mapping</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#share-backends">Share backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../man/index.html">Command-Line Utilities</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../adminref/index.html">Admin Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "devref/hitachi_hnas_driver" + ".rst";
        gitURL = "Source: http://git.openstack.org/cgit/openstack/manila/tree/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 610baa2fdb702fa4cc2c12eb5c61599bdcad21ce";
        var bugProject = "manila";
        var bugTitle = "Hitachi NAS Platform File Services Driver for OpenStack in manila";
    var fieldTags = "docs";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 4.0.0.0rc2.dev25 on 'Tue Feb 14 14:25:27 2017, commit 610baa2'";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>