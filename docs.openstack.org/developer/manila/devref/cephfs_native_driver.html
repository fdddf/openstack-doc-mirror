<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: CephFS Native driver</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../_static/css/combined.css" rel="stylesheet">
<link href="../_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>CephFS Native driver</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="glusterfs_native_driver.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: GlusterFS Native driver"></i></a>
    
    
    <a href="gpfs_driver.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: GPFS Driver"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 'Tue Feb 14 14:25:27 2017, commit 610baa2'</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">CephFS Native driver</a><ul>
<li><a class="reference internal" href="#supported-operations">Supported Operations</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#authorize-the-driver-to-communicate-with-ceph">Authorize the driver to communicate with Ceph</a></li>
<li><a class="reference internal" href="#configure-cephfs-backend-in-manila-conf">Configure CephFS backend in manila.conf</a></li>
<li><a class="reference internal" href="#creating-shares">Creating shares</a></li>
<li><a class="reference internal" href="#allowing-access-to-shares">Allowing access to shares</a></li>
<li><a class="reference internal" href="#mounting-shares-using-fuse-client">Mounting shares using FUSE client</a></li>
<li><a class="reference internal" href="#known-restrictions">Known restrictions</a></li>
<li><a class="reference internal" href="#security">Security</a><ul>
<li><a class="reference internal" href="#the-manila-share-drivers-cephfs-cephfs-native-module">The <code class="docutils literal"><span class="pre">manila.share.drivers.cephfs.cephfs_native</span></code> Module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="cephfs-native-driver">
<h1>CephFS Native driver<a class="headerlink" href="#cephfs-native-driver" title="Permalink to this headline">¶</a></h1>
<p>The CephFS Native driver enables manila to export shared filesystems to guests
using the Ceph network protocol.  Guests require a Ceph client in order to
mount the filesystem.</p>
<p>Access is controlled via Ceph&#8217;s cephx authentication system.  When a user
requests share access for an ID, Ceph creates a corresponding Ceph auth ID
and a secret key, if they do not already exist, and authorizes the ID to access
the share.  The client can then mount the share using the ID and the secret
key.</p>
<p>To learn more about configuring Ceph clients to access the shares created
using this driver, please see the Ceph documentation(
<a class="reference external" href="http://docs.ceph.com/docs/master/cephfs/">http://docs.ceph.com/docs/master/cephfs/</a>).  If you choose to use the kernel
client rather than the FUSE client, the share size limits set in manila
may not be obeyed.</p>
<div class="section" id="supported-operations">
<h2>Supported Operations<a class="headerlink" href="#supported-operations" title="Permalink to this headline">¶</a></h2>
<p>The following operations are supported with CephFS backend:</p>
<ul class="simple">
<li>Create/delete CephFS share</li>
<li>Allow/deny CephFS share access<ul>
<li>Only <code class="docutils literal"><span class="pre">cephx</span></code> access type is supported for CephFS protocol.</li>
<li><code class="docutils literal"><span class="pre">read-only</span></code> access level is supported in Newton or later versions
of manila.</li>
<li><code class="docutils literal"><span class="pre">read-write</span></code> access level is supported in Mitaka or later versions
of manila.</li>
</ul>
</li>
<li>Extend/shrink share</li>
<li>Create/delete snapshot</li>
<li>Create/delete consistency group (CG)</li>
<li>Create/delete CG snapshot</li>
</ul>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Mitaka or later versions of manila.</li>
<li>Jewel or later versions of Ceph.</li>
<li>A Ceph cluster with a filesystem configured (
<a class="reference external" href="http://docs.ceph.com/docs/master/cephfs/createfs/">http://docs.ceph.com/docs/master/cephfs/createfs/</a>)</li>
<li><code class="docutils literal"><span class="pre">ceph-common</span></code> package installed in the servers running the
<a class="reference internal" href="../glossary.html#term-manila-share"><span class="xref std std-term">manila-share</span></a> service.</li>
<li>Ceph client installed in the guest, preferably the FUSE based client,
<code class="docutils literal"><span class="pre">ceph-fuse</span></code>.</li>
<li>Network connectivity between your Ceph cluster&#8217;s public network and the
servers running the <a class="reference internal" href="../glossary.html#term-manila-share"><span class="xref std std-term">manila-share</span></a> service.</li>
<li>Network connectivity between your Ceph cluster&#8217;s public network and guests.</li>
</ul>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">A manila share backed onto CephFS is only as good as the
underlying filesystem.  Take care when configuring your Ceph
cluster, and consult the latest guidance on the use of
CephFS in the Ceph documentation (
<a class="reference external" href="http://docs.ceph.com/docs/master/cephfs/">http://docs.ceph.com/docs/master/cephfs/</a>)</p>
</div>
</div>
<div class="section" id="authorize-the-driver-to-communicate-with-ceph">
<h2>Authorize the driver to communicate with Ceph<a class="headerlink" href="#authorize-the-driver-to-communicate-with-ceph" title="Permalink to this headline">¶</a></h2>
<p>Run the following commands to create a Ceph identity for manila to use:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">read -d &#39;&#39; MON_CAPS &lt;&lt; EOF</span>
<span class="go">allow r,</span>
<span class="go">allow command &quot;auth del&quot;,</span>
<span class="go">allow command &quot;auth caps&quot;,</span>
<span class="go">allow command &quot;auth get&quot;,</span>
<span class="go">allow command &quot;auth get-or-create&quot;</span>
<span class="go">EOF</span>

<span class="go">ceph auth get-or-create client.manila -o manila.keyring \</span>
<span class="go">mds &#39;allow *&#39; \</span>
<span class="go">osd &#39;allow rw&#39; \</span>
<span class="go">mon &quot;$MON_CAPS&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">manila.keyring</span></code>, along with your <code class="docutils literal"><span class="pre">ceph.conf</span></code> file, will then need to be
placed on the server running the <a class="reference internal" href="../glossary.html#term-manila-share"><span class="xref std std-term">manila-share</span></a> service.</p>
<p>Enable snapshots in Ceph if you want to use them in manila:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">ceph mds set allow_new_snaps true --yes-i-really-mean-it</span>
</pre></div>
</div>
<p>In the server running the <a class="reference internal" href="../glossary.html#term-manila-share"><span class="xref std std-term">manila-share</span></a> service, you can place the
<code class="docutils literal"><span class="pre">ceph.conf</span></code> and <code class="docutils literal"><span class="pre">manila.keyring</span></code> files in the /etc/ceph directory.  Set the
same owner for the <a class="reference internal" href="../glossary.html#term-manila-share"><span class="xref std std-term">manila-share</span></a> process and the <code class="docutils literal"><span class="pre">manila.keyring</span></code>
file.  Add the following section to the <code class="docutils literal"><span class="pre">ceph.conf</span></code> file.</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[client.manila]</span>
<span class="na">client mount uid</span> <span class="o">=</span> <span class="s">0</span>
<span class="na">client mount gid</span> <span class="o">=</span> <span class="s">0</span>
<span class="na">log file</span> <span class="o">=</span> <span class="s">/opt/stack/logs/ceph-client.manila.log</span>
<span class="na">admin socket</span> <span class="o">=</span> <span class="s">/opt/stack/status/stack/ceph-$name.$pid.asok</span>
<span class="na">keyring</span> <span class="o">=</span> <span class="s">/etc/ceph/manila.keyring</span>
</pre></div>
</div>
<p>It is advisable to modify the Ceph client&#8217;s admin socket file and log file
locations so that they are co-located with manila services&#8217;s pid files and
log files respectively.</p>
</div>
<div class="section" id="configure-cephfs-backend-in-manila-conf">
<h2>Configure CephFS backend in manila.conf<a class="headerlink" href="#configure-cephfs-backend-in-manila-conf" title="Permalink to this headline">¶</a></h2>
<p>Add CephFS to <code class="docutils literal"><span class="pre">enabled_share_protocols</span></code> (enforced at manila api layer).  In
this example we leave NFS and CIFS enabled, although you can remove these
if you will only use CephFS:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="na">enabled_share_protocols</span> <span class="o">=</span> <span class="s">NFS,CIFS,CEPHFS</span>
</pre></div>
</div>
<p>Create a section like this to define a CephFS backend:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[cephfs1]</span>
<span class="na">driver_handles_share_servers</span> <span class="o">=</span> <span class="s">False</span>
<span class="na">share_backend_name</span> <span class="o">=</span> <span class="s">CEPHFS1</span>
<span class="na">share_driver</span> <span class="o">=</span> <span class="s">manila.share.drivers.cephfs.cephfs_native.CephFSNativeDriver</span>
<span class="na">cephfs_conf_path</span> <span class="o">=</span> <span class="s">/etc/ceph/ceph.conf</span>
<span class="na">cephfs_auth_id</span> <span class="o">=</span> <span class="s">manila</span>
<span class="na">cephfs_cluster_name</span> <span class="o">=</span> <span class="s">ceph</span>
<span class="na">cephfs_enable_snapshots</span> <span class="o">=</span> <span class="s">True</span>
</pre></div>
</div>
<p>Set <code class="docutils literal"><span class="pre">driver-handles-share-servers</span></code> to <code class="docutils literal"><span class="pre">False</span></code> as the driver does not
manage the lifecycle of <code class="docutils literal"><span class="pre">share-servers</span></code>.  To let the driver perform snapshot
related operations, set <code class="docutils literal"><span class="pre">cephfs_enable_snapshots</span></code> to True.</p>
<p>Then edit <code class="docutils literal"><span class="pre">enabled_share_backends</span></code> to point to the driver&#8217;s backend section
using the section name.  In this example we are also including another backend
(&#8220;generic1&#8221;), you would include whatever other backends you have configured.</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="na">enabled_share_backends</span> <span class="o">=</span> <span class="s">generic1, cephfs1</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-shares">
<h2>Creating shares<a class="headerlink" href="#creating-shares" title="Permalink to this headline">¶</a></h2>
<p>The default share type may have <code class="docutils literal"><span class="pre">driver_handles_share_servers</span></code> set to True.
Configure a share type suitable for cephfs:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">manila type-create cephfstype false</span>
</pre></div>
</div>
<p>Then create yourself a share:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">manila create --share-type cephfstype --name cephshare1 cephfs 1</span>
</pre></div>
</div>
<p>Note the export location of the share:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">manila share-export-location-list cephshare1</span>
</pre></div>
</div>
<p>The export location of the share contains the Ceph monitor (mon) addresses and
ports, and the path to be mounted.  It is of the form,
<code class="docutils literal"><span class="pre">{mon</span> <span class="pre">ip</span> <span class="pre">addr:port}[,{mon</span> <span class="pre">ip</span> <span class="pre">addr:port}]:{path</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">mounted}</span></code></p>
</div>
<div class="section" id="allowing-access-to-shares">
<h2>Allowing access to shares<a class="headerlink" href="#allowing-access-to-shares" title="Permalink to this headline">¶</a></h2>
<p>Allow Ceph auth ID <code class="docutils literal"><span class="pre">alice</span></code> access to the share using <code class="docutils literal"><span class="pre">cephx</span></code> access type.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">manila access-allow cephshare1 cephx alice</span>
</pre></div>
</div>
<p>Note the access status, and the access/secret key of <code class="docutils literal"><span class="pre">alice</span></code>.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">manila access-list cephshare1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In Mitaka release, the secret key is not exposed by any manila API.  The
Ceph storage admin needs to pass the secret key to the guest out of band of
manila.  You can refer to the link below to see how the storage admin
could obtain the secret key of an ID.
<a class="reference external" href="http://docs.ceph.com/docs/jewel/rados/operations/user-management/#get-a-user">http://docs.ceph.com/docs/jewel/rados/operations/user-management/#get-a-user</a></p>
<p>Alternatively, the cloud admin can create Ceph auth IDs for each of the
tenants.  The users can then request manila to authorize the pre-created
Ceph auth IDs, whose secret keys are already shared with them out of band
of manila, to access the shares.</p>
<p>Following is a command that the cloud admin could run from the
server running the <a class="reference internal" href="../glossary.html#term-manila-share"><span class="xref std std-term">manila-share</span></a> service to create a Ceph auth ID
and get its keyring file.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">ceph --name=client.manila --keyring=/etc/ceph/manila.keyring auth \</span>
<span class="go">get-or-create client.alice -o alice.keyring</span>
</pre></div>
</div>
<p class="last">For more details, please see the Ceph documentation.
<a class="reference external" href="http://docs.ceph.com/docs/jewel/rados/operations/user-management/#add-a-user">http://docs.ceph.com/docs/jewel/rados/operations/user-management/#add-a-user</a></p>
</div>
</div>
<div class="section" id="mounting-shares-using-fuse-client">
<h2>Mounting shares using FUSE client<a class="headerlink" href="#mounting-shares-using-fuse-client" title="Permalink to this headline">¶</a></h2>
<p>Using the secret key of the authorized ID <code class="docutils literal"><span class="pre">alice</span></code> create a keyring file,
<code class="docutils literal"><span class="pre">alice.keyring</span></code> like:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[client.alice]</span>
        <span class="na">key</span> <span class="o">=</span> <span class="s">AQA8+ANW/4ZWNRAAOtWJMFPEihBA1unFImJczA==</span>
</pre></div>
</div>
<p>Using the mon IP addresses from the share&#8217;s export location, create a
configuration file, <code class="docutils literal"><span class="pre">ceph.conf</span></code> like:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[client]</span>
        <span class="na">client quota</span> <span class="o">=</span> <span class="s">true</span>
<span class="s">        mon host = 192.168.1.7:6789, 192.168.1.8:6789, 192.168.1.9:6789</span>
</pre></div>
</div>
<p>Finally, mount the filesystem, substituting the filenames of the keyring and
configuration files you just created, and substituting the path to be mounted
from the share&#8217;s export location:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">sudo ceph-fuse ~/mnt \</span>
<span class="go">--id=alice \</span>
<span class="go">--conf=./ceph.conf \</span>
<span class="go">--keyring=./alice.keyring \</span>
<span class="go">--client-mountpoint=/volumes/_nogroup/4c55ad20-9c55-4a5e-9233-8ac64566b98c</span>
</pre></div>
</div>
</div>
<div class="section" id="known-restrictions">
<h2>Known restrictions<a class="headerlink" href="#known-restrictions" title="Permalink to this headline">¶</a></h2>
<p>Consider the driver as a building block for supporting multi-tenant
workloads in the future.  However, it can be used in private cloud
deployments.</p>
<ul class="simple">
<li>The guests have direct access to Ceph&#8217;s public network.</li>
<li>The snapshot support of the driver is disabled by default.
<code class="docutils literal"><span class="pre">cephfs_enable_snapshots</span></code> configuration option needs to be set to <code class="docutils literal"><span class="pre">True</span></code>
to allow snapshot operations.</li>
<li>Snapshots are read-only.  A user can read a snapshot&#8217;s contents from the
<code class="docutils literal"><span class="pre">.snap/{manila-snapshot-id}_{unknown-id}</span></code> folder within the mounted
share.</li>
<li>To restrict share sizes, CephFS uses quotas that are enforced in the client
side.  The CephFS clients are relied on to respect quotas.</li>
</ul>
<p>Mitaka release</p>
<ul class="simple">
<li>The secret-key of a Ceph auth ID required to mount a share is not exposed to
an user by a manila API.  To workaround this, the storage admin would need to
pass the key out of band of manila, or the user would need to use the Ceph ID
and key already created and shared with her by the cloud admin.</li>
</ul>
</div>
<div class="section" id="security">
<h2>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Each share&#8217;s data is mapped to a distinct Ceph RADOS namespace.  A guest is
restricted to access only that particular RADOS namespace.
<a class="reference external" href="http://docs.ceph.com/docs/master/cephfs/file-layouts/">http://docs.ceph.com/docs/master/cephfs/file-layouts/</a></p>
</li>
<li><p class="first">An additional level of resource isolation can be provided by mapping a
share&#8217;s contents to a separate RADOS pool.  This layout would be be preferred
only for cloud deployments with a limited number of shares needing strong
resource separation.  You can do this by setting a share type specification,
<code class="docutils literal"><span class="pre">cephfs:data_isolated</span></code> for the share type used by the cephfs driver.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">manila type-key cephfstype set cephfs:data_isolated=True</span>
</pre></div>
</div>
</li>
<li><p class="first">As mentioned earlier, untrusted manila guests pose security risks to the
Ceph storage cluster as they would have direct access to the cluster&#8217;s
public network.</p>
</li>
</ul>
<div class="section" id="the-manila-share-drivers-cephfs-cephfs-native-module">
<h3>The <code class="xref py py-mod docutils literal"><span class="pre">manila.share.drivers.cephfs.cephfs_native</span></code> Module<a class="headerlink" href="#the-manila-share-drivers-cephfs-cephfs-native-module" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt>
<em class="property">class </em><code class="descname">CephFSNativeDriver</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="share_replication.html#manila.share.driver.ShareDriver" title="manila.share.driver.ShareDriver"><code class="xref py py-class docutils literal"><span class="pre">manila.share.driver.ShareDriver</span></code></a></p>
<p>Driver for the Ceph Filesystem.</p>
<p>This driver is &#8216;native&#8217; in the sense that it exposes a CephFS filesystem
for use directly by guests, with no intermediate layer like NFS.</p>
<dl class="method">
<dt>
<code class="descname">check_for_setup_error</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">create_share</code><span class="sig-paren">(</span><em>context</em>, <em>share</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd><p>Create a CephFS volume.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>context</strong> &#8211; A RequestContext.</li>
<li><strong>share</strong> &#8211; A Share.</li>
<li><strong>share_server</strong> &#8211; Always None for CephFS native.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The export locations dictionary.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">create_share_group</code><span class="sig-paren">(</span><em>context</em>, <em>cg_dict</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">create_share_group_snapshot</code><span class="sig-paren">(</span><em>context</em>, <em>snap_dict</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">create_snapshot</code><span class="sig-paren">(</span><em>context</em>, <em>snapshot</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">delete_share</code><span class="sig-paren">(</span><em>context</em>, <em>share</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">delete_share_group</code><span class="sig-paren">(</span><em>context</em>, <em>cg_dict</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">delete_share_group_snapshot</code><span class="sig-paren">(</span><em>context</em>, <em>snap_dict</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">delete_snapshot</code><span class="sig-paren">(</span><em>context</em>, <em>snapshot</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">ensure_share</code><span class="sig-paren">(</span><em>context</em>, <em>share</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">extend_share</code><span class="sig-paren">(</span><em>share</em>, <em>new_size</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">shrink_share</code><span class="sig-paren">(</span><em>share</em>, <em>new_size</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">supported_protocols</code><em class="property"> = ('CEPHFS',)</em></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">update_access</code><span class="sig-paren">(</span><em>context</em>, <em>share</em>, <em>access_rules</em>, <em>add_rules</em>, <em>delete_rules</em>, <em>share_server=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">volume_client</code></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="glusterfs_native_driver.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: GlusterFS Native driver"></i></a>
          
          
            <a href="gpfs_driver.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: GPFS Driver"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 'Tue Feb 14 14:25:27 2017, commit 610baa2'</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="../_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="../index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#programming-howtos-and-tutorials">Programming HowTos and Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#background-concepts-for-manila">Background Concepts for manila</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#other-resources">Other Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#api-reference">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#module-reference">Module Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#capabilities-and-extra-specs">Capabilities and Extra-Specs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#share-backends-feature-support-mapping">Share backends feature support mapping</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#share-backends">Share backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../man/index.html">Command-Line Utilities</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../adminref/index.html">Admin Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "devref/cephfs_native_driver" + ".rst";
        gitURL = "Source: http://git.openstack.org/cgit/openstack/manila/tree/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 610baa2fdb702fa4cc2c12eb5c61599bdcad21ce";
        var bugProject = "manila";
        var bugTitle = "CephFS Native driver in manila";
    var fieldTags = "docs";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 4.0.0.0rc2.dev25 on 'Tue Feb 14 14:25:27 2017, commit 610baa2'";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>