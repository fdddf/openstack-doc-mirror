<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Application development framework &mdash; Murano</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.1.1.dev17',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Murano" href="../index.html" />
    <link rel="up" title="Application Developer Guide" href="developer_index.html" />
    <link rel="next" title="Application developer’s cookbook" href="app_debugging.html" />
    <link rel="prev" title="Use-cases" href="use_cases.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="application-development-framework">
<span id="app-development-framework"></span><h1>Application development framework<a class="headerlink" href="#application-development-framework" title="Permalink to this headline">¶</a></h1>
<p>Application development framework is a library that helps application
developers to create applications that can be scalable, highly available,
(self)healable and do not contain boilerplate code for common application
workflow operations. This library is placed into the Murano repository under
the <code class="docutils literal"><span class="pre">meta/io.murano.applications</span></code> folder.</p>
<p>To allow your applications to use the code of the library, zip it and upload
to the Murano application catalog.</p>
<div class="section" id="framework-objectives">
<h2>Framework objectives<a class="headerlink" href="#framework-objectives" title="Permalink to this headline">¶</a></h2>
<p>The library allows application developers to focus on their
application-specific tasks without the real need to dive into resource
orchestration, server farm configuration, and so on. For example, on how to
install the software on the VMs, how to configure it to interact with other
applications. Application developers are able to focus more on the software
configuration tools (scripts, puppets, and others) and care less about the
MuranoPL if they do not need to define any custom workflow logic.</p>
<p>The main capabilities the library provides and its main use-cases are as
follows:</p>
<ul class="simple">
<li>Standard operations are implemented in the framework and can be left as is</li>
<li>The capability to create multi-server applications and scale them</li>
<li>The capability to create composite multi-component applications</li>
<li>The capability to track application failures and recover from them</li>
<li>The capability to define event handlers for various events</li>
</ul>
</div>
<div class="section" id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h2>
<p>To use the framework in your application, include the following lines to the
<code class="docutils literal"><span class="pre">manifest.yaml</span></code> file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Require</span><span class="p p-Indicator">:</span>
 <span class="l l-Scalar l-Scalar-Plain">io.murano.applications</span><span class="p p-Indicator">:</span>
</pre></div>
</div>
<div class="section" id="create-a-one-component-single-server-application">
<h3>Create a one-component single-server application<a class="headerlink" href="#create-a-one-component-single-server-application" title="Permalink to this headline">¶</a></h3>
<p><strong>To create a simple application deployed on a single server</strong>:</p>
<ol class="arabic">
<li><p class="first">Include the following lines to the code of the application class:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Namespaces</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">=</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my.new.ns</span>
  <span class="l l-Scalar l-Scalar-Plain">apps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.applications</span>

<span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AppName</span>
<span class="l l-Scalar l-Scalar-Plain">Extends</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">apps:SingleServerApplication</span>
</pre></div>
</div>
</li>
<li><p class="first">Provide an input for the application <code class="docutils literal"><span class="pre">server</span></code> property in your
<code class="docutils literal"><span class="pre">ui.yaml</span></code> file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Application</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my.new.ns.AppName</span>
  <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.resources.LinuxMuranoInstance</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">generateHostname($.instanceConfiguration.unitNamingPattern, 1)</span>
    <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.flavor</span>
    <span class="l l-Scalar l-Scalar-Plain">... &lt;other instance properties&gt;</span>
</pre></div>
</div>
<p>Now you already have the app that creates a server ready for installing
software on it.</p>
</li>
<li><p class="first">To create a fully functional app, add an installation script to the body
of the <code class="docutils literal"><span class="pre">onInstallServer</span></code> method:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Methods</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">onInstallServer</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Arguments</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">server</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.class(res:Instance).notNull()</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">serverGroup</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.class(apps:ServerGroup).notNull()</span>
    <span class="l l-Scalar l-Scalar-Plain">Body</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$file</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sys:Resources.string(&#39;installScript.sh&#39;)</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">conf:Linux.runCommand($server.agent, $file)</span>
</pre></div>
</div>
</li>
<li><p class="first">Optional. Add other methods that handle certain stages of the application
workflow, such as <code class="docutils literal"><span class="pre">onBeforeInstall</span></code>, <code class="docutils literal"><span class="pre">onCompleteInstallation</span></code>,
<code class="docutils literal"><span class="pre">onConfigureServer</span></code>, <code class="docutils literal"><span class="pre">onCompleteConfiguration</span></code>, and others. For details
about these methods, see the
<a class="reference internal" href="#software-components"><span>Software components</span></a> section.</p>
</li>
</ol>
</div>
<div class="section" id="create-a-one-component-multi-server-application">
<h3>Create a one-component multi-server application<a class="headerlink" href="#create-a-one-component-multi-server-application" title="Permalink to this headline">¶</a></h3>
<p><strong>To create an application that is intended to be installed on several servers</strong>:</p>
<ol class="arabic">
<li><p class="first">Make it inherit the <code class="docutils literal"><span class="pre">MultiServerApplication</span></code> class:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Namespaces</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">=</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my.new.ns</span>
  <span class="l l-Scalar l-Scalar-Plain">apps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.applications</span>

<span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AppName</span>
<span class="l l-Scalar l-Scalar-Plain">Extends</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">apps:MultiServerApplication</span>
</pre></div>
</div>
</li>
<li><p class="first">Instead of the <code class="docutils literal"><span class="pre">server</span></code> property in <code class="docutils literal"><span class="pre">SingleServerApplication</span></code>, provide
an input for the <code class="docutils literal"><span class="pre">servers</span></code> property that accepts the instance of one of
the inheritors of the <code class="docutils literal"><span class="pre">ServerGroup</span></code> class. The <code class="docutils literal"><span class="pre">ui.yaml</span></code> file in this
case may look as follows:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Application</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my.new.ns.AppName</span>
  <span class="l l-Scalar l-Scalar-Plain">servers</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.applications.ServerList</span>
    <span class="l l-Scalar l-Scalar-Plain">servers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.resources.LinuxMuranoInstance</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;Server-1&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.flavor</span>
        <span class="l l-Scalar l-Scalar-Plain">... &lt;other instance properties&gt;</span>

      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.resources.LinuxMuranoInstance</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;Server-2&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.flavor</span>
        <span class="l l-Scalar l-Scalar-Plain">... &lt;other instance properties&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Define the custom logic of the application in the handler methods, and it
will be applied to the whole app, exactly like with
<code class="docutils literal"><span class="pre">SingleServerApplication</span></code>.</p>
</li>
</ol>
</div>
<div class="section" id="create-a-scalable-multi-server-application">
<h3>Create a scalable multi-server application<a class="headerlink" href="#create-a-scalable-multi-server-application" title="Permalink to this headline">¶</a></h3>
<p><strong>To provide the application with the ability to scale</strong>:</p>
<ol class="arabic">
<li><p class="first">Make the app extend the <code class="docutils literal"><span class="pre">MultiServerApplicationWithScaling</span></code> class:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Namespaces</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">=</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my.new.ns</span>
  <span class="l l-Scalar l-Scalar-Plain">apps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.applications</span>

<span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AppName</span>
<span class="l l-Scalar l-Scalar-Plain">Extends</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">apps:MultiServerApplicationWithScaling</span>
</pre></div>
</div>
</li>
<li><p class="first">Provide the <code class="docutils literal"><span class="pre">ui.yaml</span></code> file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Application</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my.new.ns.AppName</span>
  <span class="l l-Scalar l-Scalar-Plain">servers</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.applications.ServerReplicationGroup</span>
    <span class="l l-Scalar l-Scalar-Plain">numItems</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.appConfiguration.numNodes</span>
    <span class="l l-Scalar l-Scalar-Plain">provider</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.applications.TemplateServerProvider</span>
      <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.resources.LinuxMuranoInstance</span>
        <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.flavor</span>
        <span class="l l-Scalar l-Scalar-Plain">... &lt;other instance properties&gt;</span>
      <span class="l l-Scalar l-Scalar-Plain">serverNamePattern</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.unitNamingPattern</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">servers</span></code> property accepts instance of the <code class="docutils literal"><span class="pre">ServerReplicationGroup</span></code>
class, and in turn it requires input of the <code class="docutils literal"><span class="pre">numItems</span></code> and <code class="docutils literal"><span class="pre">provider</span></code>
properties.</p>
</li>
</ol>
<p>After the deployment, the <code class="docutils literal"><span class="pre">scaleOut</span></code> and <code class="docutils literal"><span class="pre">scaleIn</span></code> public methods
(actions) become available in the dashboard UI.</p>
<p>For a working example of such application, see the
<code class="docutils literal"><span class="pre">com.example.apache.ApacheHttpServer</span></code> package version 1.0.0.</p>
</div>
</div>
<div class="section" id="library-overview">
<h2>Library overview<a class="headerlink" href="#library-overview" title="Permalink to this headline">¶</a></h2>
<p>The framework includes several groups of classes:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal"><span class="pre">replication.yaml</span></code></dt>
<dd>Classes that provide the capability to replicate the resources.</dd>
<dt><code class="docutils literal"><span class="pre">servers.yaml</span></code></dt>
<dd>Classes that provide instances grouping and replication.</dd>
<dt><code class="docutils literal"><span class="pre">component.yaml</span></code></dt>
<dd>Classes that define common application workflows.</dd>
<dt><code class="docutils literal"><span class="pre">events.yaml</span></code></dt>
<dd>Class for handling events.</dd>
<dt><code class="docutils literal"><span class="pre">baseapps.yaml</span></code></dt>
<dd>Base classes for applications.</dd>
</dl>
</div></blockquote>
<p>As it is described in the <a class="reference internal" href="../enduser-guide/quickstart/quickstart.html#quickstart"><span>QuickStart</span></a> section, the application makes use
of the Application development framework by inheriting from one of the base
application classes, such as <code class="docutils literal"><span class="pre">SingleServerApplication</span></code>,
<code class="docutils literal"><span class="pre">MultiServerApplication</span></code>, <code class="docutils literal"><span class="pre">MultiServerApplicationWithScaling</span></code>. In turn,
these classes are inheritors of the standard <code class="docutils literal"><span class="pre">Application</span></code> class and the
<code class="docutils literal"><span class="pre">SoftwareComponent</span></code> class. The latter class binds all of the framework
capabilities.</p>
<p>The <code class="docutils literal"><span class="pre">SoftwareComponent</span></code> class inherits both <code class="docutils literal"><span class="pre">Installable</span></code> and
<code class="docutils literal"><span class="pre">Configurable</span></code> classes which provide boilerplate code for the installation
and configuration workflow respectively. They also contain empty methods
for each stage of the workflow (e.g. <code class="docutils literal"><span class="pre">onBeforeInstall</span></code>, <code class="docutils literal"><span class="pre">onInstallServer</span></code>),
which are the places where application developers can add their own
customization code.</p>
<p>The entry point to execute deployment of the software component is its
<code class="docutils literal"><span class="pre">deployAt</span></code> method which requires instance of one of the inheritors of the
<code class="docutils literal"><span class="pre">serverGroup</span></code>  class. It is the object representing the group of servers
the application should be deployed to. The application holds such an object as
one of its properties. It can be a single server (<code class="docutils literal"><span class="pre">SingleServerGroup</span></code>
subclass), a prepopulated list of servers (<code class="docutils literal"><span class="pre">ServerList</span></code> subclass) or a list
of servers that are dynamically generated in runtime
(<code class="docutils literal"><span class="pre">ServerReplicationGroup</span></code> subclass).</p>
<p><code class="docutils literal"><span class="pre">ServerReplicationGroup</span></code> or, more precisely, one of its parent classes
<code class="docutils literal"><span class="pre">ReplicationGroup</span></code> controls the number of items it holds by releasing items
over the required amount and requesting creation of the new items in runtime
from the <code class="docutils literal"><span class="pre">ReplicaProvider</span></code> class which acts like an object factory. In case
of servers, it is <code class="docutils literal"><span class="pre">TemplateServerProvider</span></code> which creates new servers from the
given template. Replication is done during the initial deployment and during
the scaling actions execution.</p>
</div>
<div class="section" id="framework-detailed-description">
<h2>Framework detailed description<a class="headerlink" href="#framework-detailed-description" title="Permalink to this headline">¶</a></h2>
<p>This section provides technical description of all the classes present in the
application development library, their hierarchy and usage.</p>
<div class="section" id="scaling-primitives">
<h3>Scaling primitives<a class="headerlink" href="#scaling-primitives" title="Permalink to this headline">¶</a></h3>
<p>There is an ability to group similar resources together, produce new copies
of the same resources or release the existing ones on request. Now it is
implemented for instances only, other resources may be added later.</p>
<p>The following is the hierarchy of classes that provide grouping and
replication of resources:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>+-------+
| +-------+
| | +--------+        +------------------+        +-----------------+
| | |        |        |                  |        |                 |
+-+ | Object &lt;--------+ ReplicationGroup +--------&gt; ReplicaProvider |
  +-+        |        |                  |        |                 |
    +--------+        +---+--------------+        +-+--------+------+
                          ^                         ^        ^
                          |                         |        |
                          |      +------------------+-----+  |
                          |      |                        |  |
+-------+                 |      |  CloneReplicaProvider  |  |
| +-------+               |      |        + other         |  |
| | +----------+          |      +------------------------+  |
| | |          |          |                                  |
+-+ | Instance |          |                                  |
  +-+          |          |                                  |
    +----+-----+          |                                  |
         |                |                                  |
   +-----+-------+        |                                  |
   |             |        |                                  |
   | ServerGroup |        |                  +---------------+--+
   |             |        |                  |     Template     |
   +-----^-------+    +---+----------+       |      Server      +--+
         |            |    Server    +-------&gt;     Provider     |  |
         +------------+  Replication |       +-----+------------+  +---+
                      |    Group     |             |               |   |
                      +--------------+             +---+---other---+   |
                                                       |               |
                                                       +---------------+
</pre></div>
</div>
<p><strong>ReplicationGroup</strong></p>
<blockquote>
<div><p>A base class which holds the collection of objects generated in runtime in
its <code class="docutils literal"><span class="pre">items</span></code> output property and contains a reference to a
<code class="docutils literal"><span class="pre">ReplicaProvider</span></code> object in its <code class="docutils literal"><span class="pre">provider</span></code> property which is used to
dynamically generate the objects in runtime.</p>
<p>Input properties of this class include the <code class="docutils literal"><span class="pre">minItems</span></code> and <code class="docutils literal"><span class="pre">maxItems</span></code>
allowing to limit the number of objects it holds in its collection.</p>
<p>An input-output property <code class="docutils literal"><span class="pre">numItems</span></code> allows to declaratively change the
set of objects in the collection by setting its size.</p>
<p>The <code class="docutils literal"><span class="pre">deploy()</span></code> method is used to apply the replica settings: it drops
the objects from the collection if their number exceeds the number
specified by the <code class="docutils literal"><span class="pre">numItems</span></code> or generate some new if there are not enough
of them.</p>
<p>The <code class="docutils literal"><span class="pre">scale()</span></code> method is used to increase or decrease the <code class="docutils literal"><span class="pre">numItems</span></code> by
some number specified in the <code class="docutils literal"><span class="pre">delta</span></code> argument of the method, but in
range between <code class="docutils literal"><span class="pre">maxItems</span></code> and <code class="docutils literal"><span class="pre">minItems</span></code>.</p>
</div></blockquote>
<p><strong>ReplicaProvider</strong></p>
<blockquote>
<div><p>A class which does the object replication. The base one is abstract, its
inheritors should implement the abstract <code class="docutils literal"><span class="pre">createReplica</span></code> method to
create the actual object. The method accepts the <code class="docutils literal"><span class="pre">index</span></code> parameter to
properly parametrize the newly created copy and optional <code class="docutils literal"><span class="pre">owner</span></code>
parameter to use it as an owner for the newly created objects.</p>
<p>The concrete implementations of this class should define all the input
properties needed to create new instances of object. Thus the provider
actually acts as a template of the object it generates.</p>
</div></blockquote>
<p><strong>CloneReplicaProvider</strong></p>
<blockquote>
<div>An implementation of <code class="docutils literal"><span class="pre">ReplicaProvider</span></code> capable to create replicas by
cloning some user-provided object, making use of the <code class="docutils literal"><span class="pre">template()</span></code>
contract.</div></blockquote>
<p><strong>PoolReplicaProvider</strong></p>
<blockquote>
<div>Replica provider that takes replicas from the prepopulated pool instead
of creating them.</div></blockquote>
<p><strong>RoundrobinReplicaProvider</strong></p>
<blockquote>
<div>Replica provider with a load balancing that returns replica from the
prepopulated list. Once the provider runs out of free items it goes to the
beginning of the list and returns the same replicas again.</div></blockquote>
<p><strong>CompositeReplicaProvider</strong></p>
<blockquote>
<div><p>Replica provider which is a composition of other replica providers. It
holds the collection of providers in its <code class="docutils literal"><span class="pre">providers</span></code> input property.
Its <code class="docutils literal"><span class="pre">ReplicaProvider</span></code> method returns a new replica created by the first
provider in that list. If that value is <cite>null</cite>, the replica created by the
second provider is returned, and so on. If no not-null replicas are
created by all providers, the method returns null.</p>
<p>This provider can be used to have some default provider with the ability
to fall back to the next options if the preferable one is not successful.</p>
</div></blockquote>
</div>
<div class="section" id="servers-replication">
<h3>Servers replication<a class="headerlink" href="#servers-replication" title="Permalink to this headline">¶</a></h3>
<p><strong>ServerGroup</strong></p>
<blockquote>
<div><p>A class that provides static methods for deployment and releasing
resources on the group of instances.</p>
<p>The <code class="docutils literal"><span class="pre">deployServers()</span></code> static method accepts instance of <code class="docutils literal"><span class="pre">ServerGroup</span></code>
class and a list of servers as the parameters and deploys all servers from
the list in the environment which owns the server group, unless server is
already deployed.</p>
<p>The <code class="docutils literal"><span class="pre">releaseServers()</span></code> static method accepts a list of servers as the
parameter and consequentially calls <code class="docutils literal"><span class="pre">beginReleaseResources()</span></code> and
<code class="docutils literal"><span class="pre">endReleaseResources()</span></code> methods on each server.</p>
</div></blockquote>
<p><strong>ServerList</strong></p>
<blockquote>
<div><p>A class that extends the <code class="docutils literal"><span class="pre">ServerGroup</span></code> class and holds a group of
prepopulated servers in its <code class="docutils literal"><span class="pre">servers</span></code> input property.</p>
<p>The <code class="docutils literal"><span class="pre">deploy()</span></code> method calls the <code class="docutils literal"><span class="pre">deployServers()</span></code> method with the
servers defined in the <code class="docutils literal"><span class="pre">servers</span></code> property.</p>
<p>The <code class="docutils literal"><span class="pre">.destroy()</span></code> method calls the <code class="docutils literal"><span class="pre">releaseServers()</span></code> method with the
servers defined in the <code class="docutils literal"><span class="pre">servers</span></code> property.</p>
</div></blockquote>
<p><strong>SingleServerGroup</strong></p>
<blockquote>
<div>Degenerate case of a <code class="docutils literal"><span class="pre">ServerGroup</span></code> which consists of a single server.
Has the <code class="docutils literal"><span class="pre">server</span></code> input property to hold a single server.</div></blockquote>
<p><strong>CompositeServerGroup</strong></p>
<blockquote>
<div>A server group that is composed of other server groups.</div></blockquote>
<p><strong>ServerReplicationGroup</strong></p>
<blockquote>
<div><p>A subclass of the <code class="docutils literal"><span class="pre">ReplicationGroup</span></code> class and the <code class="docutils literal"><span class="pre">ServerGroup</span></code>
class to replicate the <code class="docutils literal"><span class="pre">Instance</span></code> objects it holds.</p>
<p>The <code class="docutils literal"><span class="pre">deploy()</span></code> method of this group not only generates new instances of
servers but also deploys them if needed.</p>
</div></blockquote>
<p><strong>TemplateServerProvider</strong></p>
<blockquote>
<div><p>A subclass of <code class="docutils literal"><span class="pre">ReplicaProvider</span></code> which is used to produce the objects
of one of the <code class="docutils literal"><span class="pre">Instance</span></code> class inheritors by creating them from the
provided template with parameterization of the hostnames. The resulting
hostname looks like &#8216;Server {index}{groupName}&#8217;.</p>
<p>May be passed as <code class="docutils literal"><span class="pre">provider</span></code> property to objects of the
<code class="docutils literal"><span class="pre">ServerReplicationGroup</span></code> class.</p>
</div></blockquote>
<p><strong>other replica providers</strong></p>
<blockquote>
<div>Other subclasses of <code class="docutils literal"><span class="pre">ReplicaProvider</span></code> may be created to produce different
objects of <code class="docutils literal"><span class="pre">Instance</span></code> class and its subclasses depending on particular
application needs.</div></blockquote>
<p>Classes for grouping and replication of other kinds of resources are to be
implemented later.</p>
</div>
<div class="section" id="software-components">
<span id="id1"></span><h3>Software Components<a class="headerlink" href="#software-components" title="Permalink to this headline">¶</a></h3>
<p>The class to handle the lifecycle of the application is the
<code class="docutils literal"><span class="pre">SoftwareComponent</span></code> class which is a subclass of <code class="docutils literal"><span class="pre">Installable</span></code> and
<code class="docutils literal"><span class="pre">Configurable</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>+-----------+-+           +-+------------+
|             |           |              |
| Installable |           | Configurable |
|             |           |              |
+-----------+-+           +-+------------+
            ^               ^
            |               |
            |               |
          +-+---------------+-+
          |                   |
          | SoftwareComponent |
          |                   |
          +-------------------+
</pre></div>
</div>
<p>The hierarchy of the <code class="docutils literal"><span class="pre">SoftwareComponent</span></code> classes is used to define the
workflows of different application lifecycles. The general logic of the
application behaviour is contained in the methods of the base classes and
the derived classes are able to implement the handlers for the custom logic.
The model is event-driven: the workflow consists of the multiple steps, and
most of the steps invoke appropriate <cite>on%StepName%</cite> methods intended to
provide application-specific logic.</p>
<p>Now &#8216;internal&#8217; steps logic and their &#8216;public&#8217; handlers are split into the
separate methods. It should improve the developers&#8217; experience and simplify
the code of the derived classes.</p>
<p>The standard workflows (such as Installation and Configuration) are defined
by the <code class="docutils literal"><span class="pre">Installable</span></code> and <code class="docutils literal"><span class="pre">Configurable</span></code> classes respectively. The
<code class="docutils literal"><span class="pre">SoftwareComponent</span></code> class inherits both these classes and defines its
deployment workflow as a sequence of Installation and Configuration flows.
Other future implementations may add new workflow interfaces and mix them in
to change the deployment workflow or add new actions.</p>
<p><strong>Installation</strong> workflow consists of the following methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>+----------------------------------------------------------------------------------------------------------------------+
| INSTALL                                                                                                              |
|                                                                                                                      |
|      +------------------------------+                               +---------------+                                |
|    +------------------------------+ |                             +---------------+ |                                |
|  +------------------------------+ | |      +---------------+    +---------------+ | |      +----------------------+  |
|  |                              | | |      |               |    |               | | |      |                      |  |
|  |    checkServerIsInstalled    | +-+ +----&gt; beforeInstall +----&gt; installServer | +-+ +----&gt; completeInstallation |  |
|  |                              +-+        |               |    |               +-+        |                      |  |
|  +------------------------------+          +------+--------+    +------+--------+          +-----------+----------+  |
|                                                   |                    |                               |             |
+----------------------------------------------------------------------------------------------------------------------+
                                                    |                    |                               |
                                                    |                    |                               |
                                                    |                    |                               |
                                                    v                    v                               v
                                              onBeforeInstall      onInstallServer              onCompleteInstallation
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Arguments</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>install</strong></td>
<td><code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Entry point of the installation workflow.
Iterates through all the servers of the passed ServerGroup and calls the
<code class="docutils literal"><span class="pre">checkServerIsInstalled</span></code> method for each of them. If at least one
of the calls has returned <cite>false</cite>, calls a <code class="docutils literal"><span class="pre">beforeInstall</span></code> method.
Then, for each server which returned <cite>false</cite> as the result of the
<code class="docutils literal"><span class="pre">checkServerIsInstalled</span></code> calls the <code class="docutils literal"><span class="pre">installServer</span></code> method to do
the actual software installation.
After the installation is completed on all the servers and if at
least one of the previous calls of <code class="docutils literal"><span class="pre">checkServerIsInstalled</span></code> returned
<cite>false</cite>, the method runs the <code class="docutils literal"><span class="pre">completeInstallation</span></code> method.
If all the calls to <code class="docutils literal"><span class="pre">checkServerIsInstalled</span></code> return <cite>true</cite>, this
method concludes without calling any others.</td>
</tr>
<tr class="row-odd"><td><strong>checkServerIsInstalled</strong></td>
<td><code class="docutils literal"><span class="pre">server</span></code></td>
<td>Checks if the given server requires a (re)deployment of the software
component. By default checks for the value of the attribute <cite>installed</cite>
of the instance.
May be overridden by subclasses to provide some better logic (e.g. the
app developer may provide code to check if the given software is
pre-installed on the image which was provisioned on the VM).</td>
</tr>
<tr class="row-even"><td><strong>beforeInstall</strong></td>
<td><code class="docutils literal"><span class="pre">servers</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Reports the beginning of installation process, sends notification about
this event to all objects which are subscribed for it (see
<em>Event notification pattern</em> section for details) and calls the public
event handler <code class="docutils literal"><span class="pre">onBeforeInstall</span></code>.</td>
</tr>
<tr class="row-odd"><td><strong>onBeforeInstall</strong></td>
<td><code class="docutils literal"><span class="pre">servers</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Public handler of the <cite>beforeInstall</cite> event. Empty in the base class,
may be overridden in subclasses if some custom pre-install logic needs
to be executed.</td>
</tr>
<tr class="row-even"><td><strong>installServer</strong></td>
<td><code class="docutils literal"><span class="pre">server</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Does the actual software deployment on a given server by calling an
<code class="docutils literal"><span class="pre">onInstallServer</span></code> public event handler (with notification on this
event). If the installation completes successfully sets the <cite>installed</cite>
attribute of the server to <cite>true</cite>, reports successful installation and
returns <cite>null</cite>. If an exception encountered during the invocation of
<code class="docutils literal"><span class="pre">onInstallServer</span></code>, the method handles that exception, reports a
warning and returns the server. The return value of the method indicates
to the <code class="docutils literal"><span class="pre">install</span></code> method how many failures encountered in total during
the installation and with what servers.</td>
</tr>
<tr class="row-odd"><td><strong>onInstallServer</strong></td>
<td><code class="docutils literal"><span class="pre">server</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>An event-handler method which is called by the <code class="docutils literal"><span class="pre">installServer</span></code> method
when the actual software deployment is needed.It is empty in the base
class. The implementations should override it with custom logic to
deploy the actual software bits.</td>
</tr>
<tr class="row-even"><td><strong>completeInstallation</strong></td>
<td><code class="docutils literal"><span class="pre">servers</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code>, <code class="docutils literal"><span class="pre">failedServers</span></code></td>
<td>It is executed after all the <code class="docutils literal"><span class="pre">installServer</span></code> methods were called.
Checks for the number of errors reported during the installation: if it
is greater than the value of <code class="docutils literal"><span class="pre">allowedInstallFailures</span></code> property, an
exception is raised to interrupt the deployment workflow. Otherwise the
method emits notification on this event, calls an
<code class="docutils literal"><span class="pre">onCompleteInstallation</span></code> event handler and then reports the successful
completion of the installation workflow.</td>
</tr>
<tr class="row-odd"><td><strong>onCompleteInstallation</strong></td>
<td><code class="docutils literal"><span class="pre">servers</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code>, <code class="docutils literal"><span class="pre">failedServers</span></code></td>
<td>An event-handler method which is called by the <code class="docutils literal"><span class="pre">completeInstallation</span></code>
method when the component installation is about to be completed.
Default implementation is empty. Inheritors may implement this method to
add some final handling, reporting etc.</td>
</tr>
</tbody>
</table>
<p><strong>Configuration</strong> workflow consists of the following methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>+----------------------------------------------------------------------------------------------------------------------+
| CONFIGURATION                                                                                                        |
|               +-----------------+                                                                                    |
|               |                 |                                                                                    |
|               |          +---------------+                          +-----------------+                              |
|               |        +---------------+ |                        +-----------------+ |                              |
|  +------------v--+   +---------------+ | |   +--------------+   +-----------------+ | |   +-----------------------+  |
|  |               |   |               | | |   |              |   |                 | | |   |                       |  |
|  | checkCluster\ +---&gt; checkServer\  | +-+---&gt; preConfigure +---&gt; configureServer | +-+---&gt; completeConfiguration |  |
|  | IsConfigured  |   | IsConfigured  +-+     |              |   |                 +-+     |                       |  |
|  +------------+--+   +---------------+       +------+-------+   +--------+--------+       +-----------+-----------+  |
|               |                                     |                    |                            |              |
|               |                                     |                    |                            |              |
|    +----------v----------+                          |                    |                            |              |
|    |                     |                          |                    |                            |              |
|    | getConfigurationKey |                          |                    |                            |              |
|    |                     |                          |                    |                            |              |
|    +---------------------+                          |                    |                            |              |
|                                                     |                    |                            |              |
+----------------------------------------------------------------------------------------------------------------------+
                                                      |                    |                            |
                                                      |                    |                            |
                                                      v                    v                            v
                                              configureSecurity,    onConfigureServer          onCompleteConfiguration
                                                onPreConfigure
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Arguments</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>configure</strong></td>
<td><code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Entry point of the configuration workflow.
Calls a <code class="docutils literal"><span class="pre">checkClusterIsConfigured</span></code> method. If the call returns <cite>true</cite>,
workflow exits without any further action. Otherwise for each server in
the <code class="docutils literal"><span class="pre">serverGroup</span></code> it calls <code class="docutils literal"><span class="pre">checkServerIsConfigured</span></code> method and gets
the list of servers that need reconfiguration. The <code class="docutils literal"><span class="pre">preConfigure</span></code>
method is called with that list. At the end calls the
<code class="docutils literal"><span class="pre">completeConfiguration</span></code> method.</td>
</tr>
<tr class="row-odd"><td><strong>checkClusterIsConfigured</strong></td>
<td><code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Has to return <cite>true</cite> if the configuration (i.e. the values of input
properties) of the component has not been changed since it was last
deployed on the given server group. Default implementation calls the
<code class="docutils literal"><span class="pre">getConfigurationKey</span></code> method and compares the returned result with a
value of <cite>configuration</cite> attribute of <code class="docutils literal"><span class="pre">serverGroup</span></code>. If the results
match returns <cite>true</cite> otherwise <cite>false</cite>.</td>
</tr>
<tr class="row-even"><td><strong>getConfigurationKey</strong></td>
<td>None</td>
<td>Should return some values describing the configuration state of the
component. This state is used to track the changes of the configuration
by the <code class="docutils literal"><span class="pre">checkClusterIsConfigured</span></code> and <code class="docutils literal"><span class="pre">checkServerIsConfigured</span></code>
methods.
Default implementation returns a synthetic value which gets updated on
every environment redeployment. Thus the subsequent calls of the
<code class="docutils literal"><span class="pre">configure</span></code> method on the same server group during the same deployment
will not cause the reconfiguration, while the calls on the next
deployment will reapply the configuration again.
The inheritors may redefine this to include the actual values of the
configuration properties, so the configuration is reapplied only if the
appropriate input properties are changed.</td>
</tr>
<tr class="row-odd"><td><strong>checkServerIsConfigured</strong></td>
<td><code class="docutils literal"><span class="pre">server</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>It is called to check if the particular server of the server group has
to be reconfigured thus providing more precise control compared to
cluster-wide <code class="docutils literal"><span class="pre">checkClusterIsConfigured</span></code>.
Default implementation calls the <code class="docutils literal"><span class="pre">getConfigurationKey</span></code> method and
compares the returned result with a value of <cite>configuration</cite> attribute
of the server. If the results match returns <cite>true</cite> otherwise <cite>false</cite>.
This method gets called only if the <code class="docutils literal"><span class="pre">checkClusterIsConfigured</span></code> method
returned <cite>false</cite> for the whole server group.</td>
</tr>
<tr class="row-even"><td><strong>preConfigure</strong></td>
<td><code class="docutils literal"><span class="pre">servers</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Reports the beginning of configuration process, calls the
<code class="docutils literal"><span class="pre">configureSecurity</span></code> method, emits the notification and calls the
public event handler <code class="docutils literal"><span class="pre">onPreConfigure</span></code>. This method is called once per
the server group and only if the changes in configuration are detected.</td>
</tr>
<tr class="row-odd"><td><strong>configureSecurity</strong></td>
<td><code class="docutils literal"><span class="pre">servers</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Intended for configuring the security rules. It is empty in the base
class. Fully implemented in the <code class="docutils literal"><span class="pre">OpenStackSecurityConfigurable</span></code> class
which is the inheritor of <code class="docutils literal"><span class="pre">Configurable</span></code>.</td>
</tr>
<tr class="row-even"><td><strong>onPreConfigure</strong></td>
<td><code class="docutils literal"><span class="pre">servers</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Public event-handler which is called by the <code class="docutils literal"><span class="pre">preConfigure</span></code> method
when the (re)configuration of the component is required.
Default implementation is empty. Inheritors may implement this method to
set various kinds of cluster-wide states or output properties which may
be of use at later stages of the workflow.</td>
</tr>
<tr class="row-odd"><td><strong>configureServer</strong></td>
<td><code class="docutils literal"><span class="pre">server</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Does the actual software configuration on a given server by calling the
<code class="docutils literal"><span class="pre">onConfigureServer</span></code> public event handler. Before that reports the
beginning of the configuration and emits the notification. If the
configuration completes successfully calls the <code class="docutils literal"><span class="pre">getConfigurationKey</span></code>
method and sets the <cite>configuration</cite> attribute of the server to resulting
value thus saving the configuration applied to a given server. Returns
<cite>null</cite> to indicate successful configuration.
If an exception encountered during the invocation of
<code class="docutils literal"><span class="pre">onConfigureServer</span></code>, the method will handle that exception, report a
warning and return the current server to signal its failure to the
<code class="docutils literal"><span class="pre">configure</span></code> method.</td>
</tr>
<tr class="row-even"><td><strong>onConfigureServer</strong></td>
<td><code class="docutils literal"><span class="pre">server</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>An event-handler method which is called by the <code class="docutils literal"><span class="pre">configureServer</span></code>
method when the actual software configuration is needed. It is empty in
the base class. The implementations should override it with custom logic
to apply the actual software configuration on a given server.</td>
</tr>
<tr class="row-odd"><td><strong>completeConfiguration</strong></td>
<td><code class="docutils literal"><span class="pre">servers</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code>, <code class="docutils literal"><span class="pre">failedServers</span></code></td>
<td>It is executed after all the <code class="docutils literal"><span class="pre">configureServer</span></code> methods were called.
Checks for the number of errors reported during the configuration: if it
is greater than set by the <code class="docutils literal"><span class="pre">allowedConfigurationFailures</span></code> property, an
exception is raised to interrupt the deployment workflow. Otherwise the
method emits notification, calls an <code class="docutils literal"><span class="pre">onCompleteConfiguration</span></code> event
handler, calls the <code class="docutils literal"><span class="pre">getConfigurationKey</span></code> method and sets the
<cite>configuration</cite> attribute of the server group to resulting value and
then reports successful completion of the configuration workflow.</td>
</tr>
<tr class="row-even"><td><strong>onCompleteConfiguration</strong></td>
<td><code class="docutils literal"><span class="pre">servers</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code>, <code class="docutils literal"><span class="pre">failedServers</span></code></td>
<td>The event-handler method which is called by the <code class="docutils literal"><span class="pre">completeConfiguration</span></code>
method when the component configuration is finished at all the servers.
Default implementation is empty. Inheritors may implement this method to
add some final handling, reporting etc.</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">OpenStackSecurityConfigurable</span></code> class extends <code class="docutils literal"><span class="pre">Configurable</span></code> by
implementing the <code class="docutils literal"><span class="pre">configureSecurity</span></code> method of the base class and adding the
empty <code class="docutils literal"><span class="pre">getSecurityRules</span></code> method.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Arguments</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>getSecurityRules</strong></td>
<td>None</td>
<td><p class="first">Returns an empty dictionary in default implementation. Inheritors which
want to add security rules during the app configuration should
implement this method and make it return a list of dictionaries
describing the security rules with the following keys:</p>
<blockquote class="last">
<div><ul class="simple">
<li>FromPort (port number, e.g. 80).</li>
<li>ToPort (port number, e.g. 80).</li>
<li>IpProtocol: (string, e.g. &#8216;tcp&#8217;).</li>
<li>External: (boolean: <cite>true</cite> means that the inbound traffic to the given
port (or port range) may originate from outside of the environment;
<cite>false</cite> means that only the VMs spawned by this or other apps of the
current environment may connect to this port).</li>
<li>Ethertype: (optional, can be &#8216;IPv4&#8217; or &#8216;IPv6&#8217;).</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td><strong>configureSecurity</strong></td>
<td><code class="docutils literal"><span class="pre">servers</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Gets the list of security rules provided by the <code class="docutils literal"><span class="pre">getSecurityRules</span></code>
method and adds security group with these rules to the Heat stacks of
all regions which the component&#8217;s <code class="docutils literal"><span class="pre">servers</span></code> are deployed to</td>
</tr>
</tbody>
</table>
<p>Consider the following example of this class usage:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Namespaces</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">=</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">com.example.apache</span>
  <span class="l l-Scalar l-Scalar-Plain">apps</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.applications</span>

<span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ApacheHttpServer</span>

<span class="l l-Scalar l-Scalar-Plain">Extends</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apps:MultiServerApplicationWithScaling</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apps:OpenStackSecurityConfigurable</span>

<span class="l l-Scalar l-Scalar-Plain">Methods</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">getSecurityRules</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Body</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Return</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ToPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
            <span class="l l-Scalar l-Scalar-Plain">FromPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
            <span class="l l-Scalar l-Scalar-Plain">IpProtocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
            <span class="l l-Scalar l-Scalar-Plain">External</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ToPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
            <span class="l l-Scalar l-Scalar-Plain">FromPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
            <span class="l l-Scalar l-Scalar-Plain">IpProtocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
            <span class="l l-Scalar l-Scalar-Plain">External</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>In the example above, the <code class="docutils literal"><span class="pre">ApacheHttpServer</span></code> class is configured to create
a security group with two security rules allowing network traffic over HTTP
and HTTPS protocols on its deployment.</p>
<p>The <code class="docutils literal"><span class="pre">SoftwareComponent</span></code> class inherits both <code class="docutils literal"><span class="pre">Installable</span></code> and
<code class="docutils literal"><span class="pre">Configurable</span></code> and adds several additional methods.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Arguments</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>deployAt</strong></td>
<td><code class="docutils literal"><span class="pre">serverGroup</span></code></td>
<td>Binds all workflows into one process. Consequentially calls <code class="docutils literal"><span class="pre">deploy</span></code>
method of the <code class="docutils literal"><span class="pre">serverGroup</span></code>, <code class="docutils literal"><span class="pre">install</span></code> and <code class="docutils literal"><span class="pre">configure</span></code> methods
inherited from the parent classes.</td>
</tr>
<tr class="row-odd"><td><strong>report</strong></td>
<td><code class="docutils literal"><span class="pre">message</span></code></td>
<td>Reports a <code class="docutils literal"><span class="pre">message</span></code> using environment&#8217;s reporter.</td>
</tr>
<tr class="row-even"><td><strong>detectSuccess</strong></td>
<td><code class="docutils literal"><span class="pre">allowedFailures</span></code>, <code class="docutils literal"><span class="pre">serverGroup</span></code>, <code class="docutils literal"><span class="pre">failedServers</span></code></td>
<td>Static method that returns <cite>true</cite> in case the actual number of failures
(number of <code class="docutils literal"><span class="pre">failedServers</span></code>) is less than or equal to the
<code class="docutils literal"><span class="pre">allowedFailures</span></code>. The latter can be on of the following options:
<cite>none</cite>, <cite>one</cite>, <cite>two</cite>, <cite>three</cite>, <cite>any</cite>, &#8216;quorum&#8217;. <cite>any</cite> allows any number
of failures during the installation or configuration. <cite>quorum</cite> allows
failure of less than a half of all servers.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="event-notification-pattern">
<h3>Event notification pattern<a class="headerlink" href="#event-notification-pattern" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">Event</span></code> class may be used to issue various notifications to other
MuranoPL classes in an event-driven manner.</p>
<p>Any object which is going to emit the notifications should declare the
instances of the <code class="docutils literal"><span class="pre">Event</span></code> class as its public Runtime properties. You can see
the examples of such properties in the <code class="docutils literal"><span class="pre">Installable</span></code> and <code class="docutils literal"><span class="pre">Configurable</span></code>
classes:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Installable</span>

<span class="l l-Scalar l-Scalar-Plain">Properties</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">beforeInstallEvent</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.class(Event).notNull()</span>
    <span class="l l-Scalar l-Scalar-Plain">Usage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Runtime</span>
    <span class="l l-Scalar l-Scalar-Plain">Default</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">beforeInstall</span>
</pre></div>
</div>
<p>The object which is going to subscribe for the notifications should pass
itself into the <code class="docutils literal"><span class="pre">subscribe</span></code> method of the event along with the name of its
method which will be used to handle the notification:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$event.subscribe($subscriber, handleFoo)</span>
</pre></div>
</div>
<p>The specified handler method must be present in the subscriber class
(if the method name is missing it will default to <code class="docutils literal"><span class="pre">handle%Eventname%</span></code>)
and have at least one standard (i.e. not <code class="docutils literal"><span class="pre">VarArgs</span></code> or <code class="docutils literal"><span class="pre">KwArgs</span></code>) argument
which will be treated as <code class="docutils literal"><span class="pre">sender</span></code> while invoking.</p>
<p>The <code class="docutils literal"><span class="pre">unsubscribe</span></code> method does the opposite and removes object from the
subscribers of the event.</p>
<p>The class which is going to emit the notification should call the <code class="docutils literal"><span class="pre">notify</span></code>
method of the event and pass itself as the first argument (<code class="docutils literal"><span class="pre">sender</span></code>). All
the optional parameters of the event may be passed as varargs/kwargs of the
<code class="docutils literal"><span class="pre">notify</span></code> call. They will be passed all the way to the handler methods.</p>
<p>This is how it looks in the <code class="docutils literal"><span class="pre">Installable</span></code> class:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">beforeInstall</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">Arguments</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">servers</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$.class(res:Instance).notNull()</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">serverGroup</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.class(ServerGroup).notNull()</span>
  <span class="l l-Scalar l-Scalar-Plain">Body</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$this.beforeInstallEvent.notify($this, $servers, $serverGroup)</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">notifyInParallel</span></code> method does the same, but invokes all handlers of
subscribers in parallel.</p>
</div>
<div class="section" id="base-application-classes">
<h3>Base application classes<a class="headerlink" href="#base-application-classes" title="Permalink to this headline">¶</a></h3>
<p>There are several base classes that extend standard <code class="docutils literal"><span class="pre">io.murano.Application</span></code>
class and <code class="docutils literal"><span class="pre">SoftwareComponent</span></code> class from the application development
library.</p>
<dl class="docutils">
<dt><strong>SingleServerApplication</strong></dt>
<dd>A base class for applications running a single software component on a
single server only. Its <code class="docutils literal"><span class="pre">deploy</span></code> method simply creates the
<code class="docutils literal"><span class="pre">SingleServerGroup</span></code> with the <code class="docutils literal"><span class="pre">server</span></code> provided as an application input.</dd>
<dt><strong>MultiServerApplication</strong></dt>
<dd>A base class for applications running a single software component on
multiple servers. Unlike <code class="docutils literal"><span class="pre">SingleServerApplication</span></code>, it has the
<code class="docutils literal"><span class="pre">servers</span></code> input property instead of <code class="docutils literal"><span class="pre">server</span></code>. It accepts instance of
on of the inheritors of the <code class="docutils literal"><span class="pre">ServerGroup</span></code> class.</dd>
<dt><strong>MultiServerApplicationWithScaling</strong></dt>
<dd><p class="first">Extends <code class="docutils literal"><span class="pre">MultiServerApplication</span></code> with the ability to scale the
application by increasing (scaling out) or decreasing (scaling in) the
number of nodes with the application after it is installed. The
differences from <code class="docutils literal"><span class="pre">MultiServerApplication</span></code> are:</p>
<blockquote class="last">
<div><ul class="simple">
<li>the <code class="docutils literal"><span class="pre">servers</span></code> property accepts only instances of
<code class="docutils literal"><span class="pre">ServerReplicationGroup</span></code> rather than any <code class="docutils literal"><span class="pre">ServerGroup</span></code></li>
<li>the additional optional <code class="docutils literal"><span class="pre">scaleFactor</span></code> property accepts the number by
which the app is scaled at once; it defaults to 1</li>
<li>the <code class="docutils literal"><span class="pre">scaleOut</span></code> and <code class="docutils literal"><span class="pre">scaleIn</span></code> public methods are added</li>
</ul>
</div></blockquote>
</dd>
</dl>
<p>Application developers may as well define their own classes using the
same approach and combining base classes behaviour with the custom code to
satisfy the needs of their applications.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Application development framework</a><ul>
<li><a class="reference internal" href="#framework-objectives">Framework objectives</a></li>
<li><a class="reference internal" href="#quickstart">Quickstart</a><ul>
<li><a class="reference internal" href="#create-a-one-component-single-server-application">Create a one-component single-server application</a></li>
<li><a class="reference internal" href="#create-a-one-component-multi-server-application">Create a one-component multi-server application</a></li>
<li><a class="reference internal" href="#create-a-scalable-multi-server-application">Create a scalable multi-server application</a></li>
</ul>
</li>
<li><a class="reference internal" href="#library-overview">Library overview</a></li>
<li><a class="reference internal" href="#framework-detailed-description">Framework detailed description</a><ul>
<li><a class="reference internal" href="#scaling-primitives">Scaling primitives</a></li>
<li><a class="reference internal" href="#servers-replication">Servers replication</a></li>
<li><a class="reference internal" href="#software-components">Software Components</a></li>
<li><a class="reference internal" href="#event-notification-pattern">Event notification pattern</a></li>
<li><a class="reference internal" href="#base-application-classes">Base application classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="use_cases.html"
                                  title="previous chapter">Use-cases</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="app_debugging.html"
                                  title="next chapter">Application developer&#8217;s cookbook</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/murano
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/appdev-guide/app_development_framework.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="app_debugging.html" title="Application developer’s cookbook"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="use_cases.html" title="Use-cases"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Murano</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="developer_index.html" accesskey="U">Application Developer Guide</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Last updated on &#39;Fri Feb 10 03:18:12 2017, commit fbee404&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/Murano");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>