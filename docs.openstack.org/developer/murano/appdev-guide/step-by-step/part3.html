<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Part 3: Creating a Plone CMS application package &mdash; Murano</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.1.1.dev17',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Murano" href="../../index.html" />
    <link rel="up" title="Developing Murano Packages 101" href="step_by_step.html" />
    <link rel="next" title="Part 4: Refactoring code to use the Application Framework" href="part4.html" />
    <link rel="prev" title="Part 2: Customizing your Application Package" href="part2.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="part-3-creating-a-plone-cms-application-package">
<h1>Part 3: Creating a Plone CMS application package<a class="headerlink" href="#part-3-creating-a-plone-cms-application-package" title="Permalink to this headline">¶</a></h1>
<p>If you&#8217;ve completed &#8220;Hello, World&#8221; scenarios in the previous parts and are
ready for some serious tasks, we&#8217;ve got a good example here.</p>
<p>Let&#8217;s automate the deployment of some real application. We&#8217;ve chosen a &#8220;Plone
CMS&#8221; for this purpose. Plone is a simple, but powerful and flexible Content
Management System which can efficiently run on cloud. Its deployment scenario
can be very simple for demo cases and can become really complicated for
production-grade usage. So it&#8217;s a good playground: in this part we&#8217;ll create a
Murano application to address the simplest scenario, then we will gradually add
more features of production-grade deployments.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To learn more about Plone, its features, capabilities and deployment
scenarios you may visit the <a class="reference external" href="http://www.plone.org/">Official website of Plone Foundation</a>.</p>
</div>
<div class="section" id="the-goal">
<h2>The goal<a class="headerlink" href="#the-goal" title="Permalink to this headline">¶</a></h2>
<p>Simplest deployment of Plone CMS requires a single server, or, in the case of
OpenStack, a Virtual Machine, to run on. Then a software should be downloaded
and configured to run on that server.</p>
<p>So, as a bare minimum our Plone application package for Murano should automate
the following steps:</p>
<ol class="arabic simple">
<li>Provision a virtual machine in OpenStack (VM);</li>
<li>Configure ths VM&#8217;s network connectivity and security;</li>
<li>Download a distribution of Plone from Internet to the virtual machine;</li>
<li>Install the distribution and configure some of its parameters with user
input.</li>
</ol>
</div>
<div class="section" id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h2>
<p>First let&#8217;s revisit what we&#8217;ve learned in previous parts and create a new
application package with its manifest and create a class file to contain the
logic of your app.</p>
<p>Create a new directory for a package, call it <code class="docutils literal"><span class="pre">PloneApp</span></code>. Create a
<code class="docutils literal"><span class="pre">manifest.yaml</span></code> file as described in part 1 of this tutorial in the root of
the package and fill it with data: name your package <code class="docutils literal"><span class="pre">com.yourdomain.Plone</span></code>,
set its type to <code class="docutils literal"><span class="pre">Application</span></code>, give it a display name of &#8220;Plone CMS&#8221; and put
your name as the author of the package:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">FullName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">com.yourdomain.Plone</span>
<span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Plone CMS</span>
<span class="l l-Scalar l-Scalar-Plain">Description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Simple Plone Deployment</span>
<span class="l l-Scalar l-Scalar-Plain">Type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Application</span>
<span class="l l-Scalar l-Scalar-Plain">Author</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">John Doe</span>
</pre></div>
</td></tr></table></div>
<p>Then create a <code class="docutils literal"><span class="pre">Classes</span></code> sub directory inside your package directory and
create a <code class="docutils literal"><span class="pre">plone.yaml</span></code> there. This will be your application class.</p>
<p>At the top of this file declare a <cite>Namespace</cite> section: this will simplify the
code and save time on typing long class names. Make your namespace
(<code class="docutils literal"><span class="pre">com.yourdomain</span></code>) a default namespace of the file, also include the standard
namespace for Murano applications - <code class="docutils literal"><span class="pre">io.murano</span></code>, alias it as <code class="docutils literal"><span class="pre">std</span></code>.</p>
<p>Don&#8217;t forget to include the <code class="docutils literal"><span class="pre">Name</span></code> of your class. Since you&#8217;ve declared a
default namespace for a file you can name your class without a need to type its
long part, just using the shortname.</p>
<p>Also include the <code class="docutils literal"><span class="pre">Extends</span></code> section: same as in our &#8220;Hello, World&#8221; example
this application will inherit the <code class="docutils literal"><span class="pre">io.murano.Application</span></code> class, but since
we&#8217;ve aliased this namespace as well, it may be shortened to
<code class="docutils literal"><span class="pre">std:Application</span></code></p>
<p>By now your class file should look like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Namespaces</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">=</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">com.yourdomain</span>
  <span class="l l-Scalar l-Scalar-Plain">std</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano</span>

<span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span>  <span class="l l-Scalar l-Scalar-Plain">Plone</span>

<span class="l l-Scalar l-Scalar-Plain">Extends</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">std:Application</span>
</pre></div>
</div>
<p>We&#8217;ll add the actual logic in the next section. Now, save the file and include
it into the <code class="docutils literal"><span class="pre">Classes</span></code> section of your manifest.yaml, which should now look
like this:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">FullName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">com.yourdomain.Plone</span>
<span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Plone CMS</span>
<span class="l l-Scalar l-Scalar-Plain">Description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Simple Plone Deployment</span>
<span class="l l-Scalar l-Scalar-Plain">Type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Application</span>
<span class="l l-Scalar l-Scalar-Plain">Author</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">John Doe</span>
<span class="hll"><span class="l l-Scalar l-Scalar-Plain">Classes</span><span class="p p-Indicator">:</span>
</span><span class="hll">  <span class="l l-Scalar l-Scalar-Plain">com.yourdomain.Plone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">plone.yaml</span>
</span></pre></div>
</td></tr></table></div>
<p>You are all set and ready to go. Let&#8217;s add the actual deployment logic.</p>
</div>
<div class="section" id="library-classes">
<h2>Library classes<a class="headerlink" href="#library-classes" title="Permalink to this headline">¶</a></h2>
<p>Murano comes bundled with a so-called &#8220;Murano Core Library&#8221; - a Murano Package
containing the classes to automate different scenarios of interaction with
other entities such as OpenStack services or virtual machines. They follow
object-oriented design: for example, there is a Murano class called
<code class="docutils literal"><span class="pre">Instance</span></code> which represents an OpenStack virtual machine: if you create an
object of this class and execute a method called <code class="docutils literal"><span class="pre">deploy</span></code> for it Murano will
do all the needed system calls to OpenStack Services to orchestrate the
provisioning of a virtual machine and its networking configuration. Then this
object will contain information about the state and configuration of the VM,
such as its hostname, ip addresses etc. After the VM is provisioned you can use
its object to send the configuration scripts to the VM to install and configure
software for your application.</p>
<p>Other OpenStack resources such as Volumes, Networks, Ports, Routers etc also
have their corresponding classes in the core library.</p>
</div>
<div class="section" id="provisioning-a-vm">
<h2>Provisioning a VM<a class="headerlink" href="#provisioning-a-vm" title="Permalink to this headline">¶</a></h2>
<p>When creating your application package you can <cite>compose</cite> your application out
of the components of core library. For example for an application which
should run on a VM you can define an input property called <code class="docutils literal"><span class="pre">instance</span></code> and
restrict the value type of this property to the aforementioned <code class="docutils literal"><span class="pre">Instance</span></code>
class with a contract.</p>
<p>Let&#8217;s do that in the <code class="docutils literal"><span class="pre">plone.yaml</span></code> class file you&#8217;ve created.
First, add a new namespace alias to your <code class="docutils literal"><span class="pre">Namespaces</span></code> section:
shorten <code class="docutils literal"><span class="pre">io.murano.resources</span></code> as <code class="docutils literal"><span class="pre">res</span></code>. This namespace of the core
library contains all the resource classes, including the
<code class="docutils literal"><span class="pre">io.murano.resources.Instance</span></code> which we need to define the virtual machine:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Namespaces</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">=</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">com.yourdomain</span>
  <span class="l l-Scalar l-Scalar-Plain">std</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano</span>
<span class="hll">  <span class="l l-Scalar l-Scalar-Plain">res</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.resources</span>
</span></pre></div>
</div>
<p>Now, let&#8217;s add an input property to your class:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Properties</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">instance</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Usage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
    <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.class(res:Instance)</span>
</pre></div>
</td></tr></table></div>
<p>Notice the contract at line 4: it limits the values of this property to the
objects of class <code class="docutils literal"><span class="pre">io.murano.resources.Instance</span></code> or its subclasses.</p>
<p>This defines that your application needs a virtual machine. Now let&#8217;s ensure
that it is provisioned - or provision it otherwise. Add a <code class="docutils literal"><span class="pre">deploy</span></code> method to
your application class and call instance&#8217;s deploy method from it:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Methods</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">deploy</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Body</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$this.instance.deploy()</span>
</pre></div>
</td></tr></table></div>
<p>That&#8217;s very simple: you just access the <code class="docutils literal"><span class="pre">instance</span></code> property of your current
object and run a method <code class="docutils literal"><span class="pre">deploy</span></code> for it. The core library defines this method
of the <code class="docutils literal"><span class="pre">Instance</span></code> class in an <cite>idempotent</cite> manner: you may call it as many
times as you want: the first call will actually provision the virtual machine
in the cloud, while all the subsequent calls will no nothing, thus you may
always call this method to ensure that the VM was properly provisioned. It&#8217;s
important since we define it as an input property: theoretically a user can
pass an already-provisioned VM object as input, but you need to be sure.
Always calling the <code class="docutils literal"><span class="pre">deploy</span></code> method is the best practice to follow.</p>
</div>
<div class="section" id="running-a-command-on-the-vm">
<h2>Running a command on the VM<a class="headerlink" href="#running-a-command-on-the-vm" title="Permalink to this headline">¶</a></h2>
<p>Once the VM has been provisioned you may execute various kinds of software
configuration scenarios on it to install and configure the actual application
on the VM. Murano supports different types of software configuration tools to
be run on a VM, but the simplest and the most common type is just a shell
script.</p>
<p>To run a shell script on a virtual machine you may use a <cite>static method</cite>
<code class="docutils literal"><span class="pre">runCommand</span></code> of class <code class="docutils literal"><span class="pre">io.murano.configuration.Linux</span></code>. Since this method is
static you do not need to create any objects of its class: you can just do
something like:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type(&#39;io.murano.configuration.Linux&#39;).runCommand($server.agent, &#39;sudo apt-get update&#39;)</span>
</pre></div>
</div>
<p>or, if we declare another namespace prefix</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Namespaces</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">conf</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.configuration</span>
</pre></div>
</div>
<p>this may be shortened to</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">conf:Linux.runCommand($server.agent, &#39;sudo apt-get update&#39;)</span>
</pre></div>
</div>
<p>In this case <code class="docutils literal"><span class="pre">$server</span></code> should be a variable containing an object of
<code class="docutils literal"><span class="pre">io.murano.resources.Instance</span></code> class, everything you pass as a second
argument (<code class="docutils literal"><span class="pre">apt</span> <span class="pre">get</span> <span class="pre">update</span></code> in the example above) is the shell command to be
executed on a VM. You may pass not just a single line, but a multi-line text:
it will be treated as a shell script.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The shell scripts and commands you send to a VM are executed by a special
software component running on the VM - a <cite>murano agent</cite>. For the most
popular distributions of Linux (Debian, Ubuntu, Centos, Fedora, etc.) it
automatically gets installed on the VM once it is provisioned, but for other
distribution and non-Linux OSes it has to be manually pre-installed in the
image. See <a class="reference internal" href="../../appendix/articles/image_builders/index.html#building-images"><span>Building Murano Image</span></a> for details.</p>
</div>
</div>
<div class="section" id="loading-a-script-from-a-resource-file">
<h2>Loading a script from a resource file<a class="headerlink" href="#loading-a-script-from-a-resource-file" title="Permalink to this headline">¶</a></h2>
<p>Passing strings as a second argument of a <code class="docutils literal"><span class="pre">runCommand</span></code> method is convenient
for short commands like the <code class="docutils literal"><span class="pre">apt-get</span> <span class="pre">update</span></code> shown in an example above.
However for larger scripts it is not that useful. Instead it is preferable
to load a script text from a file and run it. You can do that in Murano.</p>
<p>For example, let&#8217;s make a script which downloads, unpacks, installs and
configures Plone CMS on our VM. First, create a directory called <code class="docutils literal"><span class="pre">Resources</span></code>
inside your package directory. Then, create a file named <code class="docutils literal"><span class="pre">install-plone.sh</span></code>
and put the following script there:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#input parameters</span>

<span class="nv">PL_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="nv">PL_PASS</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="nv">PL_PORT</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>


<span class="c1"># Write log. Redirect stdout &amp; stderr into log file:</span>
<span class="nb">exec</span> <span class="p">&amp;</span>&gt; /var/log/runPloneDeploy.log
<span class="c1"># echo &quot;Update all packages.&quot;</span>
sudo apt-get update

<span class="c1"># Install the operating system software and libraries needed to run Plone:</span>
sudo apt-get -y install python-setuptools python-dev build-essential libssl-dev libxml2-dev libxslt1-dev libbz2-dev libjpeg62-dev

<span class="c1"># Install optional system packages for the handling of PDF and Office files. Can be omitted:</span>
sudo apt-get -y install libreadline-dev wv poppler-utils

<span class="c1"># Download the latest Plone unified installer:</span>
wget --no-check-certificate https://launchpad.net/plone/5.0/5.0.4/+download/Plone-5.0.4-UnifiedInstaller.tgz

<span class="c1"># Unzip the latest Plone unified installer:</span>
tar -xvf Plone-5.0.4-UnifiedInstaller.tgz
<span class="nb">cd</span> Plone-5.0.4-UnifiedInstaller

<span class="c1"># Set the port that Plone will listen to on available network interfaces. Editing &quot;http-address&quot; param in buildout.cfg file:</span>
sed -i <span class="s2">&quot;s/^http-address = [0-9]*</span>$<span class="s2">/http-address = </span><span class="si">${</span><span class="nv">PL_PORT</span><span class="si">}</span><span class="s2">/&quot;</span> buildout_templates/buildout.cfg

<span class="c1"># Run the Plone installer in standalone mode</span>
./install.sh --password<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PL_PASS</span><span class="si">}</span><span class="s2">&quot;</span> --target<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PL_PATH</span><span class="si">}</span><span class="s2">&quot;</span> standalone

<span class="c1"># Start Plone</span>
<span class="nb">cd</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PL_PATH</span><span class="si">}</span><span class="s2">/zinstance&quot;</span>
bin/plonectl start
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As you can see, this script uses apt to install the prerequisite software
packages, so it expects a Debian-compatible Linux distro as the VM operating
system. This particular script was tested on Ubuntu 14.04. Other distros
may have a different set of preinstalled software and thus require different
additional prerequisites.</p>
</div>
<p>The comments in the script give the needed explanation: the script installs all
the prerequisites, downloads a targz archive with a distribution of Plone,
unpacks it, edits the <code class="docutils literal"><span class="pre">buildout.cfg</span></code> file to specify the port Plone will
listen at, then runs the installation script which is included in the
distribution. When that script is finished, the Plone daemon is started.</p>
<p>Save the file as <code class="docutils literal"><span class="pre">Resources/install-plone.sh</span></code>. Now you may load its contents
into a string variable in your class file. To do that, you need to use another
static method: a <code class="docutils literal"><span class="pre">string()</span></code> method of a <code class="docutils literal"><span class="pre">io.murano.system.Resources</span></code> class:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$script</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">type(&#39;io.murano.system.Resources&#39;).string(&#39;install-plone.sh&#39;)</span>
</pre></div>
</div>
<p>or, with the introduction of another namespace prefix</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$script</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sys:Resources.string(&#39;install-plone.sh&#39;)</span>
</pre></div>
</div>
<p>But before sending this script to a VM, it needs to be parametrized: as you
can see in the script snippet above, it declares three variables which are
used to set the installation path in the VM&#8217;s filesystem, a default
administrator&#8217;s password and a listening port. In the script these values are
initialized with stubs <code class="docutils literal"><span class="pre">$1</span></code>, <code class="docutils literal"><span class="pre">$2</span></code> and <code class="docutils literal"><span class="pre">$3</span></code>, now we need to replace these
stubs with the actual user input. To do that our class needs to define the
appropriate input properties and then do string replacement.</p>
<p>First, let&#8217;s define the appropriate input properties in the <code class="docutils literal"><span class="pre">Properties</span></code>
block of the class, right after the <code class="docutils literal"><span class="pre">instance</span></code> property:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Properties</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">instance</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Usage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
    <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.class(res:Instance)</span>

<span class="hll">  <span class="l l-Scalar l-Scalar-Plain">installationPath</span><span class="p p-Indicator">:</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">Usage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.string().notNull()</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">Default</span><span class="p p-Indicator">:</span> <span class="s">&#39;/opt/plone&#39;</span>
</span><span class="hll">
</span><span class="hll">  <span class="l l-Scalar l-Scalar-Plain">defaultPassword</span><span class="p p-Indicator">:</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">Usage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.string().notNull()</span>
</span><span class="hll">
</span><span class="hll">  <span class="l l-Scalar l-Scalar-Plain">listeningPort</span><span class="p p-Indicator">:</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">Usage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.int().notNull()</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">Default</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
</span></pre></div>
</td></tr></table></div>
<p>Now, let&#8217;s replace the stub values in that script value we&#8217;ve loaded into the
<code class="docutils literal"><span class="pre">$script</span></code> variable. This may be done using a <code class="docutils literal"><span class="pre">replace</span></code> function:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$script</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$script.replace({&quot;$1&quot; =&gt; $this.installationPath,</span>
     <span class="l l-Scalar l-Scalar-Plain">&quot;$2&quot; =&gt; $this.defaultPassword,</span>
     <span class="l l-Scalar l-Scalar-Plain">&quot;$3&quot; =&gt; $this.listeningPort})</span>
</pre></div>
</div>
<p>Finally, the resulting <code class="docutils literal"><span class="pre">$script</span></code> variable may be passed as a second argument
of a <code class="docutils literal"><span class="pre">runCommand</span></code> method, while the first one should be the <code class="docutils literal"><span class="pre">instance</span></code>
property, containing our VM-object:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">conf:Linux.runCommand($this.instance.agent, $script)</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-openstack-security">
<h2>Configuring OpenStack Security<a class="headerlink" href="#configuring-openstack-security" title="Permalink to this headline">¶</a></h2>
<p>By now we&#8217;ve got code which provisions a VM and a script which deploys and
configures Plone on it. However, in most OpenStack clouds this is not enough:
usually all incoming traffic to all the VMs is blocked by default, so we need
to configure security group of OpenStack to allow the incoming http calls to
our VM on the port our Plone server listens at.</p>
<p>To do that we need to use a <code class="docutils literal"><span class="pre">securityGroupManager</span></code> property of the
<code class="docutils literal"><span class="pre">Environment</span></code> class which owns our application. That property contains an
object of type <code class="docutils literal"><span class="pre">io.murano.system.SecurityGroupManager</span></code>, which defines a
<code class="docutils literal"><span class="pre">addGroupIngress</span></code> method. This method allows us to add a security group rule
to allow incoming traffic of some type through a specific port within a port
range. It accepts a list of YAML objects, each having four keys: <code class="docutils literal"><span class="pre">FromPort</span></code>
and <code class="docutils literal"><span class="pre">ToPort</span></code> to define the boundaries of the port range, <code class="docutils literal"><span class="pre">IpProtocol</span></code> to
define the type of the protocol and <code class="docutils literal"><span class="pre">External</span></code> boolean flag to indicate if
the incoming traffic should be be allowed to originate from outside of the
environment (if this flag is false, the traffic will be accepted only from the
VMs deployed by the application in the same Murano environment).</p>
<p>Let&#8217;s do this in code:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$environment</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$this.find(std:Environment)</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$manager</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$environment.securityGroupManager</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$rules</span><span class="p p-Indicator">:</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">FromPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$this.listeningPort</span>
     <span class="l l-Scalar l-Scalar-Plain">ToPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$this.listeningPort</span>
     <span class="l l-Scalar l-Scalar-Plain">IpProtocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
     <span class="l l-Scalar l-Scalar-Plain">External</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$manager.addGroupIngress($rules)</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$environment.stack.push()</span>
</pre></div>
</td></tr></table></div>
<p>It&#8217;s quite straightforward, just notice the last line. It is required, because
current implementation of <code class="docutils literal"><span class="pre">SecurityGroupManager</span></code> relies on Heat underneath -
it modifies the <cite>Heat Stack</cite> associated with our environment, but does not
apply the changes to the actual cloud. To apply them the stack needs to be
<cite>pushed</cite>, i.e. submitted to Heat Orchestration service. The last line does
exactly that.</p>
</div>
<div class="section" id="notifying-end-user-on-plone-location">
<h2>Notifying end-user on Plone location<a class="headerlink" href="#notifying-end-user-on-plone-location" title="Permalink to this headline">¶</a></h2>
<p>When the deployment is completed and our instance of Plone server starts
listening on a provisioned virtual machine, the end user has one last question
to solve: to find out where it is. Of course, the user may use OpenStack
Dashboard to list all the provisioned VMs, find the one which has just been
created and look for its IP address. But that&#8217;s inconvenient. It would be much
better if Murano notified the end-user on where to find Plone once it is ready.</p>
<p>We may utilize the same approach we used in the previous parts to say &#8220;Hello,
World&#8221; - call a <code class="docutils literal"><span class="pre">report</span></code> method of <code class="docutils literal"><span class="pre">reporter</span></code> attribute of the
<code class="docutils literal"><span class="pre">Environment</span></code> class. The tricky part is getting the IP address.</p>
<p>Class <code class="docutils literal"><span class="pre">io.murano.resources.Instance</span></code> has an <cite>output property</cite> called
<code class="docutils literal"><span class="pre">ipAddresses</span></code>. Unlike input properties the output ones are not provided by
users but are set by objects themselves while their methods are executed. The
<code class="docutils literal"><span class="pre">ipAddresses</span></code> is assigned during the execution of <code class="docutils literal"><span class="pre">deploy</span></code> method of the
VM. The value is the list of ip addresses assigned to different interfaces of
the machine. Also, if the <code class="docutils literal"><span class="pre">assignFloatingIp</span></code> input property is set to
<code class="docutils literal"><span class="pre">true</span></code>, another output property will be set during the execution of
<code class="docutils literal"><span class="pre">deploy</span></code> - a <code class="docutils literal"><span class="pre">floatingIpAddress</span></code> will contain the floating ip attached to
the VM.</p>
<p>Let&#8217;s use this knowledge and build a proper report message:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$message</span><span class="p p-Indicator">:</span> <span class="s">&#39;Plone</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">up</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">&#39;</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">If</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$this.instance.assignFloatingIp</span>
  <span class="l l-Scalar l-Scalar-Plain">Then</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$message</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$message + $this.instance.floatingIpAddress</span>
  <span class="l l-Scalar l-Scalar-Plain">Else</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$message</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$message + $this.instance.ipAddresses.first()</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$message</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$message + &quot;:&quot; + str($this.listeningPort)</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$environment.reporter.report($this, $message)</span>
</pre></div>
</td></tr></table></div>
<p>Note the usage of <code class="docutils literal"><span class="pre">If</span></code> expression: it is similar to other programming
languages, just uses YAML keys to define the &#8220;if&#8221; and &#8220;else&#8221; blocks.</p>
<p>This code creates a string variable called <code class="docutils literal"><span class="pre">$message</span></code>, initializes it with
the beginning of the message string, then appends either a floating ip address
of the VM (if it&#8217;s set) or the first of the regular ips otherwise. Then it
appends a listening port after a colon character - and reports the resulting
message to the user.</p>
</div>
<div class="section" id="completing-the-plone-class">
<h2>Completing the Plone class<a class="headerlink" href="#completing-the-plone-class" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ve got all the pieces to deploy our Plone application, now let&#8217;s combine
them together. Our final class file should look like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Namespaces</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">=</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">com.yourdomain</span>
  <span class="l l-Scalar l-Scalar-Plain">std</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano</span>
  <span class="l l-Scalar l-Scalar-Plain">res</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.resources</span>
  <span class="l l-Scalar l-Scalar-Plain">sys</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.system</span>

<span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Plone</span>

<span class="l l-Scalar l-Scalar-Plain">Extends</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">std:Application</span>

<span class="l l-Scalar l-Scalar-Plain">Properties</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">instance</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Usage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
    <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.class(res:Instance)</span>

  <span class="l l-Scalar l-Scalar-Plain">installationPath</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Usage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
    <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.string().notNull()</span>
    <span class="l l-Scalar l-Scalar-Plain">Default</span><span class="p p-Indicator">:</span> <span class="s">&#39;/opt/plone&#39;</span>

  <span class="l l-Scalar l-Scalar-Plain">defaultPassword</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Usage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
    <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.string().notNull()</span>

  <span class="l l-Scalar l-Scalar-Plain">listeningPort</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Usage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
    <span class="l l-Scalar l-Scalar-Plain">Contract</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.int().notNull()</span>
    <span class="l l-Scalar l-Scalar-Plain">Default</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>

<span class="l l-Scalar l-Scalar-Plain">Methods</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">deploy</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">Body</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$this.instance.deploy()</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$script</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sys:Resources.string(&#39;install-plone.sh&#39;)</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$script</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$script.replace({</span>
          <span class="l l-Scalar l-Scalar-Plain">&quot;$1&quot; =&gt; $this.installationPath,</span>
          <span class="l l-Scalar l-Scalar-Plain">&quot;$2&quot; =&gt; $this.defaultPassword,</span>
          <span class="l l-Scalar l-Scalar-Plain">&quot;$3&quot; =&gt; $this.listeningPort</span>
         <span class="l l-Scalar l-Scalar-Plain">})</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type(&#39;io.murano.configuration.Linux&#39;).runCommand($this.instance.agent, $script)</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$environment</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$this.find(std:Environment)</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$manager</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$environment.securityGroupManager</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$rules</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">FromPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$this.listeningPort</span>
          <span class="l l-Scalar l-Scalar-Plain">ToPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$this.listeningPort</span>
          <span class="l l-Scalar l-Scalar-Plain">IpProtocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
          <span class="l l-Scalar l-Scalar-Plain">External</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$manager.addGroupIngress($rules)</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$environment.stack.push()</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$formatString</span><span class="p p-Indicator">:</span> <span class="s">&#39;Plone</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">up</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">{0}:{1}&#39;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">If</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$this.instance.assignFloatingIp</span>
        <span class="l l-Scalar l-Scalar-Plain">Then</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$address</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$this.instance.floatingIpAddress</span>
        <span class="l l-Scalar l-Scalar-Plain">Else</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$address</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$this.instance.ipAddresses.first()</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$message</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">format($formatString, $address, $this.listeningPort)</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$environment.reporter.report($this, $message)</span>
</pre></div>
</div>
<p>That&#8217;s all, our class is ready.</p>
</div>
<div class="section" id="providing-a-ui-definition">
<h2>Providing a UI definition<a class="headerlink" href="#providing-a-ui-definition" title="Permalink to this headline">¶</a></h2>
<p>Last but not least, we need to add a UI definition file to define a template
for the user input and create wizard steps.</p>
<p>This time both are a bit more complicated than they were for the &#8220;Hello, World&#8221;
app.</p>
<p>First, let&#8217;s create the wizard steps. It&#8217;s better to decompose the UI into two
steps: the first one will define the properties of a Virtual Machine, and the
second one the configuration properties of the Plone application itself.</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Forms</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">instanceConfiguration</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hostname</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
          <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">image</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">image</span>
          <span class="l l-Scalar l-Scalar-Plain">imageType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">linux</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">flavor</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">flavor</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">assignFloatingIp</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">boolean</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ploneConfiguration</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">installationPath</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">defaultPassword</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
          <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">listeningPort</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
</pre></div>
</td></tr></table></div>
<p>This is familiar to what we had on the previous step, however there are several
new types of fields: while the types <code class="docutils literal"><span class="pre">integer</span></code> and <code class="docutils literal"><span class="pre">boolean</span></code> are quite
obvious - they will render a numeric up-and-down textbox and checkbox controls
respectively - other field types are more specific.</p>
<p>Field of type <code class="docutils literal"><span class="pre">image</span></code> will render a drop-down list allowing you to choose an
image for your VM, and the list of images will contain only the ones having
appropriate metadata associated (the type of metadata is defined by the
<code class="docutils literal"><span class="pre">imageType</span></code> attribute: this particular example requires it to be tagged as
&#8220;Generic Linux&#8221;).</p>
<p>Field of type <code class="docutils literal"><span class="pre">flavor</span></code> will render a drop-down list allowing you to choose a
flavor for your VM among the ones registered in Nova.</p>
<p>Field of type <code class="docutils literal"><span class="pre">password</span></code> will render a pair of text-boxes in a password
input mode (i.e. hiding all the input with &#8216;*&#8217;-characters). The rendered field
will have appropriate validation: it will ensure that the values entered in
both fields are identical (thus providing a &#8220;repeat password&#8221; functionality)
and will also enforce password complexity check.</p>
<p>This defines the basic UI, but it is not particularly user friendly: when
MuranoDashboard renders the wizard it will label appropriate controls with the
names of the fields, but they usually don&#8217;t look informative and pretty.</p>
<p>So, to improve the user experience you may add additional attributes to field
descriptors here. <code class="docutils literal"><span class="pre">label</span></code> attribute allows you to define a custom label to be
rendered next to appropriate control, <code class="docutils literal"><span class="pre">description</span></code> allows you to provide a
longer text to be displayed on the form as a description of the control, and,
finally, an <code class="docutils literal"><span class="pre">initial</span></code> attribute allows you define the default value to be
entered into the control when it is shown to the end-user.</p>
<p>Modify the <code class="docutils literal"><span class="pre">Forms</span></code> section to use these attributes:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Forms</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">instanceConfiguration</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hostname</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="hll">          <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Host Name</span>
</span><span class="hll">          <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;-</span>
</span><span class="hll">            <span class="no">Enter a hostname for a virtual machine to be created</span>
</span><span class="hll">          <span class="l l-Scalar l-Scalar-Plain">initial</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">plone-vm</span>
</span>          <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">image</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">image</span>
          <span class="l l-Scalar l-Scalar-Plain">imageType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">linux</span>
<span class="hll">          <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Instance image</span>
</span><span class="hll">          <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;-</span>
</span><span class="hll">            <span class="no">Select valid image for the application. Image should already be prepared and</span>
</span><span class="hll">            <span class="no">registered in glance.</span>
</span>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">flavor</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">flavor</span>
<span class="hll">          <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Instance flavor</span>
</span><span class="hll">          <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;-</span>
</span><span class="hll">            <span class="no">Select registered in Openstack flavor. Consider that application performance</span>
</span><span class="hll">            <span class="no">depends on this parameter.</span>
</span>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">assignFloatingIp</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">boolean</span>
<span class="hll">          <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Assign Floating IP</span>
</span><span class="hll">          <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;-</span>
</span><span class="hll">             <span class="no">Check to assign floating IP automatically</span>
</span>  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ploneConfiguration</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">installationPath</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="hll">          <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Installation Path</span>
</span><span class="hll">          <span class="l l-Scalar l-Scalar-Plain">initial</span><span class="p p-Indicator">:</span> <span class="s">&#39;/opt/plone&#39;</span>
</span><span class="hll">          <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;-</span>
</span><span class="hll">            <span class="no">Enter the path on the VM filesystem to deploy Plone into</span>
</span>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">defaultPassword</span>
<span class="hll">          <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Admin password</span>
</span><span class="hll">          <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Default administrator&#39;s password</span>
</span>          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
          <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">listeningPort</span>
          <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
<span class="hll">          <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Listening Port</span>
</span><span class="hll">          <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Port to listen at</span>
</span><span class="hll">          <span class="l l-Scalar l-Scalar-Plain">initial</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
</span></pre></div>
</td></tr></table></div>
<p>Now, let&#8217;s add an <code class="docutils literal"><span class="pre">Application</span></code> section to provide templated input for our
app:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Application</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">com.yourdomain.Plone</span>
  <span class="l l-Scalar l-Scalar-Plain">instance</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.resources.LinuxMuranoInstance</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.hostname</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.image</span>
    <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.flavor</span>
    <span class="l l-Scalar l-Scalar-Plain">assignFloatingIp</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.assignFloatingIp</span>
  <span class="l l-Scalar l-Scalar-Plain">installationPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.ploneConfiguration.installationPath</span>
  <span class="l l-Scalar l-Scalar-Plain">defaultPassword</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.ploneConfiguration.defaultPassword</span>
  <span class="l l-Scalar l-Scalar-Plain">listeningPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.ploneConfiguration.listeningPort</span>
</pre></div>
</td></tr></table></div>
<p>Note the <code class="docutils literal"><span class="pre">instance</span></code> part here: since our <code class="docutils literal"><span class="pre">instance</span></code> input property is not
a scalar value but rather an object, we are placing another object template
inside the appropriate section. Note that the type of this object is not
<code class="docutils literal"><span class="pre">io.murano.resources.Instance</span></code> as you could expect based on the property
contract, but a more specific class: <code class="docutils literal"><span class="pre">LinuxMuranoInstance</span></code> in the same
namespace. Since this class inherits the former, it matches the contract, but
it provides a more appropriate implementation than the base one.</p>
<p>Let&#8217;s combine the two snippets together, we&#8217;ll get the final UI definition of
our app:</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Application</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">com.yourdomain.Plone</span>
  <span class="l l-Scalar l-Scalar-Plain">instance</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">?</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">io.murano.resources.LinuxMuranoInstance</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.hostname</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.image</span>
    <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.flavor</span>
    <span class="l l-Scalar l-Scalar-Plain">assignFloatingIp</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.instanceConfiguration.assignFloatingIp</span>
  <span class="l l-Scalar l-Scalar-Plain">installationPath</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.ploneConfiguration.installationPath</span>
  <span class="l l-Scalar l-Scalar-Plain">defaultPassword</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.ploneConfiguration.defaultPassword</span>
  <span class="l l-Scalar l-Scalar-Plain">listeningPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$.ploneConfiguration.listeningPort</span>
<span class="l l-Scalar l-Scalar-Plain">Forms</span><span class="p p-Indicator">:</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">instanceConfiguration</span><span class="p p-Indicator">:</span>
       <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
         <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hostname</span>
           <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
           <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Host Name</span>
           <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;-</span>
             <span class="no">Enter a hostname for a virtual machine to be created</span>
           <span class="l l-Scalar l-Scalar-Plain">initial</span><span class="p p-Indicator">:</span> <span class="s">&#39;plone-vm&#39;</span>
           <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
         <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">image</span>
           <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">image</span>
           <span class="l l-Scalar l-Scalar-Plain">imageType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">linux</span>
           <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Instance image</span>
           <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;-</span>
             <span class="no">Select valid image for the application. Image should already be prepared and</span>
             <span class="no">registered in glance.</span>
         <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">flavor</span>
           <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">flavor</span>
           <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Instance flavor</span>
           <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;-</span>
             <span class="no">Select registered in Openstack flavor. Consider that application performance</span>
             <span class="no">depends on this parameter.</span>
         <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">assignFloatingIp</span>
           <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">boolean</span>
           <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Assign Floating IP</span>
           <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;-</span>
             <span class="no">Check to assign floating IP automatically</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ploneConfiguration</span><span class="p p-Indicator">:</span>
       <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
         <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">installationPath</span>
           <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
           <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Installation Path</span>
           <span class="l l-Scalar l-Scalar-Plain">initial</span><span class="p p-Indicator">:</span> <span class="s">&#39;/opt/plone&#39;</span>
           <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;-</span>
             <span class="no">Enter the path on the VM filesystem to deploy Plone into</span>
         <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">defaultPassword</span>
           <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Admin password</span>
           <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Default administrator&#39;s password</span>
           <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
           <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
         <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">listeningPort</span>
           <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
           <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Listening Port</span>
           <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Port to listen at</span>
           <span class="l l-Scalar l-Scalar-Plain">initial</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
</pre></div>
</td></tr></table></div>
<p>Save this file as a <code class="docutils literal"><span class="pre">ui.yaml</span></code> in a <code class="docutils literal"><span class="pre">UI</span></code> folder of your package. As a final
touch add a logo to the package - save the image below to the root directory of
your package as <code class="docutils literal"><span class="pre">logo.png</span></code>:</p>
<a class="reference internal image-reference" href="../../_images/plone-logo.png"><img alt="../../_images/plone-logo.png" src="../../_images/plone-logo.png" style="width: 100px;" /></a>
<p>The package is ready. Zip it and import to Murano catalog. We are ready to try
it.</p>
</div>
<div class="section" id="deploying-the-package">
<h2>Deploying the package<a class="headerlink" href="#deploying-the-package" title="Permalink to this headline">¶</a></h2>
<p>Go to Murano Dashboard, create an environment and add a &#8220;Plone CMS&#8221; application
to it. You&#8217;ll see the nice wizard with all the field labels and descriptions
you&#8217;ve added to the ui definition file:</p>
<a class="reference internal image-reference" href="../../_images/plone-simple-step1.png"><img alt="../../_images/plone-simple-step1.png" src="../../_images/plone-simple-step1.png" style="width: 50%;" /></a>
<a class="reference internal image-reference" href="../../_images/plone-simple-step2.png"><img alt="../../_images/plone-simple-step2.png" src="../../_images/plone-simple-step2.png" style="width: 50%;" /></a>
<p>After the app is added to the environment, click the &#8220;Deploy this environment&#8221;
button. The deployment will take about 10 minutes, depending on the speed of
the VM&#8217;s internet connection and the amount of packages to be updated. When it
is over, check the &#8220;Last operation&#8221; column in the environment&#8217;s list of
components near the Plone component. It should contain a message &#8220;Plone is up
and running at ...&#8221; followed by ip address and port:</p>
<a class="reference internal image-reference" href="../../_images/plone-ready.png"><img alt="../../_images/plone-ready.png" src="../../_images/plone-ready.png" style="width: 50%;" /></a>
<p>Enter this address to the address bar of your browser. You&#8217;ll see the default
management interface of Plone:</p>
<a class="reference internal image-reference" href="../../_images/plone-admin.png"><img alt="../../_images/plone-admin.png" src="../../_images/plone-admin.png" style="width: 50%;" /></a>
<p>If you click a &#8220;Create a new Plone site&#8221; button you&#8217;ll be prompted for username
and password. Use <code class="docutils literal"><span class="pre">admin</span></code> username and the password which you entered in the
Wizard. See <a class="reference external" href="http://docs.plone.org">Plone Documentation</a> for details on how
to operate Plone.</p>
<p>This concludes this part of the course. The application package we created
demonstrates the basic capabilities of Murano for the deployments of real-world
applications. However, the deployed configuration of Plone is not of
production-grade service: it is just a single VM with all-in-one service
topology, which is not a scalable or fault-tolerant solution.
In the next part we will learn some advanced features which may help to bring
more production-grade capabilities to our package.</p>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Part 3: Creating a Plone CMS application package</a><ul>
<li><a class="reference internal" href="#the-goal">The goal</a></li>
<li><a class="reference internal" href="#preparation">Preparation</a></li>
<li><a class="reference internal" href="#library-classes">Library classes</a></li>
<li><a class="reference internal" href="#provisioning-a-vm">Provisioning a VM</a></li>
<li><a class="reference internal" href="#running-a-command-on-the-vm">Running a command on the VM</a></li>
<li><a class="reference internal" href="#loading-a-script-from-a-resource-file">Loading a script from a resource file</a></li>
<li><a class="reference internal" href="#configuring-openstack-security">Configuring OpenStack Security</a></li>
<li><a class="reference internal" href="#notifying-end-user-on-plone-location">Notifying end-user on Plone location</a></li>
<li><a class="reference internal" href="#completing-the-plone-class">Completing the Plone class</a></li>
<li><a class="reference internal" href="#providing-a-ui-definition">Providing a UI definition</a></li>
<li><a class="reference internal" href="#deploying-the-package">Deploying the package</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="part2.html"
                                  title="previous chapter">Part 2: Customizing your Application Package</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="part4.html"
                                  title="next chapter">Part 4: Refactoring code to use the Application Framework</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/murano
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/appdev-guide/step-by-step/part3.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="part4.html" title="Part 4: Refactoring code to use the Application Framework"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="part2.html" title="Part 2: Customizing your Application Package"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Murano</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../developer_index.html" >Application Developer Guide</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="step_by_step.html" accesskey="U">Developing Murano Packages 101</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Last updated on &#39;Fri Feb 10 03:18:12 2017, commit fbee404&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/Murano");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>