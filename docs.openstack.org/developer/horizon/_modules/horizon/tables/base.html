<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>horizon.tables.base &mdash; horizon 11.0.0.0rc2.dev56 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '11.0.0.0rc2.dev56',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="horizon 11.0.0.0rc2.dev56 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for horizon.tables.base</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2012 Nebula, Inc.</span>
<span class="c1">#</span>
<span class="c1">#    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may</span>
<span class="c1">#    not use this file except in compliance with the License. You may obtain</span>
<span class="c1">#    a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#         http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1">#    Unless required by applicable law or agreed to in writing, software</span>
<span class="c1">#    distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span>
<span class="c1">#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span>
<span class="c1">#    License for the specific language governing permissions and limitations</span>
<span class="c1">#    under the License.</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">attrgetter</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">exceptions</span> <span class="k">as</span> <span class="n">core_exceptions</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">urlresolvers</span>
<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
<span class="kn">from</span> <span class="nn">django.template.defaultfilters</span> <span class="kn">import</span> <span class="n">slugify</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">django.template.defaultfilters</span> <span class="kn">import</span> <span class="n">truncatechars</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">render_to_string</span>
<span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">escape</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">http</span>
<span class="kn">from</span> <span class="nn">django.utils.http</span> <span class="kn">import</span> <span class="n">urlencode</span>
<span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">termcolors</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">horizon</span> <span class="kn">import</span> <span class="n">conf</span>
<span class="kn">from</span> <span class="nn">horizon</span> <span class="kn">import</span> <span class="n">exceptions</span>
<span class="kn">from</span> <span class="nn">horizon.forms</span> <span class="kn">import</span> <span class="n">ThemableCheckboxInput</span>
<span class="kn">from</span> <span class="nn">horizon</span> <span class="kn">import</span> <span class="n">messages</span>
<span class="kn">from</span> <span class="nn">horizon.tables.actions</span> <span class="kn">import</span> <span class="n">FilterAction</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">horizon.tables.actions</span> <span class="kn">import</span> <span class="n">LinkAction</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">horizon.utils</span> <span class="kn">import</span> <span class="n">html</span>


<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">PALETTE</span> <span class="o">=</span> <span class="n">termcolors</span><span class="o">.</span><span class="n">PALETTES</span><span class="p">[</span><span class="n">termcolors</span><span class="o">.</span><span class="n">DEFAULT_PALETTE</span><span class="p">]</span>
<span class="n">STRING_SEPARATOR</span> <span class="o">=</span> <span class="s2">&quot;__&quot;</span>


<span class="nd">@six.python_2_unicode_compatible</span>
<div class="viewcode-block" id="Column"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.Column">[docs]</a><span class="k">class</span> <span class="nc">Column</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">HTMLElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class which represents a single column in a :class:`.DataTable`.</span>

<span class="sd">    .. attribute:: transform</span>

<span class="sd">        A string or callable. If ``transform`` is a string, it should be the</span>
<span class="sd">        name of the attribute on the underlying data class which</span>
<span class="sd">        should be displayed in this column. If it is a callable, it</span>
<span class="sd">        will be passed the current row&#39;s data at render-time and should</span>
<span class="sd">        return the contents of the cell. Required.</span>

<span class="sd">    .. attribute:: verbose_name</span>

<span class="sd">        The name for this column which should be used for display purposes.</span>
<span class="sd">        Defaults to the value of ``transform`` with the first letter</span>
<span class="sd">        of each word capitalized if the ``transform`` is not callable,</span>
<span class="sd">        otherwise it defaults to an empty string (``&quot;&quot;``).</span>

<span class="sd">    .. attribute:: sortable</span>

<span class="sd">        Boolean to determine whether this column should be sortable or not.</span>
<span class="sd">        Defaults to ``True``.</span>

<span class="sd">    .. attribute:: hidden</span>

<span class="sd">        Boolean to determine whether or not this column should be displayed</span>
<span class="sd">        when rendering the table. Default: ``False``.</span>

<span class="sd">    .. attribute:: link</span>

<span class="sd">        A string or callable which returns a URL which will be wrapped around</span>
<span class="sd">        this column&#39;s text as a link.</span>

<span class="sd">    .. attribute:: allowed_data_types</span>

<span class="sd">        A list of data types for which the link should be created.</span>
<span class="sd">        Default is an empty list (``[]``).</span>

<span class="sd">        When the list is empty and the ``link`` attribute is not None, all the</span>
<span class="sd">        rows under this column will be links.</span>

<span class="sd">    .. attribute::  status</span>

<span class="sd">        Boolean designating whether or not this column represents a status</span>
<span class="sd">        (i.e. &quot;enabled/disabled&quot;, &quot;up/down&quot;, &quot;active/inactive&quot;).</span>
<span class="sd">        Default: ``False``.</span>

<span class="sd">    .. attribute::  status_choices</span>

<span class="sd">        A tuple of tuples representing the possible data values for the</span>
<span class="sd">        status column and their associated boolean equivalent. Positive</span>
<span class="sd">        states should equate to ``True``, negative states should equate</span>
<span class="sd">        to ``False``, and indeterminate states should be ``None``.</span>

<span class="sd">        Values are compared in a case-insensitive manner.</span>

<span class="sd">        Example (these are also the default values)::</span>

<span class="sd">            status_choices = (</span>
<span class="sd">                    (&#39;enabled&#39;, True),</span>
<span class="sd">                    (&#39;true&#39;, True),</span>
<span class="sd">                    (&#39;up&#39;, True),</span>
<span class="sd">                    (&#39;active&#39;, True),</span>
<span class="sd">                    (&#39;yes&#39;, True),</span>
<span class="sd">                    (&#39;on&#39;, True),</span>
<span class="sd">                    (&#39;none&#39;, None),</span>
<span class="sd">                    (&#39;unknown&#39;, None),</span>
<span class="sd">                    (&#39;&#39;, None),</span>
<span class="sd">                    (&#39;disabled&#39;, False),</span>
<span class="sd">                    (&#39;down&#39;, False),</span>
<span class="sd">                    (&#39;false&#39;, False),</span>
<span class="sd">                    (&#39;inactive&#39;, False),</span>
<span class="sd">                    (&#39;no&#39;, False),</span>
<span class="sd">                    (&#39;off&#39;, False),</span>
<span class="sd">                )</span>

<span class="sd">    .. attribute::  display_choices</span>

<span class="sd">        A tuple of tuples representing the possible values to substitute</span>
<span class="sd">        the data when displayed in the column cell.</span>

<span class="sd">    .. attribute:: empty_value</span>

<span class="sd">        A string or callable to be used for cells which have no data.</span>
<span class="sd">        Defaults to the string ``&quot;-&quot;``.</span>

<span class="sd">    .. attribute:: summation</span>

<span class="sd">        A string containing the name of a summation method to be used in</span>
<span class="sd">        the generation of a summary row for this column. By default the</span>
<span class="sd">        options are ``&quot;sum&quot;`` or ``&quot;average&quot;``, which behave as expected.</span>
<span class="sd">        Optional.</span>

<span class="sd">    .. attribute:: filters</span>

<span class="sd">        A list of functions (often template filters) to be applied to the</span>
<span class="sd">        value of the data for this column prior to output. This is effectively</span>
<span class="sd">        a shortcut for writing a custom ``transform`` function in simple cases.</span>

<span class="sd">    .. attribute:: classes</span>

<span class="sd">        An iterable of CSS classes which should be added to this column.</span>
<span class="sd">        Example: ``classes=(&#39;foo&#39;, &#39;bar&#39;)``.</span>

<span class="sd">    .. attribute:: attrs</span>

<span class="sd">        A dict of HTML attribute strings which should be added to this column.</span>
<span class="sd">        Example: ``attrs={&quot;data-foo&quot;: &quot;bar&quot;}``.</span>

<span class="sd">    .. attribute:: cell_attributes_getter</span>

<span class="sd">       A callable to get the HTML attributes of a column cell depending</span>
<span class="sd">       on the data. For example, to add additional description or help</span>
<span class="sd">       information for data in a column cell (e.g. in Images panel, for the</span>
<span class="sd">       column &#39;format&#39;)::</span>

<span class="sd">            helpText = {</span>
<span class="sd">              &#39;ARI&#39;:&#39;Amazon Ramdisk Image&#39;,</span>
<span class="sd">              &#39;QCOW2&#39;:&#39;QEMU&#39; Emulator&#39;</span>
<span class="sd">              }</span>

<span class="sd">            getHoverHelp(data):</span>
<span class="sd">              text = helpText.get(data, None)</span>
<span class="sd">              if text:</span>
<span class="sd">                  return {&#39;title&#39;: text}</span>
<span class="sd">              else:</span>
<span class="sd">                  return {}</span>
<span class="sd">            ...</span>
<span class="sd">            ...</span>
<span class="sd">            cell_attributes_getter = getHoverHelp</span>

<span class="sd">    .. attribute:: truncate</span>

<span class="sd">        An integer for the maximum length of the string in this column. If the</span>
<span class="sd">        length of the data in this column is larger than the supplied number,</span>
<span class="sd">        the data for this column will be truncated and an ellipsis will be</span>
<span class="sd">        appended to the truncated data.</span>
<span class="sd">        Defaults to ``None``.</span>

<span class="sd">    .. attribute:: link_classes</span>

<span class="sd">        An iterable of CSS classes which will be added when the column&#39;s text</span>
<span class="sd">        is displayed as a link.</span>
<span class="sd">        This is left for backward compatibility. Deprecated in favor of the</span>
<span class="sd">        link_attributes attribute.</span>
<span class="sd">        Example: ``link_classes=(&#39;link-foo&#39;, &#39;link-bar&#39;)``.</span>
<span class="sd">        Defaults to ``None``.</span>

<span class="sd">    .. attribute:: wrap_list</span>

<span class="sd">        Boolean value indicating whether the contents of this cell should be</span>
<span class="sd">        wrapped in a ``&lt;ul&gt;&lt;/ul&gt;`` tag. Useful in conjunction with Django&#39;s</span>
<span class="sd">        ``unordered_list`` template filter. Defaults to ``False``.</span>

<span class="sd">    .. attribute:: form_field</span>

<span class="sd">        A form field used for inline editing of the column. A django</span>
<span class="sd">        forms.Field can be used or django form.Widget can be used.</span>

<span class="sd">        Example: ``form_field=forms.CharField(required=True)``.</span>
<span class="sd">        Defaults to ``None``.</span>

<span class="sd">    .. attribute:: form_field_attributes</span>

<span class="sd">        The additional html attributes that will be rendered to form_field.</span>
<span class="sd">        Example: ``form_field_attributes={&#39;class&#39;: &#39;bold_input_field&#39;}``.</span>
<span class="sd">        Defaults to ``None``.</span>

<span class="sd">    .. attribute:: update_action</span>

<span class="sd">        The class that inherits from tables.actions.UpdateAction, update_cell</span>
<span class="sd">        method takes care of saving inline edited data. The tables.base.Row</span>
<span class="sd">        get_data method needs to be connected to table for obtaining the data.</span>
<span class="sd">        Example: ``update_action=UpdateCell``.</span>
<span class="sd">        Defaults to ``None``.</span>

<span class="sd">    .. attribute:: link_attrs</span>

<span class="sd">        A dict of HTML attribute strings which should be added when the</span>
<span class="sd">        column&#39;s text is displayed as a link.</span>
<span class="sd">        Examples:</span>
<span class="sd">        ``link_attrs={&quot;data-foo&quot;: &quot;bar&quot;}``.</span>
<span class="sd">        ``link_attrs={&quot;target&quot;: &quot;_blank&quot;, &quot;class&quot;: &quot;link-foo link-bar&quot;}``.</span>
<span class="sd">        Defaults to ``None``.</span>

<span class="sd">    .. attribute:: policy_rules</span>

<span class="sd">        List of scope and rule tuples to do policy checks on, the</span>
<span class="sd">        composition of which is (scope, rule)</span>

<span class="sd">            scope: service type managing the policy for action</span>
<span class="sd">            rule: string representing the action to be checked</span>

<span class="sd">            for a policy that requires a single rule check:</span>
<span class="sd">                policy_rules should look like</span>
<span class="sd">                    &quot;((&quot;compute&quot;, &quot;compute:create_instance&quot;),)&quot;</span>
<span class="sd">            for a policy that requires multiple rule checks:</span>
<span class="sd">                rules should look like</span>
<span class="sd">                    &quot;((&quot;identity&quot;, &quot;identity:list_users&quot;),</span>
<span class="sd">                      (&quot;identity&quot;, &quot;identity:list_roles&quot;))&quot;</span>

<span class="sd">    .. attribute:: help_text</span>

<span class="sd">        A string of simple help text displayed in a tooltip when you hover</span>
<span class="sd">        over the help icon beside the Column name. Defaults to ``None``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">summation_methods</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;sum&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">,</span>
        <span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1"># Used to retain order when instantiating columns on a table</span>
    <span class="n">creation_counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">transform</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">status_choices</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;inactive&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sortable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">link</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">allowed_data_types</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">status</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">status_choices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">display_choices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">empty_value</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">summation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">auto</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">link_classes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">wrap_list</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">form_field</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">form_field_attributes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">update_action</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">link_attrs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">policy_rules</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">cell_attributes_getter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">allowed_data_types</span> <span class="o">=</span> <span class="n">allowed_data_types</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">classes</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attrs</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">transform</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2"> callable&gt;&quot;</span> <span class="o">%</span> <span class="n">transform</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>

        <span class="c1"># Empty string is a valid value for verbose_name</span>
        <span class="k">if</span> <span class="n">verbose_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">transform</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verbose_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose_name</span> <span class="o">=</span> <span class="n">verbose_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">auto</span> <span class="o">=</span> <span class="n">auto</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sortable</span> <span class="o">=</span> <span class="n">sortable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">link</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_data_types</span> <span class="o">=</span> <span class="n">allowed_data_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="n">hidden</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">empty_value</span> <span class="o">=</span> <span class="n">empty_value</span> <span class="ow">or</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span> <span class="o">=</span> <span class="n">truncate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrap_list</span> <span class="o">=</span> <span class="n">wrap_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form_field</span> <span class="o">=</span> <span class="n">form_field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form_field_attributes</span> <span class="o">=</span> <span class="n">form_field_attributes</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_action</span> <span class="o">=</span> <span class="n">update_action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_attrs</span> <span class="o">=</span> <span class="n">link_attrs</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policy_rules</span> <span class="o">=</span> <span class="n">policy_rules</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_text</span> <span class="o">=</span> <span class="n">help_text</span>
        <span class="k">if</span> <span class="n">link_classes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">link_attrs</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">link_classes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_attributes_getter</span> <span class="o">=</span> <span class="n">cell_attributes_getter</span>

        <span class="k">if</span> <span class="n">status_choices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_choices</span> <span class="o">=</span> <span class="n">status_choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_choices</span> <span class="o">=</span> <span class="n">display_choices</span>

        <span class="k">if</span> <span class="n">summation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">summation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summation_methods</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Summation method </span><span class="si">%(summation)s</span><span class="s2"> must be one of </span><span class="si">%(keys)s</span><span class="s2">.&quot;</span><span class="p">,</span>
                <span class="p">{</span><span class="s1">&#39;summation&#39;</span><span class="p">:</span> <span class="n">summation</span><span class="p">,</span>
                 <span class="s1">&#39;keys&#39;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summation_methods</span><span class="o">.</span><span class="n">keys</span><span class="p">())})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summation</span> <span class="o">=</span> <span class="n">summation</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">creation_counter</span> <span class="o">=</span> <span class="n">Column</span><span class="o">.</span><span class="n">creation_counter</span>
        <span class="n">Column</span><span class="o">.</span><span class="n">creation_counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sortable</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;sortable&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;hide&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;anchor&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="Column.allowed"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.Column.allowed">[docs]</a>    <span class="k">def</span> <span class="nf">allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine whether processing/displaying the column is allowed</span>
<span class="sd">        for the current request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">policy_rules</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="n">policy_check</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;POLICY_CHECK_FUNCTION&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">policy_check</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">policy_check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">policy_rules</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="Column.get_raw_data"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.Column.get_raw_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_raw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the raw data for this column, before any filters or</span>
<span class="sd">        formatting are applied to it. This is useful when doing calculations</span>
<span class="sd">        on data in the table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Callable transformations</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
        <span class="c1"># Dict lookups</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Mapping</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="ow">in</span> <span class="n">datum</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">datum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Basic object lookups</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;The attribute </span><span class="si">%(attr)s</span><span class="s2"> doesn&#39;t exist on &quot;</span>
                        <span class="s2">&quot;</span><span class="si">%(obj)s</span><span class="s2">.&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attr&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">:</span> <span class="n">datum</span><span class="p">}</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">termcolors</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">**</span><span class="n">PALETTE</span><span class="p">[</span><span class="s1">&#39;ERROR&#39;</span><span class="p">])</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Column.get_data"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.Column.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the final display data for this column from the given</span>
<span class="sd">        inputs.</span>

<span class="sd">        The return value will be either the attribute specified for this column</span>
<span class="sd">        or the return value of the attr:`~horizon.tables.Column.transform`</span>
<span class="sd">        method for this column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">datum_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">datum_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_data_cache</span><span class="p">[</span><span class="bp">self</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_data_cache</span><span class="p">[</span><span class="bp">self</span><span class="p">][</span><span class="n">datum_id</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_raw_data</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
        <span class="n">display_value</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_choices</span><span class="p">:</span>
            <span class="n">display_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">display</span> <span class="k">for</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">display</span><span class="p">)</span> <span class="ow">in</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">display_choices</span>
                             <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span><span class="n">data</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

        <span class="k">if</span> <span class="n">display_value</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">display_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">filter_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">filter_func</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Filter &#39;</span><span class="si">%(filter)s</span><span class="s2">&#39; failed with data &quot;</span>
                           <span class="s2">&quot;&#39;</span><span class="si">%(data)s</span><span class="s2">&#39; on column &#39;</span><span class="si">%(col_name)s</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="n">filter_func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
                            <span class="s1">&#39;col_name&#39;</span><span class="p">:</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">)}</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">truncatechars</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncate</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_data_cache</span><span class="p">[</span><span class="bp">self</span><span class="p">][</span><span class="n">datum_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_data_cache</span><span class="p">[</span><span class="bp">self</span><span class="p">][</span><span class="n">datum_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="Column.get_link_url"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.Column.get_link_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the final value for the column&#39;s ``link`` property.</span>

<span class="sd">        If ``allowed_data_types`` of this column  is not empty and the datum</span>
<span class="sd">        has an assigned type, check if the datum&#39;s type is in the</span>
<span class="sd">        ``allowed_data_types`` list. If not, the datum won&#39;t be displayed</span>
<span class="sd">        as a link.</span>

<span class="sd">        If ``link`` is a callable, it will be passed the current data object</span>
<span class="sd">        and should return a URL. Otherwise ``get_link_url`` will attempt to</span>
<span class="sd">        call ``reverse`` on ``link`` with the object&#39;s id as a parameter.</span>
<span class="sd">        Failing that, it will simply return the value of ``link``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_data_types</span><span class="p">:</span>
            <span class="n">data_type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">data_type_name</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="n">data_type_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_data_types</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="n">obj_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">urlresolvers</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">obj_id</span><span class="p">,))</span>
        <span class="k">except</span> <span class="n">urlresolvers</span><span class="o">.</span><span class="n">NoReverseMatch</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span></div>

    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;INTEGRATION_TESTS_SUPPORT&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">get_default_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_default_attrs</span><span class="p">()</span>
            <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;data-selenium&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">attrs</span>

<div class="viewcode-block" id="Column.get_summation"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.Column.get_summation">[docs]</a>    <span class="k">def</span> <span class="nf">get_summation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the summary value for the data in this column if a</span>
<span class="sd">        valid summation method is specified for it. Otherwise returns ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summation_methods</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">summation_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summation_methods</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">summation</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_raw_data</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">raw_data</span> <span class="k">for</span> <span class="n">raw_data</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">summation</span> <span class="o">=</span> <span class="n">summation_function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">filter_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
                    <span class="n">summation</span> <span class="o">=</span> <span class="n">filter_func</span><span class="p">(</span><span class="n">summation</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">summation</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">None</span></div></div>


<span class="k">class</span> <span class="nc">WrappingColumn</span><span class="p">(</span><span class="n">Column</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A column that wraps its contents. Useful for data like UUIDs or names&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WrappingColumn</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;word-break&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Row"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.Row">[docs]</a><span class="k">class</span> <span class="nc">Row</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">HTMLElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a row in the table.</span>

<span class="sd">    When iterated, the ``Row`` instance will yield each of its cells.</span>

<span class="sd">    Rows are capable of AJAX updating, with a little added work:</span>

<span class="sd">    The ``ajax`` property needs to be set to ``True``, and</span>
<span class="sd">    subclasses need to define a ``get_data`` method which returns a data</span>
<span class="sd">    object appropriate for consumption by the table (effectively the &quot;get&quot;</span>
<span class="sd">    lookup versus the table&#39;s &quot;list&quot; lookup).</span>

<span class="sd">    The automatic update interval is configurable by setting the key</span>
<span class="sd">    ``ajax_poll_interval`` in the ``HORIZON_CONFIG`` dictionary.</span>
<span class="sd">    Default: ``2500`` (measured in milliseconds).</span>

<span class="sd">    .. attribute:: table</span>

<span class="sd">        The table which this row belongs to.</span>

<span class="sd">    .. attribute:: datum</span>

<span class="sd">        The data object which this row represents.</span>

<span class="sd">    .. attribute:: id</span>

<span class="sd">        A string uniquely representing this row composed of the table name</span>
<span class="sd">        and the row data object&#39;s identifier.</span>

<span class="sd">    .. attribute:: cells</span>

<span class="sd">        The cells belonging to this row stored in a ``OrderedDict`` object.</span>
<span class="sd">        This attribute is populated during instantiation.</span>

<span class="sd">    .. attribute:: status</span>

<span class="sd">        Boolean value representing the status of this row calculated from</span>
<span class="sd">        the values of the table&#39;s ``status_columns`` if they are set.</span>

<span class="sd">    .. attribute:: status_class</span>

<span class="sd">        Returns a css class for the status of the row based on ``status``.</span>

<span class="sd">    .. attribute:: ajax</span>

<span class="sd">        Boolean value to determine whether ajax updating for this row is</span>
<span class="sd">        enabled.</span>

<span class="sd">    .. attribute:: ajax_action_name</span>

<span class="sd">        String that is used for the query parameter key to request AJAX</span>
<span class="sd">        updates. Generally you won&#39;t need to change this value.</span>
<span class="sd">        Default: ``&quot;row_update&quot;``.</span>

<span class="sd">    .. attribute:: ajax_cell_action_name</span>

<span class="sd">        String that is used for the query parameter key to request AJAX</span>
<span class="sd">        updates of cell. Generally you won&#39;t need to change this value.</span>
<span class="sd">        It is also used for inline edit of the cell.</span>
<span class="sd">        Default: ``&quot;cell_update&quot;``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ajax</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">ajax_action_name</span> <span class="o">=</span> <span class="s2">&quot;row_update&quot;</span>
    <span class="n">ajax_cell_action_name</span> <span class="o">=</span> <span class="s2">&quot;cell_update&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">datum</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Row</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="n">datum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_cells</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Row.load_cells"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.Row.load_cells">[docs]</a>    <span class="k">def</span> <span class="nf">load_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the row&#39;s data (either provided at initialization or as an</span>
<span class="sd">        argument to this function), initialize all the cells contained</span>
<span class="sd">        by this row, and set the appropriate row properties which require</span>
<span class="sd">        the row&#39;s data to be determined.</span>

<span class="sd">        This function is called automatically by</span>
<span class="sd">        :meth:`~horizon.tables.Row.__init__` if the ``datum`` argument is</span>
<span class="sd">        provided. However, by not providing the data during initialization</span>
<span class="sd">        this function allows for the possibility of a two-step loading</span>
<span class="sd">        pattern when you need a row instance but don&#39;t yet have the data</span>
<span class="sd">        available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Compile all the cells on instantiation.</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span>
        <span class="k">if</span> <span class="n">datum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="n">datum</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">datum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datum</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">cell_class</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">column</span><span class="o">.</span><span class="n">auto</span><span class="p">,</span> <span class="n">cell</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ajax</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">HORIZON_CONFIG</span><span class="p">[</span><span class="s1">&#39;ajax_poll_interval&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;data-update-interval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;data-update-url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ajax_update_url</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ajax-update&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;data-object-id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>

        <span class="c1"># Add the row&#39;s status class and id to the attributes to be rendered.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_class</span><span class="p">)</span>
        <span class="n">id_vals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                   <span class="s2">&quot;sep&quot;</span><span class="p">:</span> <span class="n">STRING_SEPARATOR</span><span class="p">,</span>
                   <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(table)s%(sep)s</span><span class="s2">row</span><span class="si">%(sep)s%(id)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">id_vals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>

        <span class="c1"># Add the row&#39;s display name if available</span>
        <span class="n">display_name</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_object_display</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
        <span class="n">display_name_key</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_object_display_key</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">display_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;data-display&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">escape</span><span class="p">(</span><span class="n">display_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;data-display-key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">escape</span><span class="p">(</span><span class="n">display_name_key</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">status_columns</span>
        <span class="k">if</span> <span class="n">column_names</span><span class="p">:</span>
            <span class="n">statuses</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="p">)</span> <span class="k">for</span>
                             <span class="n">column_name</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">calculate_row_status</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">status_columns</span>
        <span class="k">if</span> <span class="n">column_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">get_row_status_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s2">&quot;horizon/common/_data_table_row.html&quot;</span><span class="p">,</span>
                                <span class="p">{</span><span class="s2">&quot;row&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">})</span>

<div class="viewcode-block" id="Row.get_cells"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.Row.get_cells">[docs]</a>    <span class="k">def</span> <span class="nf">get_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the bound cells for this row in order.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">get_ajax_update_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">table_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">([</span>
            <span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ajax_action_name</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;obj_id&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">))</span>
        <span class="p">]))</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">?</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

<div class="viewcode-block" id="Row.can_be_selected"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.Row.can_be_selected">[docs]</a>    <span class="k">def</span> <span class="nf">can_be_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;By default if multiselect enabled return True. You can remove the</span>
<span class="sd">        checkbox after an ajax update here if required.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="Row.get_data"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.Row.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetches the updated data for the row based on the object id</span>
<span class="sd">        passed in. Must be implemented by a subclass to allow AJAX updating.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span></div></div>


<span class="k">class</span> <span class="nc">Cell</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">HTMLElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a single cell in the table.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="n">classes</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Cell</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attrs</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="n">datum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrap_list</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">wrap_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inline_edit_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">update_action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="c1"># initialize the update action if available</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_edit_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">update_action</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;data-cell-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;data-update-url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ajax_update_url</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inline_edit_mod</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># add tooltip to cells if the truncate variable is set</span>
        <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">truncate</span><span class="p">:</span>
            <span class="c1"># NOTE(tsufiev): trying to pull cell raw data out of datum for</span>
            <span class="c1"># those columns where truncate is False leads to multiple errors</span>
            <span class="c1"># in unit tests</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">column</span><span class="o">.</span><span class="n">truncate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;data-toggle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tooltip&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;INTEGRATION_TESTS_SUPPORT&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;data-selenium&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetches the data to be displayed in this cell.&quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">table</span>
        <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">auto</span> <span class="o">==</span> <span class="s2">&quot;multi_select&quot;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">can_be_selected</span><span class="p">(</span><span class="n">datum</span><span class="p">):</span>
                <span class="n">widget</span> <span class="o">=</span> <span class="n">ThemableCheckboxInput</span><span class="p">(</span><span class="n">check_test</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">False</span><span class="p">)</span>
                <span class="c1"># Convert value to string to avoid accidental type conversion</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;object_ids&#39;</span><span class="p">,</span>
                                     <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)),</span>
                                     <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;table-row-multi-select&#39;</span><span class="p">})</span>
            <span class="n">table</span><span class="o">.</span><span class="n">_data_cache</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">auto</span> <span class="o">==</span> <span class="s2">&quot;form_field&quot;</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">form_field</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">forms</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="n">widget</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">widget</span>

            <span class="n">widget_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">__</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                 <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)))</span>

            <span class="c1"># Create local copy of attributes, so it don&#39;t change column</span>
            <span class="c1"># class form_field_attributes</span>
            <span class="n">form_field_attributes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">form_field_attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">form_field_attributes</span><span class="p">)</span>
            <span class="c1"># Adding id of the input so it pairs with label correctly</span>
            <span class="n">form_field_attributes</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget_name</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">defaultfilters</span><span class="o">.</span><span class="n">urlize</span> <span class="ow">in</span> <span class="n">column</span><span class="o">.</span><span class="n">filters</span> <span class="ow">or</span>
                    <span class="n">template</span><span class="o">.</span><span class="n">defaultfilters</span><span class="o">.</span><span class="n">yesno</span> <span class="ow">in</span> <span class="n">column</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">widget_name</span><span class="p">,</span>
                                     <span class="n">column</span><span class="o">.</span><span class="n">get_raw_data</span><span class="p">(</span><span class="n">datum</span><span class="p">),</span>
                                     <span class="n">form_field_attributes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">widget_name</span><span class="p">,</span>
                                     <span class="n">column</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">datum</span><span class="p">),</span>
                                     <span class="n">form_field_attributes</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">_data_cache</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">auto</span> <span class="o">==</span> <span class="s2">&quot;actions&quot;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">render_row_actions</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">_data_cache</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">cell_attributes_getter</span><span class="p">:</span>
                <span class="n">cell_attributes</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">cell_attributes_getter</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cell_attributes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">__</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">))))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a formatted version of the data for final output.</span>

<span class="sd">        This takes into consideration the</span>
<span class="sd">        :attr:`~horizon.tables.Column.link`` and</span>
<span class="sd">        :attr:`~horizon.tables.Column.empty_value`</span>
<span class="sd">        attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">empty_value</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">empty_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">empty_value</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">exc_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">TemplateSyntaxError</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">auto</span> <span class="o">==</span> <span class="s2">&quot;form_field&quot;</span><span class="p">:</span>
            <span class="n">link_attrs</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">link_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="c1"># Escape the data inside while allowing our HTML to render</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot; </span><span class="si">%s</span><span class="s1">&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                             <span class="p">(</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">),</span>
                              <span class="n">link_attrs</span><span class="p">,</span>
                              <span class="n">escape</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">data</span><span class="p">)))))</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">link</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">get_link_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">url</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the status for the column based on the cell&#39;s data.&quot;&quot;&quot;</span>
        <span class="c1"># Deal with status column mechanics based in this cell&#39;s data</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_status&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">status</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">status_columns</span><span class="p">:</span>
            <span class="c1"># returns the first matching status found</span>
            <span class="n">data_status_lower</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">get_raw_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">status_name</span><span class="p">,</span> <span class="n">status_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">status_choices</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">status_name</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">data_status_lower</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status_value</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>

    <span class="k">def</span> <span class="nf">get_status_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a css class name determined by the status value.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;status_up&quot;</span>
        <span class="k">elif</span> <span class="n">status</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;status_down&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;warning&quot;</span>

    <span class="k">def</span> <span class="nf">get_default_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a flattened string of the cell&#39;s CSS classes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">classes</span>
                                   <span class="k">if</span> <span class="bp">cls</span> <span class="o">!=</span> <span class="s2">&quot;anchor&quot;</span><span class="p">]</span>
        <span class="n">column_class_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">get_final_attrs</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">column_class_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
            <span class="n">classes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_status_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_edit_available</span><span class="p">:</span>
            <span class="n">classes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;inline_edit_available&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_ajax_update_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span>
        <span class="n">table_url</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">([</span>
            <span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="o">.</span><span class="n">ajax_cell_action_name</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;cell_name&quot;</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;obj_id&quot;</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">))</span>
        <span class="p">]))</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">?</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">update_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines whether update of given cell is allowed.</span>

<span class="sd">        Calls allowed action of defined UpdateAction of the Column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_action</span><span class="o">.</span><span class="n">allowed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">request</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s2">&quot;horizon/common/_data_table_cell.html&quot;</span><span class="p">,</span>
                                <span class="p">{</span><span class="s2">&quot;cell&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">})</span>


<div class="viewcode-block" id="DataTableOptions"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTableOptions">[docs]</a><span class="k">class</span> <span class="nc">DataTableOptions</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Contains options for :class:`.DataTable` objects.</span>

<span class="sd">    .. attribute:: name</span>

<span class="sd">        A short name or slug for the table.</span>

<span class="sd">    .. attribute:: verbose_name</span>

<span class="sd">        A more verbose name for the table meant for display purposes.</span>

<span class="sd">    .. attribute:: columns</span>

<span class="sd">        A list of column objects or column names. Controls ordering/display</span>
<span class="sd">        of the columns in the table.</span>

<span class="sd">    .. attribute:: table_actions</span>

<span class="sd">        A list of action classes derived from the</span>
<span class="sd">        :class:`~horizon.tables.Action` class. These actions will handle tasks</span>
<span class="sd">        such as bulk deletion, etc. for multiple objects at once.</span>

<span class="sd">    .. attribute:: table_actions_menu</span>

<span class="sd">        A list of action classes similar to ``table_actions`` except these</span>
<span class="sd">        will be displayed in a menu instead of as individual buttons. Actions</span>
<span class="sd">        from this list will take precedence over actions from the</span>
<span class="sd">        ``table_actions`` list.</span>

<span class="sd">    .. attribute:: row_actions</span>

<span class="sd">        A list similar to ``table_actions`` except tailored to appear for</span>
<span class="sd">        each row. These actions act on a single object at a time.</span>

<span class="sd">    .. attribute:: actions_column</span>

<span class="sd">        Boolean value to control rendering of an additional column containing</span>
<span class="sd">        the various actions for each row. Defaults to ``True`` if any actions</span>
<span class="sd">        are specified in the ``row_actions`` option.</span>

<span class="sd">    .. attribute:: multi_select</span>

<span class="sd">        Boolean value to control rendering of an extra column with checkboxes</span>
<span class="sd">        for selecting multiple objects in the table. Defaults to ``True`` if</span>
<span class="sd">        any actions are specified in the ``table_actions`` option.</span>

<span class="sd">    .. attribute:: filter</span>

<span class="sd">        Boolean value to control the display of the &quot;filter&quot; search box</span>
<span class="sd">        in the table actions. By default it checks whether or not an instance</span>
<span class="sd">        of :class:`.FilterAction` is in ``table_actions``.</span>

<span class="sd">    .. attribute:: template</span>

<span class="sd">        String containing the template which should be used to render the</span>
<span class="sd">        table. Defaults to ``&quot;horizon/common/_data_table.html&quot;``.</span>

<span class="sd">    .. attribute:: row_actions_dropdown_template</span>

<span class="sd">        String containing the template which should be used to render the</span>
<span class="sd">        row actions dropdown. Defaults to</span>
<span class="sd">        ``&quot;horizon/common/_data_table_row_actions_dropdown.html&quot;``.</span>

<span class="sd">    .. attribute:: row_actions_row_template</span>

<span class="sd">        String containing the template which should be used to render the</span>
<span class="sd">        row actions. Defaults to</span>
<span class="sd">        ``&quot;horizon/common/_data_table_row_actions_row.html&quot;``.</span>

<span class="sd">    .. attribute:: table_actions_template</span>

<span class="sd">        String containing the template which should be used to render the</span>
<span class="sd">        table actions. Defaults to</span>
<span class="sd">        ``&quot;horizon/common/_data_table_table_actions.html&quot;``.</span>

<span class="sd">    .. attribute:: context_var_name</span>

<span class="sd">        The name of the context variable which will contain the table when</span>
<span class="sd">        it is rendered. Defaults to ``&quot;table&quot;``.</span>

<span class="sd">    .. attribute:: prev_pagination_param</span>

<span class="sd">        The name of the query string parameter which will be used when</span>
<span class="sd">        paginating backward in this table. When using multiple tables in a</span>
<span class="sd">        single view this will need to be changed to differentiate between the</span>
<span class="sd">        tables. Default: ``&quot;prev_marker&quot;``.</span>

<span class="sd">    .. attribute:: pagination_param</span>

<span class="sd">        The name of the query string parameter which will be used when</span>
<span class="sd">        paginating forward in this table. When using multiple tables in a</span>
<span class="sd">        single view this will need to be changed to differentiate between the</span>
<span class="sd">        tables. Default: ``&quot;marker&quot;``.</span>

<span class="sd">    .. attribute:: status_columns</span>

<span class="sd">        A list or tuple of column names which represents the &quot;state&quot;</span>
<span class="sd">        of the data object being represented.</span>

<span class="sd">        If ``status_columns`` is set, when the rows are rendered the value</span>
<span class="sd">        of this column will be used to add an extra class to the row in</span>
<span class="sd">        the form of ``&quot;status_up&quot;`` or ``&quot;status_down&quot;`` for that row&#39;s</span>
<span class="sd">        data.</span>

<span class="sd">        The row status is used by other Horizon components to trigger tasks</span>
<span class="sd">        such as dynamic AJAX updating.</span>

<span class="sd">    .. attribute:: cell_class</span>

<span class="sd">        The class which should be used for rendering the cells of this table.</span>
<span class="sd">        Optional. Default: :class:`~horizon.tables.Cell`.</span>

<span class="sd">    .. attribute:: row_class</span>

<span class="sd">        The class which should be used for rendering the rows of this table.</span>
<span class="sd">        Optional. Default: :class:`~horizon.tables.Row`.</span>

<span class="sd">    .. attribute:: column_class</span>

<span class="sd">        The class which should be used for handling the columns of this table.</span>
<span class="sd">        Optional. Default: :class:`~horizon.tables.Column`.</span>

<span class="sd">    .. attribute:: css_classes</span>

<span class="sd">        A custom CSS class or classes to add to the ``&lt;table&gt;`` tag of the</span>
<span class="sd">        rendered table, for when the particular table requires special styling.</span>
<span class="sd">        Default: ``&quot;&quot;``.</span>

<span class="sd">    .. attribute:: mixed_data_type</span>

<span class="sd">        A toggle to indicate if the table accepts two or more types of data.</span>
<span class="sd">        Optional. Default: ``False``</span>

<span class="sd">    .. attribute:: data_types</span>

<span class="sd">        A list of data types that this table would accept. Default to be an</span>
<span class="sd">        empty list, but if the attribute ``mixed_data_type`` is set to</span>
<span class="sd">        ``True``, then this list must have at least one element.</span>

<span class="sd">    .. attribute:: data_type_name</span>

<span class="sd">        The name of an attribute to assign to data passed to the table when it</span>
<span class="sd">        accepts mix data. Default: ``&quot;_table_data_type&quot;``</span>

<span class="sd">    .. attribute:: footer</span>

<span class="sd">        Boolean to control whether or not to show the table&#39;s footer.</span>
<span class="sd">        Default: ``True``.</span>

<span class="sd">    .. attribute:: hidden_title</span>

<span class="sd">        Boolean to control whether or not to show the table&#39;s title.</span>
<span class="sd">        Default: ``True``.</span>

<span class="sd">    .. attribute:: permissions</span>

<span class="sd">        A list of permission names which this table requires in order to be</span>
<span class="sd">        displayed. Defaults to an empty list (``[]``).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;verbose_name&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                        <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_name</span> <span class="o">=</span> <span class="n">verbose_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_columns</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;status_columns&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_actions</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;table_actions&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_actions</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;row_actions&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_actions_menu</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;table_actions_menu&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;cell_class&#39;</span><span class="p">,</span> <span class="n">Cell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;row_class&#39;</span><span class="p">,</span> <span class="n">Row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;column_class&#39;</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">css_classes</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;css_classes&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_pagination_param</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                                             <span class="s1">&#39;prev_pagination_param&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;prev_marker&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pagination_param</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;pagination_param&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser_table</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;browser_table&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">footer</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;footer&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_title</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;hidden_title&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_data_message</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                                       <span class="s2">&quot;no_data_message&quot;</span><span class="p">,</span>
                                       <span class="n">_</span><span class="p">(</span><span class="s2">&quot;No items to display.&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">permissions</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;permissions&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Set self.filter if we have any FilterActions</span>
        <span class="n">filter_actions</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_actions</span> <span class="k">if</span>
                          <span class="nb">issubclass</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">FilterAction</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_actions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Multiple filter actions are not &quot;</span>
                                      <span class="s2">&quot;currently supported.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_actions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_actions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filter_action</span> <span class="o">=</span> <span class="n">filter_actions</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filter_action</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                                <span class="s1">&#39;template&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;horizon/common/_data_table.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_actions_dropdown_template</span> <span class="o">=</span> \
            <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                    <span class="s1">&#39;row_actions_dropdown_template&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;horizon/common/_data_table_row_actions_dropdown.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_actions_row_template</span> <span class="o">=</span> \
            <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                    <span class="s1">&#39;row_actions_row_template&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;horizon/common/_data_table_row_actions_row.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_actions_template</span> <span class="o">=</span> \
            <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                    <span class="s1">&#39;table_actions_template&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;horizon/common/_data_table_table_actions.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_var_name</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                                                      <span class="s1">&#39;context_var_name&#39;</span><span class="p">,</span>
                                                      <span class="s1">&#39;table&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions_column</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                                      <span class="s1">&#39;actions_column&#39;</span><span class="p">,</span>
                                      <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_actions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_select</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                                    <span class="s1">&#39;multi_select&#39;</span><span class="p">,</span>
                                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_actions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Set runtime table defaults; not configurable.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_prev_data</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_more_data</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># Set mixed data type table attr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mixed_data_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;mixed_data_type&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_types</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;data_types&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># If the data_types has more than 2 elements, set mixed_data_type</span>
        <span class="c1"># to True automatically.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mixed_data_type</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c1"># However, if the mixed_data_type is set to True manually and</span>
        <span class="c1"># the data_types is empty, raise an error.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mixed_data_type</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_types</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If mixed_data_type is set to True in class </span><span class="si">%s</span><span class="s2">, &quot;</span>
                             <span class="s2">&quot;data_types should has more than one types&quot;</span> <span class="o">%</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_type_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                                      <span class="s1">&#39;data_type_name&#39;</span><span class="p">,</span>
                                      <span class="s2">&quot;_table_data_type&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filter_first_message</span> <span class="o">=</span> \
            <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>
                    <span class="s1">&#39;filter_first_message&#39;</span><span class="p">,</span>
                    <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Please specify a search criteria first.&#39;</span><span class="p">))</span></div>


<span class="k">class</span> <span class="nc">DataTableMetaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass to add options to DataTable class and collect columns.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="c1"># Process options from Meta</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">dt_attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dt_attrs</span><span class="p">[</span><span class="s2">&quot;_meta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span> <span class="o">=</span> <span class="n">DataTableOptions</span><span class="p">(</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Meta&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

        <span class="c1"># Gather columns; this prevents the column from being an attribute</span>
        <span class="c1"># on the DataTable class and avoids naming conflicts.</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">column_class</span><span class="p">,</span> <span class="n">Column</span><span class="p">)):</span>
                <span class="n">column_instance</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                <span class="n">column_instance</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">attr_name</span>
                <span class="n">column_instance</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;normal_column&#39;</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">column_instance</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dt_attrs</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">creation_counter</span><span class="p">)</span>

        <span class="c1"># Iterate in reverse to preserve final order</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;base_columns&#39;</span><span class="p">):</span>
                <span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">base_columns</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="n">dt_attrs</span><span class="p">[</span><span class="s1">&#39;base_columns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>

        <span class="c1"># If the table is in a ResourceBrowser, the column number must meet</span>
        <span class="c1"># these limits because of the width of the browser.</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">browser_table</span> <span class="o">==</span> <span class="s2">&quot;navigation&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You can assign at most three columns to </span><span class="si">%s</span><span class="s2">.&quot;</span>
                             <span class="o">%</span> <span class="n">class_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">browser_table</span> <span class="o">==</span> <span class="s2">&quot;content&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You can assign at most two columns to </span><span class="si">%s</span><span class="s2">.&quot;</span>
                             <span class="o">%</span> <span class="n">class_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># Remove any columns that weren&#39;t declared if we&#39;re being explicit</span>
            <span class="c1"># NOTE: we&#39;re iterating a COPY of the list here!</span>
            <span class="k">for</span> <span class="n">column_data</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">[:]:</span>
                <span class="k">if</span> <span class="n">column_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">opts</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">columns</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">column_data</span><span class="p">))</span>
            <span class="c1"># Re-order based on declared columns</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dt_attrs</span><span class="p">[</span><span class="s1">&#39;_meta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="c1"># Add in our auto-generated columns</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">multi_select</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">browser_table</span> <span class="o">!=</span> <span class="s2">&quot;navigation&quot;</span><span class="p">:</span>
            <span class="n">multi_select</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">column_class</span><span class="p">(</span><span class="s2">&quot;multi_select&quot;</span><span class="p">,</span>
                                             <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                             <span class="n">auto</span><span class="o">=</span><span class="s2">&quot;multi_select&quot;</span><span class="p">)</span>
            <span class="n">multi_select</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;multi_select_column&#39;</span><span class="p">)</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;multi_select&quot;</span><span class="p">,</span> <span class="n">multi_select</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">actions_column</span><span class="p">:</span>
            <span class="n">actions_column</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">column_class</span><span class="p">(</span><span class="s2">&quot;actions&quot;</span><span class="p">,</span>
                                               <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Actions&quot;</span><span class="p">),</span>
                                               <span class="n">auto</span><span class="o">=</span><span class="s2">&quot;actions&quot;</span><span class="p">)</span>
            <span class="n">actions_column</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;actions_column&#39;</span><span class="p">)</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;actions&quot;</span><span class="p">,</span> <span class="n">actions_column</span><span class="p">))</span>
        <span class="c1"># Store this set of columns internally so we can copy them per-instance</span>
        <span class="n">dt_attrs</span><span class="p">[</span><span class="s1">&#39;_columns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>

        <span class="c1"># Gather and register actions for later access since we only want</span>
        <span class="c1"># to instantiate them once.</span>
        <span class="c1"># (list() call gives deterministic sort order, which sets don&#39;t have.)</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">row_actions</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">table_actions</span><span class="p">)</span> <span class="o">|</span>
                       <span class="nb">set</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">table_actions_menu</span><span class="p">))</span>
        <span class="n">actions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
        <span class="n">actions_dict</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">([(</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="p">())</span>
                                                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">])</span>
        <span class="n">dt_attrs</span><span class="p">[</span><span class="s1">&#39;base_actions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">actions_dict</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">_filter_action</span><span class="p">:</span>
            <span class="c1"># Replace our filter action with the instantiated version</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">_filter_action</span> <span class="o">=</span> <span class="n">actions_dict</span><span class="p">[</span><span class="n">opts</span><span class="o">.</span><span class="n">_filter_action</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Create our new class!</span>
        <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dt_attrs</span><span class="p">)</span>


<span class="nd">@six.python_2_unicode_compatible</span>
<span class="nd">@six.add_metaclass</span><span class="p">(</span><span class="n">DataTableMetaclass</span><span class="p">)</span>
<div class="viewcode-block" id="DataTable"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable">[docs]</a><span class="k">class</span> <span class="nc">DataTable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class which defines a table with all data and associated actions.</span>

<span class="sd">    .. attribute:: name</span>

<span class="sd">        String. Read-only access to the name specified in the</span>
<span class="sd">        table&#39;s Meta options.</span>

<span class="sd">    .. attribute:: multi_select</span>

<span class="sd">        Boolean. Read-only access to whether or not this table</span>
<span class="sd">        should display a column for multi-select checkboxes.</span>

<span class="sd">    .. attribute:: data</span>

<span class="sd">        Read-only access to the data this table represents.</span>

<span class="sd">    .. attribute:: filtered_data</span>

<span class="sd">        Read-only access to the data this table represents, filtered by</span>
<span class="sd">        the :meth:`~horizon.tables.FilterAction.filter` method of the table&#39;s</span>
<span class="sd">        :class:`~horizon.tables.FilterAction` class (if one is provided)</span>
<span class="sd">        using the current request&#39;s query parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">needs_form_wrapper</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_needs_form_wrapper</span> <span class="o">=</span> <span class="n">needs_form_wrapper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_data_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">no_data_message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breadcrumb</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_item_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">permissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">permissions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needs_filter_first</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_first_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">filter_first_message</span>

        <span class="c1"># Create a new set</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">_column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">_column</span><span class="o">.</span><span class="n">allowed</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
                <span class="n">column</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">_column</span><span class="p">)</span>
                <span class="n">column</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">column</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_data_cache</span><span class="p">()</span>

        <span class="c1"># Associate these actions with this table</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_actions</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">action</span><span class="o">.</span><span class="n">associate_with_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">needs_summary_row</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">col</span><span class="o">.</span><span class="n">summation</span>
                                      <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">footer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">footer</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">multi_select</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">multi_select</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filtered_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This function should be using django.utils.functional.cached_property</span>
        <span class="c1"># decorator, but unfortunately due to bug in Django</span>
        <span class="c1"># https://code.djangoproject.com/ticket/19872 it would make it fail</span>
        <span class="c1"># when being mocked by mox in tests.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_filtered_data&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">filter</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">_filter_action</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">_filter_action</span>
                <span class="n">filter_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filter_string</span><span class="p">()</span>
                <span class="n">filter_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filter_field</span><span class="p">()</span>
                <span class="n">request_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span>
                <span class="n">needs_preloading</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">filter_string</span>
                                    <span class="ow">and</span> <span class="n">request_method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span>
                                    <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">needs_preloading</span><span class="p">)</span>
                <span class="n">valid_method</span> <span class="o">=</span> <span class="p">(</span><span class="n">request_method</span> <span class="o">==</span> <span class="n">action</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
                <span class="n">not_api_filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter_string</span>
                                  <span class="ow">and</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">is_api_filter</span><span class="p">(</span><span class="n">filter_field</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">valid_method</span> <span class="ow">or</span> <span class="n">needs_preloading</span> <span class="ow">or</span> <span class="n">not_api_filter</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">mixed_data_type</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_data</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">data_type_filter</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">filter_string</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_data</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">filter_string</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_data</span>

    <span class="k">def</span> <span class="nf">slugify_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">slugify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

<div class="viewcode-block" id="DataTable.get_filter_string"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_filter_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_filter_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the filter string value. For &#39;server&#39; type filters this is</span>
<span class="sd">        saved in the session so that it gets persisted across table loads.</span>
<span class="sd">        For other filter types this is obtained from the POST dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filter_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">_filter_action</span>
        <span class="n">param_name</span> <span class="o">=</span> <span class="n">filter_action</span><span class="o">.</span><span class="n">get_param_name</span><span class="p">()</span>
        <span class="n">filter_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">filter_action</span><span class="o">.</span><span class="n">filter_type</span> <span class="o">==</span> <span class="s1">&#39;server&#39;</span><span class="p">:</span>
            <span class="n">filter_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filter_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filter_string</span></div>

<div class="viewcode-block" id="DataTable.get_filter_field"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_filter_field">[docs]</a>    <span class="k">def</span> <span class="nf">get_filter_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the filter field value used for &#39;server&#39; type filters. This</span>
<span class="sd">        is the value from the filter action&#39;s list of filter choices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filter_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">_filter_action</span>
        <span class="n">param_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_field&#39;</span> <span class="o">%</span> <span class="n">filter_action</span><span class="o">.</span><span class="n">get_param_name</span><span class="p">()</span>
        <span class="n">filter_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filter_field</span></div>

    <span class="k">def</span> <span class="nf">_populate_data_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Set up hash tables to store data points for each column</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_columns</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_cache</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_filter_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">datum</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Catch user errors in permission functions here</span>
            <span class="n">row_matched</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">mixed_data_type</span><span class="p">:</span>
                <span class="n">row_matched</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">data_type_matched</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="n">_allowed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">datum</span><span class="p">)</span> <span class="ow">and</span> <span class="n">row_matched</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="c1"># don&#39;t trap mox exceptions (which subclass AssertionError)</span>
            <span class="c1"># when testing!</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error while checking action permissions.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">is_browser_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">browser_table</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

<div class="viewcode-block" id="DataTable.render"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Renders the table using the template from the table options.&quot;&quot;&quot;</span>
        <span class="n">table_template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
        <span class="n">extra_context</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">context_var_name</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span>
                         <span class="s1">&#39;hidden_title&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">hidden_title</span><span class="p">}</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">RequestContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">extra_context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table_template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataTable.get_absolute_url"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_absolute_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the canonical URL for this table.</span>

<span class="sd">        This is used for the POST action attribute on the form element</span>
<span class="sd">        wrapping the table. In many cases it is also useful for redirecting</span>
<span class="sd">        after a successful action on the table.</span>

<span class="sd">        For convenience it defaults to the value of</span>
<span class="sd">        ``request.get_full_path()`` with any query string stripped off,</span>
<span class="sd">        e.g. the path at which the table was requested.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get_full_path</span><span class="p">()</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="DataTable.get_full_url"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_full_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_full_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the full URL path for this table.</span>

<span class="sd">        This is used for the POST action attribute on the form element</span>
<span class="sd">        wrapping the table. We use this method to persist the</span>
<span class="sd">        pagination marker.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get_full_path</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataTable.get_empty_message"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_empty_message">[docs]</a>    <span class="k">def</span> <span class="nf">get_empty_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the message to be displayed when there is no data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_data_message</span></div>

<div class="viewcode-block" id="DataTable.get_filter_first_message"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_filter_first_message">[docs]</a>    <span class="k">def</span> <span class="nf">get_filter_first_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the message to be displayed when the user needs to provide</span>
<span class="sd">        first a search criteria before loading any data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_first_message</span></div>

<div class="viewcode-block" id="DataTable.get_object_by_id"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_object_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lookup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the data object from the table&#39;s dataset which matches</span>
<span class="sd">        the ``lookup`` parameter specified. An error will be raised if</span>
<span class="sd">        the match is not a single data object.</span>

<span class="sd">        We will convert the object id and ``lookup`` to unicode before</span>
<span class="sd">        comparison.</span>

<span class="sd">        Uses :meth:`~horizon.tables.DataTable.get_object_id` internally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lookup</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">):</span>
            <span class="n">lookup</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lookup</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span><span class="p">:</span>
                <span class="n">lookup</span> <span class="o">=</span> <span class="n">lookup</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">obj_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_id</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">):</span>
                <span class="n">obj_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span><span class="p">:</span>
                    <span class="n">obj_id</span> <span class="o">=</span> <span class="n">obj_id</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj_id</span> <span class="o">==</span> <span class="n">lookup</span><span class="p">:</span>
                <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Multiple matches were returned for that id: </span><span class="si">%s</span><span class="s2">.&quot;</span>
                             <span class="o">%</span> <span class="n">matches</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">Http302</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">(),</span>
                                     <span class="n">_</span><span class="p">(</span><span class="s1">&#39;No match returned for the id &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span><span class="p">)</span>
                                     <span class="o">%</span> <span class="n">lookup</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Boolean. Indicates whether there are any available actions on this</span>
<span class="sd">        table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_actions</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_table_actions</span><span class="p">())</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">row_actions</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">needs_form_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Boolean. Indicates whether this table should be rendered wrapped in</span>
<span class="sd">        a ``&lt;form&gt;`` tag or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If needs_form_wrapper is explicitly set, defer to that.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_form_wrapper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_form_wrapper</span>
        <span class="c1"># Otherwise calculate whether or not we need a form element.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_actions</span>

<div class="viewcode-block" id="DataTable.get_table_actions"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_table_actions">[docs]</a>    <span class="k">def</span> <span class="nf">get_table_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of the action instances for this table.&quot;&quot;&quot;</span>
        <span class="n">button_actions</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_actions</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">table_actions</span> <span class="k">if</span>
                          <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">table_actions_menu</span><span class="p">]</span>
        <span class="n">menu_actions</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_actions</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span>
                        <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">table_actions_menu</span><span class="p">]</span>
        <span class="n">bound_actions</span> <span class="o">=</span> <span class="n">button_actions</span> <span class="o">+</span> <span class="n">menu_actions</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">action</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">bound_actions</span> <span class="k">if</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filter_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)]</span></div>

<div class="viewcode-block" id="DataTable.get_row_actions"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_row_actions">[docs]</a>    <span class="k">def</span> <span class="nf">get_row_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of the action instances for a specific row.&quot;&quot;&quot;</span>
        <span class="n">bound_actions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">row_actions</span><span class="p">:</span>
            <span class="c1"># Copy to allow modifying properties per row</span>
            <span class="n">bound_action</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_actions</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="n">bound_action</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">bound_action</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
            <span class="n">bound_action</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="n">datum</span>
            <span class="c1"># Remove disallowed actions.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_action</span><span class="p">(</span><span class="n">bound_action</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span>
                                       <span class="n">datum</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># Hook for modifying actions based on data. No-op by default.</span>
            <span class="n">bound_action</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">datum</span><span class="p">)</span>
            <span class="c1"># Pre-create the URL for this link with appropriate parameters</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">bound_action</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">LinkAction</span><span class="p">):</span>
                <span class="n">bound_action</span><span class="o">.</span><span class="n">bound_url</span> <span class="o">=</span> <span class="n">bound_action</span><span class="o">.</span><span class="n">get_link_url</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
            <span class="n">bound_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bound_action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bound_actions</span></div>

<div class="viewcode-block" id="DataTable.set_multiselect_column_visibility"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.set_multiselect_column_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">set_multiselect_column_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;hide checkbox column if no current table action is allowed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_select</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">select_column</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Try to find if the hidden class need to be</span>
        <span class="c1"># removed or added based on visible flag.</span>
        <span class="n">hidden_found</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span> <span class="ow">in</span> <span class="n">select_column</span><span class="o">.</span><span class="n">classes</span>
        <span class="k">if</span> <span class="n">hidden_found</span> <span class="ow">and</span> <span class="n">visible</span><span class="p">:</span>
            <span class="n">select_column</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;hidden&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">hidden_found</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">visible</span><span class="p">:</span>
            <span class="n">select_column</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;hidden&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataTable.render_table_actions"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.render_table_actions">[docs]</a>    <span class="k">def</span> <span class="nf">render_table_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Renders the actions specified in ``Meta.table_actions``.&quot;&quot;&quot;</span>
        <span class="n">template_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">table_actions_template</span>
        <span class="n">table_actions_template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_path</span><span class="p">)</span>
        <span class="n">bound_actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table_actions</span><span class="p">()</span>
        <span class="n">extra_context</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;table_actions&quot;</span><span class="p">:</span> <span class="n">bound_actions</span><span class="p">,</span>
                         <span class="s2">&quot;table_actions_buttons&quot;</span><span class="p">:</span> <span class="p">[],</span>
                         <span class="s2">&quot;table_actions_menu&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">filter</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filter_action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">_filter_action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)):</span>
            <span class="n">extra_context</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">_filter_action</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">bound_actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">table_actions_menu</span><span class="p">:</span>
                <span class="n">extra_context</span><span class="p">[</span><span class="s1">&#39;table_actions_menu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">action</span> <span class="o">!=</span> <span class="n">extra_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filter&#39;</span><span class="p">):</span>
                <span class="n">extra_context</span><span class="p">[</span><span class="s1">&#39;table_actions_buttons&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">RequestContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">extra_context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_multiselect_column_visibility</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bound_actions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table_actions_template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataTable.render_row_actions"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.render_row_actions">[docs]</a>    <span class="k">def</span> <span class="nf">render_row_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Renders the actions specified in ``Meta.row_actions`` using the</span>
<span class="sd">        current row data. If `row` is True, the actions are rendered in a row</span>
<span class="sd">        of buttons. Otherwise they are rendered in a dropdown box.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">template_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">row_actions_row_template</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">template_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">row_actions_dropdown_template</span>

        <span class="n">row_actions_template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_path</span><span class="p">)</span>
        <span class="n">bound_actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_row_actions</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
        <span class="n">extra_context</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;row_actions&quot;</span><span class="p">:</span> <span class="n">bound_actions</span><span class="p">,</span>
                         <span class="s2">&quot;row_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)}</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">RequestContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">extra_context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row_actions_template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="DataTable.parse_action"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.parse_action">[docs]</a>    <span class="k">def</span> <span class="nf">parse_action</span><span class="p">(</span><span class="n">action_string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parses the ``action`` parameter (a string) sent back with the</span>
<span class="sd">        POST data. By default this parses a string formatted as</span>
<span class="sd">        ``{{ table_name }}__{{ action_name }}__{{ row_id }}`` and returns</span>
<span class="sd">        each of the pieces. The ``row_id`` is optional.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">action_string</span><span class="p">:</span>
            <span class="n">bits</span> <span class="o">=</span> <span class="n">action_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">STRING_SEPARATOR</span><span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">object_id</span> <span class="o">=</span> <span class="n">STRING_SEPARATOR</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bits</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">object_id</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">object_id</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">object_id</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span> <span class="n">table</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">object_id</span></div>

<div class="viewcode-block" id="DataTable.take_action"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.take_action">[docs]</a>    <span class="k">def</span> <span class="nf">take_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">obj_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">obj_ids</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Locates the appropriate action and routes the object</span>
<span class="sd">        data to it. The action should return an HTTP redirect</span>
<span class="sd">        if successful, or a value which evaluates to ``False``</span>
<span class="sd">        if unsuccessful.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># See if we have a list of ids</span>
        <span class="n">obj_ids</span> <span class="o">=</span> <span class="n">obj_ids</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;object_ids&#39;</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_actions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span> <span class="ow">or</span> <span class="n">action</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">:</span>
            <span class="c1"># We either didn&#39;t get an action or we&#39;re being hacked. Goodbye.</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c1"># Meanwhile, back in Gotham...</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">requires_input</span> <span class="ow">or</span> <span class="n">obj_id</span> <span class="ow">or</span> <span class="n">obj_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj_id</span><span class="p">:</span>
                <span class="n">obj_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitize_id</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj_ids</span><span class="p">:</span>
                <span class="n">obj_ids</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sanitize_id</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">obj_ids</span><span class="p">]</span>
            <span class="c1"># Single handling is easy</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">handles_multiple</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">)</span>
            <span class="c1"># Otherwise figure out what to pass along</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Preference given to a specific id, since that implies</span>
                <span class="c1"># the user selected an action for just one row.</span>
                <span class="k">if</span> <span class="n">obj_id</span><span class="p">:</span>
                    <span class="n">obj_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj_id</span><span class="p">]</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">multiple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">obj_ids</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">requires_input</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">obj_id</span> <span class="ow">or</span> <span class="n">obj_ids</span><span class="p">):</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span>
                          <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Please select a row before taking that action.&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">None</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataTable.check_handler"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.check_handler">[docs]</a>    <span class="k">def</span> <span class="nf">check_handler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine whether the request should be handled by this table.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">and</span> <span class="s2">&quot;action&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
            <span class="n">table</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">obj_id</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">parse_action</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="s2">&quot;table&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span> <span class="ow">and</span> <span class="s2">&quot;action&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">]</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span>
            <span class="n">obj_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;obj_id&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">action</span> <span class="o">=</span> <span class="n">obj_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">table</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">obj_id</span></div>

<div class="viewcode-block" id="DataTable.maybe_preempt"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.maybe_preempt">[docs]</a>    <span class="k">def</span> <span class="nf">maybe_preempt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine whether the request should be handled by a preemptive</span>
<span class="sd">        action on this table or by an AJAX row update before loading any data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">obj_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">table_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="c1"># Handle AJAX row updating.</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">row_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">new_row</span><span class="o">.</span><span class="n">ajax</span> <span class="ow">and</span> <span class="n">new_row</span><span class="o">.</span><span class="n">ajax_action_name</span> <span class="o">==</span> <span class="n">action_name</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">datum</span> <span class="o">=</span> <span class="n">new_row</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_item_id</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">new_row</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;current_selected&#39;</span><span class="p">)</span>
                    <span class="n">new_row</span><span class="o">.</span><span class="n">load_cells</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">datum</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">error</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">new_row</span><span class="o">.</span><span class="n">render</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">new_row</span><span class="o">.</span><span class="n">ajax_cell_action_name</span> <span class="o">==</span> <span class="n">action_name</span><span class="p">:</span>
                <span class="c1"># inline edit of the cell actions</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_edit_handle</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span>
                                               <span class="n">action_name</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">,</span>
                                               <span class="n">new_row</span><span class="p">)</span>

            <span class="n">preemptive_actions</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">base_actions</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">preempt</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">action_name</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">preemptive_actions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">action_name</span><span class="p">:</span>
                        <span class="n">handled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">handled</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">handled</span>
        <span class="k">return</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="DataTable.inline_edit_handle"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.inline_edit_handle">[docs]</a>    <span class="k">def</span> <span class="nf">inline_edit_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">,</span>
                           <span class="n">new_row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Inline edit handler.</span>

<span class="sd">        Showing form or handling update by POST of the cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cell_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s1">&#39;cell_name&#39;</span><span class="p">]</span>
            <span class="n">datum</span> <span class="o">=</span> <span class="n">new_row</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">)</span>
            <span class="c1"># TODO(lsmola) extract load cell logic to Cell and load</span>
            <span class="c1"># only 1 cell. This is kind of ugly.</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;inline_edit_mod&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">cell_name</span><span class="p">]</span><span class="o">.</span><span class="n">auto</span> <span class="o">=</span> <span class="s2">&quot;form_field&quot;</span>
                <span class="n">inline_edit_mod</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inline_edit_mod</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="c1"># Load the cell and set the inline_edit_mod.</span>
            <span class="n">new_row</span><span class="o">.</span><span class="n">load_cells</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cell_name</span><span class="p">]</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">inline_edit_mod</span> <span class="o">=</span> <span class="n">inline_edit_mod</span>

            <span class="c1"># If not allowed, neither edit mod or updating is allowed.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cell</span><span class="o">.</span><span class="n">update_allowed</span><span class="p">:</span>
                <span class="n">datum_display</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_object_display</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;N/A&quot;</span><span class="p">)</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Permission denied to </span><span class="si">%s</span><span class="s1">: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="s2">&quot;Update Action&quot;</span><span class="p">,</span> <span class="n">datum_display</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">401</span><span class="p">)</span>
            <span class="c1"># If it is post request, we are updating the cell.</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_update_action</span><span class="p">(</span><span class="n">request</span><span class="p">,</span>
                                                 <span class="n">datum</span><span class="p">,</span>
                                                 <span class="n">cell</span><span class="p">,</span>
                                                 <span class="n">obj_id</span><span class="p">,</span>
                                                 <span class="n">cell_name</span><span class="p">)</span>

            <span class="n">error</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">datum</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">render</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataTable.inline_update_action"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.inline_update_action">[docs]</a>    <span class="k">def</span> <span class="nf">inline_update_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">cell_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handling update by POST of the cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_cell_value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">cell_name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">obj_id</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">form_field</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span>
                      <span class="n">forms</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># using Django Form Field to parse the</span>
                <span class="c1"># right value from POST and to validate it</span>
                <span class="n">new_cell_value</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">cell</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">form_field</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span>
                        <span class="n">new_cell_value</span><span class="p">))</span>
                <span class="n">cell</span><span class="o">.</span><span class="n">update_action</span><span class="o">.</span><span class="n">action</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">datum</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">cell_name</span><span class="p">,</span> <span class="n">new_cell_value</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;updated&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">),</span>
                    <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                    <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">core_exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">:</span>
                <span class="c1"># if there is a validation error, I will</span>
                <span class="c1"># return the message to the client</span>
                <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
                <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;validation_error&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exc_value</span><span class="o">.</span><span class="n">messages</span><span class="p">)}</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">),</span>
                    <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                    <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataTable.maybe_handle"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.maybe_handle">[docs]</a>    <span class="k">def</span> <span class="nf">maybe_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine whether the request should be handled by any action on</span>
<span class="sd">        this table after data has been loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>
        <span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">obj_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="n">action_name</span><span class="p">:</span>
            <span class="n">action_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">base_actions</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">preempt</span><span class="p">]</span>
            <span class="c1"># do not run preemptive actions here</span>
            <span class="k">if</span> <span class="n">action_name</span> <span class="ow">in</span> <span class="n">action_names</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="DataTable.sanitize_id"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.sanitize_id">[docs]</a>    <span class="k">def</span> <span class="nf">sanitize_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override to modify an incoming obj_id to match existing</span>
<span class="sd">        API data types or modify the format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj_id</span></div>

<div class="viewcode-block" id="DataTable.get_object_id"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_object_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the identifier for the object this row will represent.</span>

<span class="sd">        By default this returns an ``id`` attribute on the given object,</span>
<span class="sd">        but this can be overridden to return other values.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            Make sure that the value returned is a unique value for the id</span>
<span class="sd">            otherwise rendering issues can occur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">datum</span><span class="o">.</span><span class="n">id</span></div>

    <span class="k">def</span> <span class="nf">get_object_display_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;name&#39;</span>

<div class="viewcode-block" id="DataTable.get_object_display"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_object_display">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a display name that identifies this object.</span>

<span class="sd">        By default, this returns a ``name`` attribute from the given object,</span>
<span class="sd">        but this can be overridden to return other values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">display_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_display_key</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="n">display_key</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataTable.has_prev_data"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.has_prev_data">[docs]</a>    <span class="k">def</span> <span class="nf">has_prev_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a boolean value indicating whether there is previous data</span>
<span class="sd">        available to this table from the source (generally an API).</span>

<span class="sd">        The method is largely meant for internal use, but if you want to</span>
<span class="sd">        override it to provide custom behavior you can do so at your own risk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">has_prev_data</span></div>

<div class="viewcode-block" id="DataTable.has_more_data"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.has_more_data">[docs]</a>    <span class="k">def</span> <span class="nf">has_more_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a boolean value indicating whether there is more data</span>
<span class="sd">        available to this table from the source (generally an API).</span>

<span class="sd">        The method is largely meant for internal use, but if you want to</span>
<span class="sd">        override it to provide custom behavior you can do so at your own risk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">has_more_data</span></div>

<div class="viewcode-block" id="DataTable.get_prev_marker"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_prev_marker">[docs]</a>    <span class="k">def</span> <span class="nf">get_prev_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the identifier for the first object in the current data set</span>
<span class="sd">        for APIs that use marker/limit-based paging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">urlquote_plus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="DataTable.get_marker"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_marker">[docs]</a>    <span class="k">def</span> <span class="nf">get_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the identifier for the last object in the current data set</span>
<span class="sd">        for APIs that use marker/limit-based paging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">urlquote_plus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="DataTable.get_prev_pagination_string"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_prev_pagination_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_prev_pagination_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the query parameter string to paginate this table</span>
<span class="sd">        to the previous page.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;=&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">prev_pagination_param</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">get_prev_marker</span><span class="p">()])</span></div>

<div class="viewcode-block" id="DataTable.get_pagination_string"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_pagination_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_pagination_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the query parameter string to paginate this table</span>
<span class="sd">        to the next page.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;=&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">pagination_param</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker</span><span class="p">()])</span></div>

<div class="viewcode-block" id="DataTable.calculate_row_status"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.calculate_row_status">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_row_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statuses</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a boolean value determining the overall row status</span>
<span class="sd">        based on the dictionary of column name to status mappings passed in.</span>

<span class="sd">        By default, it uses the following logic:</span>

<span class="sd">        #. If any statuses are ``False``, return ``False``.</span>
<span class="sd">        #. If no statuses are ``False`` but any or ``None``, return ``None``.</span>
<span class="sd">        #. If all statuses are ``True``, return ``True``.</span>

<span class="sd">        This provides the greatest protection against false positives without</span>
<span class="sd">        weighting any particular columns.</span>

<span class="sd">        The ``statuses`` parameter is passed in as a dictionary mapping</span>
<span class="sd">        column names to their statuses in order to allow this function to</span>
<span class="sd">        be overridden in such a way as to weight one column&#39;s status over</span>
<span class="sd">        another should that behavior be desired.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">statuses</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">status</span> <span class="ow">is</span> <span class="bp">False</span> <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">([</span><span class="n">status</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="DataTable.get_row_status_class"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_row_status_class">[docs]</a>    <span class="k">def</span> <span class="nf">get_row_status_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a css class name determined by the status value. This class</span>
<span class="sd">        name is used to indicate the status of the rows in the table if</span>
<span class="sd">        any ``status_columns`` have been specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;status_up&quot;</span>
        <span class="k">elif</span> <span class="n">status</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;status_down&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;warning&quot;</span></div>

<div class="viewcode-block" id="DataTable.get_columns"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_columns">[docs]</a>    <span class="k">def</span> <span class="nf">get_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns this table&#39;s columns including auto-generated ones.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataTable.get_rows"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.get_rows">[docs]</a>    <span class="k">def</span> <span class="nf">get_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the row data for this table broken out by columns.&quot;&quot;&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtered_data</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">row_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_id</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_item_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;current_selected&#39;</span><span class="p">)</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Exceptions can be swallowed at the template level here,</span>
            <span class="c1"># re-raising as a TemplateSyntaxError makes them visible.</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error while rendering table rows.&quot;</span><span class="p">)</span>
            <span class="n">exc_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">TemplateSyntaxError</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">rows</span></div>

<div class="viewcode-block" id="DataTable.css_classes"><a class="viewcode-back" href="../../../ref/tables.html#horizon.tables.DataTable.css_classes">[docs]</a>    <span class="k">def</span> <span class="nf">css_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the additional CSS class to be added to &lt;table&gt; tag.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">css_classes</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/horizon
"
                     rel="nofollow">Project Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">horizon 11.0.0.0rc2.dev56 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, OpenStack Foundation.
      Last updated on &#39;Tue Feb 14 01:44:33 2017, commit d07a02a&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/horizon");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>