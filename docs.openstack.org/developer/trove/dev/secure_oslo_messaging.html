<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Secure RPC messaging &mdash; trove 7.0.0.0rc2.dev2 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.0.0rc2.dev2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="trove 7.0.0.0rc2.dev2 documentation" href="../index.html" />
    <link rel="prev" title="Trove API Extensions" href="trove_api_extensions.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="secure-rpc-messaging">
<span id="id1"></span><h1>Secure RPC messaging<a class="headerlink" href="#secure-rpc-messaging" title="Permalink to this headline">¶</a></h1>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Trove uses oslo_messaging.rpc for communication amongst the various
control plane components and the guest agents. For secure operation of
the system, these RPC calls can be fully encrypted. A control plane
encryption key is used for communications between the API service and
the taskmanager, and system generated per-instance keys are used for
communication between the control plane and guest instances.</p>
<p>This document provides some useful tips on how to use this mechanism.</p>
</div>
<div class="section" id="the-default-system-behavior">
<h2>The default system behavior<a class="headerlink" href="#the-default-system-behavior" title="Permalink to this headline">¶</a></h2>
<p>By default, the system will attempt to encrypt all RPC
communication. This behavior is controlled by the following
configuration parameters:</p>
<ul>
<li><p class="first">enable_secure_rpc_messaging</p>
<p>boolean that determines whether rpc messages will be secured by
encryption. The default value is True.</p>
</li>
<li><p class="first">taskmanager_rpc_encr_key</p>
<p>the key used for encrypting messages sent to the taskmanager. A
default value is provided for this and it is important that
deployers change this.</p>
</li>
<li><p class="first">inst_rpc_key_encr_key</p>
<p>the key used for encrypting the per-instance keys when they are
stored in the trove infrastructure database (catalog). A default is
provided for this and it is important that deployers change this.</p>
</li>
</ul>
</div>
<div class="section" id="interoperability-and-upgrade">
<h2>Interoperability and Upgrade<a class="headerlink" href="#interoperability-and-upgrade" title="Permalink to this headline">¶</a></h2>
<p>Consider the system as shown below which runs a version of code prior
to the introduciton of this oslo_messaging.rpc security. Observe, for
example that the instances table in the system catalog does not
include the per-instance encrypted key column.</p>
<p>mysql&gt; describe instances;
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8211;+&#8212;&#8212;&#8212;+&#8212;&#8212;-+
| Field                | Type         | Null | Key | Default | Extra |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8211;+&#8212;&#8212;&#8212;+&#8212;&#8212;-+
| id                   | varchar(36)  | NO   | PRI | NULL    |       |
| created              | datetime     | YES  |     | NULL    |       |
| updated              | datetime     | YES  |     | NULL    |       |
| name                 | varchar(255) | YES  |     | NULL    |       |
| hostname             | varchar(255) | YES  |     | NULL    |       |
| compute_instance_id  | varchar(36)  | YES  |     | NULL    |       |
| task_id              | int(11)      | YES  |     | NULL    |       |
| task_description     | varchar(255) | YES  |     | NULL    |       |
| task_start_time      | datetime     | YES  |     | NULL    |       |
| volume_id            | varchar(36)  | YES  |     | NULL    |       |
| flavor_id            | varchar(255) | YES  |     | NULL    |       |
| volume_size          | int(11)      | YES  |     | NULL    |       |
| tenant_id            | varchar(36)  | YES  | MUL | NULL    |       |
| server_status        | varchar(64)  | YES  |     | NULL    |       |
| deleted              | tinyint(1)   | YES  | MUL | NULL    |       |
| deleted_at           | datetime     | YES  |     | NULL    |       |
| datastore_version_id | varchar(36)  | NO   | MUL | NULL    |       |
| configuration_id     | varchar(36)  | YES  | MUL | NULL    |       |
| slave_of_id          | varchar(36)  | YES  | MUL | NULL    |       |
| cluster_id           | varchar(36)  | YES  | MUL | NULL    |       |
| shard_id             | varchar(36)  | YES  |     | NULL    |       |
| type                 | varchar(64)  | YES  |     | NULL    |       |
| region_id            | varchar(255) | YES  |     | NULL    |       |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8211;+&#8212;&#8212;&#8212;+&#8212;&#8212;-+
23 rows in set (0.00 sec)</p>
<p>We launch an instance of MySQL using this version of the software.</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove/integration/scripts$ openstack network list
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| ID                                   | Name        | Subnets                              |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
[...]
| 4bab02e7-87bb-4cc0-8c07-2f282c777c85 | public      | e620c4f5-749c-4212-b1d1-4a6e2c0a3f16 |
[...]
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove/integration/scripts$ trove create m2 25 &#8211;size 3 &#8211;nic net-id=4bab02e7-87bb-4cc0-8c07-2f282c777c85
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| Property          | Value                                |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| created           | 2017-01-09T18:17:13                  |
| datastore         | mysql                                |
| datastore_version | 5.6                                  |
| flavor            | 25                                   |
| id                | bb0c9213-31f8-4427-8898-c644254b3642 |
| name              | m2                                   |
| region            | RegionOne                            |
| server_id         | None                                 |
| status            | BUILD                                |
| updated           | 2017-01-09T18:17:13                  |
| volume            | 3                                    |
| volume_id         | None                                 |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove/integration/scripts$ nova list
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+
| ID                                   | Name | Status | Task State | Power State | Networks          |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+
| a4769ce2-4e22-4134-b958-6db6c23cb221 | m2   | BUILD  | spawning   | NOSTATE     | public=172.24.4.4 |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+</p>
<p>And on that machine, the configuration file looks like this:</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;m2">amrith<span>&#64;</span>m2</a>:~$ cat /etc/trove/conf.d/guest_info.conf
[DEFAULT]
guest_id=bb0c9213-31f8-4427-8898-c644254b3642
datastore_manager=mysql
tenant_id=56cca8484d3e48869126ada4f355c284</p>
<p>The instance goes online</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove/integration/scripts$ trove show m2
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| Property          | Value                                |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| created           | 2017-01-09T18:17:13                  |
| datastore         | mysql                                |
| datastore_version | 5.6                                  |
| flavor            | 25                                   |
| id                | bb0c9213-31f8-4427-8898-c644254b3642 |
| name              | m2                                   |
| region            | RegionOne                            |
| server_id         | a4769ce2-4e22-4134-b958-6db6c23cb221 |
| status            | ACTIVE                               |
| updated           | 2017-01-09T18:17:17                  |
| volume            | 3                                    |
| volume_id         | 16e57e3f-b462-4db2-968b-3c284aa2751c |
| volume_used       | 0.11                                 |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+</p>
<p>For testing later, we launch a few more instances.</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove/integration/scripts$ trove create m3 25 &#8211;size 3 &#8211;nic net-id=4bab02e7-87bb-4cc0-8c07-2f282c777c85
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove/integration/scripts$ trove create m4 25 &#8211;size 3 &#8211;nic net-id=4bab02e7-87bb-4cc0-8c07-2f282c777c85</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove/integration/scripts$ trove list
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
| ID                                   | Name | Datastore | Datastore Version | Status | Flavor ID | Size | Region    |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
| 6d55ab3a-267f-4b95-8ada-33fc98fd1767 | m4   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
| 9ceebd62-e13d-43c5-953a-c0f24f08757e | m3   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
| bb0c9213-31f8-4427-8898-c644254b3642 | m2   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+</p>
<p>In this condition, we take down the control plane and upgrade the
software running on it. This will result in a catalog upgrade. Since
this system is based on devstack, here&#8217;s what that looks like.</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove$ git branch
* master</p>
<blockquote>
<div>review/amrith/bp/secure-oslo-messaging-messages</div></blockquote>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove$ git checkout review/amrith/bp/secure-oslo-messaging-messages
Switched to branch &#8216;review/amrith/bp/secure-oslo-messaging-messages&#8217;
Your branch is ahead of &#8216;gerrit/master&#8217; by 1 commit.</p>
<blockquote>
<div>(use &#8220;git push&#8221; to publish your local commits)</div></blockquote>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove$ find . -name &#8216;<a href="#id2"><span class="problematic" id="id3">*</span></a>.pyc&#8217; -delete
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove$</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove$ trove-manage db_sync
[...]
2017-01-09 13:24:25.251 DEBUG migrate.versioning.repository [-] Config: OrderedDict([(&#8216;db_settings&#8217;, OrderedDict([(&#8216;__name__&#8217;, &#8216;db_settings&#8217;), (&#8216;repository_id&#8217;, &#8216;Trove Migrations&#8217;), (&#8216;version_table&#8217;, &#8216;migrate_version&#8217;), (&#8216;required_dbs&#8217;, &#8220;[&#8216;mysql&#8217;,&#8217;postgres&#8217;,&#8217;sqlite&#8217;]&#8221;)]))]) from (pid=96180) __init__ /usr/local/lib/python2.7/dist-packages/migrate/versioning/repository.py:83
2017-01-09 13:24:25.260 INFO migrate.versioning.api [-] 40 -&gt; 41...
2017-01-09 13:24:25.328 INFO migrate.versioning.api [-] done
2017-01-09 13:24:25.329 DEBUG migrate.versioning.util [-] Disposing SQLAlchemy engine Engine(mysql+pymysql://root:<a href="#id4"><span class="problematic" id="id5">**</span></a><a href="#id6"><span class="problematic" id="id7">*</span></a>&#64;127.0.0.1/trove?charset=utf8) from (pid=96180) with_engine /usr/local/lib/python2.7/dist-packages/migrate/versioning/util/__init__.py:163
[...]</p>
<p>We observe that the new table in the system has the encrypted_key column</p>
<p>mysql&gt; describe instances;
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8211;+&#8212;&#8212;&#8212;+&#8212;&#8212;-+
| Field                | Type         | Null | Key | Default | Extra |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8211;+&#8212;&#8212;&#8212;+&#8212;&#8212;-+
| id                   | varchar(36)  | NO   | PRI | NULL    |       |
| created              | datetime     | YES  |     | NULL    |       |
| updated              | datetime     | YES  |     | NULL    |       |
| name                 | varchar(255) | YES  |     | NULL    |       |
| hostname             | varchar(255) | YES  |     | NULL    |       |
| compute_instance_id  | varchar(36)  | YES  |     | NULL    |       |
| task_id              | int(11)      | YES  |     | NULL    |       |
| task_description     | varchar(255) | YES  |     | NULL    |       |
| task_start_time      | datetime     | YES  |     | NULL    |       |
| volume_id            | varchar(36)  | YES  |     | NULL    |       |
| flavor_id            | varchar(255) | YES  |     | NULL    |       |
| volume_size          | int(11)      | YES  |     | NULL    |       |
| tenant_id            | varchar(36)  | YES  | MUL | NULL    |       |
| server_status        | varchar(64)  | YES  |     | NULL    |       |
| deleted              | tinyint(1)   | YES  | MUL | NULL    |       |
| deleted_at           | datetime     | YES  |     | NULL    |       |
| datastore_version_id | varchar(36)  | NO   | MUL | NULL    |       |
| configuration_id     | varchar(36)  | YES  | MUL | NULL    |       |
| slave_of_id          | varchar(36)  | YES  | MUL | NULL    |       |
| cluster_id           | varchar(36)  | YES  | MUL | NULL    |       |
| shard_id             | varchar(36)  | YES  |     | NULL    |       |
| type                 | varchar(64)  | YES  |     | NULL    |       |
| region_id            | varchar(255) | YES  |     | NULL    |       |
| encrypted_key        | varchar(255) | YES  |     | NULL    |       |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8211;+&#8212;&#8212;&#8212;+&#8212;&#8212;-+</p>
<p>mysql&gt; select id, encrypted_key from instances;
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;+
| id                                   | encrypted_key |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;+
| 13a787f2-b699-4867-a727-b3f4d8040a12 | NULL          |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;+
1 row in set (0.00 sec)</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove$ sudo python setup.py install -f
[...]</p>
<p>We can now relaunch the control plane software but before we do that,
we inspect the configuration parameters and disable secure RPC
messaging by adding this line into the configuration files.</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ grep enable_secure_rpc_messaging <a href="#id8"><span class="problematic" id="id9">*</span></a>.conf
trove-conductor.conf:enable_secure_rpc_messaging = False
trove.conf:enable_secure_rpc_messaging = False
trove-taskmanager.conf:enable_secure_rpc_messaging = False</p>
<p>The first thing we observe is that heartbeat messages from the
existing instance are still properly handled by the conductor and the
instance remains active.</p>
<p>2017-01-09 13:26:57.742 DEBUG oslo_messaging._drivers.amqpdriver [-] received message with unique_id: eafe22c08bae485e9346ce0fbdaa4d6c from (pid=96551) __call__ /usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py:196
2017-01-09 13:26:57.744 DEBUG trove.conductor.manager [-] Instance ID: bb0c9213-31f8-4427-8898-c644254b3642, Payload: {u&#8217;service_status&#8217;: u&#8217;running&#8217;} from (pid=96551) heartbeat /opt/stack/trove/trove/conductor/manager.py:88
2017-01-09 13:26:57.748 DEBUG trove.conductor.manager [-] Instance bb0c9213-31f8-4427-8898-c644254b3642 sent heartbeat at 1483986416.52  from (pid=96551) _message_too_old /opt/stack/trove/trove/conductor/manager.py:54
2017-01-09 13:26:57.750 DEBUG trove.conductor.manager [-] [Instance bb0c9213-31f8-4427-8898-c644254b3642] Rec&#8217;d message is younger than last seen. Updating. from (pid=96551) _message_too_old /opt/stack/trove/trove/conductor/manager.py:76
2017-01-09 13:27:01.197 DEBUG oslo_messaging._drivers.amqpdriver [-] received message with unique_id: df62b76523004338876bc7b08f8b7711 from (pid=96552) __call__ /usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py:196
2017-01-09 13:27:01.200 DEBUG trove.conductor.manager [-] Instance ID: 9ceebd62-e13d-43c5-953a-c0f24f08757e, Payload: {u&#8217;service_status&#8217;: u&#8217;running&#8217;} from (pid=96552) heartbeat /opt/stack/trove/trove/conductor/manager.py:88
2017-01-09 13:27:01.219 DEBUG oslo_db.sqlalchemy.engines [-] Parent process 96542 forked (96552) with an open database connection, which is being discarded and recreated. from (pid=96552) checkout /usr/local/lib/python2.7/dist-packages/oslo_db/sqlalchemy/engines.py:362
2017-01-09 13:27:01.225 DEBUG trove.conductor.manager [-] Instance 9ceebd62-e13d-43c5-953a-c0f24f08757e sent heartbeat at 1483986419.99  from (pid=96552) _message_too_old /opt/stack/trove/trove/conductor/manager.py:54
2017-01-09 13:27:01.231 DEBUG trove.conductor.manager [-] [Instance 9ceebd62-e13d-43c5-953a-c0f24f08757e] Rec&#8217;d message is younger than last seen. Updating. from (pid=96552) _message_too_old /opt/stack/trove/trove/conductor/manager.py:76</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove list
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
| ID                                   | Name | Datastore | Datastore Version | Status | Flavor ID | Size | Region    |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
| 6d55ab3a-267f-4b95-8ada-33fc98fd1767 | m4   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
| 9ceebd62-e13d-43c5-953a-c0f24f08757e | m3   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
| bb0c9213-31f8-4427-8898-c644254b3642 | m2   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove show m2
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| Property          | Value                                |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| created           | 2017-01-09T18:17:13                  |
| datastore         | mysql                                |
| datastore_version | 5.6                                  |
| flavor            | 25                                   |
| id                | bb0c9213-31f8-4427-8898-c644254b3642 |
| name              | m2                                   |
| region            | RegionOne                            |
| server_id         | a4769ce2-4e22-4134-b958-6db6c23cb221 |
| status            | ACTIVE                               |
| updated           | 2017-01-09T18:17:17                  |
| volume            | 3                                    |
| volume_id         | 16e57e3f-b462-4db2-968b-3c284aa2751c |
| volume_used       | 0.11                                 |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+</p>
<p>We now launch a new instance, recall that secure_rpc_messaging is disabled.</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove create m10 25 &#8211;size 3 &#8211;nic net-id=4bab02e7-87bb-4cc0-8c07-2f282c777c85
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| Property          | Value                                |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| created           | 2017-01-09T18:28:56                  |
| datastore         | mysql                                |
| datastore_version | 5.6                                  |
| flavor            | 25                                   |
| id                | 514ef051-0bf7-48a5-adcf-071d4a6625fb |
| name              | m10                                  |
| region            | RegionOne                            |
| server_id         | None                                 |
| status            | BUILD                                |
| updated           | 2017-01-09T18:28:56                  |
| volume            | 3                                    |
| volume_id         | None                                 |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+</p>
<p>Observe that the task manager does not create a password for the instance.</p>
<p>2017-01-09 13:29:00.111 INFO trove.instance.models [-] Resetting task status to NONE on instance 514ef051-0bf7-48a5-adcf-071d4a6625fb.
2017-01-09 13:29:00.115 DEBUG trove.db.models [-] Saving DBInstance: {u&#8217;region_id&#8217;: u&#8217;RegionOne&#8217;, u&#8217;cluster_id&#8217;: None, u&#8217;shard_id&#8217;: None, u&#8217;deleted_at&#8217;: None, u&#8217;id&#8217;: u&#8216;514ef051-0bf7-48a5-adcf-071d4a6625fb&#8217;, u&#8217;datastore_version_id&#8217;: u&#8216;4a881cb5-9e48-4cb2-a209-4283ed44eb01&#8217;, &#8216;errors&#8217;: {}, u&#8217;hostname&#8217;: None, u&#8217;server_status&#8217;: None, u&#8217;task_description&#8217;: u&#8217;No tasks for the instance.&#8217;, u&#8217;volume_size&#8217;: 3, u&#8217;type&#8217;: None, u&#8217;updated&#8217;: datetime.datetime(2017, 1, 9, 18, 29, 0, 114971), &#8216;_sa_instance_state&#8217;: &lt;sqlalchemy.orm.state.InstanceState object at 0x7f460dbca410&gt;, u&#8217;encrypted_key&#8217;: None, u&#8217;deleted&#8217;: 0, u&#8217;configuration_id&#8217;: None, u&#8217;volume_id&#8217;: u&#8217;cee2e17b-80fa-48e5-a488-da8b7809373a&#8217;, u&#8217;slave_of_id&#8217;: None, u&#8217;task_start_time&#8217;: None, u&#8217;name&#8217;: u&#8217;m10&#8217;, u&#8217;task_id&#8217;: 1, u&#8217;created&#8217;: datetime.datetime(2017, 1, 9, 18, 28, 56), u&#8217;tenant_id&#8217;: u&#8216;56cca8484d3e48869126ada4f355c284&#8217;, u&#8217;compute_instance_id&#8217;: u&#8216;2452263e-3d33-48ec-8f24-2851fe74db28&#8217;, u&#8217;flavor_id&#8217;: u&#8216;25&#8217;} from (pid=96635) save /opt/stack/trove/trove/db/models.py:64</p>
<p>the configuration file for this instance is:</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;m10">amrith<span>&#64;</span>m10</a>:~$ cat /etc/trove/conf.d/guest_info.conf
[DEFAULT]
guest_id=514ef051-0bf7-48a5-adcf-071d4a6625fb
datastore_manager=mysql
tenant_id=56cca8484d3e48869126ada4f355c284</p>
<p>We can now shutdown the control plane again and enable the secure RPC
capability. Observe that we&#8217;ve just commented out the lines (below).</p>
<p>trove-conductor.conf:# enable_secure_rpc_messaging = False
trove.conf:# enable_secure_rpc_messaging = False
trove-taskmanager.conf:# enable_secure_rpc_messaging = False</p>
<p>And create another database instance</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove create m20 25 &#8211;size 3 &#8211;nic net-id=4bab02e7-87bb-4cc0-8c07-2f282c777c85
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| Property          | Value                                |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| created           | 2017-01-09T18:31:48                  |
| datastore         | mysql                                |
| datastore_version | 5.6                                  |
| flavor            | 25                                   |
| id                | 792fa220-2a40-4831-85af-cfb0ded8033c |
| name              | m20                                  |
| region            | RegionOne                            |
| server_id         | None                                 |
| status            | BUILD                                |
| updated           | 2017-01-09T18:31:48                  |
| volume            | 3                                    |
| volume_id         | None                                 |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+</p>
<p>Observe that a unique per-instance encryption key was created for this instance.</p>
<p>2017-01-09 13:31:52.474 DEBUG trove.db.models [-] Saving DBInstance: {u&#8217;region_id&#8217;: u&#8217;RegionOne&#8217;, u&#8217;cluster_id&#8217;: None, u&#8217;shard_id&#8217;: None, u&#8217;deleted_at&#8217;: None, u&#8217;id&#8217;: u&#8216;792fa220-2a40-4831-85af-cfb0ded8033c&#8217;, u&#8217;datastore_version_id&#8217;: u&#8216;4a881cb5-9e48-4cb2-a209-4283ed44eb01&#8217;, &#8216;errors&#8217;: {}, u&#8217;hostname&#8217;: None, u&#8217;server_status&#8217;: None, u&#8217;task_description&#8217;: u&#8217;No tasks for the instance.&#8217;, u&#8217;volume_size&#8217;: 3, u&#8217;type&#8217;: None, u&#8217;updated&#8217;: datetime.datetime(2017, 1, 9, 18, 31, 52, 473552), &#8216;_sa_instance_state&#8217;: &lt;sqlalchemy.orm.state.InstanceState object at 0x7fdb14d44550&gt;, u&#8217;encrypted_key&#8217;: u&#8217;fVpHrkUIjVsXe7Fj7Lm4u2xnJUsWX2rMC9GL0AppILJINBZxLvkowY8FOa+asKS+8pWb4iNyukQQ4AQoLEUHUQ==&#8217;, u&#8217;deleted&#8217;: 0, u&#8217;configuration_id&#8217;: None, u&#8217;volume_id&#8217;: u&#8216;4cd563dc-fe08-477b-828f-120facf4351b&#8217;, u&#8217;slave_of_id&#8217;: None, u&#8217;task_start_time&#8217;: None, u&#8217;name&#8217;: u&#8217;m20&#8217;, u&#8217;task_id&#8217;: 1, u&#8217;created&#8217;: datetime.datetime(2017, 1, 9, 18, 31, 49), u&#8217;tenant_id&#8217;: u&#8216;56cca8484d3e48869126ada4f355c284&#8217;, u&#8217;compute_instance_id&#8217;: u&#8216;1e62a192-83d3-43fd-b32e-b5ee2fa4e24b&#8217;, u&#8217;flavor_id&#8217;: u&#8216;25&#8217;} from (pid=97562) save /opt/stack/trove/trove/db/models.py:64</p>
<p>And the configuration file on that instance includes an encryption key.</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;m20">amrith<span>&#64;</span>m20</a>:~$ cat /etc/trove/conf.d/guest_info.conf
[DEFAULT]
guest_id=792fa220-2a40-4831-85af-cfb0ded8033c
datastore_manager=mysql
tenant_id=56cca8484d3e48869126ada4f355c284
instance_rpc_encr_key=eRz43LwE6eaxIbBlA2pNukzPjSdcQkVi</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove list
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
| ID                                   | Name | Datastore | Datastore Version | Status | Flavor ID | Size | Region    |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
| 514ef051-0bf7-48a5-adcf-071d4a6625fb | m10  | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
| 6d55ab3a-267f-4b95-8ada-33fc98fd1767 | m4   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
| 792fa220-2a40-4831-85af-cfb0ded8033c | m20  | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
| 9ceebd62-e13d-43c5-953a-c0f24f08757e | m3   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
| bb0c9213-31f8-4427-8898-c644254b3642 | m2   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+</p>
<p>At this point communication between API service and Task Manager, and
between the control plane and instance m20 is encrypted but
communication between control plane and all other instances is not
encrypted.</p>
<p>In this condition we can attempt some operations on the various
instances. First with the legacy instances created on software that
predated the secure RPC mechanism.</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove database-list m2
+&#8212;&#8212;+
| Name |
+&#8212;&#8212;+
+&#8212;&#8212;+
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove database-create m2 foo2
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove database-list m2
+&#8212;&#8212;+
| Name |
+&#8212;&#8212;+
| foo2 |
+&#8212;&#8212;+</p>
<p>And at the same time with the instance m10 which is created with the
current software but without RPC encryption.</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove database-list m10
+&#8212;&#8212;+
| Name |
+&#8212;&#8212;+
+&#8212;&#8212;+
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove database-create m10 foo10
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove database-list m10
+&#8212;&#8212;-+
| Name  |
+&#8212;&#8212;-+
| foo10 |
+&#8212;&#8212;-+
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$</p>
<p>And finally with an instance that uses encrypted RPC communications.</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove database-list m20
+&#8212;&#8212;+
| Name |
+&#8212;&#8212;+
+&#8212;&#8212;+
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove database-create m20 foo20
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove database-list m20
+&#8212;&#8212;-+
| Name  |
+&#8212;&#8212;-+
| foo20 |
+&#8212;&#8212;-+</p>
<p>Finally, we can upgrade an instance that has no encryption to have rpc
encryption.</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove datastore-list
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;+
| ID                                   | Name             |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;+
| 8e052edb-5f14-4aec-9149-0a80a30cf5e4 | mysql            |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;+
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove datastore-version-list mysql
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;+
| ID                                   | Name             |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;+
| 4a881cb5-9e48-4cb2-a209-4283ed44eb01 | 5.6              |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;+</p>
<p>Let&#8217;s look at instance m2.</p>
<p>mysql&gt; select id, name, encrypted_key from instances where id = &#8216;bb0c9213-31f8-4427-8898-c644254b3642&#8217;;
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;&#8212;+
| id                                   | name | encrypted_key |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;&#8212;+
| bb0c9213-31f8-4427-8898-c644254b3642 | m2   | NULL          |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;&#8212;+
1 row in set (0.00 sec)</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove upgrade m2 4a881cb5-9e48-4cb2-a209-4283ed44eb01</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove list
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
| ID                                   | Name | Datastore | Datastore Version | Status  | Flavor ID | Size | Region    |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
| 514ef051-0bf7-48a5-adcf-071d4a6625fb | m10  | mysql     | 5.6               | ACTIVE  | 25        |    3 | RegionOne |
| 6d55ab3a-267f-4b95-8ada-33fc98fd1767 | m4   | mysql     | 5.6               | ACTIVE  | 25        |    3 | RegionOne |
| 792fa220-2a40-4831-85af-cfb0ded8033c | m20  | mysql     | 5.6               | ACTIVE  | 25        |    3 | RegionOne |
| 9ceebd62-e13d-43c5-953a-c0f24f08757e | m3   | mysql     | 5.6               | ACTIVE  | 25        |    3 | RegionOne |
| bb0c9213-31f8-4427-8898-c644254b3642 | m2   | mysql     | 5.6               | UPGRADE | 25        |    3 | RegionOne |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ nova list
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| ID                                   | Name | Status  | Task State | Power State | Networks           |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
[...]
| a4769ce2-4e22-4134-b958-6db6c23cb221 | m2   | REBUILD | rebuilding | Running     | public=172.24.4.4  |
[...]
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+</p>
<p>2017-01-09 13:47:24.337 DEBUG trove.db.models [-] Saving DBInstance: {u&#8217;region_id&#8217;: u&#8217;RegionOne&#8217;, u&#8217;cluster_id&#8217;: None, u&#8217;shard_id&#8217;: None, u&#8217;deleted_at&#8217;: None, u&#8217;id&#8217;: u&#8217;bb0c9213-31f8-4427-8898-c644254b3642&#8217;, u&#8217;datastore_version_id&#8217;: u&#8216;4a881cb5-9e48-4cb2-a209-4283ed44eb01&#8217;, &#8216;errors&#8217;: {}, u&#8217;hostname&#8217;: None, u&#8217;server_status&#8217;: None, u&#8217;task_description&#8217;: u&#8217;Upgrading the instance.&#8217;, u&#8217;volume_size&#8217;: 3, u&#8217;type&#8217;: None, u&#8217;updated&#8217;: datetime.datetime(2017, 1, 9, 18, 47, 24, 337400), &#8216;_sa_instance_state&#8217;: &lt;sqlalchemy.orm.state.InstanceState object at 0x7fdb14d44150&gt;, u&#8217;encrypted_key&#8217;: u&#8217;gMrlHkEVxKgEFMTabzZr2TLJ6r5+wgfJfhohs7K/BzutWxs1wXfBswyV5Bgw4qeD212msmgSdOUCFov5otgzyg==&#8217;, u&#8217;deleted&#8217;: 0, u&#8217;configuration_id&#8217;: None, u&#8217;volume_id&#8217;: u&#8216;16e57e3f-b462-4db2-968b-3c284aa2751c&#8217;, u&#8217;slave_of_id&#8217;: None, u&#8217;task_start_time&#8217;: None, u&#8217;name&#8217;: u&#8217;m2&#8217;, u&#8217;task_id&#8217;: 89, u&#8217;created&#8217;: datetime.datetime(2017, 1, 9, 18, 17, 13), u&#8217;tenant_id&#8217;: u&#8216;56cca8484d3e48869126ada4f355c284&#8217;, u&#8217;compute_instance_id&#8217;: u&#8217;a4769ce2-4e22-4134-b958-6db6c23cb221&#8217;, u&#8217;flavor_id&#8217;: u&#8216;25&#8217;} from (pid=97562) save /opt/stack/trove/trove/db/models.py:64
2017-01-09 13:47:24.347 DEBUG trove.taskmanager.models [-] Generated unique RPC encryption key for instance = bb0c9213-31f8-4427-8898-c644254b3642, key = gMrlHkEVxKgEFMTabzZr2TLJ6r5+wgfJfhohs7K/BzutWxs1wXfBswyV5Bgw4qeD212msmgSdOUCFov5otgzyg== from (pid=97562) upgrade /opt/stack/trove/trove/taskmanager/models.py:1440
2017-01-09 13:47:24.350 DEBUG trove.taskmanager.models [-] Rebuilding instance m2(bb0c9213-31f8-4427-8898-c644254b3642) with image ea05cba7-2f70-4745-abea-136d7bcc16c7. from (pid=97562) upgrade /opt/stack/trove/trove/taskmanager/models.py:1445</p>
<p>The instance now has an encryption key in its configuration</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;m2">amrith<span>&#64;</span>m2</a>:~$ cat /etc/trove/conf.d/guest_info.conf
[DEFAULT]
guest_id=bb0c9213-31f8-4427-8898-c644254b3642
datastore_manager=mysql
tenant_id=56cca8484d3e48869126ada4f355c284
instance_rpc_encr_key=pN2hHEl171ngyD0mPvyV1xKJF2im01Gv</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove list
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
| ID                                   | Name | Datastore | Datastore Version | Status | Flavor ID | Size | Region    |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
[...]
| bb0c9213-31f8-4427-8898-c644254b3642 | m2   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
[...]
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove show m2
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| Property          | Value                                |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| created           | 2017-01-09T18:17:13                  |
| datastore         | mysql                                |
| datastore_version | 5.6                                  |
| flavor            | 25                                   |
| id                | bb0c9213-31f8-4427-8898-c644254b3642 |
| name              | m2                                   |
| region            | RegionOne                            |
| server_id         | a4769ce2-4e22-4134-b958-6db6c23cb221 |
| status            | ACTIVE                               |
| updated           | 2017-01-09T18:50:07                  |
| volume            | 3                                    |
| volume_id         | 16e57e3f-b462-4db2-968b-3c284aa2751c |
| volume_used       | 0.13                                 |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove database-list m2
+&#8212;&#8212;+
| Name |
+&#8212;&#8212;+
| foo2 |
+&#8212;&#8212;+</p>
<p>We can similarly upgrade m4.</p>
<p>2017-01-09 13:51:43.078 DEBUG trove.instance.models [-] Instance 6d55ab3a-267f-4b95-8ada-33fc98fd1767 service status is running. from (pid=97562) load_instance /opt/stack/trove/trove/instance/models.py:534
2017-01-09 13:51:43.083 DEBUG trove.taskmanager.models [-] Upgrading instance m4(6d55ab3a-267f-4b95-8ada-33fc98fd1767) to new datastore version 5.6(4a881cb5-9e48-4cb2-a209-4283ed44eb01) from (pid=97562) upgrade /opt/stack/trove/trove/taskmanager/models.py:1410
2017-01-09 13:51:43.087 DEBUG trove.guestagent.api [-] Sending the call to prepare the guest for upgrade. from (pid=97562) pre_upgrade /opt/stack/trove/trove/guestagent/api.py:351
2017-01-09 13:51:43.087 DEBUG trove.guestagent.api [-] Calling pre_upgrade with timeout 600 from (pid=97562) _call /opt/stack/trove/trove/guestagent/api.py:86
2017-01-09 13:51:43.088 DEBUG oslo_messaging._drivers.amqpdriver [-] CALL msg_id: 41dbb7fff3dc4f8fa69d8b5f219809e0 exchange &#8216;trove&#8217; topic &#8216;guestagent.6d55ab3a-267f-4b95-8ada-33fc98fd1767&#8217; from (pid=97562) _send /usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py:442
2017-01-09 13:51:45.452 DEBUG oslo_messaging._drivers.amqpdriver [-] received reply msg_id: 41dbb7fff3dc4f8fa69d8b5f219809e0 from (pid=97562) __call__ /usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py:299
2017-01-09 13:51:45.452 DEBUG trove.guestagent.api [-] Result is {u&#8217;mount_point&#8217;: u&#8217;/var/lib/mysql&#8217;, u&#8217;save_etc_dir&#8217;: u&#8217;/var/lib/mysql/etc&#8217;, u&#8217;home_save&#8217;: u&#8217;/var/lib/mysql/trove_user&#8217;, u&#8217;save_dir&#8217;: u&#8217;/var/lib/mysql/etc_mysql&#8217;}. from (pid=97562) _call /opt/stack/trove/trove/guestagent/api.py:91
2017-01-09 13:51:45.544 DEBUG trove.db.models [-] Saving DBInstance: {u&#8217;region_id&#8217;: u&#8217;RegionOne&#8217;, u&#8217;cluster_id&#8217;: None, u&#8217;shard_id&#8217;: None, u&#8217;deleted_at&#8217;: None, u&#8217;id&#8217;: u&#8216;6d55ab3a-267f-4b95-8ada-33fc98fd1767&#8217;, u&#8217;datastore_version_id&#8217;: u&#8216;4a881cb5-9e48-4cb2-a209-4283ed44eb01&#8217;, &#8216;errors&#8217;: {}, u&#8217;hostname&#8217;: None, u&#8217;server_status&#8217;: None, u&#8217;task_description&#8217;: u&#8217;Upgrading the instance.&#8217;, u&#8217;volume_size&#8217;: 3, u&#8217;type&#8217;: None, u&#8217;updated&#8217;: datetime.datetime(2017, 1, 9, 18, 51, 45, 544496), &#8216;_sa_instance_state&#8217;: &lt;sqlalchemy.orm.state.InstanceState object at 0x7fdb14972c10&gt;, u&#8217;encrypted_key&#8217;: u&#8216;0gBkJl5Aqb4kFIPeJDMTNIymEUuUUB8NBksecTiYyQl+Ibrfi7ME8Bi58q2n61AxbG2coOqp97ETjHRyN7mYTg==&#8217;, u&#8217;deleted&#8217;: 0, u&#8217;configuration_id&#8217;: None, u&#8217;volume_id&#8217;: u&#8217;b7dc17b5-d0a8-47bb-aef4-ef9432c269e9&#8217;, u&#8217;slave_of_id&#8217;: None, u&#8217;task_start_time&#8217;: None, u&#8217;name&#8217;: u&#8217;m4&#8217;, u&#8217;task_id&#8217;: 89, u&#8217;created&#8217;: datetime.datetime(2017, 1, 9, 18, 20, 58), u&#8217;tenant_id&#8217;: u&#8216;56cca8484d3e48869126ada4f355c284&#8217;, u&#8217;compute_instance_id&#8217;: u&#8217;f43bba63-3be6-4993-b2d0-4ddfb7818d27&#8217;, u&#8217;flavor_id&#8217;: u&#8216;25&#8217;} from (pid=97562) save /opt/stack/trove/trove/db/models.py:64
2017-01-09 13:51:45.557 DEBUG trove.taskmanager.models [-] Generated unique RPC encryption key for instance = 6d55ab3a-267f-4b95-8ada-33fc98fd1767, key = 0gBkJl5Aqb4kFIPeJDMTNIymEUuUUB8NBksecTiYyQl+Ibrfi7ME8Bi58q2n61AxbG2coOqp97ETjHRyN7mYTg== from (pid=97562) upgrade /opt/stack/trove/trove/taskmanager/models.py:1440
2017-01-09 13:51:45.560 DEBUG trove.taskmanager.models [-] Rebuilding instance m4(6d55ab3a-267f-4b95-8ada-33fc98fd1767) with image ea05cba7-2f70-4745-abea-136d7bcc16c7. from (pid=97562) upgrade /opt/stack/trove/trove/taskmanager/models.py:1445</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ nova list
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| ID                                   | Name | Status  | Task State | Power State | Networks           |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
[...]
| f43bba63-3be6-4993-b2d0-4ddfb7818d27 | m4   | REBUILD | rebuilding | Running     | public=172.24.4.11 |
[...]
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+</p>
<p>2017-01-09 13:53:26.581 DEBUG trove.guestagent.api [-] Recover the guest after upgrading the guest&#8217;s image. from (pid=97562) post_upgrade /opt/stack/trove/trove/guestagent/api.py:359
2017-01-09 13:53:26.581 DEBUG trove.guestagent.api [-] Recycling the client ... from (pid=97562) post_upgrade /opt/stack/trove/trove/guestagent/api.py:361
2017-01-09 13:53:26.581 DEBUG trove.guestagent.api [-] Calling post_upgrade with timeout 600 from (pid=97562) _call /opt/stack/trove/trove/guestagent/api.py:86
2017-01-09 13:53:26.583 DEBUG oslo_messaging._drivers.amqpdriver [-] CALL msg_id: 2e9ccc88715b4b98848a017e19b2938d exchange &#8216;trove&#8217; topic &#8216;guestagent.6d55ab3a-267f-4b95-8ada-33fc98fd1767&#8217; from (pid=97562) _send /usr/local/lib/python2.7/dist-packages/oslo_messaging/_drivers/amqpdriver.py:442</p>
<p>mysql&gt; select id, name, encrypted_key from instances where name in (&#8216;m2&#8217;, &#8216;m4&#8217;, &#8216;m10&#8217;, &#8216;m20&#8217;);
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;+
| id                                   | name | encrypted_key                                                                            |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;+
| 514ef051-0bf7-48a5-adcf-071d4a6625fb | m10  | NULL                                                                                     |
| 6d55ab3a-267f-4b95-8ada-33fc98fd1767 | m4   | 0gBkJl5Aqb4kFIPeJDMTNIymEUuUUB8NBksecTiYyQl+Ibrfi7ME8Bi58q2n61AxbG2coOqp97ETjHRyN7mYTg== |
| 792fa220-2a40-4831-85af-cfb0ded8033c | m20  | fVpHrkUIjVsXe7Fj7Lm4u2xnJUsWX2rMC9GL0AppILJINBZxLvkowY8FOa+asKS+8pWb4iNyukQQ4AQoLEUHUQ== |
| bb0c9213-31f8-4427-8898-c644254b3642 | m2   | gMrlHkEVxKgEFMTabzZr2TLJ6r5+wgfJfhohs7K/BzutWxs1wXfBswyV5Bgw4qeD212msmgSdOUCFov5otgzyg== |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;+</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/etc/trove$ trove list
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
| ID                                   | Name | Datastore | Datastore Version | Status | Flavor ID | Size | Region    |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+
| 514ef051-0bf7-48a5-adcf-071d4a6625fb | m10  | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
| 6d55ab3a-267f-4b95-8ada-33fc98fd1767 | m4   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
| 792fa220-2a40-4831-85af-cfb0ded8033c | m20  | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
| bb0c9213-31f8-4427-8898-c644254b3642 | m2   | mysql     | 5.6               | ACTIVE | 25        |    3 | RegionOne |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;&#8212;&#8212;&#8211;+</p>
</div>
<div class="section" id="inspecting-which-instances-are-using-secure-rpc-communications">
<h2>Inspecting which instances are using secure RPC communications<a class="headerlink" href="#inspecting-which-instances-are-using-secure-rpc-communications" title="Permalink to this headline">¶</a></h2>
<p>An additional field is returned in the trove show command output to
indicate whether any given instance is using secure RPC communication
or not.</p>
<p>NOTE: This field is only returned if the user is an &#8216;admin&#8217;. Non admin
users do not see the field.</p>
<p><a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove$ trove show m20
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| Property                | Value                                |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| created                 | 2017-01-09T18:31:49                  |
| datastore               | mysql                                |
| datastore_version       | 5.6                                  |
| encrypted_rpc_messaging | True                                 |
| flavor                  | 25                                   |
| id                      | 792fa220-2a40-4831-85af-cfb0ded8033c |
| name                    | m20                                  |
| region                  | RegionOne                            |
| server_id               | 1e62a192-83d3-43fd-b32e-b5ee2fa4e24b |
| status                  | ACTIVE                               |
| updated                 | 2017-01-09T18:31:52                  |
| volume                  | 3                                    |
| volume_id               | 4cd563dc-fe08-477b-828f-120facf4351b |
| volume_used             | 0.11                                 |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove$ trove show m10
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| Property                | Value                                |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| created                 | 2017-01-09T18:28:56                  |
| datastore               | mysql                                |
| datastore_version       | 5.6                                  |
| encrypted_rpc_messaging | False                                |
| flavor                  | 25                                   |
| id                      | 514ef051-0bf7-48a5-adcf-071d4a6625fb |
| name                    | m10                                  |
| region                  | RegionOne                            |
| server_id               | 2452263e-3d33-48ec-8f24-2851fe74db28 |
| status                  | ACTIVE                               |
| updated                 | 2017-01-09T18:29:00                  |
| volume                  | 3                                    |
| volume_id               | cee2e17b-80fa-48e5-a488-da8b7809373a |
| volume_used             | 0.11                                 |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove$ trove show m2
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| Property                | Value                                |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| created                 | 2017-01-09T18:17:13                  |
| datastore               | mysql                                |
| datastore_version       | 5.6                                  |
| encrypted_rpc_messaging | True                                 |
| flavor                  | 25                                   |
| id                      | bb0c9213-31f8-4427-8898-c644254b3642 |
| name                    | m2                                   |
| region                  | RegionOne                            |
| server_id               | a4769ce2-4e22-4134-b958-6db6c23cb221 |
| status                  | ACTIVE                               |
| updated                 | 2017-01-09T18:50:07                  |
| volume                  | 3                                    |
| volume_id               | 16e57e3f-b462-4db2-968b-3c284aa2751c |
| volume_used             | 0.13                                 |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove$ trove show m4
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| Property                | Value                                |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
| created                 | 2017-01-09T18:20:58                  |
| datastore               | mysql                                |
| datastore_version       | 5.6                                  |
| encrypted_rpc_messaging | True                                 |
| flavor                  | 25                                   |
| id                      | 6d55ab3a-267f-4b95-8ada-33fc98fd1767 |
| name                    | m4                                   |
| region                  | RegionOne                            |
| server_id               | f43bba63-3be6-4993-b2d0-4ddfb7818d27 |
| status                  | ACTIVE                               |
| updated                 | 2017-01-09T18:54:30                  |
| volume                  | 3                                    |
| volume_id               | b7dc17b5-d0a8-47bb-aef4-ef9432c269e9 |
| volume_used             | 0.13                                 |
+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;+
<a class="reference external" href="mailto:amrith&#37;&#52;&#48;amrith-work">amrith<span>&#64;</span>amrith-work</a>:/opt/stack/trove$</p>
<p>In the API response, note that the additional key
&#8220;encrypted_rpc_messaging&#8221; has been added (as below).</p>
<p>NOTE: This field is only returned if the user is an &#8216;admin&#8217;. Non admin
users do not see the field.</p>
<p>RESP BODY: {&#8220;instance&#8221;: {&#8220;status&#8221;: &#8220;ACTIVE&#8221;, &#8220;updated&#8221;: &#8220;2017-01-09T18:29:00&#8221;, &#8220;name&#8221;: &#8220;m10&#8221;, &#8220;links&#8221;: [{&#8220;href&#8221;: &#8220;<a class="reference external" href="https://192.168.126.130:8779/v1.0/56cca8484d3e48869126ada4f355c284/instances/514ef051-0bf7-48a5-adcf-071d4a6625fb">https://192.168.126.130:8779/v1.0/56cca8484d3e48869126ada4f355c284/instances/514ef051-0bf7-48a5-adcf-071d4a6625fb</a>&#8221;, &#8220;rel&#8221;: &#8220;self&#8221;}, {&#8220;href&#8221;: &#8220;<a class="reference external" href="https://192.168.126.130:8779/instances/514ef051-0bf7-48a5-adcf-071d4a6625fb">https://192.168.126.130:8779/instances/514ef051-0bf7-48a5-adcf-071d4a6625fb</a>&#8221;, &#8220;rel&#8221;: &#8220;bookmark&#8221;}], &#8220;created&#8221;: &#8220;2017-01-09T18:28:56&#8221;, &#8220;region&#8221;: &#8220;RegionOne&#8221;, &#8220;server_id&#8221;: &#8220;2452263e-3d33-48ec-8f24-2851fe74db28&#8221;, &#8220;id&#8221;: &#8220;514ef051-0bf7-48a5-adcf-071d4a6625fb&#8221;, &#8220;volume&#8221;: {&#8220;used&#8221;: 0.11, &#8220;size&#8221;: 3}, &#8220;volume_id&#8221;: &#8220;cee2e17b-80fa-48e5-a488-da8b7809373a&#8221;, &#8220;flavor&#8221;: {&#8220;id&#8221;: &#8220;25&#8221;, &#8220;links&#8221;: [{&#8220;href&#8221;: &#8220;<a class="reference external" href="https://192.168.126.130:8779/v1.0/56cca8484d3e48869126ada4f355c284/flavors/25">https://192.168.126.130:8779/v1.0/56cca8484d3e48869126ada4f355c284/flavors/25</a>&#8221;, &#8220;rel&#8221;: &#8220;self&#8221;}, {&#8220;href&#8221;: &#8220;<a class="reference external" href="https://192.168.126.130:8779/flavors/25">https://192.168.126.130:8779/flavors/25</a>&#8221;, &#8220;rel&#8221;: &#8220;bookmark&#8221;}]}, &#8220;datastore&#8221;: {&#8220;version&#8221;: &#8220;5.6&#8221;, &#8220;type&#8221;: &#8220;mysql&#8221;}, &#8220;encrypted_rpc_messaging&#8221;: false}}</p>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Secure RPC messaging</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#the-default-system-behavior">The default system behavior</a></li>
<li><a class="reference internal" href="#interoperability-and-upgrade">Interoperability and Upgrade</a></li>
<li><a class="reference internal" href="#inspecting-which-instances-are-using-secure-rpc-communications">Inspecting which instances are using secure RPC communications</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="trove_api_extensions.html"
                                  title="previous chapter">Trove API Extensions</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/trove
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/dev/secure_oslo_messaging.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="trove_api_extensions.html" title="Trove API Extensions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">trove 7.0.0.0rc2.dev2 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, OpenStack Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/trove");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>