<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SAIO - Swift All In One &mdash; swift 2.12.1.dev102 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.12.1.dev102',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="swift 2.12.1.dev102 documentation" href="index.html" />
    <link rel="next" title="First Contribution to Swift" href="first_contribution_swift.html" />
    <link rel="prev" title="Development Guidelines" href="development_guidelines.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="saio-swift-all-in-one">
<h1>SAIO - Swift All In One<a class="headerlink" href="#saio-swift-all-in-one" title="Permalink to this headline">¶</a></h1>
<div class="section" id="instructions-for-setting-up-a-development-vm">
<h2>Instructions for setting up a development VM<a class="headerlink" href="#instructions-for-setting-up-a-development-vm" title="Permalink to this headline">¶</a></h2>
<p>This section documents setting up a virtual machine for doing Swift
development.  The virtual machine will emulate running a four node Swift
cluster. To begin:</p>
<ul class="simple">
<li>Get an Ubuntu 14.04 LTS server image or try something
Fedora/CentOS.</li>
<li>Create guest virtual machine from the image.</li>
</ul>
</div>
<div class="section" id="what-s-in-a-your-user-name">
<h2>What&#8217;s in a &lt;your-user-name&gt;<a class="headerlink" href="#what-s-in-a-your-user-name" title="Permalink to this headline">¶</a></h2>
<p>Much of the configuration described in this guide requires escalated
administrator (<code class="docutils literal"><span class="pre">root</span></code>) privileges; however, we assume that administrator logs
in as an unprivileged user and can use <code class="docutils literal"><span class="pre">sudo</span></code> to run privileged commands.</p>
<p>Swift processes also run under a separate user and group, set by configuration
option, and referenced as <code class="docutils literal"><span class="pre">&lt;your-user-name&gt;:&lt;your-group-name&gt;</span></code>.  The default user
is <code class="docutils literal"><span class="pre">swift</span></code>, which may not exist on your system.  These instructions are
intended to allow a developer to use his/her username for
<code class="docutils literal"><span class="pre">&lt;your-user-name&gt;:&lt;your-group-name&gt;</span></code>.</p>
</div>
<div class="section" id="installing-dependencies">
<h2>Installing dependencies<a class="headerlink" href="#installing-dependencies" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">On <code class="docutils literal"><span class="pre">apt</span></code> based systems:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo apt-get update
sudo apt-get install curl gcc memcached rsync sqlite3 xfsprogs \
                     git-core libffi-dev python-setuptools \
                     liberasurecode-dev libssl-dev
sudo apt-get install python-coverage python-dev python-nose \
                     python-xattr python-eventlet \
                     python-greenlet python-pastedeploy \
                     python-netifaces python-pip python-dnspython \
                     python-mock
</pre></div>
</div>
</li>
<li><p class="first">On <code class="docutils literal"><span class="pre">yum</span></code> based systems:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo yum update
sudo yum install curl gcc memcached rsync sqlite xfsprogs git-core \
                 libffi-devel xinetd liberasurecode-devel \
                 openssl-devel python-setuptools \
                 python-coverage python-devel python-nose \
                 pyxattr python-eventlet \
                 python-greenlet python-paste-deploy \
                 python-netifaces python-pip python-dns \
                 python-mock
</pre></div>
</div>
<p>Note: This installs necessary system dependencies and <em>most</em> of the python
dependencies. Later in the process setuptools/distribute or pip will install
and/or upgrade packages.</p>
</li>
</ul>
<p>Next, choose either <a class="reference internal" href="#partition-section"><span>Using a partition for storage</span></a> or <a class="reference internal" href="#loopback-section"><span>Using a loopback device for storage</span></a>.</p>
<div class="section" id="using-a-partition-for-storage">
<span id="partition-section"></span><h3>Using a partition for storage<a class="headerlink" href="#using-a-partition-for-storage" title="Permalink to this headline">¶</a></h3>
<p>If you are going to use a separate partition for Swift data, be sure to add
another device when creating the VM, and follow these instructions:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Set up a single partition:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo fdisk /dev/sdb
sudo mkfs.xfs /dev/sdb1
</pre></div>
</div>
</li>
<li><p class="first">Edit <code class="docutils literal"><span class="pre">/etc/fstab</span></code> and add:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/dev/sdb1 /mnt/sdb1 xfs noatime,nodiratime,nobarrier,logbufs=8 0 0
</pre></div>
</div>
</li>
<li><p class="first">Create the mount point and the individualized links:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo mkdir /mnt/sdb1
sudo mount /mnt/sdb1
sudo mkdir /mnt/sdb1/1 /mnt/sdb1/2 /mnt/sdb1/3 /mnt/sdb1/4
sudo chown ${USER}:${USER} /mnt/sdb1/*
sudo mkdir /srv
for x in {1..4}; do sudo ln -s /mnt/sdb1/$x /srv/$x; done
sudo mkdir -p /srv/1/node/sdb1 /srv/1/node/sdb5 \
              /srv/2/node/sdb2 /srv/2/node/sdb6 \
              /srv/3/node/sdb3 /srv/3/node/sdb7 \
              /srv/4/node/sdb4 /srv/4/node/sdb8 \
              /var/run/swift
sudo chown -R ${USER}:${USER} /var/run/swift
# **Make sure to include the trailing slash after /srv/$x/**
for x in {1..4}; do sudo chown -R ${USER}:${USER} /srv/$x/; done
</pre></div>
</div>
<p>Note: We create the mount points and mount the storage disk under
/mnt/sdb1. This disk will contain one directory per simulated swift node,
each owned by the current swift user.</p>
<p>We then create symlinks to these directories under /srv.
If the disk sdb is unmounted, files will not be written under
/srv/*, because the symbolic link destination /mnt/sdb1/* will not
exist. This prevents disk sync operations from writing to the root
partition in the event a drive is unmounted.</p>
</li>
<li><p class="first">Next, skip to <a class="reference internal" href="#common-dev-section"><span>Common Post-Device Setup</span></a>.</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="using-a-loopback-device-for-storage">
<span id="loopback-section"></span><h3>Using a loopback device for storage<a class="headerlink" href="#using-a-loopback-device-for-storage" title="Permalink to this headline">¶</a></h3>
<p>If you want to use a loopback device instead of another partition, follow
these instructions:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Create the file for the loopback device:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo mkdir /srv
sudo truncate -s 1GB /srv/swift-disk
sudo mkfs.xfs /srv/swift-disk
</pre></div>
</div>
<p>Modify size specified in the <code class="docutils literal"><span class="pre">truncate</span></code> command to make a larger or
smaller partition as needed.</p>
</li>
<li><p class="first">Edit <cite>/etc/fstab</cite> and add:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/srv/swift-disk /mnt/sdb1 xfs loop,noatime,nodiratime,nobarrier,logbufs=8 0 0
</pre></div>
</div>
</li>
<li><p class="first">Create the mount point and the individualized links:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo mkdir /mnt/sdb1
sudo mount /mnt/sdb1
sudo mkdir /mnt/sdb1/1 /mnt/sdb1/2 /mnt/sdb1/3 /mnt/sdb1/4
sudo chown ${USER}:${USER} /mnt/sdb1/*
for x in {1..4}; do sudo ln -s /mnt/sdb1/$x /srv/$x; done
sudo mkdir -p /srv/1/node/sdb1 /srv/1/node/sdb5 \
              /srv/2/node/sdb2 /srv/2/node/sdb6 \
              /srv/3/node/sdb3 /srv/3/node/sdb7 \
              /srv/4/node/sdb4 /srv/4/node/sdb8 \
              /var/run/swift
sudo chown -R ${USER}:${USER} /var/run/swift
# **Make sure to include the trailing slash after /srv/$x/**
for x in {1..4}; do sudo chown -R ${USER}:${USER} /srv/$x/; done
</pre></div>
</div>
<p>Note: We create the mount points and mount the loopback file under
/mnt/sdb1. This file will contain one directory per simulated swift node,
each owned by the current swift user.</p>
<p>We then create symlinks to these directories under /srv.
If the loopback file is unmounted, files will not be written under
/srv/*, because the symbolic link destination /mnt/sdb1/* will not
exist. This prevents disk sync operations from writing to the root
partition in the event a drive is unmounted.</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="common-post-device-setup">
<span id="common-dev-section"></span><h3>Common Post-Device Setup<a class="headerlink" href="#common-post-device-setup" title="Permalink to this headline">¶</a></h3>
<p>Add the following lines to <code class="docutils literal"><span class="pre">/etc/rc.local</span></code> (before the <code class="docutils literal"><span class="pre">exit</span> <span class="pre">0</span></code>):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>mkdir -p /var/cache/swift /var/cache/swift2 /var/cache/swift3 /var/cache/swift4
chown &lt;your-user-name&gt;:&lt;your-group-name&gt; /var/cache/swift*
mkdir -p /var/run/swift
chown &lt;your-user-name&gt;:&lt;your-group-name&gt; /var/run/swift
</pre></div>
</div>
<p>Note that on some systems you might have to create <code class="docutils literal"><span class="pre">/etc/rc.local</span></code>.</p>
<p>On Fedora 19 or later, you need to place these in <code class="docutils literal"><span class="pre">/etc/rc.d/rc.local</span></code>.</p>
</div>
</div>
<div class="section" id="getting-the-code">
<h2>Getting the code<a class="headerlink" href="#getting-the-code" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Check out the python-swiftclient repo:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd $HOME; git clone https://github.com/openstack/python-swiftclient.git
</pre></div>
</div>
</li>
<li><p class="first">Build a development installation of python-swiftclient:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd $HOME/python-swiftclient; sudo python setup.py develop; cd -
</pre></div>
</div>
<p>Ubuntu 12.04 users need to install python-swiftclient&#8217;s dependencies before the installation of
python-swiftclient. This is due to a bug in an older version of setup tools:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd $HOME/python-swiftclient; sudo pip install -r requirements.txt; sudo python setup.py develop; cd -
</pre></div>
</div>
</li>
<li><p class="first">Check out the swift repo:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>git clone https://github.com/openstack/swift.git
</pre></div>
</div>
</li>
<li><p class="first">Build a development installation of swift:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd $HOME/swift; sudo pip install -r requirements.txt; sudo python setup.py develop; cd -
</pre></div>
</div>
<p>Fedora 19 or later users might have to perform the following if development
installation of swift fails:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo pip install -U xattr
</pre></div>
</div>
</li>
<li><p class="first">Install swift&#8217;s test dependencies:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd $HOME/swift; sudo pip install -r test-requirements.txt
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="setting-up-rsync">
<h2>Setting up rsync<a class="headerlink" href="#setting-up-rsync" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Create <code class="docutils literal"><span class="pre">/etc/rsyncd.conf</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo cp $HOME/swift/doc/saio/rsyncd.conf /etc/
sudo sed -i &quot;s/&lt;your-user-name&gt;/${USER}/&quot; /etc/rsyncd.conf
</pre></div>
</div>
<p>Here is the default <code class="docutils literal"><span class="pre">rsyncd.conf</span></code> file contents maintained in the repo
that is copied and fixed up above:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>uid = &lt;your-user-name&gt;
gid = &lt;your-user-name&gt;
log file = /var/log/rsyncd.log
pid file = /var/run/rsyncd.pid
address = 127.0.0.1

[account6012]
max connections = 25
path = /srv/1/node/
read only = false
lock file = /var/lock/account6012.lock

[account6022]
max connections = 25
path = /srv/2/node/
read only = false
lock file = /var/lock/account6022.lock

[account6032]
max connections = 25
path = /srv/3/node/
read only = false
lock file = /var/lock/account6032.lock

[account6042]
max connections = 25
path = /srv/4/node/
read only = false
lock file = /var/lock/account6042.lock

[container6011]
max connections = 25
path = /srv/1/node/
read only = false
lock file = /var/lock/container6011.lock

[container6021]
max connections = 25
path = /srv/2/node/
read only = false
lock file = /var/lock/container6021.lock

[container6031]
max connections = 25
path = /srv/3/node/
read only = false
lock file = /var/lock/container6031.lock

[container6041]
max connections = 25
path = /srv/4/node/
read only = false
lock file = /var/lock/container6041.lock

[object6010]
max connections = 25
path = /srv/1/node/
read only = false
lock file = /var/lock/object6010.lock

[object6020]
max connections = 25
path = /srv/2/node/
read only = false
lock file = /var/lock/object6020.lock

[object6030]
max connections = 25
path = /srv/3/node/
read only = false
lock file = /var/lock/object6030.lock

[object6040]
max connections = 25
path = /srv/4/node/
read only = false
lock file = /var/lock/object6040.lock
</pre></div>
</div>
</li>
<li><p class="first">On Ubuntu, edit the following line in <code class="docutils literal"><span class="pre">/etc/default/rsync</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">RSYNC_ENABLE</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>On Fedora, edit the following line in <code class="docutils literal"><span class="pre">/etc/xinetd.d/rsync</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">disable</span> <span class="o">=</span> <span class="n">no</span>
</pre></div>
</div>
<p>One might have to create the above files to perform the edits.</p>
</li>
<li><p class="first">On platforms with SELinux in <code class="docutils literal"><span class="pre">Enforcing</span></code> mode, either set to <code class="docutils literal"><span class="pre">Permissive</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo setenforce Permissive
</pre></div>
</div>
<p>Or just allow rsync full access:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo setsebool -P rsync_full_access 1
</pre></div>
</div>
</li>
<li><p class="first">Start the rsync daemon</p>
<ul>
<li><p class="first">On Ubuntu, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo service rsync restart
</pre></div>
</div>
</li>
<li><p class="first">On Fedora, run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo systemctl restart xinetd.service
sudo systemctl enable rsyncd.service
sudo systemctl start rsyncd.service
</pre></div>
</div>
</li>
<li><p class="first">On other xinetd based systems simply run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo service xinetd restart
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Verify rsync is accepting connections for all servers:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>rsync rsync://pub@localhost/
</pre></div>
</div>
<p>You should see the following output from the above command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">account6012</span>
<span class="n">account6022</span>
<span class="n">account6032</span>
<span class="n">account6042</span>
<span class="n">container6011</span>
<span class="n">container6021</span>
<span class="n">container6031</span>
<span class="n">container6041</span>
<span class="n">object6010</span>
<span class="n">object6020</span>
<span class="n">object6030</span>
<span class="n">object6040</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="starting-memcached">
<h2>Starting memcached<a class="headerlink" href="#starting-memcached" title="Permalink to this headline">¶</a></h2>
<p>On non-Ubuntu distros you need to ensure memcached is running:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo service memcached start
sudo chkconfig memcached on
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo systemctl enable memcached.service
sudo systemctl start memcached.service
</pre></div>
</div>
<p>The tempauth middleware stores tokens in memcached. If memcached is not
running, tokens cannot be validated, and accessing Swift becomes impossible.</p>
</div>
<div class="section" id="optional-setting-up-rsyslog-for-individual-logging">
<h2>Optional: Setting up rsyslog for individual logging<a class="headerlink" href="#optional-setting-up-rsyslog-for-individual-logging" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Install the swift rsyslogd configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo cp $HOME/swift/doc/saio/rsyslog.d/10-swift.conf /etc/rsyslog.d/
</pre></div>
</div>
<p>Be sure to review that conf file to determine if you want all the logs
in one file vs. all the logs separated out, and if you want hourly logs
for stats processing. For convenience, we provide its default contents
below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># Uncomment the following to have a log containing all logs together
#local1,local2,local3,local4,local5.*   /var/log/swift/all.log

# Uncomment the following to have hourly proxy logs for stats processing
#$template HourlyProxyLog,&quot;/var/log/swift/hourly/%$YEAR%%$MONTH%%$DAY%%$HOUR%&quot;
#local1.*;local1.!notice ?HourlyProxyLog

local1.*;local1.!notice /var/log/swift/proxy.log
local1.notice           /var/log/swift/proxy.error
local1.*                ~

local2.*;local2.!notice /var/log/swift/storage1.log
local2.notice           /var/log/swift/storage1.error
local2.*                ~

local3.*;local3.!notice /var/log/swift/storage2.log
local3.notice           /var/log/swift/storage2.error
local3.*                ~

local4.*;local4.!notice /var/log/swift/storage3.log
local4.notice           /var/log/swift/storage3.error
local4.*                ~

local5.*;local5.!notice /var/log/swift/storage4.log
local5.notice           /var/log/swift/storage4.error
local5.*                ~

local6.*;local6.!notice /var/log/swift/expirer.log
local6.notice           /var/log/swift/expirer.error
local6.*                ~
</pre></div>
</div>
</li>
<li><p class="first">Edit <code class="docutils literal"><span class="pre">/etc/rsyslog.conf</span></code> and make the following change (usually in the
&#8220;GLOBAL DIRECTIVES&#8221; section):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$PrivDropToGroup adm
</pre></div>
</div>
</li>
<li><p class="first">If using hourly logs (see above) perform:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo mkdir -p /var/log/swift/hourly
</pre></div>
</div>
<p>Otherwise perform:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo mkdir -p /var/log/swift
</pre></div>
</div>
</li>
<li><p class="first">Setup the logging directory and start syslog:</p>
<ul>
<li><p class="first">On Ubuntu:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo chown -R syslog.adm /var/log/swift
sudo chmod -R g+w /var/log/swift
sudo service rsyslog restart
</pre></div>
</div>
</li>
<li><p class="first">On Fedora:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo chown -R root:adm /var/log/swift
sudo chmod -R g+w /var/log/swift
sudo systemctl restart rsyslog.service
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="configuring-each-node">
<h2>Configuring each node<a class="headerlink" href="#configuring-each-node" title="Permalink to this headline">¶</a></h2>
<p>After performing the following steps, be sure to verify that Swift has access
to resulting configuration files (sample configuration files are provided with
all defaults in line-by-line comments).</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Optionally remove an existing swift directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sudo rm -rf /etc/swift
</pre></div>
</div>
</li>
<li><p class="first">Populate the <code class="docutils literal"><span class="pre">/etc/swift</span></code> directory itself:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd $HOME/swift/doc; sudo cp -r saio/swift /etc/swift; cd -
sudo chown -R ${USER}:${USER} /etc/swift
</pre></div>
</div>
</li>
<li><p class="first">Update <code class="docutils literal"><span class="pre">&lt;your-user-name&gt;</span></code> references in the Swift config files:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>find /etc/swift/ -name \*.conf | xargs sudo sed -i &quot;s/&lt;your-user-name&gt;/${USER}/&quot;
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
<p>The contents of the configuration files provided by executing the above
commands are as follows:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/swift.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[swift-hash]
# random unique strings that can never change (DO NOT LOSE)
# Use only printable chars (python -c &quot;import string; print(string.printable)&quot;)
swift_hash_path_prefix = changeme
swift_hash_path_suffix = changeme

[storage-policy:0]
name = gold
policy_type = replication
default = yes

[storage-policy:1]
name = silver
policy_type = replication

[storage-policy:2]
name = ec42
policy_type = erasure_coding
ec_type = liberasurecode_rs_vand
ec_num_data_fragments = 4
ec_num_parity_fragments = 2
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/proxy-server.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
bind_ip = 127.0.0.1
bind_port = 8080
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL1
eventlet_debug = true

[pipeline:main]
# Yes, proxy-logging appears twice. This is so that
# middleware-originated requests get logged too.
pipeline = catch_errors gatekeeper healthcheck proxy-logging cache bulk tempurl ratelimit crossdomain container_sync tempauth staticweb copy container-quotas account-quotas slo dlo versioned_writes proxy-logging proxy-server

[filter:catch_errors]
use = egg:swift#catch_errors

[filter:healthcheck]
use = egg:swift#healthcheck

[filter:proxy-logging]
use = egg:swift#proxy_logging

[filter:bulk]
use = egg:swift#bulk

[filter:ratelimit]
use = egg:swift#ratelimit

[filter:crossdomain]
use = egg:swift#crossdomain

[filter:dlo]
use = egg:swift#dlo

[filter:slo]
use = egg:swift#slo

[filter:container_sync]
use = egg:swift#container_sync
current = //saio/saio_endpoint

[filter:tempurl]
use = egg:swift#tempurl

[filter:tempauth]
use = egg:swift#tempauth
user_admin_admin = admin .admin .reseller_admin
user_test_tester = testing .admin
user_test2_tester2 = testing2 .admin
user_test_tester3 = testing3

[filter:staticweb]
use = egg:swift#staticweb

[filter:account-quotas]
use = egg:swift#account_quotas

[filter:container-quotas]
use = egg:swift#container_quotas

[filter:cache]
use = egg:swift#memcache

[filter:gatekeeper]
use = egg:swift#gatekeeper

[filter:versioned_writes]
use = egg:swift#versioned_writes
allow_versioned_writes = true

[filter:copy]
use = egg:swift#copy

[app:proxy-server]
use = egg:swift#proxy
allow_account_management = true
account_autocreate = true
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/object-expirer.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
# swift_dir = /etc/swift
user = &lt;your-user-name&gt;
# You can specify default log routing here if you want:
log_name = object-expirer
log_facility = LOG_LOCAL6
log_level = INFO
#log_address = /dev/log
#
# comma separated list of functions to call to setup custom log handlers.
# functions get passed: conf, name, log_to_console, log_route, fmt, logger,
# adapted_logger
# log_custom_handlers =
#
# If set, log_udp_host will override log_address
# log_udp_host =
# log_udp_port = 514
#
# You can enable StatsD logging here:
# log_statsd_host =
# log_statsd_port = 8125
# log_statsd_default_sample_rate = 1.0
# log_statsd_sample_rate_factor = 1.0
# log_statsd_metric_prefix =

[object-expirer]
interval = 300
# auto_create_account_prefix = .
# report_interval = 300
# concurrency is the level of concurrency o use to do the work, this value
# must be set to at least 1
# concurrency = 1
# processes is how many parts to divide the work into, one part per process
#   that will be doing the work
# processes set 0 means that a single process will be doing all the work
# processes can also be specified on the command line and will override the
#   config value
# processes = 0
# process is which of the parts a particular process will work on
# process can also be specified on the command line and will override the config
#   value
# process is &quot;zero based&quot;, if you want to use 3 processes, you should run
#  processes with process set to 0, 1, and 2
# process = 0

[pipeline:main]
pipeline = catch_errors cache proxy-server

[app:proxy-server]
use = egg:swift#proxy
# See proxy-server.conf-sample for options

[filter:cache]
use = egg:swift#memcache
# See proxy-server.conf-sample for options

[filter:catch_errors]
use = egg:swift#catch_errors
# See proxy-server.conf-sample for options
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/container-reconciler.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
# swift_dir = /etc/swift
user = &lt;your-user-name&gt;
# You can specify default log routing here if you want:
# log_name = swift
# log_facility = LOG_LOCAL0
# log_level = INFO
# log_address = /dev/log
#
# comma separated list of functions to call to setup custom log handlers.
# functions get passed: conf, name, log_to_console, log_route, fmt, logger,
# adapted_logger
# log_custom_handlers =
#
# If set, log_udp_host will override log_address
# log_udp_host =
# log_udp_port = 514
#
# You can enable StatsD logging here:
# log_statsd_host =
# log_statsd_port = 8125
# log_statsd_default_sample_rate = 1.0
# log_statsd_sample_rate_factor = 1.0
# log_statsd_metric_prefix =

[container-reconciler]
# reclaim_age = 604800
# interval = 300
# request_tries = 3

[pipeline:main]
pipeline = catch_errors proxy-logging cache proxy-server

[app:proxy-server]
use = egg:swift#proxy
# See proxy-server.conf-sample for options

[filter:cache]
use = egg:swift#memcache
# See proxy-server.conf-sample for options

[filter:proxy-logging]
use = egg:swift#proxy_logging

[filter:catch_errors]
use = egg:swift#catch_errors
# See proxy-server.conf-sample for options
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/container-sync-realms.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[saio]
key = changeme
key2 = changeme
cluster_saio_endpoint = http://127.0.0.1:8080/v1/

</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/account-server/1.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/1/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6012
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL2
recon_cache_path = /var/cache/swift
eventlet_debug = true

[pipeline:main]
pipeline = recon account-server

[app:account-server]
use = egg:swift#account

[filter:recon]
use = egg:swift#recon

[account-replicator]
rsync_module = {replication_ip}::account{replication_port}

[account-auditor]

[account-reaper]
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/container-server/1.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/1/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6011
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL2
recon_cache_path = /var/cache/swift
eventlet_debug = true

[pipeline:main]
pipeline = recon container-server

[app:container-server]
use = egg:swift#container

[filter:recon]
use = egg:swift#recon

[container-replicator]
rsync_module = {replication_ip}::container{replication_port}

[container-updater]

[container-auditor]

[container-sync]
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/object-server/1.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/1/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6010
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL2
recon_cache_path = /var/cache/swift
eventlet_debug = true

[pipeline:main]
pipeline = recon object-server

[app:object-server]
use = egg:swift#object

[filter:recon]
use = egg:swift#recon

[object-replicator]
rsync_module = {replication_ip}::object{replication_port}

[object-reconstructor]

[object-updater]

[object-auditor]
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/account-server/2.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/2/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6022
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL3
recon_cache_path = /var/cache/swift2
eventlet_debug = true

[pipeline:main]
pipeline = recon account-server

[app:account-server]
use = egg:swift#account

[filter:recon]
use = egg:swift#recon

[account-replicator]
rsync_module = {replication_ip}::account{replication_port}

[account-auditor]

[account-reaper]
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/container-server/2.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/2/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6021
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL3
recon_cache_path = /var/cache/swift2
eventlet_debug = true

[pipeline:main]
pipeline = recon container-server

[app:container-server]
use = egg:swift#container

[filter:recon]
use = egg:swift#recon

[container-replicator]
rsync_module = {replication_ip}::container{replication_port}

[container-updater]

[container-auditor]

[container-sync]
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/object-server/2.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/2/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6020
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL3
recon_cache_path = /var/cache/swift2
eventlet_debug = true

[pipeline:main]
pipeline = recon object-server

[app:object-server]
use = egg:swift#object

[filter:recon]
use = egg:swift#recon

[object-replicator]
rsync_module = {replication_ip}::object{replication_port}

[object-reconstructor]

[object-updater]

[object-auditor]
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/account-server/3.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/3/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6032
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL4
recon_cache_path = /var/cache/swift3
eventlet_debug = true

[pipeline:main]
pipeline = recon account-server

[app:account-server]
use = egg:swift#account

[filter:recon]
use = egg:swift#recon

[account-replicator]
rsync_module = {replication_ip}::account{replication_port}

[account-auditor]

[account-reaper]
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/container-server/3.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/3/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6031
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL4
recon_cache_path = /var/cache/swift3
eventlet_debug = true

[pipeline:main]
pipeline = recon container-server

[app:container-server]
use = egg:swift#container

[filter:recon]
use = egg:swift#recon

[container-replicator]
rsync_module = {replication_ip}::container{replication_port}

[container-updater]

[container-auditor]

[container-sync]
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/object-server/3.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/3/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6030
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL4
recon_cache_path = /var/cache/swift3
eventlet_debug = true

[pipeline:main]
pipeline = recon object-server

[app:object-server]
use = egg:swift#object

[filter:recon]
use = egg:swift#recon

[object-replicator]
rsync_module = {replication_ip}::object{replication_port}

[object-reconstructor]

[object-updater]

[object-auditor]
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/account-server/4.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/4/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6042
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL5
recon_cache_path = /var/cache/swift4
eventlet_debug = true

[pipeline:main]
pipeline = recon account-server

[app:account-server]
use = egg:swift#account

[filter:recon]
use = egg:swift#recon

[account-replicator]
rsync_module = {replication_ip}::account{replication_port}

[account-auditor]

[account-reaper]
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/container-server/4.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/4/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6041
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL5
recon_cache_path = /var/cache/swift4
eventlet_debug = true

[pipeline:main]
pipeline = recon container-server

[app:container-server]
use = egg:swift#container

[filter:recon]
use = egg:swift#recon

[container-replicator]
rsync_module = {replication_ip}::container{replication_port}

[container-updater]

[container-auditor]

[container-sync]
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/etc/swift/object-server/4.conf</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[DEFAULT]
devices = /srv/4/node
mount_check = false
disable_fallocate = true
bind_ip = 127.0.0.1
bind_port = 6040
workers = 1
user = &lt;your-user-name&gt;
log_facility = LOG_LOCAL5
recon_cache_path = /var/cache/swift4
eventlet_debug = true

[pipeline:main]
pipeline = recon object-server

[app:object-server]
use = egg:swift#object

[filter:recon]
use = egg:swift#recon

[object-replicator]
rsync_module = {replication_ip}::object{replication_port}

[object-reconstructor]

[object-updater]

[object-auditor]
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="setting-up-scripts-for-running-swift">
<span id="setup-scripts"></span><h2>Setting up scripts for running Swift<a class="headerlink" href="#setting-up-scripts-for-running-swift" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Copy the SAIO scripts for resetting the environment:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>mkdir -p $HOME/bin
cd $HOME/swift/doc; cp saio/bin/* $HOME/bin; cd -
chmod +x $HOME/bin/*
</pre></div>
</div>
</li>
<li><p class="first">Edit the <code class="docutils literal"><span class="pre">$HOME/bin/resetswift</span></code> script</p>
<p>The template <code class="docutils literal"><span class="pre">resetswift</span></code> script looks like the following:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span>#!/bin/bash

set -e

swift-init all kill
# Remove the following line if you did not set up rsyslog for individual logging:
sudo find /var/log/swift -type f -exec rm -f {} \;
if cut -d&#39; &#39; -f2 /proc/mounts | grep -q /mnt/sdb1 ; then
    sudo umount /mnt/sdb1
fi
# If you are using a loopback device set SAIO_BLOCK_DEVICE to &quot;/srv/swift-disk&quot;
sudo mkfs.xfs -f ${SAIO_BLOCK_DEVICE:-/dev/sdb1}
sudo mount /mnt/sdb1
sudo mkdir /mnt/sdb1/1 /mnt/sdb1/2 /mnt/sdb1/3 /mnt/sdb1/4
sudo chown ${USER}:${USER} /mnt/sdb1/*
mkdir -p /srv/1/node/sdb1 /srv/1/node/sdb5 \
         /srv/2/node/sdb2 /srv/2/node/sdb6 \
         /srv/3/node/sdb3 /srv/3/node/sdb7 \
         /srv/4/node/sdb4 /srv/4/node/sdb8
sudo rm -f /var/log/debug /var/log/messages /var/log/rsyncd.log /var/log/syslog
find /var/cache/swift* -type f -name *.recon -exec rm -f {} \;
if [ &quot;`type -t systemctl`&quot; == &quot;file&quot; ]; then
    sudo systemctl restart rsyslog
    sudo systemctl restart memcached
else
    sudo service rsyslog restart
    sudo service memcached restart
fi
</pre></div>
</div>
</div></blockquote>
<p>If you are using a loopback device add an environment var to
substitute <code class="docutils literal"><span class="pre">/dev/sdb1</span></code> with <code class="docutils literal"><span class="pre">/srv/swift-disk</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>echo &quot;export SAIO_BLOCK_DEVICE=/srv/swift-disk&quot; &gt;&gt; $HOME/.bashrc
</pre></div>
</div>
<p>If you did not set up rsyslog for individual logging, remove the <code class="docutils literal"><span class="pre">find</span>
<span class="pre">/var/log/swift...</span></code> line:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>sed -i &quot;/find \/var\/log\/swift/d&quot; $HOME/bin/resetswift
</pre></div>
</div>
</li>
<li><p class="first">Install the sample configuration file for running tests:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cp $HOME/swift/test/sample.conf /etc/swift/test.conf
</pre></div>
</div>
<p>The template <code class="docutils literal"><span class="pre">test.conf</span></code> looks like the following:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span>[func_test]
# Sample config for Swift with tempauth
auth_host = 127.0.0.1
auth_port = 8080
auth_ssl = no
auth_prefix = /auth/
# Sample config for Swift with Keystone v2 API.
# For keystone v2 change auth_version to 2 and auth_prefix to /v2.0/.
# And &quot;allow_account_management&quot; should not be set &quot;true&quot;.
#auth_version = 3
#auth_host = localhost
#auth_port = 5000
#auth_ssl = no
#auth_prefix = /v3/

# Primary functional test account (needs admin access to the account)
account = test
username = tester
password = testing

# User on a second account (needs admin access to the account)
account2 = test2
username2 = tester2
password2 = testing2

# User on same account as first, but without admin access
username3 = tester3
password3 = testing3

# Fourth user is required for keystone v3 specific tests.
# Account must be in a non-default domain.
#account4 = test4
#username4 = tester4
#password4 = testing4
#domain4 = test-domain

# Fifth user is required for service token-specific tests.
# The account must be different from the primary test account.
# The user must not have a group (tempauth) or role (keystoneauth) on
# the primary test account. The user must have a group/role that is unique
# and not given to the primary tester and is specified in the options
# &lt;prefix&gt;_require_group (tempauth) or &lt;prefix&gt;_service_roles (keystoneauth).
#account5 = test5
#username5 = tester5
#password5 = testing5

# The service_prefix option is used for service token-specific tests.
# If service_prefix or username5 above is not supplied, the tests are skipped.
# To set the value and enable the service token tests, look at the
# reseller_prefix option in /etc/swift/proxy-server.conf. There must be at
# least two prefixes. If not, add a prefix as follows (where we add SERVICE):
#     reseller_prefix = AUTH, SERVICE
# The service_prefix must match the &lt;prefix&gt; used in &lt;prefix&gt;_require_group
# (tempauth) or &lt;prefix&gt;_service_roles (keystoneauth); for example:
#    SERVICE_require_group = service
#    SERVICE_service_roles = service
# Note: Do not enable service token tests if the first prefix in
# reseller_prefix is the empty prefix AND the primary functional test
# account contains an underscore.
#service_prefix = SERVICE

# Sixth user is required for access control tests.
# Account must have a role for reseller_admin_role(keystoneauth).
#account6 = test
#username6 = tester6
#password6 = testing6

collate = C

# Only necessary if a pre-existing server uses self-signed certificate
insecure = no

[unit_test]
fake_syslog = False

[probe_test]
# check_server_timeout = 30
# validate_rsync = false

[swift-constraints]
# The functional test runner will try to use the constraint values provided in
# the swift-constraints section of test.conf.
#
# If a constraint value does not exist in that section, or because the
# swift-constraints section does not exist, the constraints values found in
# the /info API call (if successful) will be used.
#
# If a constraint value cannot be found in the /info results, either because
# the /info API call failed, or a value is not present, the constraint value
# used will fall back to those loaded by the constraints module at time of
# import (which will attempt to load /etc/swift/swift.conf, see the
# swift.common.constraints module for more information).
#
# Note that the cluster must have &quot;sane&quot; values for the test suite to pass
# (for some definition of sane).
#
#max_file_size = 5368709122
#max_meta_name_length = 128
#max_meta_value_length = 256
#max_meta_count = 90
#max_meta_overall_size = 4096
#max_header_size = 8192
#extra_header_count = 0
#max_object_name_length = 1024
#container_listing_limit = 10000
#account_listing_limit = 10000
#max_account_name_length = 256
#max_container_name_length = 256

# Newer swift versions default to strict cors mode, but older ones were the
# opposite.
#strict_cors_mode = true
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Add an environment variable for running tests below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>echo &quot;export SWIFT_TEST_CONFIG_FILE=/etc/swift/test.conf&quot; &gt;&gt; $HOME/.bashrc
</pre></div>
</div>
</li>
<li><p class="first">Be sure that your <code class="docutils literal"><span class="pre">PATH</span></code> includes the <code class="docutils literal"><span class="pre">bin</span></code> directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>echo &quot;export PATH=${PATH}:$HOME/bin&quot; &gt;&gt; $HOME/.bashrc
</pre></div>
</div>
</li>
<li><p class="first">Source the above environment variables into your current environment:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>. $HOME/.bashrc
</pre></div>
</div>
</li>
<li><p class="first">Construct the initial rings using the provided script:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">remakerings</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">remakerings</span></code> script looks like the following:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span>#!/bin/bash

set -e

cd /etc/swift

rm -f *.builder *.ring.gz backups/*.builder backups/*.ring.gz

swift-ring-builder object.builder create 10 3 1
swift-ring-builder object.builder add r1z1-127.0.0.1:6010/sdb1 1
swift-ring-builder object.builder add r1z2-127.0.0.1:6020/sdb2 1
swift-ring-builder object.builder add r1z3-127.0.0.1:6030/sdb3 1
swift-ring-builder object.builder add r1z4-127.0.0.1:6040/sdb4 1
swift-ring-builder object.builder rebalance
swift-ring-builder object-1.builder create 10 2 1
swift-ring-builder object-1.builder add r1z1-127.0.0.1:6010/sdb1 1
swift-ring-builder object-1.builder add r1z2-127.0.0.1:6020/sdb2 1
swift-ring-builder object-1.builder add r1z3-127.0.0.1:6030/sdb3 1
swift-ring-builder object-1.builder add r1z4-127.0.0.1:6040/sdb4 1
swift-ring-builder object-1.builder rebalance
swift-ring-builder object-2.builder create 10 6 1
swift-ring-builder object-2.builder add r1z1-127.0.0.1:6010/sdb1 1
swift-ring-builder object-2.builder add r1z1-127.0.0.1:6010/sdb5 1
swift-ring-builder object-2.builder add r1z2-127.0.0.1:6020/sdb2 1
swift-ring-builder object-2.builder add r1z2-127.0.0.1:6020/sdb6 1
swift-ring-builder object-2.builder add r1z3-127.0.0.1:6030/sdb3 1
swift-ring-builder object-2.builder add r1z3-127.0.0.1:6030/sdb7 1
swift-ring-builder object-2.builder add r1z4-127.0.0.1:6040/sdb4 1
swift-ring-builder object-2.builder add r1z4-127.0.0.1:6040/sdb8 1
swift-ring-builder object-2.builder rebalance
swift-ring-builder container.builder create 10 3 1
swift-ring-builder container.builder add r1z1-127.0.0.1:6011/sdb1 1
swift-ring-builder container.builder add r1z2-127.0.0.1:6021/sdb2 1
swift-ring-builder container.builder add r1z3-127.0.0.1:6031/sdb3 1
swift-ring-builder container.builder add r1z4-127.0.0.1:6041/sdb4 1
swift-ring-builder container.builder rebalance
swift-ring-builder account.builder create 10 3 1
swift-ring-builder account.builder add r1z1-127.0.0.1:6012/sdb1 1
swift-ring-builder account.builder add r1z2-127.0.0.1:6022/sdb2 1
swift-ring-builder account.builder add r1z3-127.0.0.1:6032/sdb3 1
swift-ring-builder account.builder add r1z4-127.0.0.1:6042/sdb4 1
swift-ring-builder account.builder rebalance
</pre></div>
</div>
</div></blockquote>
<p>You can expect the output from this command to produce the following.  Note
that 3 object rings are created in order to test storage policies and EC in
the SAIO environment.  The EC ring is the only one with all 8 devices.
There are also two replication rings, one for 3x replication and another
for 2x replication, but those rings only use 4 devices:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Device d0r1z1-127.0.0.1:6010R127.0.0.1:6010/sdb1_&quot;&quot; with 1.0 weight got id 0
Device d1r1z2-127.0.0.1:6020R127.0.0.1:6020/sdb2_&quot;&quot; with 1.0 weight got id 1
Device d2r1z3-127.0.0.1:6030R127.0.0.1:6030/sdb3_&quot;&quot; with 1.0 weight got id 2
Device d3r1z4-127.0.0.1:6040R127.0.0.1:6040/sdb4_&quot;&quot; with 1.0 weight got id 3
Reassigned 1024 (100.00%) partitions. Balance is now 0.00.  Dispersion is now 0.00
Device d0r1z1-127.0.0.1:6010R127.0.0.1:6010/sdb1_&quot;&quot; with 1.0 weight got id 0
Device d1r1z2-127.0.0.1:6020R127.0.0.1:6020/sdb2_&quot;&quot; with 1.0 weight got id 1
Device d2r1z3-127.0.0.1:6030R127.0.0.1:6030/sdb3_&quot;&quot; with 1.0 weight got id 2
Device d3r1z4-127.0.0.1:6040R127.0.0.1:6040/sdb4_&quot;&quot; with 1.0 weight got id 3
Reassigned 1024 (100.00%) partitions. Balance is now 0.00.  Dispersion is now 0.00
Device d0r1z1-127.0.0.1:6010R127.0.0.1:6010/sdb1_&quot;&quot; with 1.0 weight got id 0
Device d1r1z1-127.0.0.1:6010R127.0.0.1:6010/sdb5_&quot;&quot; with 1.0 weight got id 1
Device d2r1z2-127.0.0.1:6020R127.0.0.1:6020/sdb2_&quot;&quot; with 1.0 weight got id 2
Device d3r1z2-127.0.0.1:6020R127.0.0.1:6020/sdb6_&quot;&quot; with 1.0 weight got id 3
Device d4r1z3-127.0.0.1:6030R127.0.0.1:6030/sdb3_&quot;&quot; with 1.0 weight got id 4
Device d5r1z3-127.0.0.1:6030R127.0.0.1:6030/sdb7_&quot;&quot; with 1.0 weight got id 5
Device d6r1z4-127.0.0.1:6040R127.0.0.1:6040/sdb4_&quot;&quot; with 1.0 weight got id 6
Device d7r1z4-127.0.0.1:6040R127.0.0.1:6040/sdb8_&quot;&quot; with 1.0 weight got id 7
Reassigned 1024 (100.00%) partitions. Balance is now 0.00.  Dispersion is now 0.00
Device d0r1z1-127.0.0.1:6011R127.0.0.1:6011/sdb1_&quot;&quot; with 1.0 weight got id 0
Device d1r1z2-127.0.0.1:6021R127.0.0.1:6021/sdb2_&quot;&quot; with 1.0 weight got id 1
Device d2r1z3-127.0.0.1:6031R127.0.0.1:6031/sdb3_&quot;&quot; with 1.0 weight got id 2
Device d3r1z4-127.0.0.1:6041R127.0.0.1:6041/sdb4_&quot;&quot; with 1.0 weight got id 3
Reassigned 1024 (100.00%) partitions. Balance is now 0.00.  Dispersion is now 0.00
Device d0r1z1-127.0.0.1:6012R127.0.0.1:6012/sdb1_&quot;&quot; with 1.0 weight got id 0
Device d1r1z2-127.0.0.1:6022R127.0.0.1:6022/sdb2_&quot;&quot; with 1.0 weight got id 1
Device d2r1z3-127.0.0.1:6032R127.0.0.1:6032/sdb3_&quot;&quot; with 1.0 weight got id 2
Device d3r1z4-127.0.0.1:6042R127.0.0.1:6042/sdb4_&quot;&quot; with 1.0 weight got id 3
Reassigned 1024 (100.00%) partitions. Balance is now 0.00.  Dispersion is now 0.00
</pre></div>
</div>
</li>
<li><p class="first">Read more about Storage Policies and your SAIO <a class="reference internal" href="policies_saio.html"><em>Adding Storage Policies to an Existing SAIO</em></a></p>
</li>
<li><p class="first">Verify the unit tests run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$HOME/swift/.unittests
</pre></div>
</div>
<p>Note that the unit tests do not require any swift daemons running.</p>
</li>
<li><p class="first">Start the &#8220;main&#8221; Swift daemon processes (proxy, account, container, and
object):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">startmain</span>
</pre></div>
</div>
<p>(The &#8220;<code class="docutils literal"><span class="pre">Unable</span> <span class="pre">to</span> <span class="pre">increase</span> <span class="pre">file</span> <span class="pre">descriptor</span> <span class="pre">limit.</span>&nbsp; <span class="pre">Running</span> <span class="pre">as</span> <span class="pre">non-root?</span></code>&#8221;
warnings are expected and ok.)</p>
<p>The <code class="docutils literal"><span class="pre">startmain</span></code> script looks like the following:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span>#!/bin/bash

set -e

swift-init main start
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Get an <code class="docutils literal"><span class="pre">X-Storage-Url</span></code> and <code class="docutils literal"><span class="pre">X-Auth-Token</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>curl -v -H &#39;X-Storage-User: test:tester&#39; -H &#39;X-Storage-Pass: testing&#39; http://127.0.0.1:8080/auth/v1.0
</pre></div>
</div>
</li>
<li><p class="first">Check that you can <code class="docutils literal"><span class="pre">GET</span></code> account:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>curl -v -H &#39;X-Auth-Token: &lt;token-from-x-auth-token-above&gt;&#39; &lt;url-from-x-storage-url-above&gt;
</pre></div>
</div>
</li>
<li><p class="first">Check that <code class="docutils literal"><span class="pre">swift</span></code> command provided by the python-swiftclient package works:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>swift -A http://127.0.0.1:8080/auth/v1.0 -U test:tester -K testing stat
</pre></div>
</div>
</li>
<li><p class="first">Verify the functional tests run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$HOME/swift/.functests
</pre></div>
</div>
<p>(Note: functional tests will first delete everything in the configured
accounts.)</p>
</li>
<li><p class="first">Verify the probe tests run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$HOME/swift/.probetests
</pre></div>
</div>
<p>(Note: probe tests will reset your environment as they call <code class="docutils literal"><span class="pre">resetswift</span></code>
for each test.)</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="debugging-issues">
<h2>Debugging Issues<a class="headerlink" href="#debugging-issues" title="Permalink to this headline">¶</a></h2>
<p>If all doesn&#8217;t go as planned, and tests fail, or you can&#8217;t auth, or something
doesn&#8217;t work, here are some good starting places to look for issues:</p>
<ol class="arabic simple">
<li>Everything is logged using system facilities &#8211; usually in <code class="docutils literal"><span class="pre">/var/log/syslog</span></code>,
but possibly in <code class="docutils literal"><span class="pre">/var/log/messages</span></code> on e.g. Fedora &#8211; so that is a good first
place to look for errors (most likely python tracebacks).</li>
<li>Make sure all of the server processes are running.  For the base
functionality, the Proxy, Account, Container, and Object servers
should be running.</li>
<li>If one of the servers are not running, and no errors are logged to syslog,
it may be useful to try to start the server manually, for example:
<code class="docutils literal"><span class="pre">swift-object-server</span> <span class="pre">/etc/swift/object-server/1.conf</span></code> will start the
object server.  If there are problems not showing up in syslog,
then you will likely see the traceback on startup.</li>
<li>If you need to, you can turn off syslog for unit tests. This can be
useful for environments where <code class="docutils literal"><span class="pre">/dev/log</span></code> is unavailable, or which
cannot rate limit (unit tests generate a lot of logs very quickly).
Open the file <code class="docutils literal"><span class="pre">SWIFT_TEST_CONFIG_FILE</span></code> points to, and change the
value of <code class="docutils literal"><span class="pre">fake_syslog</span></code> to <code class="docutils literal"><span class="pre">True</span></code>.</li>
<li>If you encounter a <code class="docutils literal"><span class="pre">401</span> <span class="pre">Unauthorized</span></code> when following Step 12 where
you check that you can <code class="docutils literal"><span class="pre">GET</span></code> account, use <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">memcached</span> <span class="pre">status</span></code>
and check if memcache is running. If memcache is not running, start it using
<code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">memcached</span> <span class="pre">start</span></code>. Once memcache is running, rerun <code class="docutils literal"><span class="pre">GET</span></code> account.</li>
</ol>
</div>
<div class="section" id="known-issues">
<h2>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<p>Listed here are some &#8220;gotcha&#8217;s&#8221; that you may run into when using or testing your SAIO:</p>
<ol class="arabic simple">
<li>fallocate_reserve - in most cases a SAIO doesn&#8217;t have a very large XFS partition
so having fallocate enabled and fallocate_reserve set can cause issues, specifically
when trying to run the functional tests. For this reason fallocate has been turned
off on the object-servers in the SAIO. If you want to play with the fallocate_reserve
settings then know that functional tests will fail unless you change the max_file_size
constraint to something more reasonable then the default (5G). Ideally you&#8217;d make
it 1/4 of your XFS file system size so the tests can pass.</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">SAIO - Swift All In One</a><ul>
<li><a class="reference internal" href="#instructions-for-setting-up-a-development-vm">Instructions for setting up a development VM</a></li>
<li><a class="reference internal" href="#what-s-in-a-your-user-name">What&#8217;s in a &lt;your-user-name&gt;</a></li>
<li><a class="reference internal" href="#installing-dependencies">Installing dependencies</a><ul>
<li><a class="reference internal" href="#using-a-partition-for-storage">Using a partition for storage</a></li>
<li><a class="reference internal" href="#using-a-loopback-device-for-storage">Using a loopback device for storage</a></li>
<li><a class="reference internal" href="#common-post-device-setup">Common Post-Device Setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-the-code">Getting the code</a></li>
<li><a class="reference internal" href="#setting-up-rsync">Setting up rsync</a></li>
<li><a class="reference internal" href="#starting-memcached">Starting memcached</a></li>
<li><a class="reference internal" href="#optional-setting-up-rsyslog-for-individual-logging">Optional: Setting up rsyslog for individual logging</a></li>
<li><a class="reference internal" href="#configuring-each-node">Configuring each node</a></li>
<li><a class="reference internal" href="#setting-up-scripts-for-running-swift">Setting up scripts for running Swift</a></li>
<li><a class="reference internal" href="#debugging-issues">Debugging Issues</a></li>
<li><a class="reference internal" href="#known-issues">Known Issues</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="development_guidelines.html"
                                  title="previous chapter">Development Guidelines</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="first_contribution_swift.html"
                                  title="next chapter">First Contribution to Swift</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/swift
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/development_saio.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="first_contribution_swift.html" title="First Contribution to Swift"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="development_guidelines.html" title="Development Guidelines"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">swift 2.12.1.dev102 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2017, OpenStack Foundation.
      Last updated on &#39;Tue Feb 14 07:57:22 2017, commit 7cb6882&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/swift");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>