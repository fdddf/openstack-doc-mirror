<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Keystone Architecture &mdash; keystone 11.0.0.0rc2.dev29 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/support-matrix.css" type="text/css" />
    <link rel="stylesheet" href="_static/support-matrix.css" type="text/css" />
    <link rel="stylesheet" href="_static/support-matrix.css" type="text/css" />
    <link rel="stylesheet" href="_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '11.0.0.0rc2.dev29',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="keystone 11.0.0.0rc2.dev29 documentation" href="index.html" />
    <link rel="next" title="Mapping of policy target to API" href="policy_mapping.html" />
    <link rel="prev" title="Running Keystone in HTTPD" href="apache-httpd.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="keystone-architecture">
<h1>Keystone Architecture<a class="headerlink" href="#keystone-architecture" title="Permalink to this headline">¶</a></h1>
<p>Much of the design is precipitated from the expectation that the auth backends
for most deployments will actually be shims in front of existing user systems.</p>
<div class="section" id="services">
<h2>Services<a class="headerlink" href="#services" title="Permalink to this headline">¶</a></h2>
<p>Keystone is organized as a group of internal services exposed on one or many
endpoints. Many of these services are used in a combined fashion by the
frontend, for example an authenticate call will validate user/project
credentials with the Identity service and, upon success, create and return a
token with the Token service.</p>
<div class="section" id="identity">
<h3>Identity<a class="headerlink" href="#identity" title="Permalink to this headline">¶</a></h3>
<p>The Identity service provides auth credential validation and data about <cite>users</cite>
and <cite>groups</cite>.</p>
<p>In the basic case all this data is managed by the service, allowing the service
to manage all the CRUD associated with the data.</p>
<p>In other cases, data is managed from an authoritative backend service. An
example of this would be when backending on LDAP. The LDAP backend utilizes
the LDAP server as the source for user and group data.</p>
<div class="section" id="users">
<h4>Users<a class="headerlink" href="#users" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">Users</span></code> represent an individual API consumer. A user itself must be owned by
a specific domain, and hence all user names are <strong>not</strong> globally unique, but
only unique to their domain.</p>
</div>
<div class="section" id="groups">
<h4>Groups<a class="headerlink" href="#groups" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">Groups</span></code> are a container representing a collection of users. A group itself
must be owned by a specific domain, and hence all group names are <strong>not</strong>
globally unique, but only unique to their domain.</p>
</div>
</div>
<div class="section" id="resource">
<h3>Resource<a class="headerlink" href="#resource" title="Permalink to this headline">¶</a></h3>
<p>The Resource service provides data about <cite>projects</cite> and <cite>domains</cite>.</p>
<div class="section" id="projects-tenants">
<h4>Projects (Tenants)<a class="headerlink" href="#projects-tenants" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">Projects</span></code> (known as <code class="docutils literal"><span class="pre">Tenants</span></code> in v2.0) represent the base unit of
<code class="docutils literal"><span class="pre">ownership</span></code> in OpenStack, in that all resources in OpenStack should be owned
by a specific project.
A project itself must be owned by a specific domain, and hence all project
names are <strong>not</strong> globally unique, but unique to their domain.
If the domain for a project is not specified, then it is added to the default
domain.</p>
</div>
<div class="section" id="domains">
<h4>Domains<a class="headerlink" href="#domains" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">Domains</span></code> are a high-level container for projects, users and groups. Each is
owned by exactly one domain. Each domain defines a namespace where an
API-visible name attribute exists. keystone provides a default domain, aptly
named &#8216;Default&#8217;.</p>
<p>In the Identity v3 API, the uniqueness of attributes is as follows:</p>
<ul class="simple">
<li>Domain Name. Globally unique across all domains.</li>
<li>Role Name. Globally unique across all domains.</li>
<li>User Name. Unique within the owning domain.</li>
<li>Project Name. Unique within the owning domain.</li>
<li>Group Name. Unique within the owning domain.</li>
</ul>
<p>Due to their container architecture, domains may be used as a way to delegate
management of OpenStack resources. A user in a domain may still access
resources in another domain, if an appropriate assignment is granted.</p>
</div>
</div>
<div class="section" id="assignment">
<h3>Assignment<a class="headerlink" href="#assignment" title="Permalink to this headline">¶</a></h3>
<p>The Assignment service provides data about <cite>roles</cite> and <cite>role assignments</cite>.</p>
<div class="section" id="roles">
<h4>Roles<a class="headerlink" href="#roles" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">Roles</span></code> dictate the level of authorization the end user can obtain. Roles
can be granted at either the domain or project level. Role can be assigned to
the individual user or at the group level. Role names are globally unique.</p>
</div>
<div class="section" id="role-assignments">
<h4>Role Assignments<a class="headerlink" href="#role-assignments" title="Permalink to this headline">¶</a></h4>
<p>A 3-tuple that has a <code class="docutils literal"><span class="pre">Role</span></code>, a <code class="docutils literal"><span class="pre">Resource</span></code> and an <code class="docutils literal"><span class="pre">Identity</span></code>.</p>
</div>
</div>
<div class="section" id="token">
<h3>Token<a class="headerlink" href="#token" title="Permalink to this headline">¶</a></h3>
<p>The Token service validates and manages tokens used for authenticating requests
once a user&#8217;s credentials have already been verified.</p>
</div>
<div class="section" id="catalog">
<h3>Catalog<a class="headerlink" href="#catalog" title="Permalink to this headline">¶</a></h3>
<p>The Catalog service provides an endpoint registry used for endpoint discovery.</p>
</div>
<div class="section" id="policy">
<h3>Policy<a class="headerlink" href="#policy" title="Permalink to this headline">¶</a></h3>
<p>The Policy service provides a rule-based authorization engine and the
associated rule management interface.</p>
</div>
</div>
<div class="section" id="application-construction">
<h2>Application Construction<a class="headerlink" href="#application-construction" title="Permalink to this headline">¶</a></h2>
<p>Keystone is an HTTP front-end to several services. Like other OpenStack
applications, this is done using python WSGI interfaces and applications are
configured together using <a class="reference external" href="http://pythonpaste.org/">Paste</a>. The application&#8217;s HTTP endpoints are made up
of pipelines of WSGI middleware, such as:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[pipeline:api_v3]</span>
<span class="na">pipeline</span> <span class="o">=</span> <span class="s">healthcheck cors sizelimit http_proxy_to_wsgi osprofiler url_normalize request_id build_auth_context token_auth json_body ec2_extension_v3 s3_extension service_v3</span>
</pre></div>
</div>
<p>These in turn use a subclass of <a class="reference internal" href="api/keystone.common.html#keystone.common.wsgi.ComposingRouter" title="keystone.common.wsgi.ComposingRouter"><code class="xref py py-mod docutils literal"><span class="pre">keystone.common.wsgi.ComposingRouter</span></code></a> to
link URLs to controllers (a subclass of
<a class="reference internal" href="api/keystone.common.html#keystone.common.wsgi.Application" title="keystone.common.wsgi.Application"><code class="xref py py-mod docutils literal"><span class="pre">keystone.common.wsgi.Application</span></code></a>). Within each controller, one or more
managers are loaded (for example, see <a class="reference internal" href="api/keystone.catalog.html#keystone.catalog.core.Manager" title="keystone.catalog.core.Manager"><code class="xref py py-mod docutils literal"><span class="pre">keystone.catalog.core.Manager</span></code></a>),
which are thin wrapper classes which load the appropriate service driver based
on the keystone configuration.</p>
<ul class="simple">
<li>Assignment</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="api/keystone.assignment.html#keystone.assignment.controllers.GrantAssignmentV3" title="keystone.assignment.controllers.GrantAssignmentV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.assignment.controllers.GrantAssignmentV3</span></code></a></li>
<li><a class="reference internal" href="api/keystone.assignment.html#keystone.assignment.controllers.ImpliedRolesV3" title="keystone.assignment.controllers.ImpliedRolesV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.assignment.controllers.ImpliedRolesV3</span></code></a></li>
<li><a class="reference internal" href="api/keystone.assignment.html#keystone.assignment.controllers.ProjectAssignmentV3" title="keystone.assignment.controllers.ProjectAssignmentV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.assignment.controllers.ProjectAssignmentV3</span></code></a></li>
<li><a class="reference internal" href="api/keystone.assignment.html#keystone.assignment.controllers.TenantAssignment" title="keystone.assignment.controllers.TenantAssignment"><code class="xref py py-mod docutils literal"><span class="pre">keystone.assignment.controllers.TenantAssignment</span></code></a></li>
<li><a class="reference internal" href="api/keystone.assignment.html#keystone.assignment.controllers.Role" title="keystone.assignment.controllers.Role"><code class="xref py py-mod docutils literal"><span class="pre">keystone.assignment.controllers.Role</span></code></a></li>
<li><a class="reference internal" href="api/keystone.assignment.html#keystone.assignment.controllers.RoleAssignmentV2" title="keystone.assignment.controllers.RoleAssignmentV2"><code class="xref py py-mod docutils literal"><span class="pre">keystone.assignment.controllers.RoleAssignmentV2</span></code></a></li>
<li><a class="reference internal" href="api/keystone.assignment.html#keystone.assignment.controllers.RoleAssignmentV3" title="keystone.assignment.controllers.RoleAssignmentV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.assignment.controllers.RoleAssignmentV3</span></code></a></li>
<li><a class="reference internal" href="api/keystone.assignment.html#keystone.assignment.controllers.RoleV3" title="keystone.assignment.controllers.RoleV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.assignment.controllers.RoleV3</span></code></a></li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Authentication</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="api/keystone.auth.html#keystone.auth.controllers.Auth" title="keystone.auth.controllers.Auth"><code class="xref py py-mod docutils literal"><span class="pre">keystone.auth.controllers.Auth</span></code></a></li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Catalog</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="api/keystone.catalog.html#keystone.catalog.controllers.EndpointFilterV3Controller" title="keystone.catalog.controllers.EndpointFilterV3Controller"><code class="xref py py-mod docutils literal"><span class="pre">keystone.catalog.controllers.EndpointFilterV3Controller</span></code></a></li>
<li><a class="reference internal" href="api/keystone.catalog.html#keystone.catalog.controllers.EndpointGroupV3Controller" title="keystone.catalog.controllers.EndpointGroupV3Controller"><code class="xref py py-mod docutils literal"><span class="pre">keystone.catalog.controllers.EndpointGroupV3Controller</span></code></a></li>
<li><a class="reference internal" href="api/keystone.catalog.html#keystone.catalog.controllers.EndpointV3" title="keystone.catalog.controllers.EndpointV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.catalog.controllers.EndpointV3</span></code></a></li>
<li><a class="reference internal" href="api/keystone.catalog.html#keystone.catalog.controllers.ProjectEndpointGroupV3Controller" title="keystone.catalog.controllers.ProjectEndpointGroupV3Controller"><code class="xref py py-mod docutils literal"><span class="pre">keystone.catalog.controllers.ProjectEndpointGroupV3Controller</span></code></a></li>
<li><a class="reference internal" href="api/keystone.catalog.html#keystone.catalog.controllers.RegionV3" title="keystone.catalog.controllers.RegionV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.catalog.controllers.RegionV3</span></code></a></li>
<li><a class="reference internal" href="api/keystone.catalog.html#keystone.catalog.controllers.ServiceV3" title="keystone.catalog.controllers.ServiceV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.catalog.controllers.ServiceV3</span></code></a></li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Credentials</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="api/keystone.contrib.ec2.html#keystone.contrib.ec2.controllers.Ec2ControllerV3" title="keystone.contrib.ec2.controllers.Ec2ControllerV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.contrib.ec2.controllers.Ec2ControllerV3</span></code></a></li>
<li><a class="reference internal" href="api/keystone.credential.html#keystone.credential.controllers.CredentialV3" title="keystone.credential.controllers.CredentialV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.credential.controllers.CredentialV3</span></code></a></li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Federation</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="api/keystone.federation.html#keystone.federation.controllers.IdentityProvider" title="keystone.federation.controllers.IdentityProvider"><code class="xref py py-mod docutils literal"><span class="pre">keystone.federation.controllers.IdentityProvider</span></code></a></li>
<li><a class="reference internal" href="api/keystone.federation.html#keystone.federation.controllers.FederationProtocol" title="keystone.federation.controllers.FederationProtocol"><code class="xref py py-mod docutils literal"><span class="pre">keystone.federation.controllers.FederationProtocol</span></code></a></li>
<li><a class="reference internal" href="api/keystone.federation.html#keystone.federation.controllers.MappingController" title="keystone.federation.controllers.MappingController"><code class="xref py py-mod docutils literal"><span class="pre">keystone.federation.controllers.MappingController</span></code></a></li>
<li><a class="reference internal" href="api/keystone.federation.html#keystone.federation.controllers.ServiceProvider" title="keystone.federation.controllers.ServiceProvider"><code class="xref py py-mod docutils literal"><span class="pre">keystone.federation.controllers.ServiceProvider</span></code></a></li>
<li><a class="reference internal" href="api/keystone.federation.html#keystone.federation.controllers.SAMLMetadataV3" title="keystone.federation.controllers.SAMLMetadataV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.federation.controllers.SAMLMetadataV3</span></code></a></li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Identity</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="api/keystone.identity.html#keystone.identity.controllers.GroupV3" title="keystone.identity.controllers.GroupV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.identity.controllers.GroupV3</span></code></a></li>
<li><a class="reference internal" href="api/keystone.identity.html#keystone.identity.controllers.UserV3" title="keystone.identity.controllers.UserV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.identity.controllers.UserV3</span></code></a></li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Policy</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="api/keystone.policy.html#keystone.policy.controllers.PolicyV3" title="keystone.policy.controllers.PolicyV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.policy.controllers.PolicyV3</span></code></a></li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Resource</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="api/keystone.resource.html#keystone.resource.controllers.DomainV3" title="keystone.resource.controllers.DomainV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.resource.controllers.DomainV3</span></code></a></li>
<li><a class="reference internal" href="api/keystone.resource.html#keystone.resource.controllers.DomainConfigV3" title="keystone.resource.controllers.DomainConfigV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.resource.controllers.DomainConfigV3</span></code></a></li>
<li><a class="reference internal" href="api/keystone.resource.html#keystone.resource.controllers.ProjectV3" title="keystone.resource.controllers.ProjectV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.resource.controllers.ProjectV3</span></code></a></li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Revoke</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="api/keystone.revoke.html#keystone.revoke.controllers.RevokeController" title="keystone.revoke.controllers.RevokeController"><code class="xref py py-mod docutils literal"><span class="pre">keystone.revoke.controllers.RevokeController</span></code></a></li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Trust</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="api/keystone.trust.html#keystone.trust.controllers.TrustV3" title="keystone.trust.controllers.TrustV3"><code class="xref py py-mod docutils literal"><span class="pre">keystone.trust.controllers.TrustV3</span></code></a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="service-backends">
<h2>Service Backends<a class="headerlink" href="#service-backends" title="Permalink to this headline">¶</a></h2>
<p>Each of the services can be configured to use a backend to allow keystone to
fit a variety of environments and needs. The backend for each service is
defined in the keystone.conf file with the key <code class="docutils literal"><span class="pre">driver</span></code> under a group
associated with each service.</p>
<p>A general class exists under each backend to provide an abstract base class
for any implementations, identifying the expected service implementations. The
abstract base classes are stored in the service&#8217;s backends directory as
<code class="docutils literal"><span class="pre">base.py</span></code>. The corresponding drivers for the services are:</p>
<ul class="simple">
<li><a class="reference internal" href="api/keystone.assignment.backends.html#keystone.assignment.backends.base.AssignmentDriverBase" title="keystone.assignment.backends.base.AssignmentDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.assignment.backends.base.AssignmentDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.assignment.role_backends.html#keystone.assignment.role_backends.base.RoleDriverBase" title="keystone.assignment.role_backends.base.RoleDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.assignment.role_backends.base.RoleDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.auth.plugins.html#keystone.auth.plugins.base.AuthMethodHandler" title="keystone.auth.plugins.base.AuthMethodHandler"><code class="xref py py-mod docutils literal"><span class="pre">keystone.auth.plugins.base.AuthMethodHandler</span></code></a></li>
<li><a class="reference internal" href="api/keystone.catalog.backends.html#keystone.catalog.backends.base.CatalogDriverBase" title="keystone.catalog.backends.base.CatalogDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.catalog.backends.base.CatalogDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.credential.backends.html#keystone.credential.backends.base.CredentialDriverBase" title="keystone.credential.backends.base.CredentialDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.credential.backends.base.CredentialDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.endpoint_policy.backends.html#keystone.endpoint_policy.backends.base.EndpointPolicyDriverBase" title="keystone.endpoint_policy.backends.base.EndpointPolicyDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.endpoint_policy.backends.base.EndpointPolicyDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.federation.backends.html#keystone.federation.backends.base.FederationDriverBase" title="keystone.federation.backends.base.FederationDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.federation.backends.base.FederationDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.identity.backends.html#keystone.identity.backends.base.IdentityDriverBase" title="keystone.identity.backends.base.IdentityDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.identity.backends.base.IdentityDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.identity.mapping_backends.html#keystone.identity.mapping_backends.base.MappingDriverBase" title="keystone.identity.mapping_backends.base.MappingDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.identity.mapping_backends.base.MappingDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.identity.shadow_backends.html#keystone.identity.shadow_backends.base.ShadowUsersDriverBase" title="keystone.identity.shadow_backends.base.ShadowUsersDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.identity.shadow_backends.base.ShadowUsersDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.oauth1.backends.html#keystone.oauth1.backends.base.Oauth1DriverBase" title="keystone.oauth1.backends.base.Oauth1DriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.oauth1.backends.base.Oauth1DriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.policy.backends.html#keystone.policy.backends.base.PolicyDriverBase" title="keystone.policy.backends.base.PolicyDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.policy.backends.base.PolicyDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.resource.backends.html#keystone.resource.backends.base.ResourceDriverBase" title="keystone.resource.backends.base.ResourceDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.resource.backends.base.ResourceDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.resource.config_backends.html#keystone.resource.config_backends.base.DomainConfigDriverBase" title="keystone.resource.config_backends.base.DomainConfigDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.resource.config_backends.base.DomainConfigDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.revoke.backends.html#keystone.revoke.backends.base.RevokeDriverBase" title="keystone.revoke.backends.base.RevokeDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.revoke.backends.base.RevokeDriverBase</span></code></a></li>
<li><a class="reference internal" href="api/keystone.token.providers.html#keystone.token.providers.base.Provider" title="keystone.token.providers.base.Provider"><code class="xref py py-mod docutils literal"><span class="pre">keystone.token.providers.base.Provider</span></code></a></li>
<li><a class="reference internal" href="api/keystone.trust.backends.html#keystone.trust.backends.base.TrustDriverBase" title="keystone.trust.backends.base.TrustDriverBase"><code class="xref py py-mod docutils literal"><span class="pre">keystone.trust.backends.base.TrustDriverBase</span></code></a></li>
</ul>
<p>If you implement a backend driver for one of the keystone services, you&#8217;re
expected to subclass from these classes.</p>
<div class="section" id="templated-backend">
<h3>Templated Backend<a class="headerlink" href="#templated-backend" title="Permalink to this headline">¶</a></h3>
<p>Largely designed for a common use case around service catalogs in the keystone
project, a catalog backend that simply expands pre-configured templates to
provide catalog data.</p>
<p>Example paste.deploy config (uses $ instead of % to avoid ConfigParser&#8217;s
interpolation)</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[DEFAULT]</span>
<span class="na">catalog.RegionOne.identity.publicURL</span> <span class="o">=</span> <span class="s">http://localhost:$(public_port)s/v2.0</span>
<span class="na">catalog.RegionOne.identity.adminURL</span> <span class="o">=</span> <span class="s">http://localhost:$(public_port)s/v2.0</span>
<span class="na">catalog.RegionOne.identity.internalURL</span> <span class="o">=</span> <span class="s">http://localhost:$(public_port)s/v2.0</span>
<span class="na">catalog.RegionOne.identity.name</span> <span class="o">=</span> <span class="s">&#39;Identity Service&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-model">
<h2>Data Model<a class="headerlink" href="#data-model" title="Permalink to this headline">¶</a></h2>
<p>Keystone was designed from the ground up to be amenable to multiple styles of
backends and as such many of the methods and data types will happily accept
more data than they know what to do with and pass them on to a backend.</p>
<p>There are a few main data types:</p>
<blockquote>
<div><ul class="simple">
<li><strong>User</strong>: has account credentials, is associated with one or more projects or domains</li>
<li><strong>Group</strong>: a collection of users, is associated with one or more projects or domains</li>
<li><strong>Project</strong>: unit of ownership in OpenStack, contains one or more users</li>
<li><strong>Domain</strong>: unit of ownership in OpenStack, contains users, groups and projects</li>
<li><strong>Role</strong>: a first-class piece of metadata associated with many user-project pairs.</li>
<li><strong>Token</strong>: identifying credential associated with a user or user and project</li>
<li><strong>Extras</strong>: bucket of key-value metadata associated with a user-project pair.</li>
<li><strong>Rule</strong>: describes a set of requirements for performing an action.</li>
</ul>
</div></blockquote>
<p>While the general data model allows a many-to-many relationship between users
and groups to projects and domains; the actual backend implementations take
varying levels of advantage of that functionality.</p>
</div>
<div class="section" id="approach-to-crud">
<h2>Approach to CRUD<a class="headerlink" href="#approach-to-crud" title="Permalink to this headline">¶</a></h2>
<p>While it is expected that any &#8220;real&#8221; deployment at a large company will manage
their users and groups in their existing user systems, a variety of CRUD
operations are provided for the sake of development and testing.</p>
<p>CRUD is treated as an extension or additional feature to the core feature set
in that it is not required that a backend support it. It is expected that
backends for services that don&#8217;t support the CRUD operations will raise a
<a class="reference internal" href="api/keystone.html#keystone.exception.NotImplemented" title="keystone.exception.NotImplemented"><code class="xref py py-mod docutils literal"><span class="pre">keystone.exception.NotImplemented</span></code></a>.</p>
</div>
<div class="section" id="approach-to-authorization-policy">
<h2>Approach to Authorization (Policy)<a class="headerlink" href="#approach-to-authorization-policy" title="Permalink to this headline">¶</a></h2>
<p>Various components in the system require that different actions are allowed
based on whether the user is authorized to perform that action.</p>
<p>For the purposes of keystone there are only a couple levels of authorization
being checked for:</p>
<blockquote>
<div><ul class="simple">
<li>Require that the performing user is considered an admin.</li>
<li>Require that the performing user matches the user being referenced.</li>
</ul>
</div></blockquote>
<p>Other systems wishing to use the policy engine will require additional styles
of checks and will possibly write completely custom backends. By default,
keystone leverages policy enforcement that is maintained in <a class="reference external" href="https://git.openstack.org/cgit/openstack/oslo.policy/">oslo.policy</a>.</p>
<div class="section" id="rules">
<h3>Rules<a class="headerlink" href="#rules" title="Permalink to this headline">¶</a></h3>
<p>Given a list of matches to check for, simply verify that the credentials
contain the matches. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">credentials</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;is_admin&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nova:netadmin&#39;</span><span class="p">]}</span>

<span class="c1"># An admin only call:</span>
<span class="n">policy_api</span><span class="o">.</span><span class="n">enforce</span><span class="p">((</span><span class="s1">&#39;is_admin:1&#39;</span><span class="p">,),</span> <span class="n">credentials</span><span class="p">)</span>

<span class="c1"># An admin or owner call:</span>
<span class="n">policy_api</span><span class="o">.</span><span class="n">enforce</span><span class="p">((</span><span class="s1">&#39;is_admin:1&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id:foo&#39;</span><span class="p">),</span> <span class="n">credentials</span><span class="p">)</span>

<span class="c1"># A netadmin call:</span>
<span class="n">policy_api</span><span class="o">.</span><span class="n">enforce</span><span class="p">((</span><span class="s1">&#39;roles:nova:netadmin&#39;</span><span class="p">,),</span> <span class="n">credentials</span><span class="p">)</span>
</pre></div>
</div>
<p>Credentials are generally built from the user metadata in the &#8216;extras&#8217; part
of the Identity API. So, adding a &#8216;role&#8217; to the user just means adding the role
to the user metadata.</p>
</div>
<div class="section" id="capability-rbac">
<h3>Capability RBAC<a class="headerlink" href="#capability-rbac" title="Permalink to this headline">¶</a></h3>
<p>(Not yet implemented.)</p>
<p>Another approach to authorization can be action-based, with a mapping of roles
to which capabilities are allowed for that role. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">credentials</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;is_admin&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nova:netadmin&#39;</span><span class="p">]}</span>

<span class="c1"># add a policy</span>
<span class="n">policy_api</span><span class="o">.</span><span class="n">add_policy</span><span class="p">(</span><span class="s1">&#39;action:nova:add_network&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;roles:nova:netadmin&#39;</span><span class="p">,))</span>

<span class="n">policy_api</span><span class="o">.</span><span class="n">enforce</span><span class="p">((</span><span class="s1">&#39;action:nova:add_network&#39;</span><span class="p">,),</span> <span class="n">credentials</span><span class="p">)</span>
</pre></div>
</div>
<p>In the backend this would look up the policy for &#8216;action:nova:add_network&#8217; and
then do what is effectively a &#8216;Simple Match&#8217; style match against the credentials.</p>
</div>
</div>
<div class="section" id="approach-to-authentication">
<h2>Approach to Authentication<a class="headerlink" href="#approach-to-authentication" title="Permalink to this headline">¶</a></h2>
<p>Keystone provides several authentication plugins that inherit from
<a class="reference internal" href="api/keystone.auth.plugins.html#module-keystone.auth.plugins.base" title="keystone.auth.plugins.base"><code class="xref py py-mod docutils literal"><span class="pre">keystone.auth.plugins.base</span></code></a>. The following is a list of available plugins.</p>
<ul class="simple">
<li><a class="reference internal" href="api/keystone.auth.plugins.html#keystone.auth.plugins.external.Base" title="keystone.auth.plugins.external.Base"><code class="xref py py-mod docutils literal"><span class="pre">keystone.auth.plugins.external.Base</span></code></a></li>
<li><a class="reference internal" href="api/keystone.auth.plugins.html#keystone.auth.plugins.mapped.Mapped" title="keystone.auth.plugins.mapped.Mapped"><code class="xref py py-mod docutils literal"><span class="pre">keystone.auth.plugins.mapped.Mapped</span></code></a></li>
<li><a class="reference internal" href="api/keystone.auth.plugins.html#keystone.auth.plugins.oauth1.OAuth" title="keystone.auth.plugins.oauth1.OAuth"><code class="xref py py-mod docutils literal"><span class="pre">keystone.auth.plugins.oauth1.OAuth</span></code></a></li>
<li><a class="reference internal" href="api/keystone.auth.plugins.html#keystone.auth.plugins.password.Password" title="keystone.auth.plugins.password.Password"><code class="xref py py-mod docutils literal"><span class="pre">keystone.auth.plugins.password.Password</span></code></a></li>
<li><a class="reference internal" href="api/keystone.auth.plugins.html#keystone.auth.plugins.token.Token" title="keystone.auth.plugins.token.Token"><code class="xref py py-mod docutils literal"><span class="pre">keystone.auth.plugins.token.Token</span></code></a></li>
<li><a class="reference internal" href="api/keystone.auth.plugins.html#keystone.auth.plugins.totp.TOTP" title="keystone.auth.plugins.totp.TOTP"><code class="xref py py-mod docutils literal"><span class="pre">keystone.auth.plugins.totp.TOTP</span></code></a></li>
</ul>
<p>In the most basic plugin <code class="docutils literal"><span class="pre">password</span></code>, two pieces of information are required
to authenticate with keystone, a bit of <code class="docutils literal"><span class="pre">Resource</span></code> information and a bit of
<code class="docutils literal"><span class="pre">Identity</span></code>.</p>
<p>Take the following call POST data for instance:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;auth&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;identity&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;methods&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s2">&quot;password&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;password&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;0ca8f6&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;password&quot;</span><span class="o">:</span> <span class="s2">&quot;secretsecret&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;scope&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;project&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;263fd9&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The user (ID of 0ca8f6) is attempting to retrieve a token that is scoped to
project (ID of 263fd9).</p>
<p>To perform the same call with names instead of IDs, we now need to supply
information about the domain. This is because usernames are only unique within
a given domain, but user IDs are supposed to be unique across the deployment.
Thus, the auth request looks like the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;auth&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;identity&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;methods&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s2">&quot;password&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;password&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;acme&quot;</span>
                    <span class="p">}</span>
                    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;userA&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;password&quot;</span><span class="o">:</span> <span class="s2">&quot;secretsecret&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;scope&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;project&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;1789d1&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;project-x&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For both the user and the project portion, we must supply either a domain ID
or a domain name, in order to properly determine the correct user and project.</p>
<p>Alternatively, if we wanted to represent this as environment variables for a
command line, it would be:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">OS_PROJECT_DOMAIN_ID</span><span class="o">=</span>1789d1
$ <span class="nb">export</span> <span class="nv">OS_USER_DOMAIN_NAME</span><span class="o">=</span>acme
$ <span class="nb">export</span> <span class="nv">OS_USERNAME</span><span class="o">=</span>userA
$ <span class="nb">export</span> <span class="nv">OS_PASSWORD</span><span class="o">=</span>secretsecret
$ <span class="nb">export</span> <span class="nv">OS_PROJECT_NAME</span><span class="o">=</span>project-x
</pre></div>
</div>
<p>Note that the project the user it attempting to access must be in the same
domain as the user.</p>
<div class="section" id="what-is-scope">
<h3>What is Scope?<a class="headerlink" href="#what-is-scope" title="Permalink to this headline">¶</a></h3>
<p>Scope is an overloaded term.</p>
<p>In reference to authenticating, as seen above, scope refers to the portion
of the POST data that dictates what <code class="docutils literal"><span class="pre">Resource</span></code> (project or domain) the user
wants to access.</p>
<p>In reference to tokens, scope refers to the effectiveness of a token,
i.e.: a <cite>project-scoped</cite> token is only useful on the project it was initially
granted for. A <cite>domain-scoped</cite> token may be used to perform domain-related
function.</p>
<p>In reference to users, groups, and projects, scope often refers to the domain
that the entity is owned by. i.e.: a user in domain X is scoped to domain X.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Keystone Architecture</a><ul>
<li><a class="reference internal" href="#services">Services</a><ul>
<li><a class="reference internal" href="#identity">Identity</a><ul>
<li><a class="reference internal" href="#users">Users</a></li>
<li><a class="reference internal" href="#groups">Groups</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resource">Resource</a><ul>
<li><a class="reference internal" href="#projects-tenants">Projects (Tenants)</a></li>
<li><a class="reference internal" href="#domains">Domains</a></li>
</ul>
</li>
<li><a class="reference internal" href="#assignment">Assignment</a><ul>
<li><a class="reference internal" href="#roles">Roles</a></li>
<li><a class="reference internal" href="#role-assignments">Role Assignments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#token">Token</a></li>
<li><a class="reference internal" href="#catalog">Catalog</a></li>
<li><a class="reference internal" href="#policy">Policy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#application-construction">Application Construction</a></li>
<li><a class="reference internal" href="#service-backends">Service Backends</a><ul>
<li><a class="reference internal" href="#templated-backend">Templated Backend</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-model">Data Model</a></li>
<li><a class="reference internal" href="#approach-to-crud">Approach to CRUD</a></li>
<li><a class="reference internal" href="#approach-to-authorization-policy">Approach to Authorization (Policy)</a><ul>
<li><a class="reference internal" href="#rules">Rules</a></li>
<li><a class="reference internal" href="#capability-rbac">Capability RBAC</a></li>
</ul>
</li>
<li><a class="reference internal" href="#approach-to-authentication">Approach to Authentication</a><ul>
<li><a class="reference internal" href="#what-is-scope">What is Scope?</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="apache-httpd.html"
                                  title="previous chapter">Running Keystone in HTTPD</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="policy_mapping.html"
                                  title="next chapter">Mapping of policy target to API</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/keystone
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/architecture.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="policy_mapping.html" title="Mapping of policy target to API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="apache-httpd.html" title="Running Keystone in HTTPD"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">keystone 11.0.0.0rc2.dev29 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, OpenStack Foundation.
      Last updated on &#39;Fri Feb 10 22:47:54 2017, commit 9c47495&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/keystone");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>