<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Mapping Combinations &mdash; keystone 11.0.0.0rc2.dev29 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/support-matrix.css" type="text/css" />
    <link rel="stylesheet" href="../_static/support-matrix.css" type="text/css" />
    <link rel="stylesheet" href="../_static/support-matrix.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '11.0.0.0rc2.dev29',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="keystone 11.0.0.0rc2.dev29 documentation" href="../index.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="mapping-combinations">
<h1>Mapping Combinations<a class="headerlink" href="#mapping-combinations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>During the authentication process an identity provider (IdP) will present
keystone with a set of user attributes about the user that is authenticating.
For example, in the SAML2 flow this comes to keystone in the form of a SAML
document.</p>
<p>The attributes are typically processed by third-party software and are presented
to keystone as environment variables. The original document from the IdP is
generally not available to keystone. This is how the <cite>Shibboleth</cite> and <cite>Mellon</cite>
implementations work.</p>
<p>The mapping format described in this document maps these environment variables
to a local keystone user. The mapping may also define group membership for
that user and projects the user can access.</p>
<p>An IdP has exactly one mapping specified per protocol. Mappings themselves can
be used multiple times by different combinations of IdP and protocol.</p>
</div>
<div class="section" id="definitions">
<h2>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">¶</a></h2>
<p>A mapping looks as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="o">&lt;</span><span class="nx">user</span><span class="o">&gt;</span>
                    <span class="p">[</span><span class="o">&lt;</span><span class="nx">group</span><span class="o">&gt;</span><span class="p">]</span>
                    <span class="p">[</span><span class="o">&lt;</span><span class="nx">project</span><span class="o">&gt;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="o">&lt;</span><span class="nx">match</span><span class="o">&gt;</span>
                    <span class="p">[</span><span class="o">&lt;</span><span class="nx">condition</span><span class="o">&gt;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><cite>mapping</cite>: a JSON object containing a list of rules.</li>
<li><cite>rules</cite>: a property in the mapping that contains the list of rules.</li>
<li><cite>rule</cite>: a JSON object containing <cite>local</cite> and <cite>remote</cite> properties to define
the rule. There is no explicit <cite>rule</cite> property.</li>
<li><cite>local</cite>: a JSON object containing information on what local attributes will
be mapped. The mapping engine processes this using the <cite>context</cite> (defined
below) and the result is a representation of the user from keystone&#8217;s
perspective.<ul>
<li><cite>&lt;user&gt;</cite>: the local user that will be mapped to the federated user.</li>
<li><cite>&lt;group&gt;</cite>: (optional) the local groups the federated user will be placed in.</li>
<li><cite>&lt;projects&gt;</cite>: (optional) the local projects mapped to the federated user.</li>
</ul>
</li>
<li><cite>remote</cite>: a JSON object containing information on what remote attributes will be mapped.<ul>
<li><cite>&lt;match&gt;</cite>: a JSON object that tells the mapping engine what federated attribute
to make available for substitution in the local object. There can be one or more
of these objects in the <cite>remote</cite> list.</li>
<li><cite>&lt;condition&gt;</cite>: a JSON object containing conditions that allow a rule. There can be
zero or more of these objects in the <cite>remote</cite> list.</li>
</ul>
</li>
<li><cite>direct mapping</cite>: the mapping engine keeps track of each match and makes them
available to the local rule for substitution.</li>
<li><cite>assertion</cite>: data provided to keystone by the IdP to assert facts
(name, groups, etc) about the authenticating user. This is an XML document when
using the SAML2 protocol.</li>
<li><cite>mapping context</cite>: the data, represented as key-value pairs, that is used by the
mapping engine to turn the <cite>local</cite> object into a representation of the user
from keystone&#8217;s perspective. The mapping context contains the environment of the
keystone process and any <cite>direct mapping</cite> values calculated when processing the
<cite>remote</cite> list.</li>
</ul>
</div>
<div class="section" id="how-mappings-are-processed">
<h2>How Mappings Are Processed<a class="headerlink" href="#how-mappings-are-processed" title="Permalink to this headline">¶</a></h2>
<p>A mapping is selected by IdP and protocol. Then keystone takes the mapping and
processes each rule sequentially stopping after the first matched rule. A rule
is matched when all of its conditions are met.</p>
<p>First keystone evaluates each condition from the rule&#8217;s remote property to see
if the rule is a match. If it is a match, keystone saves the data captured by
each of the matches from the rule&#8217;s remote property in an ordered list. We call
these matches <cite>direct mappings</cite> since they can be used in the next step.</p>
<p>After the rule is found using the rule&#8217;s conditions and a list of direct mappings is
stored, keystone begins processing the rule&#8217;s <cite>local</cite> property. Each object in
the <cite>local</cite> property is collapsed into a single JSON object. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{...}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;projects&quot;</span><span class="o">:</span> <span class="p">[...]</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>becomes:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{...}</span>
        <span class="s2">&quot;projects&quot;</span><span class="o">:</span> <span class="p">[...]</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>when the same property exists in the local multiple times the first occurrence wins:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>{
    &quot;local&quot;: [
        {
            &quot;user&quot;: {#first#}
        },
        {
            &quot;projects&quot;: [...]
        },
        {
            &quot;user&quot;: {#second#}
        },
    ]
}
</pre></div>
</div>
<p>becomes:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>{
    &quot;local&quot;: {
        &quot;user&quot;: {#first#}
        &quot;projects&quot;: [...]
    },
}
</pre></div>
</div>
<p>We take this JSON object and then recursively process it in order to apply
the direct mappings. This is simply looking for the pattern <cite>{#}</cite> and
substituting it with values from the direct mappings list. The index of the
direct mapping starts at zero.</p>
</div>
<div class="section" id="mapping-rules">
<h2>Mapping Rules<a class="headerlink" href="#mapping-rules" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mapping-engine">
<h3>Mapping Engine<a class="headerlink" href="#mapping-engine" title="Permalink to this headline">¶</a></h3>
<p>The mapping engine can be tested before creating a federated setup. It can be
tested with the <code class="docutils literal"><span class="pre">keystone-manage</span> <span class="pre">mapping_engine</span></code> command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ keystone-manage mapping_engine --rules &lt;file&gt; --input &lt;file&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although the rules file is formated as JSON, the input file of assertion
data is formatted as individual lines of key: value pairs, see
<cite>keystone-manage mapping_engine &#8211;help</cite> for details.</p>
</div>
</div>
<div class="section" id="mapping-conditions">
<h3>Mapping Conditions<a class="headerlink" href="#mapping-conditions" title="Permalink to this headline">¶</a></h3>
<p>Mappings support 5 different types of conditions:</p>
<p><code class="docutils literal"><span class="pre">empty</span></code>: The rule is matched to all claims containing the remote attribute type.
This condition does not need to be specified.</p>
<p><code class="docutils literal"><span class="pre">any_one_of</span></code>: The rule is matched only if any of the specified strings appear
in the remote attribute type. Condition result is boolean, not the argument that
is passed as input.</p>
<p><code class="docutils literal"><span class="pre">not_any_of</span></code>: The rule is not matched if any of the specified strings appear
in the remote attribute type. Condition result is boolean, not the argument that
is passed as input.</p>
<p><code class="docutils literal"><span class="pre">blacklist</span></code>: The rule allows all except a specified set of groups. Condition
result is the argument(s) passed as input minus what was matched in the
blacklist.</p>
<p><code class="docutils literal"><span class="pre">whitelist</span></code>: The rules allows a specified set of groups. Condition result is
the argument(s) passed as input and is/are also present in the whitelist.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">empty</span></code>, <code class="docutils literal"><span class="pre">blacklist</span></code> and <code class="docutils literal"><span class="pre">whitelist</span></code> are the only conditions that can
be used in direct mapping ({0}, {1}, etc.)</p>
</div>
<p>Multiple conditions can be combined to create a single rule.</p>
</div>
<div class="section" id="mappings-examples">
<h3>Mappings Examples<a class="headerlink" href="#mappings-examples" title="Permalink to this headline">¶</a></h3>
<p>The following are all examples of mapping rule types.</p>
<div class="section" id="empty-condition">
<h4>empty condition<a class="headerlink" href="#empty-condition" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;{0} {1}&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;{2}&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;{3}&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="p">{</span>
                            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;0cd5e9&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;FirstName&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;LastName&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Email&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;OIDC_GROUPS&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The numbers in braces {} are indices, they map in order. For example:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span>- Mapping to user with the name matching the value in remote attribute FirstName
- Mapping to user with the name matching the value in remote attribute LastName
- Mapping to user with the email matching value in remote attribute Email
- Mapping to a group(s) with the name matching the value(s) in remote attribute OIDC_GROUPS
</pre></div>
</div>
</div>
<p>Groups can have multiple values. Each value must be separated by a <cite>;</cite>
Example: OIDC_GROUPS=developers;testers</p>
</div>
<div class="section" id="other-conditions">
<h4>other conditions<a class="headerlink" href="#other-conditions" title="Permalink to this headline">¶</a></h4>
<p>In <code class="docutils literal"><span class="pre">&lt;other_condition&gt;</span></code> shown below, please supply one of the following:
<code class="docutils literal"><span class="pre">any_one_of</span></code>, or <code class="docutils literal"><span class="pre">not_any_of</span></code>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;{0}&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;0cd5e9&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;UserName&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;HTTP_OIDC_GROUPIDS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&lt;other_condition&gt;&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;HTTP_OIDC_EMAIL&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In <code class="docutils literal"><span class="pre">&lt;other_condition&gt;</span></code> shown below, please supply one of the following:
<code class="docutils literal"><span class="pre">blacklist</span></code>, or <code class="docutils literal"><span class="pre">whitelist</span></code>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;{0}&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;groups&quot;</span><span class="o">:</span> <span class="s2">&quot;{1}&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;0cd5e9&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;UserName&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;HTTP_OIDC_GROUPIDS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&lt;other_condition&gt;&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;me@example.com&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the user id and name are not specified in the mapping, the server tries to
directly map <code class="docutils literal"><span class="pre">REMOTE_USER</span></code> environment variable. If this variable is also
unavailable the server returns an HTTP 401 Unauthorized error.</p>
</div>
<p>Group ids and names can be provided in the local section:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="s2">&quot;0cd5e9&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;developer_group&quot;</span><span class="p">,</span>
                <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;abc1234&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;developer_group&quot;</span><span class="p">,</span>
                <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;private_cloud&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<p>If a mapping is valid you will receive the following output:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;group_ids&quot;</span><span class="o">:</span> <span class="s2">&quot;[&lt;group-ids&gt;]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;user&quot;</span><span class="o">:</span>
        <span class="p">{</span>
            <span class="s2">&quot;domain&quot;</span><span class="o">:</span>
                <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;Federated&quot;</span> <span class="nx">or</span> <span class="s2">&quot;&lt;local-domain-id&gt;&quot;</span>
                <span class="p">},</span>
            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;ephemeral&quot;</span> <span class="nx">or</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;local-user-name&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;local-user-id&gt;&quot;</span>
        <span class="p">},</span>
    <span class="s2">&quot;group_names&quot;</span><span class="o">:</span>
        <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;domain&quot;</span><span class="o">:</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;domain-name&gt;&quot;</span>
                    <span class="p">},</span>
                <span class="s2">&quot;name&quot;</span><span class="o">:</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;[&lt;groups-names&gt;]&quot;</span>
                    <span class="p">}</span>
            <span class="p">}</span>
            <span class="p">{</span>
                <span class="s2">&quot;domain&quot;</span><span class="o">:</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;domain-name&gt;&quot;</span>
                    <span class="p">},</span>
                <span class="s2">&quot;name&quot;</span><span class="o">:</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;[&lt;groups-names&gt;]&quot;</span>
                    <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">type</span></code> parameter specifies the type of user being mapped. The 2 possible
user types are <code class="docutils literal"><span class="pre">local</span></code> and <code class="docutils literal"><span class="pre">ephemeral</span></code>.``local`` is displayed if the user
has a domain specified. The user is treated as existing in the backend, hence
the server will fetch user details (id, name, roles, groups).``ephemeral`` is
displayed for a user that does not exist in the backend.</p>
<p>The <code class="docutils literal"><span class="pre">id</span></code> parameter in the service domain specifies the domain a user belongs
to. <code class="docutils literal"><span class="pre">Federated</span></code> will be displayed if no domain is specified in the local rule.
User is deemed ephemeral and becomes a member of service domain named <code class="docutils literal"><span class="pre">Federated</span></code>.
If the domain is specified the local domain&#8217;s id will be displayed.
If the mapped user is local, mapping engine will discard further group
assigning and return set of roles configured for the user.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Domain <code class="docutils literal"><span class="pre">Federated</span></code> is a service domain - it cannot be listed, displayed,
added or deleted.  There is no need to perform any operation on it prior to
federation configuration.</p>
</div>
</div>
<div class="section" id="regular-expressions">
<h3>Regular Expressions<a class="headerlink" href="#regular-expressions" title="Permalink to this headline">¶</a></h3>
<p>Regular expressions can be used in a mapping by specifying the <code class="docutils literal"><span class="pre">regex</span></code> key, and
setting it to <code class="docutils literal"><span class="pre">true</span></code>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;{0}&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;0cd5e9&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;UserName&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;HTTP_OIDC_GROUPIDS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;any_one_of&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;.*@yeah.com$&quot;</span>
                    <span class="p">]</span>
                    <span class="s2">&quot;regex&quot;</span><span class="o">:</span> <span class="kc">true</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This allows any user with a claim containing a key with any value in
<code class="docutils literal"><span class="pre">HTTP_OIDC_GROUPIDS</span></code> to be mapped to group with id <code class="docutils literal"><span class="pre">0cd5e9</span></code>.</p>
</div>
<div class="section" id="condition-combinations">
<h3>Condition Combinations<a class="headerlink" href="#condition-combinations" title="Permalink to this headline">¶</a></h3>
<p>Combinations of mappings conditions can also be done.</p>
<p><code class="docutils literal"><span class="pre">empty</span></code>, <code class="docutils literal"><span class="pre">any_one_of</span></code>, and <code class="docutils literal"><span class="pre">not_any_of</span></code> can all be used in the same rule,
but cannot be repeated within the same condition. <code class="docutils literal"><span class="pre">any_one_of</span></code> and
<code class="docutils literal"><span class="pre">not_any_of</span></code> are mutually exclusive within a condition&#8217;s scope. So are
<code class="docutils literal"><span class="pre">whitelist</span></code> and <code class="docutils literal"><span class="pre">blacklist</span></code>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;{0}&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;0cd5e9&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;UserName&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;cn=IBM_Canada_Lab&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;not_any_of&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;.*@naww.com$&quot;</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;regex&quot;</span><span class="o">:</span> <span class="kc">true</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;cn=IBM_USA_Lab&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;any_one_of&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;.*@yeah.com$&quot;</span>
                    <span class="p">]</span>
                    <span class="s2">&quot;regex&quot;</span><span class="o">:</span> <span class="kc">true</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As before group names and users can also be provided in the local section.</p>
<p>This allows any user with the following claim information to be mapped to
group with id 0cd5e9.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;UserName&quot;</span><span class="o">:</span><span class="s2">&quot;&lt;any_name&gt;@yeah.com&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;cn=IBM_USA_Lab&quot;</span><span class="o">:</span><span class="s2">&quot;&lt;any_name&gt;@yeah.com&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;cn=IBM_Canada_Lab&quot;</span><span class="o">:</span><span class="s2">&quot;&lt;any_name&gt;@yeah.com&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>The following claims will be mapped:</p>
<ul class="simple">
<li>any claim containing the key UserName.</li>
<li>any claim containing key cn=IBM_Canada_Lab that doesn&#8217;t have the value &lt;any_name&gt;&#64;naww.com.</li>
<li>any claim containing key cn=IBM_USA_Lab that has value &lt;any_name&gt;&#64;yeah.com.</li>
</ul>
</div>
<div class="section" id="multiple-rules">
<h3>Multiple Rules<a class="headerlink" href="#multiple-rules" title="Permalink to this headline">¶</a></h3>
<p>Multiple rules can also be utilized in a mapping.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;{0}&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;non-contractors&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="p">{</span>
                            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;abc1234&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;UserName&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;orgPersonType&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;not_any_of&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;Contractor&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;SubContractor&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;{0}&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;contractors&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="p">{</span>
                            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;abc1234&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;UserName&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;orgPersonType&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;any_one_of&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;Contractor&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;SubContractor&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above assigns groups membership basing on <code class="docutils literal"><span class="pre">orgPersonType</span></code> values:</p>
<ul class="simple">
<li>neither <code class="docutils literal"><span class="pre">Contractor</span></code> nor <code class="docutils literal"><span class="pre">SubContractor</span></code> will belong to the <code class="docutils literal"><span class="pre">non-contractors</span></code> group.</li>
<li>either <code class="docutils literal"><span class="pre">Contractor</span> <span class="pre">or</span> <span class="pre">``SubContractor</span></code> will belong to the <code class="docutils literal"><span class="pre">contractors</span></code> group.</li>
</ul>
<p>Rules are additive, so permissions will only be granted for the rules that
succeed.  All the remote conditions of a rule must be valid.</p>
<p>When using multiple rules you can specify more than one effective user
identification, but only the first match will be considered and the others
ignored ordered from top to bottom.</p>
<p>Since rules are additive one can specify one user identification and this will
also work. The best practice for multiple rules is to create a rule for just
user and another rule for just groups. Below is rules example repeated but with
global username mapping.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;{0}&quot;</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;UserType&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;non-contractors&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="p">{</span>
                            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;abc1234&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;orgPersonType&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;not_any_of&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;Contractor&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;SubContractor&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;contractors&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="p">{</span>
                            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;abc1234&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;orgPersonType&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;any_one_of&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;Contractor&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;SubContractor&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="auto-provisioning">
<h3>Auto-Provisioning<a class="headerlink" href="#auto-provisioning" title="Permalink to this headline">¶</a></h3>
<p>The mapping engine has the ability to aid in the auto-provisioning of resources
when a federated user authenticates for the first time. This can be achieved
using a specific mapping syntax that the mapping engine can parse and
ultimately make decisions on.</p>
<p>For example, consider the following mapping:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;{0}&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;projects&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Production&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;roles&quot;</span><span class="o">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;observer&quot;</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Staging&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;roles&quot;</span><span class="o">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;member&quot;</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Project for {0}&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;roles&quot;</span><span class="o">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;admin&quot;</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;UserName&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The semantics of the <code class="docutils literal"><span class="pre">remote</span></code> section have not changed. The difference
between this mapping and the other examples is the addition of a <code class="docutils literal"><span class="pre">projects</span></code>
section within the <code class="docutils literal"><span class="pre">local</span></code> rules. The <code class="docutils literal"><span class="pre">projects</span></code> list supplies a list
of projects that the federated user will be given access to. The projects
will be automatically created if they don&#8217;t exist when the user
authenticated and the mapping engine has applied values from the assertion
and mapped them into the <code class="docutils literal"><span class="pre">local</span></code> rules.</p>
<p>In the above example, an authenticated federated user will be granted the
<code class="docutils literal"><span class="pre">observer</span></code> role on the <code class="docutils literal"><span class="pre">Production</span></code> project, <code class="docutils literal"><span class="pre">member</span></code> role on the
<code class="docutils literal"><span class="pre">Staging</span></code> project, and they will have <code class="docutils literal"><span class="pre">admin</span></code> role on the <code class="docutils literal"><span class="pre">Project</span> <span class="pre">for</span>
<span class="pre">jsmith</span></code>.</p>
<p>It is important to note the following constraints apply when auto-provisioning:</p>
<ul class="simple">
<li>Projects are the only resource that will be created dynamically.</li>
<li>Projects will be created within the domain associated with the Identity
Provider.</li>
<li>The <code class="docutils literal"><span class="pre">projects</span></code> section of the mapping must also contain a <code class="docutils literal"><span class="pre">roles</span></code>
section.<ul>
<li>Roles within the project must already exist in the deployment or domain.</li>
</ul>
</li>
<li>Assignments are actually created for the user which is unlike the
ephemeral group memberships.</li>
</ul>
<p>Since the creation of roles typically requires policy changes across other
services in the deployment, it is expected that roles are created ahead of
time. Federated authentication should also be considered idempotent if the
attributes from the SAML assertion have not changed. In the example from above,
if the user&#8217;s name is still <code class="docutils literal"><span class="pre">jsmith</span></code>, then no new projects will be
created as a result of authentication.</p>
<p>Mappings can be created that mix <code class="docutils literal"><span class="pre">groups</span></code> and <code class="docutils literal"><span class="pre">projects</span></code> within the
<code class="docutils literal"><span class="pre">local</span></code> section. The mapping shown in the example above does not contain a
<code class="docutils literal"><span class="pre">groups</span></code> section in the <code class="docutils literal"><span class="pre">local</span></code> rules. This will result in the federated
user having direct role assignments on the projects in the <code class="docutils literal"><span class="pre">projects</span></code> list.
The following example contains <code class="docutils literal"><span class="pre">local</span></code> rules comprised of both <code class="docutils literal"><span class="pre">projects</span></code>
and <code class="docutils literal"><span class="pre">groups</span></code>, which allow for direct role assignments and group memberships.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;{0}&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;projects&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Marketing&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;roles&quot;</span><span class="o">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;member&quot;</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Development project for {0}&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;roles&quot;</span><span class="o">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;admin&quot;</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Finance&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;domain&quot;</span><span class="o">:</span> <span class="p">{</span>
                            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;6fe767&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;UserName&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the above example, a federated user will receive direct role assignments on
the <code class="docutils literal"><span class="pre">Marketing</span></code> project, as well as a dedicated project specific to the
federated user&#8217;s name. In addition to that, they will also be placed in the
<code class="docutils literal"><span class="pre">Finance</span></code> group and receive all role assignments that group has on projects
and domains.</p>
</div>
<div class="section" id="keystone-to-keystone">
<h3>keystone-to-keystone<a class="headerlink" href="#keystone-to-keystone" title="Permalink to this headline">¶</a></h3>
<p>keystone-to-keystone federation also utilizes mappings, but has some
differences.</p>
<p>An attribute file (e.g. <code class="docutils literal"><span class="pre">/etc/shibboleth/attribute-map.xml</span></code> in a Shibboleth
implementation) is used to add attributes to the mapping <cite>context</cite>. Attributes
look as follows:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- example from a K2k Shibboleth implementation --&gt;</span>
<span class="nt">&lt;Attribute</span> <span class="na">name=</span><span class="s">&quot;openstack_user&quot;</span> <span class="na">id=</span><span class="s">&quot;openstack_user&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;Attribute</span> <span class="na">name=</span><span class="s">&quot;openstack_user_domain&quot;</span> <span class="na">id=</span><span class="s">&quot;openstack_user_domain&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>The service provider must contain a mapping as shown below.
<code class="docutils literal"><span class="pre">openstack_user</span></code>, and <code class="docutils literal"><span class="pre">openstack_user_domain</span></code> match to the attribute
names we have in the Identity Provider. It will map any user with the name
<code class="docutils literal"><span class="pre">user1</span></code> or <code class="docutils literal"><span class="pre">admin</span></code> in the <code class="docutils literal"><span class="pre">openstack_user</span></code> attribute and
<code class="docutils literal"><span class="pre">openstack_domain</span></code> attribute <code class="docutils literal"><span class="pre">default</span></code> to a group with id <code class="docutils literal"><span class="pre">abc1234</span></code>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;local&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;abc1234&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;remote&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;openstack_user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;any_one_of&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;user1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;admin&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;openstack_user_domain&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;any_one_of&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;Default&quot;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The possible attributes that can be used in a mapping are <cite>openstack_user</cite>,
<cite>openstack_user_domain</cite>, <cite>openstack_roles</cite>, <cite>openstack_project</cite>, and
<cite>openstack_project_domain</cite>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Mapping Combinations</a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#definitions">Definitions</a></li>
<li><a class="reference internal" href="#how-mappings-are-processed">How Mappings Are Processed</a></li>
<li><a class="reference internal" href="#mapping-rules">Mapping Rules</a><ul>
<li><a class="reference internal" href="#mapping-engine">Mapping Engine</a></li>
<li><a class="reference internal" href="#mapping-conditions">Mapping Conditions</a></li>
<li><a class="reference internal" href="#mappings-examples">Mappings Examples</a><ul>
<li><a class="reference internal" href="#empty-condition">empty condition</a></li>
<li><a class="reference internal" href="#other-conditions">other conditions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#output">Output</a></li>
<li><a class="reference internal" href="#regular-expressions">Regular Expressions</a></li>
<li><a class="reference internal" href="#condition-combinations">Condition Combinations</a></li>
<li><a class="reference internal" href="#multiple-rules">Multiple Rules</a></li>
<li><a class="reference internal" href="#auto-provisioning">Auto-Provisioning</a></li>
<li><a class="reference internal" href="#keystone-to-keystone">keystone-to-keystone</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/keystone
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/federation/mapping_combinations.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">keystone 11.0.0.0rc2.dev29 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, OpenStack Foundation.
      Last updated on &#39;Fri Feb 10 22:47:54 2017, commit 9c47495&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/keystone");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>