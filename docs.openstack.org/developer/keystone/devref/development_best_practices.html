<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Best Practices &mdash; keystone 11.0.0.0rc2.dev29 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/support-matrix.css" type="text/css" />
    <link rel="stylesheet" href="../_static/support-matrix.css" type="text/css" />
    <link rel="stylesheet" href="../_static/support-matrix.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '11.0.0.0rc2.dev29',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="keystone 11.0.0.0rc2.dev29 documentation" href="../index.html" />
    <link rel="next" title="Setting up a Development Environment" href="development.environment.html" />
    <link rel="prev" title="Security Compliance &amp; PCI-DSS" href="../security_compliance.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="best-practices">
<h1>Best Practices<a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-keystone">
<h2>Setting up Keystone<a class="headerlink" href="#setting-up-keystone" title="Permalink to this headline">¶</a></h2>
<p>Get your development environment set up according to
<a class="reference internal" href="development.environment.html"><em>Setting up a Development Environment</em></a>. It is recommended that you install
Keystone into a virtualenv.</p>
</div>
<div class="section" id="configuring-keystone">
<h2>Configuring Keystone<a class="headerlink" href="#configuring-keystone" title="Permalink to this headline">¶</a></h2>
<p>Keystone requires a configuration file. There is a sample configuration file
that can be used to get started:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cp etc/keystone.conf.sample etc/keystone.conf
</pre></div>
</div>
<p>The defaults are enough to get you going, but you can make any changes if
needed.</p>
</div>
<div class="section" id="running-keystone">
<h2>Running Keystone<a class="headerlink" href="#running-keystone" title="Permalink to this headline">¶</a></h2>
<p>To run the Keystone Admin and API server instances, use:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ uwsgi --http <span class="m">127</span>.0.0.1:35357 --wsgi-file <span class="k">$(</span>which keystone-wsgi-admin<span class="k">)</span>
</pre></div>
</div>
<p>This runs Keystone with the configuration the etc/ directory of the project.
See <a class="reference internal" href="../configuration.html"><em>Configuring Keystone</em></a> for details on how Keystone is configured. By default,
Keystone is configured with SQL backends.</p>
</div>
<div class="section" id="initializing-keystone">
<h2>Initializing Keystone<a class="headerlink" href="#initializing-keystone" title="Permalink to this headline">¶</a></h2>
<p>Before using keystone, it is necessary to create the database tables and ensures
the database schemas are up to date, perform the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ keystone-manage db_sync
</pre></div>
</div>
<p>If the above commands result in a <code class="docutils literal"><span class="pre">KeyError</span></code>, or they fail on a
<code class="docutils literal"><span class="pre">.pyc</span></code> file with the message, <code class="docutils literal"><span class="pre">You</span> <span class="pre">can</span> <span class="pre">only</span> <span class="pre">have</span> <span class="pre">one</span> <span class="pre">Python</span> <span class="pre">script</span> <span class="pre">per</span>
<span class="pre">version</span></code>, then it is possible that there are out-of-date compiled Python
bytecode files in the Keystone directory tree that are causing problems. This
can occur if you have previously installed and ran older versions of Keystone.
These out-of-date files can be easily removed by running a command like the
following from the Keystone root project directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ find . -name <span class="s2">&quot;*.pyc&quot;</span> -delete
</pre></div>
</div>
<div class="section" id="initial-sample-data">
<h3>Initial Sample Data<a class="headerlink" href="#initial-sample-data" title="Permalink to this headline">¶</a></h3>
<p>There is an included script which is helpful in setting up some initial sample
data for use with keystone:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nv">ADMIN_PASSWORD</span><span class="o">=</span>s3cr3t tools/sample_data.sh
</pre></div>
</div>
<p>Once run, you can see the sample data that has been created by using the
<a class="reference external" href="https://git.openstack.org/cgit/openstack/python-openstackclient">python-openstackclient</a> command-line interface:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">OS_USERNAME</span><span class="o">=</span>admin
$ <span class="nb">export</span> <span class="nv">OS_PASSWORD</span><span class="o">=</span>s3cr3t
$ <span class="nb">export</span> <span class="nv">OS_PROJECT_NAME</span><span class="o">=</span>admin
$ <span class="nb">export</span> <span class="nv">OS_USER_DOMAIN_ID</span><span class="o">=</span>default
$ <span class="nb">export</span> <span class="nv">OS_PROJECT_DOMAIN_ID</span><span class="o">=</span>default
$ <span class="nb">export</span> <span class="nv">OS_IDENTITY_API_VERSION</span><span class="o">=</span><span class="m">3</span>
$ <span class="nb">export</span> <span class="nv">OS_AUTH_URL</span><span class="o">=</span>http://localhost:5000/v3
$ openstack user list
</pre></div>
</div>
<p>The <a class="reference external" href="https://git.openstack.org/cgit/openstack/python-openstackclient">python-openstackclient</a> can be installed using the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ pip install python-openstackclient
</pre></div>
</div>
</div>
</div>
<div class="section" id="interacting-with-keystone">
<h2>Interacting with Keystone<a class="headerlink" href="#interacting-with-keystone" title="Permalink to this headline">¶</a></h2>
<p>You can also interact with keystone through its REST API. There is a Python
keystone client library <a class="reference external" href="https://git.openstack.org/cgit/openstack/python-keystoneclient">python-keystoneclient</a> which interacts exclusively
through the REST API, and a command-line interface <a class="reference external" href="https://git.openstack.org/cgit/openstack/python-openstackclient">python-openstackclient</a>
command-line interface.</p>
</div>
<div class="section" id="building-the-documentation">
<h2>Building the Documentation<a class="headerlink" href="#building-the-documentation" title="Permalink to this headline">¶</a></h2>
<p>The documentation is generated with Sphinx using the tox command. To create HTML
docs and man pages:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tox -e docs
</pre></div>
</div>
<p>The results are in the <code class="docutils literal"><span class="pre">doc/build/html</span></code> and <code class="docutils literal"><span class="pre">doc/build/man</span></code> directories
respectively.</p>
</div>
<div class="section" id="generating-a-new-sample-config-file">
<h2>Generating a new Sample Config File<a class="headerlink" href="#generating-a-new-sample-config-file" title="Permalink to this headline">¶</a></h2>
<p>Keystone&#8217;s sample configuration file <code class="docutils literal"><span class="pre">etc/keystone.conf.sample</span></code> is automatically
generated based upon all of the options available within Keystone. These options
are sourced from the many files around Keystone as well as some external libraries.</p>
<p>The sample configuration file will be updated as the end of the development
cycle approaches. Developers should <em>NOT</em> generate the config file and propose
it as part of their patches, this will cause unnecessary conflicts.</p>
<p>To generate a new sample configuration to see what it looks like, run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tox -egenconfig -r
</pre></div>
</div>
<p>The tox command will place an updated sample config in <code class="docutils literal"><span class="pre">etc/keystone.conf.sample</span></code>.</p>
<p>If there is a new external library (e.g. <code class="docutils literal"><span class="pre">oslo.messaging</span></code>) that utilizes the
<code class="docutils literal"><span class="pre">oslo.config</span></code> package for configuration, it can be added to the list of libraries
found in <code class="docutils literal"><span class="pre">config-generator/keystone.conf</span></code>.</p>
</div>
<div class="section" id="release-notes">
<h2>Release Notes<a class="headerlink" href="#release-notes" title="Permalink to this headline">¶</a></h2>
<p>The Keystone team uses <a class="reference external" href="https://docs.openstack.org/developer/reno/usage.html">reno</a>
to generate release notes. These are important user-facing documents that must
be included when a user-facing change is performed. A release note should be
included in the same patch the work is being performed.</p>
<p>For more information on how and when to create release notes, see the
<a class="reference external" href="https://docs.openstack.org/project-team-guide/release-management.html#how-to-add-new-release-notes">project-team-guide</a>.</p>
</div>
<div class="section" id="testing-keystone">
<h2>Testing Keystone<a class="headerlink" href="#testing-keystone" title="Permalink to this headline">¶</a></h2>
<div class="section" id="running-tests">
<h3>Running Tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h3>
<p>Before running tests, you should have <code class="docutils literal"><span class="pre">tox</span></code> installed and available in your
environment (in addition to the other external dependencies in
<a class="reference internal" href="development.environment.html"><em>Setting up a Development Environment</em></a>):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ pip install tox
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may need to perform both the above operation and the next inside a
python virtualenv, or prefix the above command with <code class="docutils literal"><span class="pre">sudo</span></code>, depending on
your preference.</p>
</div>
<p>To execute the full suite of tests maintained within Keystone, simply run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tox
</pre></div>
</div>
<p>This iterates over multiple configuration variations, and uses external
projects to do light integration testing to verify the Identity API against
other projects.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The first time you run <code class="docutils literal"><span class="pre">tox</span></code>, it will take additional time to build
virtualenvs. You can later use the <code class="docutils literal"><span class="pre">-r</span></code> option with <code class="docutils literal"><span class="pre">tox</span></code> to rebuild
your virtualenv in a similar manner.</p>
</div>
<p>To run tests for one or more specific test environments (for example, the most
common configuration of Python 2.7 and PEP-8), list the environments with the
<code class="docutils literal"><span class="pre">-e</span></code> option, separated by spaces:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tox -e py27,pep8
</pre></div>
</div>
<p>See <code class="docutils literal"><span class="pre">tox.ini</span></code> for the full list of available test environments.</p>
<div class="section" id="running-with-pdb">
<h4>Running with PDB<a class="headerlink" href="#running-with-pdb" title="Permalink to this headline">¶</a></h4>
<p>Using PDB breakpoints with tox and testr normally doesn&#8217;t work since the tests
just fail with a BdbQuit exception rather than stopping at the breakpoint.</p>
<p>To run with PDB breakpoints during testing, use the <code class="docutils literal"><span class="pre">debug</span></code> tox environment
rather than <code class="docutils literal"><span class="pre">py27</span></code>. Here&#8217;s an example, passing the name of a test since
you&#8217;ll normally only want to run the test that hits your breakpoint:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tox -e debug keystone.tests.unit.test_auth.AuthWithToken.test_belongs_to
</pre></div>
</div>
<p>For reference, the <code class="docutils literal"><span class="pre">debug</span></code> tox environment implements the instructions
here: <a class="reference external" href="https://wiki.openstack.org/wiki/Testr#Debugging_.28pdb.29_Tests">https://wiki.openstack.org/wiki/Testr#Debugging_.28pdb.29_Tests</a></p>
</div>
<div class="section" id="disabling-stream-capture">
<h4>Disabling Stream Capture<a class="headerlink" href="#disabling-stream-capture" title="Permalink to this headline">¶</a></h4>
<p>The stdout, stderr and log messages generated during a test are captured and
in the event of a test failure those streams will be printed to the terminal
along with the traceback. The data is discarded for passing tests.</p>
<p>Each stream has an environment variable that can be used to force captured
data to be discarded even if the test fails: <cite>OS_STDOUT_CAPTURE</cite> for stdout,
<cite>OS_STDERR_CAPTURE</cite> for stderr and <cite>OS_LOG_CAPTURE</cite> for logging. If the value
of the environment variable is not one of (True, true, 1, yes) the stream will
be discarded. All three variables default to 1.</p>
<p>For example, to discard logging data during a test run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nv">OS_LOG_CAPTURE</span><span class="o">=</span><span class="m">0</span> tox -e py27
</pre></div>
</div>
</div>
</div>
<div class="section" id="test-structure">
<h3>Test Structure<a class="headerlink" href="#test-structure" title="Permalink to this headline">¶</a></h3>
<p>Not all of the tests in the <code class="docutils literal"><span class="pre">keystone/tests/unit</span></code> directory are strictly unit
tests. Keystone intentionally includes tests that run the service locally and
drives the entire configuration to achieve basic functional testing.</p>
<p>For the functional tests, an in-memory key-value store or in-memory SQLite
database is used to keep the tests fast.</p>
<p>Within the tests directory, the general structure of the backend tests is a
basic set of tests represented under a test class, and then subclasses of those
tests under other classes with different configurations to drive different
backends through the APIs.</p>
<p>For example, <code class="docutils literal"><span class="pre">test_backend.py</span></code> has a sequence of tests under the class
<code class="xref py py-class docutils literal"><span class="pre">IdentityTests</span></code> that will work with
the default drivers as configured in this project&#8217;s etc/ directory.
<code class="docutils literal"><span class="pre">test_backend_sql.py</span></code> subclasses those tests, changing the configuration by
overriding with configuration files stored in the <code class="docutils literal"><span class="pre">tests/unit/config_files</span></code>
directory aimed at enabling the SQL backend for the Identity module.</p>
<p><code class="xref py py-class docutils literal"><span class="pre">keystone.tests.unit.test_v2_keystoneclient.ClientDrivenTestCase</span></code>
uses the installed python-keystoneclient, verifying it against a temporarily
running local keystone instance to explicitly verify basic functional testing
across the API.</p>
</div>
<div class="section" id="testing-schema-migrations">
<h3>Testing Schema Migrations<a class="headerlink" href="#testing-schema-migrations" title="Permalink to this headline">¶</a></h3>
<p>The application of schema migrations can be tested using SQLAlchemy Migrate’s
built-in test runner, one migration at a time.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This may leave your database in an inconsistent state; attempt this in
non-production environments only!</p>
</div>
<p>This is useful for testing the <em>next</em> migration in sequence (both forward &amp;
backward) in a database under version control:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python keystone/common/sql/migrate_repo/manage.py <span class="nb">test</span> <span class="se">\</span>
--url<span class="o">=</span>sqlite:///test.db <span class="se">\</span>
--repository<span class="o">=</span>keystone/common/sql/migrate_repo/
</pre></div>
</div>
<p>This command references to a SQLite database (test.db) to be used. Depending on
the migration, this command alone does not make assertions as to the integrity
of your data during migration.</p>
</div>
<div class="section" id="writing-tests">
<h3>Writing Tests<a class="headerlink" href="#writing-tests" title="Permalink to this headline">¶</a></h3>
<p>To add tests covering all drivers, update the base test class in
<code class="docutils literal"><span class="pre">test_backend.py</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The structure of backend testing is in transition, migrating from having
all classes in a single file (test_backend.py) to one where there is a
directory structure to reduce the size of the test files. See:</p>
<blockquote class="last">
<div><ul class="simple">
<li><code class="xref py py-mod docutils literal"><span class="pre">keystone.tests.unit.backend.role</span></code></li>
<li><code class="xref py py-mod docutils literal"><span class="pre">keystone.tests.unit.backend.domain_config</span></code></li>
</ul>
</div></blockquote>
</div>
<p>To add new drivers, subclass the <code class="docutils literal"><span class="pre">test_backend.py</span></code> (look towards
<code class="docutils literal"><span class="pre">test_backend_sql.py</span></code> for examples) and update the
configuration of the test class in <code class="docutils literal"><span class="pre">setUp()</span></code>.</p>
</div>
<div class="section" id="further-testing">
<h3>Further Testing<a class="headerlink" href="#further-testing" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://docs.openstack.org/developer/devstack/">devstack</a> is the <em>best</em> way to quickly deploy Keystone with the rest of the
OpenStack universe and should be critical step in your development workflow!</p>
<p>You may also be interested in either the
<a class="reference external" href="https://docs.openstack.org/infra/system-config">OpenStack Continuous Integration Infrastructure</a> or the
<a class="reference external" href="https://git.openstack.org/cgit/openstack/tempest">OpenStack Integration Testing Project</a>.</p>
</div>
<div class="section" id="ldap-tests">
<h3>LDAP Tests<a class="headerlink" href="#ldap-tests" title="Permalink to this headline">¶</a></h3>
<p>LDAP has a fake backend that performs rudimentary operations.  If you
are building more significant LDAP functionality, you should test against
a live LDAP server.  Devstack has an option to set up a directory server for
Keystone to use.  Add ldap to the <code class="docutils literal"><span class="pre">ENABLED_SERVICES</span></code> environment variable,
and set environment variables <code class="docutils literal"><span class="pre">KEYSTONE_IDENTITY_BACKEND=ldap</span></code> and
<code class="docutils literal"><span class="pre">KEYSTONE_CLEAR_LDAP=yes</span></code> in your <code class="docutils literal"><span class="pre">localrc</span></code> file.</p>
<p>The unit tests can be run against a live server with
<code class="docutils literal"><span class="pre">keystone/tests/unit/test_ldap_livetest.py</span></code> and
<code class="docutils literal"><span class="pre">keystone/tests/unit/test_ldap_pool_livetest.py</span></code>. The default password is
<code class="docutils literal"><span class="pre">test</span></code> but if you have installed devstack with a different LDAP password,
modify the file <code class="docutils literal"><span class="pre">keystone/tests/unit/config_files/backend_liveldap.conf</span></code> and
<code class="docutils literal"><span class="pre">keystone/tests/unit/config_files/backend_pool_liveldap.conf</span></code> to reflect your
password.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run the live tests you need to set the environment variable
<code class="docutils literal"><span class="pre">ENABLE_LDAP_LIVE_TEST</span></code> to a non-negative value.</p>
</div>
</div>
<div class="section" id="work-in-progress-tests">
<h3>&#8220;Work in progress&#8221; Tests<a class="headerlink" href="#work-in-progress-tests" title="Permalink to this headline">¶</a></h3>
<p>Work in progress (WIP) tests are very useful in a variety of situations
including:</p>
<ul class="simple">
<li>During a TDD process they can be used to add tests to a review while
they are not yet working and will not cause test failures. (They should
be removed before the final merge.)</li>
<li>Often bug reports include small snippets of code to show broken
behaviors. Some of these can be converted into WIP tests that can later
be worked on by a developer. This allows us to take code that can be
used to catch bug regressions and commit it before any code is
written.</li>
</ul>
<p>The <a class="reference internal" href="../api/keystone.tests.unit.html#keystone.tests.unit.utils.wip" title="keystone.tests.unit.utils.wip"><code class="xref py py-func docutils literal"><span class="pre">keystone.tests.unit.utils.wip()</span></code></a> decorator can be used to mark a test
as WIP. A WIP test will always be run. If the test fails then a TestSkipped
exception is raised because we expect the test to fail. We do not pass
the test in this case so that it doesn&#8217;t count toward the number of
successfully run tests. If the test passes an AssertionError exception is
raised so that the developer knows they made the test pass. This is a
reminder to remove the decorator.</p>
<p>The <a class="reference internal" href="../api/keystone.tests.unit.html#keystone.tests.unit.utils.wip" title="keystone.tests.unit.utils.wip"><code class="xref py py-func docutils literal"><span class="pre">wip()</span></code></a> decorator requires that the author
provides a message. This message is important because it will tell other
developers why this test is marked as a work in progress. Reviewers will
require that these messages are descriptive and accurate.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="../api/keystone.tests.unit.html#keystone.tests.unit.utils.wip" title="keystone.tests.unit.utils.wip"><code class="xref py py-func docutils literal"><span class="pre">wip()</span></code></a> decorator is not a replacement for
skipping tests.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@wip</span><span class="p">(</span><span class="s1">&#39;waiting on bug #000000&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Another strategy is to not use the wip decorator and instead show how the
code currently incorrectly works. Which strategy is chosen is up to the
developer.</p>
</div>
</div>
</div>
<div class="section" id="developing-doctor-checks">
<h2>Developing <code class="docutils literal"><span class="pre">doctor</span></code> checks<a class="headerlink" href="#developing-doctor-checks" title="Permalink to this headline">¶</a></h2>
<p>As noted in the section above, keystone&#8217;s management CLI provides various tools
for administrating OpenStack Identity. One of those tools is called
<code class="docutils literal"><span class="pre">keystone-manage</span> <span class="pre">doctor</span></code> and it is responsible for performing health checks
about the deployment. If <code class="docutils literal"><span class="pre">keystone-manage</span> <span class="pre">doctor</span></code> detects a symptom, it
will provide the operator with suggestions to improve the overall health of the
deployment. This section is dedicated to documenting how to write symptoms for
<code class="docutils literal"><span class="pre">doctor</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">doctor</span></code> tool consists of a list of symptoms. Each symptom is something
that we can check against, and provide a warning for if we detect a
misconfiguration. The <code class="docutils literal"><span class="pre">doctor</span></code> module is located in
<a class="reference internal" href="../api/keystone.cmd.doctor.html#module-keystone.cmd.doctor" title="keystone.cmd.doctor"><code class="xref py py-mod docutils literal"><span class="pre">keystone.cmd.doctor</span></code></a>. The current checks are based heavily on
inspecting configuration values. As a result, many of the submodules within the
<code class="docutils literal"><span class="pre">doctor</span></code> module are named after the configuration section for the symptoms
they check. For example, if we want to ensure the <code class="docutils literal"><span class="pre">keystone.conf</span> <span class="pre">[DEFAULT]</span>
<span class="pre">max_token_size</span></code> option is properly configured for whatever <code class="docutils literal"><span class="pre">keystone.conf</span>
<span class="pre">[token]</span> <span class="pre">provider</span></code> is set to, we can place that symptom in a module called
<a class="reference internal" href="../api/keystone.cmd.doctor.html#module-keystone.cmd.doctor.tokens" title="keystone.cmd.doctor.tokens"><code class="xref py py-mod docutils literal"><span class="pre">keystone.cmd.doctor.tokens</span></code></a>. The symptom will be loaded by
importing the <code class="docutils literal"><span class="pre">doctor</span></code> module, which is done when <code class="docutils literal"><span class="pre">keystone-manage</span> <span class="pre">doctor</span></code>
is invoked from the command line. When adding new symptoms, it&#8217;s important to
remember to add new modules to the <code class="docutils literal"><span class="pre">SYMPTOM_MODULES</span></code> list in
<code class="xref py py-mod docutils literal"><span class="pre">keystone.cmd.doctor.__init__</span></code>. Doing that will ensure <code class="docutils literal"><span class="pre">doctor</span></code>
discovers properly named symptoms when executed.</p>
<p>Now that we know symptoms are organized according to configuration sections,
and how to add them, how exactly do we write a new symptom? <code class="docutils literal"><span class="pre">doctor</span></code> will
automatically discover new symptoms by inspecting the methods of each symptom
module (i.e. <code class="docutils literal"><span class="pre">SYMPTOM_MODULES</span></code>). If a method declaration starts with
<code class="docutils literal"><span class="pre">def</span> <span class="pre">symptom_</span></code> it is considered a symptom that <code class="docutils literal"><span class="pre">doctor</span></code> should check for,
and it should be run. The naming of the symptom, or method name, is extremely
important since <code class="docutils literal"><span class="pre">doctor</span></code> will use it to describe what it&#8217;s doing to whoever
runs <code class="docutils literal"><span class="pre">doctor</span></code>. In addition to a well named method, we also need to provide a
complete documentation string for the method. If <code class="docutils literal"><span class="pre">doctor</span></code> detects a symptom,
it will use the method&#8217;s documentation string as feedback to the operator. It
should describe why the check is being done, why it was triggered, and possible
solutions to cure the symptom. For examples of this, see the existing symptoms
in any of <code class="docutils literal"><span class="pre">doctor</span></code>&#8216;s symptom modules.</p>
<p>The last step is evaluating the logic within the symptom. As previously stated,
<code class="docutils literal"><span class="pre">doctor</span></code> will check for a symptom if methods within specific symptom modules
make a specific naming convention. In order for <code class="docutils literal"><span class="pre">doctor</span></code> to suggest feedback,
it needs to know whether or not the symptom is actually present. We accomplish
this by making all symptoms return <code class="docutils literal"><span class="pre">True</span></code> when a symptom is present. When a
symptom evaluates to <code class="docutils literal"><span class="pre">False</span></code>, <code class="docutils literal"><span class="pre">doctor</span></code> will move along to the next symptom
in the list since. If the deployment isn&#8217;t suffering for a specific symptom,
<code class="docutils literal"><span class="pre">doctor</span></code> should not suggest any actions related to that symptom (i.e. if
you have your cholesterol under control, why would a physician recommend
cholesterol medication if you don&#8217;t need it).</p>
<p>To summarize:</p>
<ul class="simple">
<li>Symptoms should live in modules named according to the most relevant
configuration section they apply to. This ensure we keep our symptoms
organized, grouped, and easy to find.</li>
<li>When writing symptoms for a new section, remember to add the module name to
the <code class="docutils literal"><span class="pre">SYMPTOM_MODULES</span></code> list in <code class="xref py py-mod docutils literal"><span class="pre">keystone.cmd.doctor.__init__</span></code>.</li>
<li>Remember to use a good name for the symptom method signature and to prepend
it with <code class="docutils literal"><span class="pre">symptom_</span></code> in order for it to be discovered automatically by
<code class="docutils literal"><span class="pre">doctor</span></code>.</li>
<li>Symptoms have to evaluate to <code class="docutils literal"><span class="pre">True</span></code> in order to provide feedback to
operators.</li>
<li>Symptoms should have very thorough documentation strings that describe the
symptom, side-effects of the symptom, and ways to remedy it.</li>
</ul>
<p>For examples, feel free to run <code class="docutils literal"><span class="pre">doctor</span></code> locally using <code class="docutils literal"><span class="pre">keystone-manage</span></code> and
inspect the existing symptoms.</p>
</div>
<div class="section" id="database-migrations">
<h2>Database Migrations<a class="headerlink" href="#database-migrations" title="Permalink to this headline">¶</a></h2>
<p>Starting with Newton, keystone supports upgrading both with and without
downtime. In order to support this, there are three separate migration
repositories (all under <code class="docutils literal"><span class="pre">keystone/common/sql/</span></code>) that match the three phases
of an upgrade (schema expansion, data migration, and schema contraction):</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">expand_repo</span></code></dt>
<dd>For additive schema modifications and triggers to ensure data is kept in
sync between the old and new schema until the point when there are no
keystone instances running old code.</dd>
<dt><code class="docutils literal"><span class="pre">data_migration_repo</span></code></dt>
<dd>To ensure new tables/columns are fully populated with data from the old
schema.</dd>
<dt><code class="docutils literal"><span class="pre">contract_repo</span></code></dt>
<dd>Run after all old code versions have been upgraded to running the new code,
so remove any old schema columns/tables that are not used by the new
version of the code. Drop any triggers added in the expand phase.</dd>
</dl>
<p>All migrations are required to have a migration script in each of these repos,
each with the same version number (which is indicated by the first three digits
of the name of the script, e.g. <code class="docutils literal"><span class="pre">003_add_X_table.py</span></code>). If there is no work to
do in a specific phase, then include a no-op migration to simply <code class="docutils literal"><span class="pre">pass</span></code> (in
fact the <code class="docutils literal"><span class="pre">001</span></code> migration in each of these repositories is a no-op migration,
so that can be used as a template).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since rolling upgrade support was added part way through the Newton cycle,
some migrations had already been added to the legacy repository
(<code class="docutils literal"><span class="pre">keystone/common/sql/migrate_repo</span></code>). This repository is now closed and
no new migrations should be added (except for backporting of previous
placeholders).</p>
</div>
<p>In order to support rolling upgrades, where two releases of keystone briefly
operate side-by-side using the same database without downtime, each phase of
the migration must adhere to following constraints:</p>
<p>These triggers should be removed in the contract phase. There are further
restrictions as to what can and cannot be included in migration scripts in each
phase:</p>
<dl class="docutils">
<dt>Expand phase:</dt>
<dd><p class="first">Only additive schema changes are allowed, such as new columns, tables,
indices, and triggers.</p>
<p>Data insertion, modification, and removal is not allowed.</p>
<p>Triggers must be created to keep data in sync between the previous release
and the next release. Data written by the previous release must be readable
by both the previous release and the next release. Data written by the next
release must be readable by both the next release and the previous release.</p>
<p class="last">In cases it is not possible for triggers to maintain data integrity across
multiple schemas, writing data should be forbidden using triggers.</p>
</dd>
<dt>Data Migration phase:</dt>
<dd><p class="first">Data is allowed to be inserted, updated, and deleted.</p>
<p class="last">No schema changes are allowed.</p>
</dd>
<dt>Contract phase:</dt>
<dd><p class="first">Only contractive schema changes are allowed, such as dropping or altering
columns, tables, indices, and triggers.</p>
<p>Data insertion, modification, and removal is not allowed.</p>
<p class="last">Triggers created during the expand phase must be dropped.</p>
</dd>
</dl>
<p>For more information on writing individual migration scripts refer to
<a class="reference external" href="https://git.openstack.org/cgit/openstack/sqlalchemy-migrate">SQLAlchemy-migrate</a>.</p>
</div>
<div class="section" id="filtering-responsibilities-between-controllers-and-drivers">
<h2>Filtering responsibilities between controllers and drivers<a class="headerlink" href="#filtering-responsibilities-between-controllers-and-drivers" title="Permalink to this headline">¶</a></h2>
<p>Keystone supports the specification of filtering on list queries as part of the
v3 identity API. By default these queries are satisfied in the controller
class when a controller calls the <code class="docutils literal"><span class="pre">wrap_collection</span></code> method at the end of a
<code class="docutils literal"><span class="pre">list_{entity}</span></code> method.  However, to enable optimum performance, any driver
can implement some or all of the specified filters (for example, by adding
filtering to the generated SQL statements to generate the list).</p>
<p>The communication of the filter details between the controller level and its
drivers is handled by the passing of a reference to a Hints object,
which is a list of dicts describing the filters. A driver that satisfies a
filter must delete the filter from the Hints object so that when it is returned
to the controller level, it knows to only execute any unsatisfied
filters.</p>
<p>The contract for a driver for <code class="docutils literal"><span class="pre">list_{entity}</span></code> methods is therefore:</p>
<ul class="simple">
<li>It MUST return a list of entities of the specified type</li>
<li>It MAY either just return all such entities, or alternatively reduce the
list by filtering for one or more of the specified filters in the passed
Hints reference, and removing any such satisfied filters. An exception to
this is that for identity drivers that support domains, then they should
at least support filtering by domain_id.</li>
</ul>
</div>
<div class="section" id="entity-list-truncation-by-drivers">
<h2>Entity list truncation by drivers<a class="headerlink" href="#entity-list-truncation-by-drivers" title="Permalink to this headline">¶</a></h2>
<p>Keystone supports the ability for a deployment to restrict the number of
entries returned from <code class="docutils literal"><span class="pre">list_{entity}</span></code> methods, typically to prevent poorly
formed searches (e.g. without sufficient filters) from becoming a performance
issue.</p>
<p>These limits are set in the configuration file, either for a specific driver or
across all drivers.  These limits are read at the Manager level and passed into
individual drivers as part of the Hints list object. A driver should try and
honor any such limit if possible, but if it is unable to do so then it may
ignore it (and the truncation of the returned list of entities will happen at
the controller level).</p>
</div>
<div class="section" id="identity-entity-id-management-between-controllers-and-drivers">
<h2>Identity entity ID management between controllers and drivers<a class="headerlink" href="#identity-entity-id-management-between-controllers-and-drivers" title="Permalink to this headline">¶</a></h2>
<p>Keystone supports the option of having domain-specific backends for the
identity driver (i.e. for user and group storage), allowing, for example,
a different LDAP server for each domain. To ensure that Keystone can determine
to which backend it should route an API call, starting with Juno, the
identity manager will, provided that domain-specific backends are enabled,
build on-the-fly a persistent mapping table between Keystone Public IDs that
are presented to the controller and the domain that holds the entity, along
with whatever local ID is understood by the driver.  This hides, for instance,
the LDAP specifics of whatever ID is being used.</p>
<p>To ensure backward compatibility, the default configuration of either a
single SQL or LDAP backend for Identity will not use the mapping table,
meaning that public facing IDs will be the unchanged. If keeping these IDs
the same for the default LDAP backend is not required, then setting the
configuration variable <code class="docutils literal"><span class="pre">backward_compatible_ids</span></code> to <code class="docutils literal"><span class="pre">False</span></code> will enable
the mapping for the default LDAP driver, hence hiding the LDAP specifics of the
IDs being used.</p>
</div>
<div class="section" id="translated-responses">
<h2>Translated responses<a class="headerlink" href="#translated-responses" title="Permalink to this headline">¶</a></h2>
<p>The Keystone server can provide error responses translated into the language in
the <code class="docutils literal"><span class="pre">Accept-Language</span></code> header of the request. In order to test this in your
development environment, there&#8217;s a couple of things you need to do.</p>
<ol class="arabic simple">
<li>Build the message files. Run the following command in your keystone
directory:</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python setup.py compile_catalog
</pre></div>
</div>
<p>This will generate .mo files like keystone/locale/[lang]/LC_MESSAGES/[lang].mo</p>
<ol class="arabic simple" start="2">
<li>When running Keystone, set the <code class="docutils literal"><span class="pre">KEYSTONE_LOCALEDIR</span></code> environment variable
to the keystone/locale directory. For example:</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nv">KEYSTONE_LOCALEDIR</span><span class="o">=</span>/opt/stack/keystone/keystone/locale uwsgi --http <span class="m">127</span>.0.0.1:35357 --wsgi-file <span class="k">$(</span>which keystone-wsgi-admin<span class="k">)</span>
</pre></div>
</div>
<p>Now you can get a translated error response:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ curl -s -H <span class="s2">&quot;Accept-Language: zh&quot;</span> http://localhost:5000/notapath <span class="p">|</span> python -mjson.tool
<span class="o">{</span>
    <span class="s2">&quot;error&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;code&quot;</span>: <span class="m">404</span>,
        <span class="s2">&quot;message&quot;</span>: <span class="s2">&quot;\u627e\u4e0d\u5230\u8cc7\u6e90\u3002&quot;</span>,
        <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;Not Found&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="caching-layer">
<h2>Caching Layer<a class="headerlink" href="#caching-layer" title="Permalink to this headline">¶</a></h2>
<p>The caching layer is designed to be applied to any <code class="docutils literal"><span class="pre">manager</span></code> object within Keystone
via the use of the <code class="docutils literal"><span class="pre">on_arguments</span></code> decorator provided in the <code class="docutils literal"><span class="pre">keystone.common.cache</span></code>
module.  This decorator leverages <a class="reference external" href="http://dogpilecache.readthedocs.org/">dogpile.cache</a> caching system to provide a flexible
caching backend.</p>
<p>It is recommended that each of the managers have an independent toggle within the config
file to enable caching.  The easiest method to utilize the toggle within the
configuration file is to define a <code class="docutils literal"><span class="pre">caching</span></code> boolean option within that manager&#8217;s
configuration section (e.g. <code class="docutils literal"><span class="pre">identity</span></code>).  Once that option is defined you can
pass function to the <code class="docutils literal"><span class="pre">on_arguments</span></code> decorator with the named argument <code class="docutils literal"><span class="pre">should_cache_fn</span></code>.
In the <code class="docutils literal"><span class="pre">keystone.common.cache</span></code> module, there is a function called <code class="docutils literal"><span class="pre">should_cache_fn</span></code>,
which will provide a reference, to a function, that will consult the global cache
<code class="docutils literal"><span class="pre">enabled</span></code> option as well as the specific manager&#8217;s caching enable toggle.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a section-specific boolean option is not defined in the config section specified when
calling <code class="docutils literal"><span class="pre">should_cache_fn</span></code>, the returned function reference will default to enabling
caching for that <code class="docutils literal"><span class="pre">manager</span></code>.</p>
</div>
</div></blockquote>
<p>Example use of cache and <code class="docutils literal"><span class="pre">should_cache_fn</span></code> (in this example, <code class="docutils literal"><span class="pre">token</span></code> is the manager):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">keystone.common</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="n">SHOULD_CACHE</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">should_cache_fn</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>

<span class="nd">@cache.on_arguments</span><span class="p">(</span><span class="n">should_cache_fn</span><span class="o">=</span><span class="n">SHOULD_CACHE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cacheable_function</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">some_value</span>
</pre></div>
</div>
<p>With the above example, each call to the <code class="docutils literal"><span class="pre">cacheable_function</span></code> would check to see if
the arguments passed to it matched a currently valid cached item.  If the return value
was cached, the caching layer would return the cached value; if the return value was
not cached, the caching layer would call the function, pass the value to the <code class="docutils literal"><span class="pre">SHOULD_CACHE</span></code>
function reference, which would then determine if caching was globally enabled and enabled
for the <code class="docutils literal"><span class="pre">token</span></code> manager.  If either caching toggle is disabled, the value is returned but
not cached.</p>
<p>It is recommended that each of the managers have an independent configurable time-to-live (TTL).
If a configurable TTL has been defined for the manager configuration section, it is possible to
pass it to the <code class="docutils literal"><span class="pre">cache.on_arguments</span></code> decorator with the named-argument <code class="docutils literal"><span class="pre">expiration_time</span></code>.  For
consistency, it is recommended that this option be called <code class="docutils literal"><span class="pre">cache_time</span></code> and default to <code class="docutils literal"><span class="pre">None</span></code>.
If the <code class="docutils literal"><span class="pre">expiration_time</span></code> argument passed to the decorator is set to <code class="docutils literal"><span class="pre">None</span></code>, the expiration
time will be set to the global default (<code class="docutils literal"><span class="pre">expiration_time</span></code> option in the <code class="docutils literal"><span class="pre">[cache]</span></code>
configuration section.</p>
<p>Example of using a section specific <code class="docutils literal"><span class="pre">cache_time</span></code> (in this example, <code class="docutils literal"><span class="pre">identity</span></code> is the manager):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">keystone.common</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="n">SHOULD_CACHE</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">should_cache_fn</span><span class="p">(</span><span class="s1">&#39;identity&#39;</span><span class="p">)</span>

<span class="nd">@cache.on_arguments</span><span class="p">(</span><span class="n">should_cache_fn</span><span class="o">=</span><span class="n">SHOULD_CACHE</span><span class="p">,</span>
                    <span class="n">expiration_time</span><span class="o">=</span><span class="n">CONF</span><span class="o">.</span><span class="n">identity</span><span class="o">.</span><span class="n">cache_time</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cachable_function</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">some_value</span>
</pre></div>
</div>
<p>For cache invalidation, the <code class="docutils literal"><span class="pre">on_arguments</span></code> decorator will add an <code class="docutils literal"><span class="pre">invalidate</span></code> method
(attribute) to your decorated function.  To invalidate the cache, you pass the same arguments
to the <code class="docutils literal"><span class="pre">invalidate</span></code> method as you would the normal function.</p>
<p>Example (using the above cacheable_function):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">invalidate_cache</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">):</span>
    <span class="n">cacheable_function</span><span class="o">.</span><span class="n">invalidate</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <code class="docutils literal"><span class="pre">on_arguments</span></code> decorator does not accept keyword-arguments/named arguments.  An
exception will be raised if keyword arguments are passed to a caching-decorated function.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In all cases methods work the same as functions except if you are attempting to invalidate
the cache on a decorated bound-method, you need to pass  <code class="docutils literal"><span class="pre">self</span></code> to the <code class="docutils literal"><span class="pre">invalidate</span></code>
method as the first argument before the arguments.</p>
</div>
<div class="section" id="dogpile-cache-based-mongodb-nosql-backend">
<h3>dogpile.cache based MongoDB (NoSQL) backend<a class="headerlink" href="#dogpile-cache-based-mongodb-nosql-backend" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">dogpile.cache</span></code> based MongoDB backend implementation allows for various MongoDB
configurations, e.g., standalone, a replica set, sharded replicas, with or without SSL,
use of TTL type collections, etc.</p>
<p>Example of typical configuration for MongoDB backend:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dogpile.cache</span> <span class="kn">import</span> <span class="n">region</span>

<span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;db_hosts&#39;</span><span class="p">:</span> <span class="s1">&#39;localhost:27017&#39;</span><span class="p">,</span>
    <span class="s1">&#39;db_name&#39;</span><span class="p">:</span> <span class="s1">&#39;ks_cache&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cache_collection&#39;</span><span class="p">:</span> <span class="s1">&#39;cache&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;test_user&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;test_password&#39;</span><span class="p">,</span>

    <span class="c1"># optional arguments</span>
    <span class="s1">&#39;son_manipulator&#39;</span><span class="p">:</span> <span class="s1">&#39;my_son_manipulator_impl&#39;</span>
<span class="p">}</span>

<span class="n">region</span><span class="o">.</span><span class="n">make_region</span><span class="p">()</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">&#39;keystone.cache.mongo&#39;</span><span class="p">,</span>
                               <span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span>
</pre></div>
</div>
<p>The optional <cite>son_manipulator</cite> is used to manipulate custom data type while its saved in
or retrieved from MongoDB. If the dogpile cached values contain built-in data types and no
custom classes, then the provided implementation class is sufficient. For further details, refer
<a class="reference external" href="http://api.mongodb.org/python/current/examples/custom_type.html#automatic-encoding-and-decoding">http://api.mongodb.org/python/current/examples/custom_type.html#automatic-encoding-and-decoding</a></p>
<p>Similar to other backends, this backend can be added via Keystone configuration in
<code class="docutils literal"><span class="pre">keystone.conf</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[cache]
# Global cache functionality toggle.
enabled = True

# Referring to specific cache backend
backend = keystone.cache.mongo

# Backend specific configuration arguments
backend_argument = db_hosts:localhost:27017
backend_argument = db_name:ks_cache
backend_argument = cache_collection:cache
backend_argument = username:test_user
backend_argument = password:test_password
</pre></div>
</div>
<p>This backend is registered in <code class="docutils literal"><span class="pre">keystone.common.cache.core</span></code> module. So, its usage
is similar to other dogpile caching backends as it implements the same dogpile APIs.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Best Practices</a><ul>
<li><a class="reference internal" href="#setting-up-keystone">Setting up Keystone</a></li>
<li><a class="reference internal" href="#configuring-keystone">Configuring Keystone</a></li>
<li><a class="reference internal" href="#running-keystone">Running Keystone</a></li>
<li><a class="reference internal" href="#initializing-keystone">Initializing Keystone</a><ul>
<li><a class="reference internal" href="#initial-sample-data">Initial Sample Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interacting-with-keystone">Interacting with Keystone</a></li>
<li><a class="reference internal" href="#building-the-documentation">Building the Documentation</a></li>
<li><a class="reference internal" href="#generating-a-new-sample-config-file">Generating a new Sample Config File</a></li>
<li><a class="reference internal" href="#release-notes">Release Notes</a></li>
<li><a class="reference internal" href="#testing-keystone">Testing Keystone</a><ul>
<li><a class="reference internal" href="#running-tests">Running Tests</a><ul>
<li><a class="reference internal" href="#running-with-pdb">Running with PDB</a></li>
<li><a class="reference internal" href="#disabling-stream-capture">Disabling Stream Capture</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-structure">Test Structure</a></li>
<li><a class="reference internal" href="#testing-schema-migrations">Testing Schema Migrations</a></li>
<li><a class="reference internal" href="#writing-tests">Writing Tests</a></li>
<li><a class="reference internal" href="#further-testing">Further Testing</a></li>
<li><a class="reference internal" href="#ldap-tests">LDAP Tests</a></li>
<li><a class="reference internal" href="#work-in-progress-tests">&#8220;Work in progress&#8221; Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#developing-doctor-checks">Developing <code class="docutils literal"><span class="pre">doctor</span></code> checks</a></li>
<li><a class="reference internal" href="#database-migrations">Database Migrations</a></li>
<li><a class="reference internal" href="#filtering-responsibilities-between-controllers-and-drivers">Filtering responsibilities between controllers and drivers</a></li>
<li><a class="reference internal" href="#entity-list-truncation-by-drivers">Entity list truncation by drivers</a></li>
<li><a class="reference internal" href="#identity-entity-id-management-between-controllers-and-drivers">Identity entity ID management between controllers and drivers</a></li>
<li><a class="reference internal" href="#translated-responses">Translated responses</a></li>
<li><a class="reference internal" href="#caching-layer">Caching Layer</a><ul>
<li><a class="reference internal" href="#dogpile-cache-based-mongodb-nosql-backend">dogpile.cache based MongoDB (NoSQL) backend</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../security_compliance.html"
                                  title="previous chapter">Security Compliance &amp; PCI-DSS</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="development.environment.html"
                                  title="next chapter">Setting up a Development Environment</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/keystone
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/devref/development_best_practices.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="development.environment.html" title="Setting up a Development Environment"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../security_compliance.html" title="Security Compliance &amp; PCI-DSS"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">keystone 11.0.0.0rc2.dev29 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, OpenStack Foundation.
      Last updated on &#39;Fri Feb 10 22:47:54 2017, commit 9c47495&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/keystone");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>