<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>keystoneclient.common package &mdash; python-keystoneclient 3.10.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.10.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="python-keystoneclient 3.10.0 documentation" href="../index.html" />
    <link rel="up" title="keystoneclient package" href="keystoneclient.html" />
    <link rel="next" title="keystoneclient.contrib package" href="keystoneclient.contrib.html" />
    <link rel="prev" title="keystoneclient.auth.identity.v3 package" href="keystoneclient.auth.identity.v3.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="keystoneclient-common-package">
<h1>keystoneclient.common package<a class="headerlink" href="#keystoneclient-common-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-keystoneclient.common.cms">
<span id="keystoneclient-common-cms-module"></span><h2>keystoneclient.common.cms module<a class="headerlink" href="#module-keystoneclient.common.cms" title="Permalink to this headline">¶</a></h2>
<p>Certificate signing functions.</p>
<p>Call set_subprocess() with the subprocess module. Either Python&#8217;s
subprocess or eventlet.green.subprocess can be used.</p>
<p>If set_subprocess() is not called, this module will pick Python&#8217;s subprocess
or eventlet.green.subprocess based on if os module is patched by eventlet.</p>
<dl class="class">
<dt id="keystoneclient.common.cms.OpensslCmsExitStatus">
<em class="property">class </em><code class="descclassname">keystoneclient.common.cms.</code><code class="descname">OpensslCmsExitStatus</code><a class="headerlink" href="#keystoneclient.common.cms.OpensslCmsExitStatus" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<dl class="attribute">
<dt id="keystoneclient.common.cms.OpensslCmsExitStatus.COMMAND_OPTIONS_PARSING_ERROR">
<code class="descname">COMMAND_OPTIONS_PARSING_ERROR</code><em class="property"> = 1</em><a class="headerlink" href="#keystoneclient.common.cms.OpensslCmsExitStatus.COMMAND_OPTIONS_PARSING_ERROR" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="keystoneclient.common.cms.OpensslCmsExitStatus.CREATE_CMS_READ_MIME_ERROR">
<code class="descname">CREATE_CMS_READ_MIME_ERROR</code><em class="property"> = 3</em><a class="headerlink" href="#keystoneclient.common.cms.OpensslCmsExitStatus.CREATE_CMS_READ_MIME_ERROR" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="keystoneclient.common.cms.OpensslCmsExitStatus.INPUT_FILE_READ_ERROR">
<code class="descname">INPUT_FILE_READ_ERROR</code><em class="property"> = 2</em><a class="headerlink" href="#keystoneclient.common.cms.OpensslCmsExitStatus.INPUT_FILE_READ_ERROR" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="keystoneclient.common.cms.OpensslCmsExitStatus.SUCCESS">
<code class="descname">SUCCESS</code><em class="property"> = 0</em><a class="headerlink" href="#keystoneclient.common.cms.OpensslCmsExitStatus.SUCCESS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.cms_hash_token">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">cms_hash_token</code><span class="sig-paren">(</span><em>token_id</em>, <em>mode='md5'</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.cms_hash_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Hash PKI tokens.</p>
<dl class="docutils">
<dt>return: for asn1 or pkiz tokens, returns the hash of the passed in token</dt>
<dd>otherwise, returns what it was passed in.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.cms_sign_data">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">cms_sign_data</code><span class="sig-paren">(</span><em>data_to_sign</em>, <em>signing_cert_file_name</em>, <em>signing_key_file_name</em>, <em>outform='PEM'</em>, <em>message_digest='sha256'</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.cms_sign_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Use OpenSSL to sign a document.</p>
<p>Produces a Base64 encoding of a DER formatted CMS Document
<a class="reference external" href="http://en.wikipedia.org/wiki/Cryptographic_Message_Syntax">http://en.wikipedia.org/wiki/Cryptographic_Message_Syntax</a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data_to_sign</strong> &#8211; data to sign</li>
<li><strong>signing_cert_file_name</strong> &#8211; path to the X509 certificate containing
the public key associated with the private key used to sign the data</li>
<li><strong>signing_key_file_name</strong> &#8211; path to the private key used to sign
the data</li>
<li><strong>outform</strong> &#8211; Format for the signed document PKIZ_CMS_FORM or
PKI_ASN1_FORM</li>
<li><strong>message_digest</strong> &#8211; Digest algorithm to use when signing or resigning</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.cms_sign_text">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">cms_sign_text</code><span class="sig-paren">(</span><em>data_to_sign</em>, <em>signing_cert_file_name</em>, <em>signing_key_file_name</em>, <em>message_digest='sha256'</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.cms_sign_text" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.cms_sign_token">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">cms_sign_token</code><span class="sig-paren">(</span><em>text</em>, <em>signing_cert_file_name</em>, <em>signing_key_file_name</em>, <em>message_digest='sha256'</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.cms_sign_token" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.cms_to_token">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">cms_to_token</code><span class="sig-paren">(</span><em>cms_text</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.cms_to_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a CMS-signed token in PEM format to a custom URL-safe format.</p>
<p>The conversion consists of replacing &#8216;/&#8217; char in the PEM-formatted token
with the &#8216;-&#8216; char and doing other such textual replacements to make the
result marshallable via HTTP. The return value can thus be used as the
value of a HTTP header such as &#8220;X-Auth-Token&#8221;.</p>
<p>This ad-hoc conversion is an unfortunate oversight since the returned
value now does not conform to any of the standard variants of base64
encoding. It would have been better to use base64url encoding (either on
the PEM formatted text or, perhaps even better, on the inner CMS-signed
binary value without any PEM formatting). In any case, the same conversion
is done in reverse in the other direction (for token verification), so
there are no correctness issues here. Note that the non-standard encoding
of the token will be preserved so as to not break backward compatibility.</p>
<p>The conversion issue is detailed by the code author in a blog post at
<a class="reference external" href="http://adam.younglogic.com/2014/02/compressed-tokens/">http://adam.younglogic.com/2014/02/compressed-tokens/</a>.</p>
</dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.cms_verify">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">cms_verify</code><span class="sig-paren">(</span><em>formatted</em>, <em>signing_cert_file_name</em>, <em>ca_file_name</em>, <em>inform='PEM'</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.cms_verify" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify the signature of the contents IAW CMS syntax.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><a class="reference external" href="http://docs.python.org/library/subprocess.html#subprocess.CalledProcessError" title="(in Python v2.7)"><strong>subprocess.CalledProcessError</strong></a> &#8211; </li>
<li><a class="reference internal" href="keystoneclient.html#keystoneclient.exceptions.CertificateConfigError" title="keystoneclient.exceptions.CertificateConfigError"><strong>keystoneclient.exceptions.CertificateConfigError</strong></a> &#8211; if certificate
is not configured
properly.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.is_ans1_token">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">is_ans1_token</code><span class="sig-paren">(</span><em>token</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.is_ans1_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Deprecated.</p>
<p>This function is deprecated as of the 1.7.0 release in favor of
<a class="reference internal" href="#keystoneclient.common.cms.is_asn1_token" title="keystoneclient.common.cms.is_asn1_token"><code class="xref py py-func docutils literal"><span class="pre">is_asn1_token()</span></code></a> and may be removed in the 2.0.0 release.</p>
</dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.is_asn1_token">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">is_asn1_token</code><span class="sig-paren">(</span><em>token</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.is_asn1_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine if a token appears to be PKI-based.</p>
<p>thx to ayoung for sorting this out.</p>
<p>base64 decoded hex representation of MII is 3082:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>In [3]: binascii.hexlify(base64.b64decode(&#39;MII=&#39;))
Out[3]: &#39;3082&#39;
</pre></div>
</div>
<p>re: <a class="reference external" href="http://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf">http://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf</a></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>pg4:  For tags from 0 to 30 the first octet is the identfier
pg10: Hex 30 means sequence, followed by the length of that sequence.
pg5:  Second octet is the length octet
      first bit indicates short or long form, next 7 bits encode the
      number of subsequent octets that make up the content length octets
      as an unsigned binary int

      82 = 10000010 (first bit indicates long form)
      0000010 = 2 octets of content length
      so read the next 2 octets to get the length of the content.
</pre></div>
</div>
<p>In the case of a very large content length there could be a requirement to
have more than 2 octets to designate the content length, therefore
requiring us to check for MIM, MIQ, etc.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>In [4]: base64.b64encode(binascii.a2b_hex(&#39;3083&#39;))
Out[4]: &#39;MIM=&#39;
In [5]: base64.b64encode(binascii.a2b_hex(&#39;3084&#39;))
Out[5]: &#39;MIQ=&#39;
Checking for MI would become invalid at 16 octets of content length
10010000 = 90
In [6]: base64.b64encode(binascii.a2b_hex(&#39;3090&#39;))
Out[6]: &#39;MJA=&#39;
Checking for just M is insufficient
</pre></div>
</div>
<p>But we will only check for MII:
Max length of the content using 2 octets is 3FFF or 16383.</p>
<p>It&#8217;s not practical to support a token of this length or greater in http
therefore, we will check for MII only and ignore the case of larger tokens</p>
</dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.is_pkiz">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">is_pkiz</code><span class="sig-paren">(</span><em>token_text</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.is_pkiz" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine if a token is PKIZ.</p>
<p>Checks if the string has the prefix that indicates it is a
Crypto Message Syntax, Z compressed token.</p>
</dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.pkiz_sign">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">pkiz_sign</code><span class="sig-paren">(</span><em>text</em>, <em>signing_cert_file_name</em>, <em>signing_key_file_name</em>, <em>compression_level=6</em>, <em>message_digest='sha256'</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.pkiz_sign" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.pkiz_uncompress">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">pkiz_uncompress</code><span class="sig-paren">(</span><em>signed_text</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.pkiz_uncompress" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.pkiz_verify">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">pkiz_verify</code><span class="sig-paren">(</span><em>signed_text</em>, <em>signing_cert_file_name</em>, <em>ca_file_name</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.pkiz_verify" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.set_subprocess">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">set_subprocess</code><span class="sig-paren">(</span><em>_subprocess=None</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.set_subprocess" title="Permalink to this definition">¶</a></dt>
<dd><p>Set subprocess module to use.</p>
<p>The subprocess could be eventlet.green.subprocess if using eventlet,
or Python&#8217;s subprocess otherwise.</p>
</dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.token_to_cms">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">token_to_cms</code><span class="sig-paren">(</span><em>signed_text</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.token_to_cms" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a custom formatted token to a PEM-formatted token.</p>
<p>See documentation for cms_to_token() for details on the custom formatting.</p>
</dd></dl>

<dl class="function">
<dt id="keystoneclient.common.cms.verify_token">
<code class="descclassname">keystoneclient.common.cms.</code><code class="descname">verify_token</code><span class="sig-paren">(</span><em>token</em>, <em>signing_cert_file_name</em>, <em>ca_file_name</em><span class="sig-paren">)</span><a class="headerlink" href="#keystoneclient.common.cms.verify_token" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-keystoneclient.common">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-keystoneclient.common" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">keystoneclient.common package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-keystoneclient.common.cms">keystoneclient.common.cms module</a></li>
<li><a class="reference internal" href="#module-keystoneclient.common">Module contents</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="keystoneclient.auth.identity.v3.html"
                                  title="previous chapter">keystoneclient.auth.identity.v3 package</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="keystoneclient.contrib.html"
                                  title="next chapter">keystoneclient.contrib package</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/python-keystoneclient
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/api/keystoneclient.common.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="keystoneclient.contrib.html" title="keystoneclient.contrib package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="keystoneclient.auth.identity.v3.html" title="keystoneclient.auth.identity.v3 package"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">python-keystoneclient 3.10.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="modules.html" >Modules</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="keystoneclient.html" accesskey="U">keystoneclient package</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright OpenStack Contributors.
      Last updated on &#39;Wed Jan 25 04:45:52 2017, commit 5e23cef&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/python-keystoneclient");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>