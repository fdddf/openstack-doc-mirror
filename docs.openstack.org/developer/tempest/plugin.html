<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tempest Test Plugin Interface &mdash; Tempest 14.0.1.dev225 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '14.0.1.dev225',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Tempest 14.0.1.dev225 documentation" href="index.html" />
    <link rel="next" title="Tempest Plugin Registry" href="plugin-registry.html" />
    <link rel="prev" title="Tempest Test Removal Procedure" href="test-removal.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tempest-test-plugin-interface">
<h1>Tempest Test Plugin Interface<a class="headerlink" href="#tempest-test-plugin-interface" title="Permalink to this headline">¶</a></h1>
<p>Tempest has an external test plugin interface which enables anyone to integrate
an external test suite as part of a tempest run. This will let any project
leverage being run with the rest of the tempest suite while not requiring the
tests live in the tempest tree.</p>
<div class="section" id="creating-a-plugin">
<h2>Creating a plugin<a class="headerlink" href="#creating-a-plugin" title="Permalink to this headline">¶</a></h2>
<p>Creating a plugin is fairly straightforward and doesn't require much additional
effort on top of creating a test suite using tempest.lib. One thing to note with
doing this is that the interfaces exposed by tempest are not considered stable
(with the exception of configuration variables which ever effort goes into
ensuring backwards compatibility). You should not need to import anything from
tempest itself except where explicitly noted.</p>
<div class="section" id="stable-tempest-apis-plugins-may-use">
<h3>Stable Tempest APIs plugins may use<a class="headerlink" href="#stable-tempest-apis-plugins-may-use" title="Permalink to this headline">¶</a></h3>
<p>As noted above, several tempest APIs are acceptable to use from plugins, while
others are not. A list of stable APIs available to plugins is provided below:</p>
<ul class="simple">
<li>tempest.lib.*</li>
<li>tempest.config</li>
<li>tempest.test_discover.plugins</li>
</ul>
<p>If there is an interface from tempest that you need to rely on in your plugin
which is not listed above, it likely needs to be migrated to tempest.lib. In
that situation, file a bug, push a migration patch, etc. to expedite providing
the interface in a reliable manner.</p>
</div>
<div class="section" id="plugin-cookiecutter">
<h3>Plugin Cookiecutter<a class="headerlink" href="#plugin-cookiecutter" title="Permalink to this headline">¶</a></h3>
<p>In order to create the basic structure with base classes and test directories
you can use the tempest-plugin-cookiecutter project:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>&gt; pip install -U cookiecutter &amp;&amp; cookiecutter https://git.openstack.org/openstack/tempest-plugin-cookiecutter

Cloning into &#39;tempest-plugin-cookiecutter&#39;...
remote: Counting objects: 17, done.
remote: Compressing objects: 100% (13/13), done.
remote: Total 17 (delta 1), reused 14 (delta 1)
Unpacking objects: 100% (17/17), done.
Checking connectivity... done.
project (default is &quot;sample&quot;)? foo
testclass (default is &quot;SampleTempestPlugin&quot;)? FooTempestPlugin
</pre></div>
</div>
<p>This would create a folder called <code class="docutils literal"><span class="pre">foo_tempest_plugin/</span></code> with all necessary
basic classes. You only need to move/create your test in
<code class="docutils literal"><span class="pre">foo_tempest_plugin/tests</span></code>.</p>
</div>
<div class="section" id="entry-point">
<h3>Entry Point<a class="headerlink" href="#entry-point" title="Permalink to this headline">¶</a></h3>
<p>Once you've created your plugin class you need to add an entry point to your
project to enable tempest to find the plugin. The entry point must be added
to the &quot;tempest.test_plugins&quot; namespace.</p>
<p>If you are using pbr this is fairly straightforward, in the setup.cfg just add
something like the following:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[entry_points]</span>
<span class="na">tempest.test_plugins</span> <span class="o">=</span><span class="s"></span>
<span class="s">    plugin_name = module.path:PluginClass</span>
</pre></div>
</div>
</div>
<div class="section" id="standalone-plugin-vs-in-repo-plugin">
<h3>Standalone Plugin vs In-repo Plugin<a class="headerlink" href="#standalone-plugin-vs-in-repo-plugin" title="Permalink to this headline">¶</a></h3>
<p>Since all that's required for a plugin to be detected by tempest is a valid
setuptools entry point in the proper namespace there is no difference from the
tempest perspective on either creating a separate python package to
house the plugin or adding the code to an existing python project. However,
there are tradeoffs to consider when deciding which approach to take when
creating a new plugin.</p>
<p>If you create a separate python project for your plugin this makes a lot of
things much easier. Firstly it makes packaging and versioning much simpler, you
can easily decouple the requirements for the plugin from the requirements for
the other project. It lets you version the plugin independently and maintain a
single version of the test code across project release boundaries (see the
<a class="reference external" href="http://specs.openstack.org/openstack/qa-specs/specs/tempest/implemented/branchless-tempest.html">Branchless Tempest Spec</a> for more details on this). It also greatly
simplifies the install time story for external users. Instead of having to
install the right version of a project in the same python namespace as tempest
they simply need to pip install the plugin in that namespace. It also means
that users don't have to worry about inadvertently installing a tempest plugin
when they install another package.</p>
<p>The sole advantage to integrating a plugin into an existing python project is
that it enables you to land code changes at the same time you land test changes
in the plugin. This reduces some of the burden on contributors by not having
to land 2 changes to add a new API feature and then test it and doing it as a
single combined commit.</p>
</div>
</div>
<div class="section" id="plugin-class">
<h2>Plugin Class<a class="headerlink" href="#plugin-class" title="Permalink to this headline">¶</a></h2>
<p>To provide tempest with all the required information it needs to be able to run
your plugin you need to create a plugin class which tempest will load and call
to get information when it needs. To simplify creating this tempest provides an
abstract class that should be used as the parent for your plugin. To use this
you would do something like the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tempest.test_discover</span> <span class="kn">import</span> <span class="n">plugins</span>

<span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="n">plugins</span><span class="o">.</span><span class="n">TempestPlugin</span><span class="p">):</span>
</pre></div>
</div>
<p>Then you need to ensure you locally define all of the mandatory methods in the
abstract class, you can refer to the api doc below for a reference of what that
entails.</p>
<div class="section" id="abstract-plugin-class">
<h3>Abstract Plugin Class<a class="headerlink" href="#abstract-plugin-class" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="tempest.test_discover.plugins.TempestPlugin">
<em class="property">class </em><code class="descname">TempestPlugin</code><a class="reference internal" href="_modules/tempest/test_discover/plugins.html#TempestPlugin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tempest.test_discover.plugins.TempestPlugin" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide basic hooks for an external plugin</p>
<p>To provide tempest the necessary information to run the plugin.</p>
<dl class="method">
<dt id="tempest.test_discover.plugins.TempestPlugin.get_opt_lists">
<code class="descname">get_opt_lists</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tempest/test_discover/plugins.html#TempestPlugin.get_opt_lists"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tempest.test_discover.plugins.TempestPlugin.get_opt_lists" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of options for sample config generation</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Return option_list:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body">A list of tuples with the group name and options
in that group.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tempest.test_discover.plugins.TempestPlugin.get_service_clients">
<code class="descname">get_service_clients</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tempest/test_discover/plugins.html#TempestPlugin.get_service_clients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tempest.test_discover.plugins.TempestPlugin.get_service_clients" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of the service clients for registration</p>
<p>If the plugin implements service clients for one or more APIs, it
may return their details by this method for automatic registration
in any ServiceClients object instantiated by tests.
The default implementation returns an empty list.</p>
<dl class="docutils">
<dt>:return list of dictionaries. Each element of the list represents</dt>
<dd>the service client for an API. Each dict must define all
parameters required for the invocation of
<cite>service_clients.ServiceClients.register_service_client_module</cite>.</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span> <span class="c1"># Example implementation with one service client</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">myservice_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">service_client_config</span><span class="p">(</span><span class="s1">&#39;myservice&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;myservice&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;service_version&#39;</span><span class="p">:</span> <span class="s1">&#39;myservice&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;module_path&#39;</span><span class="p">:</span> <span class="s1">&#39;myservice_tempest_tests.services&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;client_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;API1Client&#39;</span><span class="p">,</span> <span class="s1">&#39;API2Client&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">myservice_config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="k">return</span> <span class="p">[</span><span class="n">params</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span> <span class="c1"># Example implementation with two service clients</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">foo1_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">service_client_config</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">params_foo1</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;foo_v1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;service_version&#39;</span><span class="p">:</span> <span class="s1">&#39;foo.v1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;module_path&#39;</span><span class="p">:</span> <span class="s1">&#39;bar_tempest_tests.services.foo.v1&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;client_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;API1Client&#39;</span><span class="p">,</span> <span class="s1">&#39;API2Client&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">params_foo1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">foo_config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">foo2_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">service_client_config</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">params_foo2</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;foo_v2&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;service_version&#39;</span><span class="p">:</span> <span class="s1">&#39;foo.v2&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;module_path&#39;</span><span class="p">:</span> <span class="s1">&#39;bar_tempest_tests.services.foo.v2&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;client_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;API1Client&#39;</span><span class="p">,</span> <span class="s1">&#39;API2Client&#39;</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">params_foo2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">foo2_config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="k">return</span> <span class="p">[</span><span class="n">params_foo1</span><span class="p">,</span> <span class="n">params_foo2</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="tempest.test_discover.plugins.TempestPlugin.load_tests">
<code class="descname">load_tests</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tempest/test_discover/plugins.html#TempestPlugin.load_tests"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tempest.test_discover.plugins.TempestPlugin.load_tests" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the information necessary to load the tests in the plugin.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a tuple with the first value being the test_dir and the second
being the top_level</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tempest.test_discover.plugins.TempestPlugin.register_opts">
<code class="descname">register_opts</code><span class="sig-paren">(</span><em>conf</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tempest/test_discover/plugins.html#TempestPlugin.register_opts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tempest.test_discover.plugins.TempestPlugin.register_opts" title="Permalink to this definition">¶</a></dt>
<dd><p>Add additional configuration options to tempest.</p>
<p>This method will be run for the plugin during the register_opts()
function in tempest.config</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>conf</strong> (<em>ConfigOpts</em>) -- The conf object that can be used to register
additional options on.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="plugin-structure">
<h2>Plugin Structure<a class="headerlink" href="#plugin-structure" title="Permalink to this headline">¶</a></h2>
<p>While there are no hard and fast rules for the structure a plugin, there are
basically no constraints on what the plugin looks like as long as the 2 steps
above are done. However,  there are some recommended patterns to follow to make
it easy for people to contribute and work with your plugin. For example, if you
create a directory structure with something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>plugin_dir/
  config.py
  plugin.py
  tests/
    api/
    scenario/
  services/
    client.py
</pre></div>
</div>
<p>That will mirror what people expect from tempest. The file</p>
<ul class="simple">
<li><strong>config.py</strong>: contains any plugin specific configuration variables</li>
<li><strong>plugin.py</strong>: contains the plugin class used for the entry point</li>
<li><dl class="first docutils">
<dt><strong>tests</strong>: the directory where test discovery will be run, all tests should</dt>
<dd>be under this dir</dd>
</dl>
</li>
<li><strong>services</strong>: where the plugin specific service clients are</li>
</ul>
<p>Additionally, when you're creating the plugin you likely want to follow all
of the tempest developer and reviewer documentation to ensure that the tests
being added in the plugin act and behave like the rest of tempest.</p>
<div class="section" id="dealing-with-configuration-options">
<h3>Dealing with configuration options<a class="headerlink" href="#dealing-with-configuration-options" title="Permalink to this headline">¶</a></h3>
<p>Historically Tempest didn't provide external guarantees on its configuration
options. However, with the introduction of the plugin interface this is no
longer the case. An external plugin can rely on using any configuration option
coming from Tempest, there will be at least a full deprecation cycle for any
option before it's removed. However, just the options provided by Tempest
may not be sufficient for the plugin. If you need to add any plugin specific
configuration options you should use the <code class="docutils literal"><span class="pre">register_opts</span></code> and
<code class="docutils literal"><span class="pre">get_opt_lists</span></code> methods to pass them to Tempest when the plugin is loaded.
When adding configuration options the <code class="docutils literal"><span class="pre">register_opts</span></code> method gets passed the
CONF object from tempest. This enables the plugin to add options to both
existing sections and also create new configuration sections for new options.</p>
</div>
<div class="section" id="service-clients">
<h3>Service Clients<a class="headerlink" href="#service-clients" title="Permalink to this headline">¶</a></h3>
<p>If a plugin defines a service client, it is beneficial for it to implement the
<code class="docutils literal"><span class="pre">get_service_clients</span></code> method in the plugin class. All service clients which
are exposed via this interface will be automatically configured and be
available in any instance of the service clients class, defined in
<code class="docutils literal"><span class="pre">tempest.lib.services.clients.ServiceClients</span></code>. In case multiple plugins are
installed, all service clients from all plugins will be registered, making it
easy to write tests which rely on multiple APIs whose service clients are in
different plugins.</p>
<p>Example implementation of <code class="docutils literal"><span class="pre">get_service_clients</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_service_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Example implementation with two service clients</span>
    <span class="n">my_service1_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">service_client_config</span><span class="p">(</span><span class="s1">&#39;my_service&#39;</span><span class="p">)</span>
    <span class="n">params_my_service1</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;my_service_v1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;service_version&#39;</span><span class="p">:</span> <span class="s1">&#39;my_service.v1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;module_path&#39;</span><span class="p">:</span> <span class="s1">&#39;plugin_tempest_tests.services.my_service.v1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;client_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;API1Client&#39;</span><span class="p">,</span> <span class="s1">&#39;API2Client&#39;</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">params_my_service1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">my_service_config</span><span class="p">)</span>
    <span class="n">my_service2_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">service_client_config</span><span class="p">(</span><span class="s1">&#39;my_service&#39;</span><span class="p">)</span>
    <span class="n">params_my_service2</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;my_service_v2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;service_version&#39;</span><span class="p">:</span> <span class="s1">&#39;my_service.v2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;module_path&#39;</span><span class="p">:</span> <span class="s1">&#39;plugin_tempest_tests.services.my_service.v2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;client_names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;API1Client&#39;</span><span class="p">,</span> <span class="s1">&#39;API2Client&#39;</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">params_my_service2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">my_service2_config</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">params_my_service1</span><span class="p">,</span> <span class="n">params_my_service2</span><span class="p">]</span>
</pre></div>
</div>
<p>Parameters:</p>
<ul class="simple">
<li><strong>name</strong>: Name of the attribute used to access the <code class="docutils literal"><span class="pre">ClientsFactory</span></code> from
the <code class="docutils literal"><span class="pre">ServiceClients</span></code> instance. See example below.</li>
<li><strong>service_version</strong>: Tempest enforces a single implementation for each
service client. Available service clients are held in a <code class="docutils literal"><span class="pre">ClientsRegistry</span></code>
singleton, and registered with <code class="docutils literal"><span class="pre">service_version</span></code>, which means that
<code class="docutils literal"><span class="pre">service_version</span></code> must be unique and it should represent the service API
and version implemented by the service client.</li>
<li><strong>module_path</strong>: Relative to the service client module, from the root of the
plugin.</li>
<li><strong>client_names</strong>: Name of the classes that implement service clients in the
service clients module.</li>
</ul>
<p>Example usage of the service clients in tests:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># my_creds is instance of tempest.lib.auth.Credentials</span>
<span class="c1"># identity_uri is v2 or v3 depending on the configuration</span>
<span class="kn">from</span> <span class="nn">tempest.lib.services</span> <span class="kn">import</span> <span class="n">clients</span>

<span class="n">my_clients</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">ServiceClients</span><span class="p">(</span><span class="n">my_creds</span><span class="p">,</span> <span class="n">identity_uri</span><span class="p">)</span>
<span class="n">my_service1_api1_client</span> <span class="o">=</span> <span class="n">my_clients</span><span class="o">.</span><span class="n">my_service_v1</span><span class="o">.</span><span class="n">API1Client</span><span class="p">()</span>
<span class="n">my_service2_api1_client</span> <span class="o">=</span> <span class="n">my_clients</span><span class="o">.</span><span class="n">my_service_v2</span><span class="o">.</span><span class="n">API1Client</span><span class="p">(</span><span class="n">my_args</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Automatic configuration and registration of service clients imposes some extra
constraints on the structure of the configuration options exposed by the
plugin.</p>
<p>First <code class="docutils literal"><span class="pre">service_version</span></code> should be in the format <cite>service_config[.version]</cite>.
The <cite>.version</cite> part is optional, and should only be used if there are multiple
versions of the same API available. The <cite>service_config</cite> must match the name of
a configuration options group defined by the plugin. Different versions of one
API must share the same configuration group.</p>
<p>Second the configuration options group <cite>service_config</cite> must contain the
following options:</p>
<ul class="simple">
<li><cite>catalog_type</cite>: corresponds to <cite>service</cite> in the catalog</li>
<li><cite>endpoint_type</cite></li>
</ul>
<p>The following options will be honoured if defined, but they are not mandatory,
as they do not necessarily apply to all service clients.</p>
<ul class="simple">
<li><cite>region</cite>: default to identity.region</li>
<li><cite>build_timeout</cite> : default to compute.build_timeout</li>
<li><cite>build_interval</cite>: default to compute.build_interval</li>
</ul>
<p>Third the service client classes should inherit from <code class="docutils literal"><span class="pre">RestClient</span></code>, should
accept generic keyword arguments, and should pass those arguments to the
<code class="docutils literal"><span class="pre">__init__</span></code> method of <code class="docutils literal"><span class="pre">RestClient</span></code>. Extra arguments can be added. For
instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyAPIClient</span><span class="p">(</span><span class="n">rest_client</span><span class="o">.</span><span class="n">RestClient</span><span class="p">):</span>

 <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_provider</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span>
              <span class="n">my_arg</span><span class="p">,</span> <span class="n">my_arg2</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
     <span class="nb">super</span><span class="p">(</span><span class="n">MyAPIClient</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
         <span class="n">auth_provider</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">my_arg</span> <span class="o">=</span> <span class="n">my_arg</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">my_args2</span> <span class="o">=</span> <span class="n">my_arg</span>
</pre></div>
</div>
<p>Finally the service client should be structured in a python module, so that all
service client classes are importable from it. Each major API version should
have its own module.</p>
<p>The following folder and module structure is recommended for a single major
API version:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>plugin_dir/
  services/
    __init__.py
    client_api_1.py
    client_api_2.py
</pre></div>
</div>
<p>The content of __init__.py module should be:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">client_api_1.py</span> <span class="kn">import</span> <span class="n">API1Client</span>
<span class="kn">from</span> <span class="nn">client_api_2.py</span> <span class="kn">import</span> <span class="n">API2Client</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;API1Client&#39;</span><span class="p">,</span> <span class="s1">&#39;API2Client&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The following folder and module structure is recommended for multiple major
API version:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>plugin_dir/
  services/
    v1/
       __init__.py
       client_api_1.py
       client_api_2.py
    v2/
       __init__.py
       client_api_1.py
       client_api_2.py
</pre></div>
</div>
<p>The content each of __init__.py module under vN should be:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">client_api_1.py</span> <span class="kn">import</span> <span class="n">API1Client</span>
<span class="kn">from</span> <span class="nn">client_api_2.py</span> <span class="kn">import</span> <span class="n">API2Client</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;API1Client&#39;</span><span class="p">,</span> <span class="s1">&#39;API2Client&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-plugins">
<h2>Using Plugins<a class="headerlink" href="#using-plugins" title="Permalink to this headline">¶</a></h2>
<p>Tempest will automatically discover any installed plugins when it is run. So by
just installing the python packages which contain your plugin you'll be using
them with tempest, nothing else is really required.</p>
<p>However, you should take care when installing plugins. By their very nature
there are no guarantees when running tempest with plugins enabled about the
quality of the plugin. Additionally, while there is no limitation on running
with multiple plugins it's worth noting that poorly written plugins might not
properly isolate their tests which could cause unexpected cross interactions
between plugins.</p>
<div class="section" id="notes-for-using-plugins-with-virtualenvs">
<h3>Notes for using plugins with virtualenvs<a class="headerlink" href="#notes-for-using-plugins-with-virtualenvs" title="Permalink to this headline">¶</a></h3>
<p>When using a tempest inside a virtualenv (like when running under tox) you have
to ensure that the package that contains your plugin is either installed in the
venv too or that you have system site-packages enabled. The virtualenv will
isolate the tempest install from the rest of your system so just installing the
plugin package on your system and then running tempest inside a venv will not
work.</p>
<p>Tempest also exposes a tox job, all-plugin, which will setup a tox virtualenv
with system site-packages enabled. This will let you leverage tox without
requiring to manually install plugins in the tox venv before running tests.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Tempest Test Plugin Interface</a><ul>
<li><a class="reference internal" href="#creating-a-plugin">Creating a plugin</a><ul>
<li><a class="reference internal" href="#stable-tempest-apis-plugins-may-use">Stable Tempest APIs plugins may use</a></li>
<li><a class="reference internal" href="#plugin-cookiecutter">Plugin Cookiecutter</a></li>
<li><a class="reference internal" href="#entry-point">Entry Point</a></li>
<li><a class="reference internal" href="#standalone-plugin-vs-in-repo-plugin">Standalone Plugin vs In-repo Plugin</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin-class">Plugin Class</a><ul>
<li><a class="reference internal" href="#abstract-plugin-class">Abstract Plugin Class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin-structure">Plugin Structure</a><ul>
<li><a class="reference internal" href="#dealing-with-configuration-options">Dealing with configuration options</a></li>
<li><a class="reference internal" href="#service-clients">Service Clients</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-plugins">Using Plugins</a><ul>
<li><a class="reference internal" href="#notes-for-using-plugins-with-virtualenvs">Notes for using plugins with virtualenvs</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="test-removal.html"
                                  title="previous chapter">Tempest Test Removal Procedure</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="plugin-registry.html"
                                  title="next chapter">Tempest Plugin Registry</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/tempest
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/plugin.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="plugin-registry.html" title="Tempest Plugin Registry"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="test-removal.html" title="Tempest Test Removal Procedure"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Tempest 14.0.1.dev225 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, OpenStack QA Team.
      Last updated on &#39;Tue Feb 14 13:17:43 2017, commit 6827cd3&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/Tempest");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>