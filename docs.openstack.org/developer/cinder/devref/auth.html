<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Authentication and Authorization &mdash; cinder 10.0.0.0rc2.dev77 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '10.0.0.0rc2.dev77',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="cinder 10.0.0.0rc2.dev77 documentation" href="../index.html" />
    <link rel="up" title="Developer Guide" href="index.html" />
    <link rel="next" title="API Endpoint" href="api.html" />
    <link rel="prev" title="Storage Volumes, Disks" href="volume.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="authentication-and-authorization">
<span id="auth"></span><h1>Authentication and Authorization<a class="headerlink" href="#authentication-and-authorization" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-cinder-api-middleware-auth-module">
<h2>The <a class="reference internal" href="../api/cinder.api.middleware.auth.html#module-cinder.api.middleware.auth" title="cinder.api.middleware.auth"><code class="xref py py-mod docutils literal"><span class="pre">cinder.api.middleware.auth</span></code></a> Module<a class="headerlink" href="#the-cinder-api-middleware-auth-module" title="Permalink to this headline">¶</a></h2>
<p>Common Auth Middleware.</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descname">CinderKeystoneContext</code><span class="sig-paren">(</span><em>application</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.wsgi.common.html#cinder.wsgi.common.Middleware" title="cinder.wsgi.common.Middleware"><code class="xref py py-class docutils literal"><span class="pre">cinder.wsgi.common.Middleware</span></code></a></p>
<p>Make a request context from keystone headers.</p>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">InjectContext</code><span class="sig-paren">(</span><em>context</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.wsgi.common.html#cinder.wsgi.common.Middleware" title="cinder.wsgi.common.Middleware"><code class="xref py py-class docutils literal"><span class="pre">cinder.wsgi.common.Middleware</span></code></a></p>
<p>Add a &#8216;cinder.context&#8217; to WSGI environ.</p>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">NoAuthMiddleware</code><span class="sig-paren">(</span><em>application</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.wsgi.common.html#cinder.wsgi.common.Middleware" title="cinder.wsgi.common.Middleware"><code class="xref py py-class docutils literal"><span class="pre">cinder.wsgi.common.Middleware</span></code></a></p>
<p>Return a fake token if one isn&#8217;t specified.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">pipeline_factory</code><span class="sig-paren">(</span><em>loader</em>, <em>global_conf</em>, <em>**local_conf</em><span class="sig-paren">)</span></dt>
<dd><p>A paste pipeline replica that keys off of auth_strategy.</p>
</dd></dl>

</div>
<div class="section" id="the-cinder-quota-module">
<h2>The <a class="reference internal" href="../api/cinder.quota.html#module-cinder.quota" title="cinder.quota"><code class="xref py py-mod docutils literal"><span class="pre">cinder.quota</span></code></a> Module<a class="headerlink" href="#the-cinder-quota-module" title="Permalink to this headline">¶</a></h2>
<p>Quotas for volumes.</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descname">AbsoluteResource</code><span class="sig-paren">(</span><em>name</em>, <em>flag=None</em>, <em>parent_project_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.quota.html#cinder.quota.BaseResource" title="cinder.quota.BaseResource"><code class="xref py py-class docutils literal"><span class="pre">cinder.quota.BaseResource</span></code></a></p>
<p>Describe a non-reservable resource.</p>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">BaseResource</code><span class="sig-paren">(</span><em>name</em>, <em>flag=None</em>, <em>parent_project_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Describe a single resource for quota checking.</p>
<dl class="attribute">
<dt>
<code class="descname">default</code></dt>
<dd><p>Return the default value of the quota.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">quota</code><span class="sig-paren">(</span><em>driver</em>, <em>context</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Given a driver and context, obtain the quota for this resource.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>driver</strong> &#8211; A quota driver.</li>
<li><strong>context</strong> &#8211; The request context.</li>
<li><strong>project_id</strong> &#8211; The project to obtain the quota value for.
If not provided, it is taken from the
context.  If it is given as None, no
project-specific quota will be searched
for.</li>
<li><strong>quota_class</strong> &#8211; The quota class corresponding to the
project, or for which the quota is to be
looked up.  If not provided, it is taken
from the context.  If it is given as None,
no quota class-specific quota will be
searched for.  Note that the quota class
defaults to the value in the context,
which may not correspond to the project if
project_id is not the same as the one in
the context.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">CGQuotaEngine</code><span class="sig-paren">(</span><em>quota_driver_class=None</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.quota.html#cinder.quota.QuotaEngine" title="cinder.quota.QuotaEngine"><code class="xref py py-class docutils literal"><span class="pre">cinder.quota.QuotaEngine</span></code></a></p>
<p>Represent the consistencygroup quotas.</p>
<dl class="method">
<dt>
<code class="descname">register_resource</code><span class="sig-paren">(</span><em>resource</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">register_resources</code><span class="sig-paren">(</span><em>resources</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">resources</code></dt>
<dd><p>Fetches all possible quota resources.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">CountableResource</code><span class="sig-paren">(</span><em>name</em>, <em>count</em>, <em>flag=None</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.quota.html#cinder.quota.AbsoluteResource" title="cinder.quota.AbsoluteResource"><code class="xref py py-class docutils literal"><span class="pre">cinder.quota.AbsoluteResource</span></code></a></p>
<p>Describe a resource where counts aren&#8217;t based only on the project ID.</p>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">DbQuotaDriver</code></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Driver to perform check to enforcement of quotas.</p>
<p>Also allows to obtain quota information.
The default driver utilizes the local database.</p>
<dl class="method">
<dt>
<code class="descname">commit</code><span class="sig-paren">(</span><em>context</em>, <em>reservations</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Commit reservations.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>reservations</strong> &#8211; A list of the reservation UUIDs, as
returned by the reserve() method.</li>
<li><strong>project_id</strong> &#8211; Specify the project_id if current context
is admin and admin wants to impact on
common user&#8217;s tenant.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">destroy_by_project</code><span class="sig-paren">(</span><em>context</em>, <em>project_id</em><span class="sig-paren">)</span></dt>
<dd><p>Destroy all limit quotas associated with a project.</p>
<p>Leave usage and reservation quotas intact.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>project_id</strong> &#8211; The ID of the project being deleted.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">expire</code><span class="sig-paren">(</span><em>context</em><span class="sig-paren">)</span></dt>
<dd><p>Expire reservations.</p>
<p>Explores all currently existing reservations and rolls back
any that have expired.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>context</strong> &#8211; The request context, for access checks.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_by_class</code><span class="sig-paren">(</span><em>context</em>, <em>quota_class</em>, <em>resource_name</em><span class="sig-paren">)</span></dt>
<dd><p>Get a specific quota by quota class.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_by_project</code><span class="sig-paren">(</span><em>context</em>, <em>project_id</em>, <em>resource_name</em><span class="sig-paren">)</span></dt>
<dd><p>Get a specific quota by project.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_class_quotas</code><span class="sig-paren">(</span><em>context</em>, <em>resources</em>, <em>quota_class</em>, <em>defaults=True</em><span class="sig-paren">)</span></dt>
<dd><p>Given list of resources, retrieve the quotas for given quota class.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>resources</strong> &#8211; A dictionary of the registered resources.</li>
<li><strong>quota_class</strong> &#8211; The name of the quota class to return
quotas for.</li>
<li><strong>defaults</strong> &#8211; If True, the default value will be reported
if there is no specific value for the
resource.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_default</code><span class="sig-paren">(</span><em>context</em>, <em>resource</em>, <em>project_id</em><span class="sig-paren">)</span></dt>
<dd><p>Get a specific default quota for a resource.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_defaults</code><span class="sig-paren">(</span><em>context</em>, <em>resources</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Given a list of resources, retrieve the default quotas.</p>
<p>Use the class quotas named <cite>_DEFAULT_QUOTA_NAME</cite> as default quotas,
if it exists.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>resources</strong> &#8211; A dictionary of the registered resources.</li>
<li><strong>project_id</strong> &#8211; The id of the current project</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_project_quotas</code><span class="sig-paren">(</span><em>context</em>, <em>resources</em>, <em>project_id</em>, <em>quota_class=None</em>, <em>defaults=True</em>, <em>usages=True</em><span class="sig-paren">)</span></dt>
<dd><p>Retrieve quotas for a project.</p>
<p>Given a list of resources, retrieve the quotas for the given
project.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>resources</strong> &#8211; A dictionary of the registered resources.</li>
<li><strong>project_id</strong> &#8211; The ID of the project to return quotas for.</li>
<li><strong>quota_class</strong> &#8211; If project_id != context.project_id, the
quota class cannot be determined.  This
parameter allows it to be specified.  It
will be ignored if project_id ==
context.project_id.</li>
<li><strong>defaults</strong> &#8211; If True, the quota class value (or the
default value, if there is no value from the
quota class) will be reported if there is no
specific value for the resource.</li>
<li><strong>usages</strong> &#8211; If True, the current in_use, reserved and allocated
counts will also be returned.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">limit_check</code><span class="sig-paren">(</span><em>context</em>, <em>resources</em>, <em>values</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Check simple quota limits.</p>
<p>For limits&#8211;those quotas for which there is no usage
synchronization function&#8211;this method checks that a set of
proposed values are permitted by the limit restriction.</p>
<p>This method will raise a QuotaResourceUnknown exception if a
given resource is unknown or if it is not a simple limit
resource.</p>
<p>If any of the proposed values is over the defined quota, an
OverQuota exception will be raised with the sorted list of the
resources which are too high.  Otherwise, the method returns
nothing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>resources</strong> &#8211; A dictionary of the registered resources.</li>
<li><strong>values</strong> &#8211; A dictionary of the values to check against the
quota.</li>
<li><strong>project_id</strong> &#8211; Specify the project_id if current context
is admin and admin wants to impact on
common user&#8217;s tenant.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">reserve</code><span class="sig-paren">(</span><em>context</em>, <em>resources</em>, <em>deltas</em>, <em>expire=None</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Check quotas and reserve resources.</p>
<p>For counting quotas&#8211;those quotas for which there is a usage
synchronization function&#8211;this method checks quotas against
current usage and the desired deltas.</p>
<p>This method will raise a QuotaResourceUnknown exception if a
given resource is unknown or if it does not have a usage
synchronization function.</p>
<p>If any of the proposed values is over the defined quota, an
OverQuota exception will be raised with the sorted list of the
resources which are too high.  Otherwise, the method returns a
list of reservation UUIDs which were created.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>resources</strong> &#8211; A dictionary of the registered resources.</li>
<li><strong>deltas</strong> &#8211; A dictionary of the proposed delta changes.</li>
<li><strong>expire</strong> &#8211; An optional parameter specifying an expiration
time for the reservations.  If it is a simple
number, it is interpreted as a number of
seconds and added to the current time; if it is
a datetime.timedelta object, it will also be
added to the current time.  A datetime.datetime
object will be interpreted as the absolute
expiration time.  If None is specified, the
default expiration time set by
&#8211;default-reservation-expire will be used (this
value will be treated as a number of seconds).</li>
<li><strong>project_id</strong> &#8211; Specify the project_id if current context
is admin and admin wants to impact on
common user&#8217;s tenant.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">rollback</code><span class="sig-paren">(</span><em>context</em>, <em>reservations</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Roll back reservations.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>reservations</strong> &#8211; A list of the reservation UUIDs, as
returned by the reserve() method.</li>
<li><strong>project_id</strong> &#8211; Specify the project_id if current context
is admin and admin wants to impact on
common user&#8217;s tenant.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">GroupQuotaEngine</code><span class="sig-paren">(</span><em>quota_driver_class=None</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.quota.html#cinder.quota.QuotaEngine" title="cinder.quota.QuotaEngine"><code class="xref py py-class docutils literal"><span class="pre">cinder.quota.QuotaEngine</span></code></a></p>
<p>Represent the group quotas.</p>
<dl class="method">
<dt>
<code class="descname">register_resource</code><span class="sig-paren">(</span><em>resource</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">register_resources</code><span class="sig-paren">(</span><em>resources</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">resources</code></dt>
<dd><p>Fetches all possible quota resources.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">NestedDbQuotaDriver</code></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.quota.html#cinder.quota.DbQuotaDriver" title="cinder.quota.DbQuotaDriver"><code class="xref py py-class docutils literal"><span class="pre">cinder.quota.DbQuotaDriver</span></code></a></p>
<dl class="method">
<dt>
<code class="descname">get_default</code><span class="sig-paren">(</span><em>context</em>, <em>resource</em>, <em>project_id</em><span class="sig-paren">)</span></dt>
<dd><p>Get a specific default quota for a resource.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_defaults</code><span class="sig-paren">(</span><em>context</em>, <em>resources</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">validate_nested_setup</code><span class="sig-paren">(</span><em>ctxt</em>, <em>resources</em>, <em>project_tree</em>, <em>fix_allocated_quotas=False</em><span class="sig-paren">)</span></dt>
<dd><p>Ensures project_tree has quotas that make sense as nested quotas.</p>
<dl class="docutils">
<dt>Validates the following:</dt>
<dd><ul class="first last simple">
<li>No parent project has child_projects who have more combined quota
than the parent&#8217;s quota limit</li>
<li>No child quota has a larger in-use value than it&#8217;s current limit
(could happen before because child default values weren&#8217;t enforced)</li>
<li>All parent projects&#8217; &#8220;allocated&#8221; quotas match the sum of the limits
of its children projects</li>
</ul>
</dd>
<dt>TODO(mc_nair): need a better way to &#8220;flip the switch&#8221; to use nested</dt>
<dd>quotas to make this less race-ee</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">QuotaEngine</code><span class="sig-paren">(</span><em>quota_driver_class=None</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Represent the set of recognized quotas.</p>
<dl class="method">
<dt>
<code class="descname">add_volume_type_opts</code><span class="sig-paren">(</span><em>context</em>, <em>opts</em>, <em>volume_type_id</em><span class="sig-paren">)</span></dt>
<dd><p>Add volume type resource options.</p>
<p>Adds elements to the opts hash for volume type quotas.
If a resource is being reserved (&#8216;gigabytes&#8217;, etc) and the volume
type is set up for its own quotas, these reservations are copied
into keys for &#8216;gigabytes_&lt;volume type name&gt;&#8217;, etc.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>opts</strong> &#8211; The reservations options hash.</li>
<li><strong>volume_type_id</strong> &#8211; The volume type id for this reservation.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">commit</code><span class="sig-paren">(</span><em>context</em>, <em>reservations</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Commit reservations.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>reservations</strong> &#8211; A list of the reservation UUIDs, as
returned by the reserve() method.</li>
<li><strong>project_id</strong> &#8211; Specify the project_id if current context
is admin and admin wants to impact on
common user&#8217;s tenant.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">count</code><span class="sig-paren">(</span><em>context</em>, <em>resource</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Count a resource.</p>
<p>For countable resources, invokes the count() function and
returns its result.  Arguments following the context and
resource are passed directly to the count function declared by
the resource.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>resource</strong> &#8211; The name of the resource, as a string.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">destroy_by_project</code><span class="sig-paren">(</span><em>context</em>, <em>project_id</em><span class="sig-paren">)</span></dt>
<dd><p>Destroy all quota limits associated with a project.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>project_id</strong> &#8211; The ID of the project being deleted.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">expire</code><span class="sig-paren">(</span><em>context</em><span class="sig-paren">)</span></dt>
<dd><p>Expire reservations.</p>
<p>Explores all currently existing reservations and rolls back
any that have expired.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>context</strong> &#8211; The request context, for access checks.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_by_class</code><span class="sig-paren">(</span><em>context</em>, <em>quota_class</em>, <em>resource_name</em><span class="sig-paren">)</span></dt>
<dd><p>Get a specific quota by quota class.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_by_project</code><span class="sig-paren">(</span><em>context</em>, <em>project_id</em>, <em>resource_name</em><span class="sig-paren">)</span></dt>
<dd><p>Get a specific quota by project.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_by_project_or_default</code><span class="sig-paren">(</span><em>context</em>, <em>project_id</em>, <em>resource_name</em><span class="sig-paren">)</span></dt>
<dd><p>Get specific quota by project or default quota if doesn&#8217;t exists.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_class_quotas</code><span class="sig-paren">(</span><em>context</em>, <em>quota_class</em>, <em>defaults=True</em><span class="sig-paren">)</span></dt>
<dd><p>Retrieve the quotas for the given quota class.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>quota_class</strong> &#8211; The name of the quota class to return
quotas for.</li>
<li><strong>defaults</strong> &#8211; If True, the default value will be reported
if there is no specific value for the
resource.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_default</code><span class="sig-paren">(</span><em>context</em>, <em>resource</em>, <em>parent_project_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Get a specific default quota for a resource.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>parent_project_id</strong> &#8211; The id of the current project&#8217;s parent,
if any.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_defaults</code><span class="sig-paren">(</span><em>context</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Retrieve the default quotas.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>project_id</strong> &#8211; The id of the current project</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">get_project_quotas</code><span class="sig-paren">(</span><em>context</em>, <em>project_id</em>, <em>quota_class=None</em>, <em>defaults=True</em>, <em>usages=True</em><span class="sig-paren">)</span></dt>
<dd><p>Retrieve the quotas for the given project.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>project_id</strong> &#8211; The ID of the project to return quotas for.</li>
<li><strong>quota_class</strong> &#8211; If project_id != context.project_id, the
quota class cannot be determined.  This
parameter allows it to be specified.</li>
<li><strong>defaults</strong> &#8211; If True, the quota class value (or the
default value, if there is no value from the
quota class) will be reported if there is no
specific value for the resource.</li>
<li><strong>usages</strong> &#8211; If True, the current in_use, reserved and
allocated counts will also be returned.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">limit_check</code><span class="sig-paren">(</span><em>context</em>, <em>project_id=None</em>, <em>**values</em><span class="sig-paren">)</span></dt>
<dd><p>Check simple quota limits.</p>
<p>For limits&#8211;those quotas for which there is no usage
synchronization function&#8211;this method checks that a set of
proposed values are permitted by the limit restriction.  The
values to check are given as keyword arguments, where the key
identifies the specific quota limit to check, and the value is
the proposed value.</p>
<p>This method will raise a QuotaResourceUnknown exception if a
given resource is unknown or if it is not a simple limit
resource.</p>
<p>If any of the proposed values is over the defined quota, an
OverQuota exception will be raised with the sorted list of the
resources which are too high.  Otherwise, the method returns
nothing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>project_id</strong> &#8211; Specify the project_id if current context
is admin and admin wants to impact on
common user&#8217;s tenant.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">register_resource</code><span class="sig-paren">(</span><em>resource</em><span class="sig-paren">)</span></dt>
<dd><p>Register a resource.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">register_resources</code><span class="sig-paren">(</span><em>resources</em><span class="sig-paren">)</span></dt>
<dd><p>Register a list of resources.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">reserve</code><span class="sig-paren">(</span><em>context</em>, <em>expire=None</em>, <em>project_id=None</em>, <em>**deltas</em><span class="sig-paren">)</span></dt>
<dd><p>Check quotas and reserve resources.</p>
<p>For counting quotas&#8211;those quotas for which there is a usage
synchronization function&#8211;this method checks quotas against
current usage and the desired deltas.  The deltas are given as
keyword arguments, and current usage and other reservations
are factored into the quota check.</p>
<p>This method will raise a QuotaResourceUnknown exception if a
given resource is unknown or if it does not have a usage
synchronization function.</p>
<p>If any of the proposed values is over the defined quota, an
OverQuota exception will be raised with the sorted list of the
resources which are too high.  Otherwise, the method returns a
list of reservation UUIDs which were created.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>expire</strong> &#8211; An optional parameter specifying an expiration
time for the reservations.  If it is a simple
number, it is interpreted as a number of
seconds and added to the current time; if it is
a datetime.timedelta object, it will also be
added to the current time.  A datetime.datetime
object will be interpreted as the absolute
expiration time.  If None is specified, the
default expiration time set by
&#8211;default-reservation-expire will be used (this
value will be treated as a number of seconds).</li>
<li><strong>project_id</strong> &#8211; Specify the project_id if current context
is admin and admin wants to impact on
common user&#8217;s tenant.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">resource_names</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">resources</code></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">rollback</code><span class="sig-paren">(</span><em>context</em>, <em>reservations</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Roll back reservations.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>reservations</strong> &#8211; A list of the reservation UUIDs, as
returned by the reserve() method.</li>
<li><strong>project_id</strong> &#8211; Specify the project_id if current context
is admin and admin wants to impact on
common user&#8217;s tenant.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">using_nested_quotas</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Returns true if nested quotas are being used</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">ReservableResource</code><span class="sig-paren">(</span><em>name</em>, <em>sync</em>, <em>flag=None</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.quota.html#cinder.quota.BaseResource" title="cinder.quota.BaseResource"><code class="xref py py-class docutils literal"><span class="pre">cinder.quota.BaseResource</span></code></a></p>
<p>Describe a reservable resource.</p>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">VolumeTypeQuotaEngine</code><span class="sig-paren">(</span><em>quota_driver_class=None</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.quota.html#cinder.quota.QuotaEngine" title="cinder.quota.QuotaEngine"><code class="xref py py-class docutils literal"><span class="pre">cinder.quota.QuotaEngine</span></code></a></p>
<p>Represent the set of all quotas.</p>
<dl class="method">
<dt>
<code class="descname">register_resource</code><span class="sig-paren">(</span><em>resource</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">register_resources</code><span class="sig-paren">(</span><em>resources</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">resources</code></dt>
<dd><p>Fetches all possible quota resources.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">update_quota_resource</code><span class="sig-paren">(</span><em>context</em>, <em>old_type_name</em>, <em>new_type_name</em><span class="sig-paren">)</span></dt>
<dd><p>Update resource in quota.</p>
<p>This is to update resource in quotas, quota_classes, and
quota_usages once the name of a volume type is changed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>context</strong> &#8211; The request context, for access checks.</li>
<li><strong>old_type_name</strong> &#8211; old name of volume type.</li>
<li><strong>new_type_name</strong> &#8211; new name of volume type.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">VolumeTypeResource</code><span class="sig-paren">(</span><em>part_name</em>, <em>volume_type</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.quota.html#cinder.quota.ReservableResource" title="cinder.quota.ReservableResource"><code class="xref py py-class docutils literal"><span class="pre">cinder.quota.ReservableResource</span></code></a></p>
<p>ReservableResource for a specific volume type.</p>
</dd></dl>

<div class="section" id="tests">
<h3>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="the-middleware-test-auth-module">
<h2>The <code class="xref py py-mod docutils literal"><span class="pre">middleware.test_auth</span></code> Module<a class="headerlink" href="#the-middleware-test-auth-module" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt>
<em class="property">class </em><code class="descname">TestCinderKeystoneContextMiddleware</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.test.html#cinder.test.TestCase" title="cinder.test.TestCase"><code class="xref py py-class docutils literal"><span class="pre">cinder.test.TestCase</span></code></a></p>
<dl class="method">
<dt>
<code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_no_user_or_user_id</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_request_id_extracted_from_env</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_tenant_id_name</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_user_id_only</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_user_id_trumps_user</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_user_only</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="the-test-quota-module">
<h2>The <code class="xref py py-mod docutils literal"><span class="pre">test_quota</span></code> Module<a class="headerlink" href="#the-test-quota-module" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt>
<em class="property">class </em><code class="descname">BaseResourceTestCase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.test.html#cinder.test.TestCase" title="cinder.test.TestCase"><code class="xref py py-class docutils literal"><span class="pre">cinder.test.TestCase</span></code></a></p>
<dl class="method">
<dt>
<code class="descname">test_no_flag</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_no_project_no_class</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_no_project_with_class</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_override_project_with_class</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_override_subproject_no_class</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_with_project_no_class</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_with_project_override_class</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_with_project_with_class</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_with_flag</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_with_flag_no_quota</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">DbQuotaDriverBaseTestCase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.test.html#cinder.test.TestCase" title="cinder.test.TestCase"><code class="xref py py-class docutils literal"><span class="pre">cinder.test.TestCase</span></code></a></p>
<dl class="method">
<dt>
<code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">DbQuotaDriverTestCase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">cinder.tests.unit.test_quota.DbQuotaDriverBaseTestCase</span></code></p>
<dl class="method">
<dt>
<code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_destroy_quota_by_project</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_class_quotas</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_class_quotas_no_defaults</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_defaults</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_project_quotas</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_project_quotas_alt_context_no_class</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_project_quotas_alt_context_with_class</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_project_quotas_lazy_load_defaults</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_project_quotas_no_defaults</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_project_quotas_no_usages</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_quotas_has_sync</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_quotas_has_sync_no_sync_resource</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_quotas_has_sync_unknown</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_quotas_no_sync_has_sync_resource</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_quotas_no_sync_unknown</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_root_project_with_subprojects_quotas</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_reserve_bad_expire</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_reserve_datetime_expire</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_reserve_default_expire</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_reserve_int_expire</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_reserve_max_age</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_reserve_timedelta_expire</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_reserve_until_refresh</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">FakeContext</code><span class="sig-paren">(</span><em>project_id</em>, <em>quota_class</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<dl class="method">
<dt>
<code class="descname">elevated</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">FakeDriver</code><span class="sig-paren">(</span><em>by_project=None</em>, <em>by_class=None</em>, <em>reservations=None</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<dl class="method">
<dt>
<code class="descname">commit</code><span class="sig-paren">(</span><em>context</em>, <em>reservations</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">destroy_by_project</code><span class="sig-paren">(</span><em>context</em>, <em>project_id</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">expire</code><span class="sig-paren">(</span><em>context</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">get_by_class</code><span class="sig-paren">(</span><em>context</em>, <em>quota_class</em>, <em>resource</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">get_by_project</code><span class="sig-paren">(</span><em>context</em>, <em>project_id</em>, <em>resource</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">get_class_quotas</code><span class="sig-paren">(</span><em>context</em>, <em>resources</em>, <em>quota_class</em>, <em>defaults=True</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">get_default</code><span class="sig-paren">(</span><em>context</em>, <em>resource</em>, <em>parent_project_id=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">get_defaults</code><span class="sig-paren">(</span><em>context</em>, <em>resources</em>, <em>parent_project_id=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">get_project_quotas</code><span class="sig-paren">(</span><em>context</em>, <em>resources</em>, <em>project_id</em>, <em>quota_class=None</em>, <em>defaults=True</em>, <em>usages=True</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">limit_check</code><span class="sig-paren">(</span><em>context</em>, <em>resources</em>, <em>values</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">reserve</code><span class="sig-paren">(</span><em>context</em>, <em>resources</em>, <em>deltas</em>, <em>expire=None</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">rollback</code><span class="sig-paren">(</span><em>context</em>, <em>reservations</em>, <em>project_id=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">FakeSession</code></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<dl class="method">
<dt>
<code class="descname">begin</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">query</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">FakeUsage</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.db.sqlalchemy.models.html#cinder.db.sqlalchemy.models.QuotaUsage" title="cinder.db.sqlalchemy.models.QuotaUsage"><code class="xref py py-class docutils literal"><span class="pre">cinder.db.sqlalchemy.models.QuotaUsage</span></code></a></p>
<dl class="attribute">
<dt>
<code class="descname">created_at</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">deleted</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">deleted_at</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">id</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">in_use</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">project_id</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">reserved</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">resource</code></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">save</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">until_refresh</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">updated_at</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">NestedDbQuotaDriverBaseTestCase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">cinder.tests.unit.test_quota.DbQuotaDriverBaseTestCase</span></code></p>
<dl class="method">
<dt>
<code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">NestedDbQuotaDriverTestCase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">cinder.tests.unit.test_quota.NestedDbQuotaDriverBaseTestCase</span></code></p>
<dl class="method">
<dt>
<code class="descname">test_get_defaults</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_subproject_quotas</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_subproject_enforce_defaults</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">NestedQuotaValidation</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">cinder.tests.unit.test_quota.NestedDbQuotaDriverBaseTestCase</span></code></p>
<dl class="method">
<dt>
<code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_cur_project_allocated</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_validate_nested_quota_bad_allocated_quotas</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_validate_nested_quota_negative_child_limits</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_validate_nested_quotas</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_validate_nested_quotas_usage_over_limit</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">QuotaEngineTestCase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.test.html#cinder.test.TestCase" title="cinder.test.TestCase"><code class="xref py py-class docutils literal"><span class="pre">cinder.test.TestCase</span></code></a></p>
<dl class="method">
<dt>
<code class="descname">test_commit</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_count</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_count_no_resource</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_count_wrong_resource</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_destroy_by_project</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_expire</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_by_class</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_by_project</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_class_quotas</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_defaults</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_project_quotas</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_get_subproject_quotas</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_init</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_init_override_obj</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_init_override_string</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_limit_check</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_register_resource</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_register_resources</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_reserve</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_resource_names</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_rollback</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">QuotaIntegrationTestCase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.test.html#cinder.test.TestCase" title="cinder.test.TestCase"><code class="xref py py-class docutils literal"><span class="pre">cinder.test.TestCase</span></code></a></p>
<dl class="method">
<dt>
<code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_backup_gb_quota_flag</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_no_snapshot_gb_quota_flag</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_too_many_backups</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_too_many_combined_backup_gigabytes</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_too_many_combined_gigabytes</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_too_many_gigabytes</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_too_many_gigabytes_of_type</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_too_many_snapshots_of_type</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_too_many_volumes</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_too_many_volumes_of_type</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_volume_size_limit_exceeds</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">QuotaReserveSqlAlchemyTestCase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.test.html#cinder.test.TestCase" title="cinder.test.TestCase"><code class="xref py py-class docutils literal"><span class="pre">cinder.test.TestCase</span></code></a></p>
<dl class="method">
<dt>
<code class="descname">compare_reservation</code><span class="sig-paren">(</span><em>reservations</em>, <em>expected</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">compare_usage</code><span class="sig-paren">(</span><em>usage_dict</em>, <em>expected</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">init_usage</code><span class="sig-paren">(</span><em>project_id</em>, <em>resource</em>, <em>in_use</em>, <em>reserved</em>, <em>until_refresh=None</em>, <em>created_at=None</em>, <em>updated_at=None</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_reserve_create_usages</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_reserve_max_age</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_reserve_max_age_negative</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_reserve_negative_in_use</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_reserve_no_refresh</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_reserve_overs</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_reserve_reduction</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_reserve_unders</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_reserve_until_refresh</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_quota_reserve_with_allocated</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">QuotaVolumeTypeReservationTestCase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.test.html#cinder.test.TestCase" title="cinder.test.TestCase"><code class="xref py py-class docutils literal"><span class="pre">cinder.test.TestCase</span></code></a></p>
<dl class="method">
<dt>
<code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_volume_type_reservation</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_volume_type_reservation_with_type_only</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">VolumeTypeQuotaEngineTestCase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.test.html#cinder.test.TestCase" title="cinder.test.TestCase"><code class="xref py py-class docutils literal"><span class="pre">cinder.test.TestCase</span></code></a></p>
<dl class="method">
<dt>
<code class="descname">test_default_resources</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_update_quota_resource</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descname">test_volume_type_resources</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descname">VolumeTypeResourceTestCase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.test.html#cinder.test.TestCase" title="cinder.test.TestCase"><code class="xref py py-class docutils literal"><span class="pre">cinder.test.TestCase</span></code></a></p>
<dl class="method">
<dt>
<code class="descname">test_name_and_flag</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="the-test-quota-utils-module">
<h2>The <code class="xref py py-mod docutils literal"><span class="pre">test_quota_utils</span></code> Module<a class="headerlink" href="#the-test-quota-utils-module" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt>
<em class="property">class </em><code class="descname">QuotaUtilsTest</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <a class="reference internal" href="../api/cinder.test.html#cinder.test.TestCase" title="cinder.test.TestCase"><code class="xref py py-class docutils literal"><span class="pre">cinder.test.TestCase</span></code></a></p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descname">FakeProject</code><span class="sig-paren">(</span><em>id='foo'</em>, <em>parent_id=None</em><span class="sig-paren">)</span></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
</dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test__filter_domain_id_from_parents_domain_as_grandparent</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test__filter_domain_id_from_parents_domain_as_parent</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test__filter_domain_id_from_parents_no_domain_in_parents</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test__filter_domain_id_from_parents_no_parents</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_backup_gigabytes_exceed_quota</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_backup_limit_quota</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_get_project_keystoneclient_v2</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_get_project_keystoneclient_v3</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_get_project_keystoneclient_v3_with_subtree</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_groups_limit_quota</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_keystone_client_instantiation</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_snapshot_limit_exceed_quota</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_unknown_quota</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_unknown_quota2</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_validate_nested_projects_non_cloud_admin</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_validate_nested_projects_with_keystone_v2</code><span class="sig-paren">(</span><em>*args</em>, <em>**keywargs</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_volume_size_exceed_quota</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="method">
<dt>
<code class="descclassname">QuotaUtilsTest.</code><code class="descname">test_volumes_limit_quota</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

<div class="section" id="legacy-docs">
<h3>Legacy Docs<a class="headerlink" href="#legacy-docs" title="Permalink to this headline">¶</a></h3>
<p>Cinder provides RBAC (Role-based access control) of the AWS-type APIs. We define the following roles:</p>
<p>Roles-Based Access Control of AWS-style APIs using SAML Assertions
“Achieving FIPS 199 Moderate certification of a hybrid cloud environment using CloudAudit and declarative C.I.A. classifications”</p>
</div>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>We will investigate one method for integrating an AWS-style API with US eAuthentication-compatible federated authentication systems, to achieve access controls and limits based on traditional operational roles.
Additionally, we will look at how combining this approach, with an implementation of the CloudAudit APIs, will allow us to achieve a certification under FIPS 199 Moderate classification for a hybrid cloud environment.</p>
</div>
<div class="section" id="relationship-of-us-eauth-to-rbac">
<h3>Relationship of US eAuth to RBAC<a class="headerlink" href="#relationship-of-us-eauth-to-rbac" title="Permalink to this headline">¶</a></h3>
<p>Typical implementations of US eAuth authentication systems are structured as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[ MS Active Directory or other federated LDAP user store ]
      --&gt; backends to…
[ SUN Identity Manager or other SAML Policy Controller ]
      --&gt; maps URLs to groups…
[ Apache Policy Agent in front of eAuth-secured Web Application ]
</pre></div>
</div>
<p>In more ideal implementations, the remainder of the application-specific account information is stored either in extended schema on the LDAP server itself, via the use of a translucent LDAP proxy, or in an independent datastore keyed off of the UID provided via SAML assertion.</p>
</div>
<div class="section" id="roles">
<span id="auth-roles"></span><h3>Roles<a class="headerlink" href="#roles" title="Permalink to this headline">¶</a></h3>
<p>AWS API calls are traditionally secured via Access and Secret Keys, which are used to sign API calls, along with traditional timestamps to prevent replay attacks. The APIs can be logically grouped into sets that align with five typical roles:</p>
<ul class="simple">
<li>Base User</li>
<li>System Administrator/Developer (currently have the same permissions)</li>
<li>Network Administrator</li>
<li>Project Manager</li>
<li>Cloud Administrator/IT-Security (currently have the same permissions)</li>
</ul>
<p>There is an additional, conceptual end-user that may or may not have API access:</p>
<ul class="simple">
<li>(EXTERNAL) End-user / Third-party User</li>
</ul>
<p>Basic operations are available to any :</p>
<ul class="simple">
<li>Describe Instances</li>
<li>Describe Images</li>
<li>Describe Volumes</li>
<li>Describe Keypairs</li>
<li>Create Keypair</li>
<li>Delete Keypair</li>
<li>Create, Upload, Delete: Buckets and Keys (Object Store)</li>
</ul>
<p>System Administrators/Developers/Project Manager:</p>
<ul class="simple">
<li>Create, Attach, Delete Volume (Block Store)</li>
<li>Launch, Reboot, Terminate Instance</li>
<li>Register/Unregister Machine Image (project-wide)</li>
<li>Request / Review CloudAudit Scans</li>
</ul>
<p>Project Manager:</p>
<ul class="simple">
<li>Add and remove other users (currently no api)</li>
<li>Set roles (currently no api)</li>
</ul>
<p>Network Administrator:</p>
<ul class="simple">
<li>Change Machine Image properties (public / private)</li>
<li>Change Firewall Rules, define Security Groups</li>
<li>Allocate, Associate, Deassociate Public IP addresses</li>
</ul>
<p>Cloud Administrator/IT-Security:</p>
<ul class="simple">
<li>All permissions</li>
</ul>
</div>
<div class="section" id="enhancements">
<h3>Enhancements<a class="headerlink" href="#enhancements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>SAML Token passing</li>
<li>REST interfaces</li>
<li>SOAP interfaces</li>
</ul>
<p>Wrapping the SAML token into the API calls.
Then store the UID (fetched via backchannel) into the instance metadata, providing end-to-end auditability of ownership and responsibility, without PII.</p>
</div>
<div class="section" id="cloudaudit-apis">
<h3>CloudAudit APIs<a class="headerlink" href="#cloudaudit-apis" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Request formats</li>
<li>Response formats</li>
<li>Stateless asynchronous queries</li>
</ul>
<p>CloudAudit queries may spawn long-running processes (similar to launching instances, etc.) They need to return a ReservationId in the same fashion, which can be returned in further queries for updates.
RBAC of CloudAudit API calls is critical, since detailed system information is a system vulnerability.</p>
</div>
<div class="section" id="type-declarations">
<h3>Type declarations<a class="headerlink" href="#type-declarations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Data declarations – Volumes and Objects</li>
<li>System declarations – Instances</li>
</ul>
<p>Existing API calls to launch instances specific a single, combined “type” flag. We propose to extend this with three additional type declarations, mapping to the “Confidentiality, Integrity, Availability” classifications of FIPS 199. An example API call would look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>RunInstances type=m1.large number=1 secgroup=default key=mykey confidentiality=low integrity=low availability=low
</pre></div>
</div>
<p>These additional parameters would also apply to creation of block storage volumes (along with the existing parameter of ‘size’), and creation of object storage ‘buckets’. (C.I.A. classifications on a bucket would be inherited by the keys within this bucket.)</p>
</div>
<div class="section" id="request-brokering">
<h3>Request Brokering<a class="headerlink" href="#request-brokering" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Cloud Interop</li>
<li>IMF Registration / PubSub</li>
<li>Digital C&amp;A</li>
</ul>
<p>Establishing declarative semantics for individual API calls will allow the cloud environment to seamlessly proxy these API calls to external, third-party vendors – when the requested CIA levels match.</p>
<p>See related work within the Infrastructure 2.0 working group for more information on how the IMF Metadata specification could be utilized to manage registration of these vendors and their C&amp;A credentials.</p>
</div>
<div class="section" id="dirty-cloud-hybrid-data-centers">
<h3>Dirty Cloud - Hybrid Data Centers<a class="headerlink" href="#dirty-cloud-hybrid-data-centers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>CloudAudit bridge interfaces</li>
<li>Anything in the ARP table</li>
</ul>
<p>A hybrid cloud environment provides dedicated, potentially co-located physical hardware with a network interconnect to the project or users’ cloud virtual network.</p>
<p>This interconnect is typically a bridged VPN connection. Any machines that can be bridged into a hybrid environment in this fashion (at Layer 2) must implement a minimum version of the CloudAudit spec, such that they can be queried to provide a complete picture of the IT-sec runtime environment.</p>
<p>Network discovery protocols (ARP, CDP) can be applied in this case, and existing protocols (SNMP location data, DNS LOC records) overloaded to provide CloudAudit information.</p>
</div>
<div class="section" id="the-details">
<h3>The Details<a class="headerlink" href="#the-details" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Preliminary Roles Definitions</li>
<li>Categorization of available API calls</li>
<li>SAML assertion vocabulary</li>
</ul>
</div>
<div class="section" id="system-limits">
<h3>System limits<a class="headerlink" href="#system-limits" title="Permalink to this headline">¶</a></h3>
<p>The following limits need to be defined and enforced:</p>
<ul class="simple">
<li>Total number of instances allowed (user / project)</li>
<li>Total number of instances, per instance type (user / project)</li>
<li>Total number of volumes (user / project)</li>
<li>Maximum size of volume</li>
<li>Cumulative size of all volumes</li>
<li>Total use of object storage (GB)</li>
<li>Total number of Public IPs</li>
</ul>
</div>
<div class="section" id="further-challenges">
<h3>Further Challenges<a class="headerlink" href="#further-challenges" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Prioritization of users / jobs in shared computing environments</li>
<li>Incident response planning</li>
<li>Limit launch of instances to specific security groups based on AMI</li>
<li>Store AMIs in LDAP for added property control</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Authentication and Authorization</a><ul>
<li><a class="reference internal" href="#the-cinder-api-middleware-auth-module">The <code class="docutils literal"><span class="pre">cinder.api.middleware.auth</span></code> Module</a></li>
<li><a class="reference internal" href="#the-cinder-quota-module">The <code class="docutils literal"><span class="pre">cinder.quota</span></code> Module</a><ul>
<li><a class="reference internal" href="#tests">Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-middleware-test-auth-module">The <code class="docutils literal"><span class="pre">middleware.test_auth</span></code> Module</a></li>
<li><a class="reference internal" href="#the-test-quota-module">The <code class="docutils literal"><span class="pre">test_quota</span></code> Module</a></li>
<li><a class="reference internal" href="#the-test-quota-utils-module">The <code class="docutils literal"><span class="pre">test_quota_utils</span></code> Module</a><ul>
<li><a class="reference internal" href="#legacy-docs">Legacy Docs</a></li>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#relationship-of-us-eauth-to-rbac">Relationship of US eAuth to RBAC</a></li>
<li><a class="reference internal" href="#roles">Roles</a></li>
<li><a class="reference internal" href="#enhancements">Enhancements</a></li>
<li><a class="reference internal" href="#cloudaudit-apis">CloudAudit APIs</a></li>
<li><a class="reference internal" href="#type-declarations">Type declarations</a></li>
<li><a class="reference internal" href="#request-brokering">Request Brokering</a></li>
<li><a class="reference internal" href="#dirty-cloud-hybrid-data-centers">Dirty Cloud - Hybrid Data Centers</a></li>
<li><a class="reference internal" href="#the-details">The Details</a></li>
<li><a class="reference internal" href="#system-limits">System limits</a></li>
<li><a class="reference internal" href="#further-challenges">Further Challenges</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="volume.html"
                                  title="previous chapter">Storage Volumes, Disks</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="api.html"
                                  title="next chapter">API Endpoint</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/cinder
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/devref/auth.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Endpoint"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="volume.html" title="Storage Volumes, Disks"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">cinder 10.0.0.0rc2.dev77 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Developer Guide</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2010-present, OpenStack Foundation.
      Last updated on Tue Feb 14 19:31:55 2017, commit e7efdb6.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/cinder");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>