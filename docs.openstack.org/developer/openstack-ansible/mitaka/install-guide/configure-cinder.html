<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuring the Block (cinder) storage service (optional) &mdash; OpenStack-Ansible 13.3.14.dev3 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '13.3.14.dev3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OpenStack-Ansible 13.3.14.dev3 documentation" href="../index.html" />
    <link rel="up" title="Chapter 4. Deployment configuration" href="configure.html" />
    <link rel="next" title="Configuring the Object Storage (swift) service (optional)" href="configure-swift.html" />
    <link rel="prev" title="Configuring the Image (glance) service" href="configure-glance.html" /> 
  </head>
  <body>
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <p><a class="reference external" href="index.html">Home</a> OpenStack-Ansible Installation Guide</p>
<div class="section" id="configuring-the-block-cinder-storage-service-optional">
<h1>Configuring the Block (cinder) storage service (optional)<a class="headerlink" href="#configuring-the-block-cinder-storage-service-optional" title="Permalink to this headline">¶</a></h1>
<p>By default, the Block (cinder) storage service installs on the host itself using
the LVM backend.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While this is the default for cinder, using the LVM backend results in a
Single Point of Failure. As a result of the volume service being deployed
directly to the host, <tt class="docutils literal"><span class="pre">is_metal</span></tt> is <tt class="docutils literal"><span class="pre">true</span></tt> when using LVM.</p>
</div>
<div class="section" id="nfs-backend">
<h2>NFS backend<a class="headerlink" href="#nfs-backend" title="Permalink to this headline">¶</a></h2>
<p>Edit <tt class="docutils literal"><span class="pre">/etc/openstack_deploy/openstack_user_config.yml</span></tt> and configure
the NFS client on each storage node if the NetApp backend is configured to use
an NFS storage protocol.</p>
<ol class="arabic">
<li><p class="first">Add the <tt class="docutils literal"><span class="pre">cinder_backends</span></tt> stanza (which includes
<tt class="docutils literal"><span class="pre">cinder_nfs_client</span></tt>) under the <tt class="docutils literal"><span class="pre">container_vars</span></tt> stanza for
each storage node:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">container_vars</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">cinder_backends</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">cinder_nfs_client</span><span class="p p-Indicator">:</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the location of the file that lists shares available to the
block storage service. This configuration file must include
<tt class="docutils literal"><span class="pre">nfs_shares_config</span></tt>:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nfs_shares_config</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">SHARE_CONFIG</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">SHARE_CONFIG</span></tt> with the location of the share
configuration file. For example, <tt class="docutils literal"><span class="pre">/etc/cinder/nfs_shares</span></tt>.</p>
</li>
<li><p class="first">Configure one or more NFS shares:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">shares</span><span class="p p-Indicator">:</span>
   <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">ip</span><span class="p p-Indicator">:</span> <span class="s">&quot;NFS_HOST&quot;</span><span class="p p-Indicator">,</span> <span class="nv">share</span><span class="p p-Indicator">:</span> <span class="s">&quot;NFS_SHARE&quot;</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">NFS_HOST</span></tt> with the IP address or hostname of the NFS
server, and the <tt class="docutils literal"><span class="pre">NFS_SHARE</span></tt> with the absolute path to an existing
and accessible NFS share.</p>
</li>
</ol>
</div>
<div class="section" id="backup">
<h2>Backup<a class="headerlink" href="#backup" title="Permalink to this headline">¶</a></h2>
<p>You can configure cinder to backup volumes to Object
Storage (swift). Enable the default
configuration to back up volumes to a swift installation
accessible within your environment. Alternatively, you can set
<tt class="docutils literal"><span class="pre">cinder_service_backup_swift_url</span></tt> and other variables to
back up to an external swift installation.</p>
<ol class="arabic">
<li><p class="first">Add or edit the following line in the
<tt class="docutils literal"><span class="pre">/etc/openstack_deploy/user_variables.yml</span></tt> file and set the value
to <tt class="docutils literal"><span class="pre">True</span></tt>:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_program_enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
</li>
<li><p class="first">By default, cinder uses the access credentials of the user
initiating the backup. Default values are set in the
<tt class="docutils literal"><span class="pre">/opt/openstack-ansible/playbooks/roles/os_cinder/defaults/main.yml</span></tt>
file. You can override those defaults by setting variables in
<tt class="docutils literal"><span class="pre">/etc/openstack_deploy/user_variables.yml</span></tt> to change how cinder
performs backups. Add and edit any of the
following variables to the
<tt class="docutils literal"><span class="pre">/etc/openstack_deploy/user_variables.yml</span></tt> file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">...</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_swift_auth</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">per_user</span>
<span class="c1"># Options include &#39;per_user&#39; or &#39;single_user&#39;. We default to</span>
<span class="c1"># &#39;per_user&#39; so that backups are saved to a user&#39;s swift</span>
<span class="c1"># account.</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_swift_url</span><span class="p p-Indicator">:</span>
<span class="c1"># This is your swift storage url when using &#39;per_user&#39;, or keystone</span>
<span class="c1"># endpoint when using &#39;single_user&#39;.  When using &#39;per_user&#39;, you</span>
<span class="c1"># can leave this as empty or as None to allow cinder-backup to</span>
<span class="c1"># obtain a storage url from environment.</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_swift_url</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_swift_auth_version</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_swift_user</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_swift_tenant</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_swift_key</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_swift_container</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">volumebackups</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_swift_object_size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">52428800</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_swift_retry_attempts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_swift_retry_backoff</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_compression_algorithm</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">zlib</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_metadata_version</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
</pre></div>
</div>
</li>
</ol>
<p>During installation of cinder, the backup service is configured.</p>
</div>
<div class="section" id="using-ceph-for-cinder-backups">
<h2>Using Ceph for cinder backups<a class="headerlink" href="#using-ceph-for-cinder-backups" title="Permalink to this headline">¶</a></h2>
<p>You can deploy Ceph to hold cinder volume backups.
To get started, set the <tt class="docutils literal"><span class="pre">cinder_service_backup_driver</span></tt> Ansible
variable:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder.backup.drivers.ceph</span>
</pre></div>
</div>
<p>Configure the Ceph user and the pool to use for backups. The defaults
are shown here:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_ceph_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder-backup</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_service_backup_ceph_pool</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">backups</span>
</pre></div>
</div>
</div>
<div class="section" id="availability-zones">
<h2>Availability zones<a class="headerlink" href="#availability-zones" title="Permalink to this headline">¶</a></h2>
<p>Create multiple availability zones to manage cinder storage hosts. Edit the
<tt class="docutils literal"><span class="pre">/etc/openstack_deploy/openstack_user_config.yml</span></tt> and
<tt class="docutils literal"><span class="pre">/etc/openstack_deploy/user_variables.yml</span></tt> files to set up
availability zones.</p>
<ol class="arabic">
<li><p class="first">For each cinder storage host, configure the availability zone under
the <tt class="docutils literal"><span class="pre">container_vars</span></tt> stanza:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">cinder_storage_availability_zone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">CINDERAZ</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">CINDERAZ</span></tt> with a suitable name. For example
<tt class="docutils literal"><span class="pre">cinderAZ_2</span></tt>.</p>
</li>
<li><p class="first">If more than one availability zone is created, configure the default
availability zone for all the hosts by creating a
<tt class="docutils literal"><span class="pre">cinder_default_availability_zone</span></tt> in your
<tt class="docutils literal"><span class="pre">/etc/openstack_deploy/user_variables.yml</span></tt></p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">cinder_default_availability_zone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">CINDERAZ_DEFAULT</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">CINDERAZ_DEFAULT</span></tt> with a suitable name. For example,
<tt class="docutils literal"><span class="pre">cinderAZ_1</span></tt>. The default availability zone should be the same
for all cinder hosts.</p>
</li>
</ol>
</div>
<div class="section" id="openstack-dashboard-horizon-configuration-for-cinder">
<h2>OpenStack Dashboard (horizon) configuration for cinder<a class="headerlink" href="#openstack-dashboard-horizon-configuration-for-cinder" title="Permalink to this headline">¶</a></h2>
<p>You can configure variables to set the behavior for cinder
volume management in OpenStack Dashboard (horizon).
By default, no horizon configuration is set.</p>
<ol class="arabic simple">
<li>The default destination availability zone is <tt class="docutils literal"><span class="pre">nova</span></tt> if you use
multiple availability zones and <tt class="docutils literal"><span class="pre">cinder_default_availability_zone</span></tt>
has no definition.  Volume creation with
horizon might fail if there is no availability zone named <tt class="docutils literal"><span class="pre">nova</span></tt>.
Set <tt class="docutils literal"><span class="pre">cinder_default_availability_zone</span></tt> to an appropriate
availability zone name so that <em class="guilabel">Any availability zone</em>
works in horizon.</li>
<li>horizon does not populate the volume type by default. On the new
volume page, a request for the creation of a volume with the
default parameters fails. Set <tt class="docutils literal"><span class="pre">cinder_default_volume_type</span></tt> so
that a volume creation request without an explicit volume type
succeeds.</li>
</ol>
</div>
<div class="section" id="configuring-cinder-to-use-lvm">
<h2>Configuring cinder to use LVM<a class="headerlink" href="#configuring-cinder-to-use-lvm" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">List the <tt class="docutils literal"><span class="pre">container_vars</span></tt> that contain the storage options for the target host.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The vars related to the cinder availability zone and the
<tt class="docutils literal"><span class="pre">limit_container_types</span></tt> are optional.</p>
</div>
<p>To configure an LVM, utilize the following example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">storage_hosts</span><span class="p p-Indicator">:</span>
 <span class="l l-Scalar l-Scalar-Plain">Infra01</span><span class="p p-Indicator">:</span>
   <span class="l l-Scalar l-Scalar-Plain">ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">172.29.236.16</span>
   <span class="l l-Scalar l-Scalar-Plain">container_vars</span><span class="p p-Indicator">:</span>
     <span class="l l-Scalar l-Scalar-Plain">cinder_storage_availability_zone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinderAZ_1</span>
     <span class="l l-Scalar l-Scalar-Plain">cinder_default_availability_zone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinderAZ_1</span>
     <span class="l l-Scalar l-Scalar-Plain">cinder_backends</span><span class="p p-Indicator">:</span>
       <span class="l l-Scalar l-Scalar-Plain">lvm</span><span class="p p-Indicator">:</span>
         <span class="l l-Scalar l-Scalar-Plain">volume_backend_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">LVM_iSCSI</span>
         <span class="l l-Scalar l-Scalar-Plain">volume_driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder.volume.drivers.lvm.LVMVolumeDriver</span>
         <span class="l l-Scalar l-Scalar-Plain">volume_group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder-volumes</span>
         <span class="l l-Scalar l-Scalar-Plain">iscsi_ip_address</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">storage_address</span><span class="nv"> </span><span class="s">}}&quot;</span>
       <span class="l l-Scalar l-Scalar-Plain">limit_container_types</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder_volume</span>
</pre></div>
</div>
</li>
</ol>
<p>To use another backend in a
container instead of bare metal, edit
the <tt class="docutils literal"><span class="pre">/etc/openstack_deploy/env.d/cinder.yml</span></tt> and remove the
<tt class="docutils literal"><span class="pre">is_metal:</span> <span class="pre">true</span></tt> stanza under the <tt class="docutils literal"><span class="pre">cinder_volumes_container</span></tt> properties.</p>
</div>
<div class="section" id="configuring-cinder-to-use-ceph">
<h2>Configuring cinder to use Ceph<a class="headerlink" href="#configuring-cinder-to-use-ceph" title="Permalink to this headline">¶</a></h2>
<p>In order for cinder to use Ceph, it is necessary to configure for both
the API and backend. When using any forms of network storage
(iSCSI, NFS, Ceph) for cinder, the API containers can be considered
as backend servers. A separate storage host is not required.</p>
<p>In <tt class="docutils literal"><span class="pre">env.d/cinder.yml</span></tt> remove <tt class="docutils literal"><span class="pre">is_metal:</span> <span class="pre">true</span></tt></p>
<ol class="arabic">
<li><p class="first">List of target hosts on which to deploy the cinder API. We recommend
that a minumum of three target hosts are used for this service.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">storage-infra_hosts</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">infra1</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">172.29.236.101</span>
  <span class="l l-Scalar l-Scalar-Plain">infra2</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">172.29.236.102</span>
  <span class="l l-Scalar l-Scalar-Plain">infra3</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">172.29.236.103</span>
</pre></div>
</div>
<p>To configure an RBD backend, utilize the following example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">container_vars</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_storage_availability_zone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinderAZ_3</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_default_availability_zone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinderAZ_1</span>
<span class="l l-Scalar l-Scalar-Plain">cinder_backends</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">limit_container_types</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder_volume</span>
  <span class="l l-Scalar l-Scalar-Plain">volumes_hdd</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">volume_driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder.volume.drivers.rbd.RBDDriver</span>
    <span class="l l-Scalar l-Scalar-Plain">rbd_pool</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">volumes_hdd</span>
    <span class="l l-Scalar l-Scalar-Plain">rbd_ceph_conf</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/ceph/ceph.conf</span>
    <span class="l l-Scalar l-Scalar-Plain">rbd_flatten_volume_from_snapshot</span><span class="p p-Indicator">:</span> <span class="s">&#39;false&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">rbd_max_clone_depth</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
    <span class="l l-Scalar l-Scalar-Plain">rbd_store_chunk_size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="l l-Scalar l-Scalar-Plain">rados_connect_timeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">-1</span>
    <span class="l l-Scalar l-Scalar-Plain">volume_backend_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">volumes_hdd</span>
    <span class="l l-Scalar l-Scalar-Plain">rbd_user</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">cinder_ceph_client</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">rbd_secret_uuid</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">cinder_ceph_client_uuid</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</li>
</ol>
<p>The following example sets cinder to use the <tt class="docutils literal"><span class="pre">cinder_volumes</span></tt> pool.
The example uses cephx authentication and requires existing <tt class="docutils literal"><span class="pre">cinder</span></tt>
account for <tt class="docutils literal"><span class="pre">cinder_volumes</span></tt> pool.</p>
<p>In <tt class="docutils literal"><span class="pre">user_variables.yml</span></tt>:</p>
<blockquote>
<div><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ceph_mons</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">172.29.244.151</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">172.29.244.152</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">172.29.244.153</span>
</pre></div>
</div>
</div></blockquote>
<p>In <tt class="docutils literal"><span class="pre">openstack_user_config.yml</span></tt>:</p>
<blockquote>
<div><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">storage_hosts</span><span class="p p-Indicator">:</span>
 <span class="l l-Scalar l-Scalar-Plain">infra1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">172.29.236.101</span>
  <span class="l l-Scalar l-Scalar-Plain">container_vars</span><span class="p p-Indicator">:</span>
   <span class="l l-Scalar l-Scalar-Plain">cinder_backends</span><span class="p p-Indicator">:</span>
     <span class="l l-Scalar l-Scalar-Plain">limit_container_types</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder_volume</span>
     <span class="l l-Scalar l-Scalar-Plain">rbd</span><span class="p p-Indicator">:</span>
       <span class="l l-Scalar l-Scalar-Plain">volume_group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder-volumes</span>
       <span class="l l-Scalar l-Scalar-Plain">volume_driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder.volume.drivers.rbd.RBDDriver</span>
       <span class="l l-Scalar l-Scalar-Plain">volume_backend_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rbd</span>
       <span class="l l-Scalar l-Scalar-Plain">rbd_pool</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder-volumes</span>
       <span class="l l-Scalar l-Scalar-Plain">rbd_ceph_conf</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/ceph/ceph.conf</span>
       <span class="l l-Scalar l-Scalar-Plain">rbd_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder</span>
 <span class="l l-Scalar l-Scalar-Plain">infra2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">172.29.236.102</span>
  <span class="l l-Scalar l-Scalar-Plain">container_vars</span><span class="p p-Indicator">:</span>
   <span class="l l-Scalar l-Scalar-Plain">cinder_backends</span><span class="p p-Indicator">:</span>
     <span class="l l-Scalar l-Scalar-Plain">limit_container_types</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder_volume</span>
     <span class="l l-Scalar l-Scalar-Plain">rbd</span><span class="p p-Indicator">:</span>
       <span class="l l-Scalar l-Scalar-Plain">volume_group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder-volumes</span>
       <span class="l l-Scalar l-Scalar-Plain">volume_driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder.volume.drivers.rbd.RBDDriver</span>
       <span class="l l-Scalar l-Scalar-Plain">volume_backend_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rbd</span>
       <span class="l l-Scalar l-Scalar-Plain">rbd_pool</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder-volumes</span>
       <span class="l l-Scalar l-Scalar-Plain">rbd_ceph_conf</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/ceph/ceph.conf</span>
       <span class="l l-Scalar l-Scalar-Plain">rbd_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder</span>
 <span class="l l-Scalar l-Scalar-Plain">infra3</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">172.29.236.103</span>
  <span class="l l-Scalar l-Scalar-Plain">container_vars</span><span class="p p-Indicator">:</span>
   <span class="l l-Scalar l-Scalar-Plain">cinder_backends</span><span class="p p-Indicator">:</span>
     <span class="l l-Scalar l-Scalar-Plain">limit_container_types</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder_volume</span>
     <span class="l l-Scalar l-Scalar-Plain">rbd</span><span class="p p-Indicator">:</span>
       <span class="l l-Scalar l-Scalar-Plain">volume_group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder-volumes</span>
       <span class="l l-Scalar l-Scalar-Plain">volume_driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder.volume.drivers.rbd.RBDDriver</span>
       <span class="l l-Scalar l-Scalar-Plain">volume_backend_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rbd</span>
       <span class="l l-Scalar l-Scalar-Plain">rbd_pool</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder-volumes</span>
       <span class="l l-Scalar l-Scalar-Plain">rbd_ceph_conf</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/ceph/ceph.conf</span>
       <span class="l l-Scalar l-Scalar-Plain">rbd_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder</span>
</pre></div>
</div>
</div></blockquote>
<p>This link provides a complete working example of Ceph setup and
integration with cinder (nova and glance included):</p>
<ul class="simple">
<li><a class="reference external" href="https://www.openstackfaq.com/openstack-ansible-ceph/">OpenStack-Ansible and Ceph Working Example</a></li>
</ul>
</div>
<div class="section" id="configuring-cinder-to-use-a-netapp-appliance">
<h2>Configuring cinder to use a NetApp appliance<a class="headerlink" href="#configuring-cinder-to-use-a-netapp-appliance" title="Permalink to this headline">¶</a></h2>
<p>To use a NetApp storage appliance back end, edit the
<tt class="docutils literal"><span class="pre">/etc/openstack_deploy/openstack_user_config.yml</span></tt> file and configure
each storage node that will use it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ensure that the NAS Team enables <tt class="docutils literal"><span class="pre">httpd.admin.access</span></tt>.</p>
</div>
<ol class="arabic">
<li><p class="first">Add the <tt class="docutils literal"><span class="pre">netapp</span></tt> stanza under the <tt class="docutils literal"><span class="pre">cinder_backends</span></tt> stanza for
each storage node:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">cinder_backends</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">netapp</span><span class="p p-Indicator">:</span>
</pre></div>
</div>
<p>The options in subsequent steps fit under the <tt class="docutils literal"><span class="pre">netapp</span></tt> stanza.</p>
<p>The backend name is arbitrary and becomes a volume type within cinder.</p>
</li>
<li><p class="first">Configure the storage family:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">netapp_storage_family</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">STORAGE_FAMILY</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">STORAGE_FAMILY</span></tt> with <tt class="docutils literal"><span class="pre">ontap_7mode</span></tt> for Data ONTAP
operating in 7-mode or <tt class="docutils literal"><span class="pre">ontap_cluster</span></tt> for Data ONTAP operating as
a cluster.</p>
</li>
<li><p class="first">Configure the storage protocol:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">netapp_storage_protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">STORAGE_PROTOCOL</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">STORAGE_PROTOCOL</span></tt> with <tt class="docutils literal"><span class="pre">iscsi</span></tt> for iSCSI or <tt class="docutils literal"><span class="pre">nfs</span></tt>
for NFS.</p>
<p>For the NFS protocol, specify the location of the
configuration file that lists the shares available to cinder:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">nfs_shares_config</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">SHARE_CONFIG</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">SHARE_CONFIG</span></tt> with the location of the share
configuration file. For example, <tt class="docutils literal"><span class="pre">/etc/cinder/nfs_shares</span></tt>.</p>
</li>
<li><p class="first">Configure the server:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">netapp_server_hostname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">SERVER_HOSTNAME</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">SERVER_HOSTNAME</span></tt> with the hostnames for both netapp
controllers.</p>
</li>
<li><p class="first">Configure the server API port:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">netapp_server_port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">PORT_NUMBER</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">PORT_NUMBER</span></tt> with 80 for HTTP or 443 for HTTPS.</p>
</li>
<li><p class="first">Configure the server credentials:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">netapp_login</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">USER_NAME</span>
<span class="l l-Scalar l-Scalar-Plain">netapp_password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">PASSWORD</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">USER_NAME</span></tt> and <tt class="docutils literal"><span class="pre">PASSWORD</span></tt> with the appropriate
values.</p>
</li>
<li><p class="first">Select the NetApp driver:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">volume_driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder.volume.drivers.netapp.common.NetAppDriver</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the volume back end name:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">volume_backend_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">BACKEND_NAME</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">BACKEND_NAME</span></tt> with a value that provides a hint
for the cinder scheduler. For example, <tt class="docutils literal"><span class="pre">NETAPP_iSCSI</span></tt>.</p>
</li>
<li><p class="first">Ensure the <tt class="docutils literal"><span class="pre">openstack_user_config.yml</span></tt> configuration is
accurate:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">storage_hosts</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">Infra01</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">ip</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">172.29.236.16</span>
    <span class="l l-Scalar l-Scalar-Plain">container_vars</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">cinder_backends</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">limit_container_types</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder_volume</span>
        <span class="l l-Scalar l-Scalar-Plain">netapp</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">netapp_storage_family</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ontap_7mode</span>
          <span class="l l-Scalar l-Scalar-Plain">netapp_storage_protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nfs</span>
          <span class="l l-Scalar l-Scalar-Plain">netapp_server_hostname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">111.222.333.444</span>
          <span class="l l-Scalar l-Scalar-Plain">netapp_server_port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
          <span class="l l-Scalar l-Scalar-Plain">netapp_login</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">openstack_cinder</span>
          <span class="l l-Scalar l-Scalar-Plain">netapp_password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">password</span>
          <span class="l l-Scalar l-Scalar-Plain">volume_driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cinder.volume.drivers.netapp.common.NetAppDriver</span>
          <span class="l l-Scalar l-Scalar-Plain">volume_backend_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NETAPP_NFS</span>
</pre></div>
</div>
<p>For <tt class="docutils literal"><span class="pre">netapp_server_hostname</span></tt>, specify the IP address of the Data
ONTAP server. Include iSCSI or NFS for the
<tt class="docutils literal"><span class="pre">netapp_storage_family</span></tt> depending on the configuration. Add 80 if
using HTTP or 443 if using HTTPS for <tt class="docutils literal"><span class="pre">netapp_server_port</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">cinder-volume.yml</span></tt> playbook will automatically install the
<tt class="docutils literal"><span class="pre">nfs-common</span></tt> file across the hosts, transitioning from an LVM to a
NetApp back end.</p>
</li>
</ol>
<hr class="docutils" />
<ul class="simple">
<li><a class="reference external" href="../index.html">Documentation Home</a></li>
<li><a class="reference external" href="index.html">Installation Guide</a></li>
<li><a class="reference external" href="../upgrade-guide/index.html">Upgrade Guide</a></li>
<li><a class="reference external" href="../developer-docs/index.html">Developer Documentation</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Configuring the Block (cinder) storage service (optional)</a><ul>
<li><a class="reference internal" href="#nfs-backend">NFS backend</a></li>
<li><a class="reference internal" href="#backup">Backup</a></li>
<li><a class="reference internal" href="#using-ceph-for-cinder-backups">Using Ceph for cinder backups</a></li>
<li><a class="reference internal" href="#availability-zones">Availability zones</a></li>
<li><a class="reference internal" href="#openstack-dashboard-horizon-configuration-for-cinder">OpenStack Dashboard (horizon) configuration for cinder</a></li>
<li><a class="reference internal" href="#configuring-cinder-to-use-lvm">Configuring cinder to use LVM</a></li>
<li><a class="reference internal" href="#configuring-cinder-to-use-ceph">Configuring cinder to use Ceph</a></li>
<li><a class="reference internal" href="#configuring-cinder-to-use-a-netapp-appliance">Configuring cinder to use a NetApp appliance</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="configure-glance.html"
                                  title="previous chapter">Configuring the Image (glance) service</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="configure-swift.html"
                                  title="next chapter">Configuring the Object Storage (swift) service (optional)</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/openstack-ansible"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/install-guide/configure-cinder.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="configure-swift.html" title="Configuring the Object Storage (swift) service (optional)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="configure-glance.html" title="Configuring the Image (glance) service"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">OpenStack-Ansible 13.3.14.dev3 documentation</a> &raquo;</li>
          <li><a href="index.html" >OpenStack-Ansible Installation Guide</a> &raquo;</li>
          <li><a href="configure.html" accesskey="U">Chapter&nbsp;4.&nbsp;Deployment configuration</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2016, OpenStack-Ansible Contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/OpenStack-Ansible");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>