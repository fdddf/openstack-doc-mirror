<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Adding new Roles and Services</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../_static/css/combined.css" rel="stylesheet">
<link href="../_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="../_static/sphinxmark.css" type="text/css" />
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Adding new Roles and Services</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="role-services.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Roles and services"></i></a>
    
    
    <a href="../inventory/index.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Inventory"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2017-02-14 17:57</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Adding new Roles and Services</a><ul>
<li><a class="reference internal" href="#recommended-procedure-to-develop-a-role">Recommended procedure to develop a Role</a></li>
<li><a class="reference internal" href="#writing-the-role">Writing the Role</a></li>
<li><a class="reference internal" href="#deploying-the-role">Deploying the Role</a></li>
<li><a class="reference internal" href="#role-development-maturity">Role development maturity</a></li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="adding-new-roles-and-services">
<h1>Adding new Roles and Services<a class="headerlink" href="#adding-new-roles-and-services" title="Permalink to this headline">¶</a></h1>
<p>If you would like to contribute towards a role to introduce an OpenStack
service or an infrastructure service to support an OpenStack deployment, the
OpenStack-Ansible project would welcome that contribution and your assistance
in maintaining it.</p>
<div class="section" id="recommended-procedure-to-develop-a-role">
<h2>Recommended procedure to develop a Role<a class="headerlink" href="#recommended-procedure-to-develop-a-role" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Deploy OpenStack-Ansible (possibly using
<a class="reference external" href="quickstart-aio.html">an AIO</a>
deploy) so that you have the rest of an OpenStack cluster to integrate with
in your testing.</li>
<li>Deploy your service on another VM, or possibly directly on the AIO host, by
hand. Configure the service to coordinate with the OpenStack cluster
appropriately. When all the related systems are communicating with each
other you can use the resulting configuration as a reference later.</li>
<li>Develop a role for your service. A recommended process is detailed below.</li>
</ol>
</div>
<div class="section" id="writing-the-role">
<h2>Writing the Role<a class="headerlink" href="#writing-the-role" title="Permalink to this headline">¶</a></h2>
<p>Most OpenStack services will follow a common series of stages to install or
update a service deployment. This is apparent when you review <cite>tasks/main.yml</cite>
for existing roles.</p>
<ol class="arabic simple">
<li>pre-install: prepare the service user group and filesystem directory paths
on the host or container</li>
<li>install: install system packages, prepare the (optional) service virtual
environment, install service and requirements (into a virtual environment)</li>
<li>post-install: apply all configuration files</li>
<li>messaging and db setup: db user and database prepared, message queue vhost
and user prepared</li>
<li>service add: register the service (each of: service type, service project,
service user, and endpoints) within Keystone&#8217;s service catalog.</li>
<li>service setup: install a service-startup script (init, upstart, SystemD,
etc.) so that the service will start up when the container or host next
starts.</li>
<li>service init/startup: signal to the host or container to start the services</li>
</ol>
<p>There may be other specialized steps required by some services but most of the
roles will perform all of these at a minimum. Begin by reviewing a role for a
service that has something in common with your service and think about how you
can fit most of the common service setup and configuration steps into that
model.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Following the patterns you find in other roles can help ensure your role
is easier to use and maintain.</p>
</div>
<p>Steps to writing the role:</p>
<ol class="arabic">
<li><p class="first">You can review roles which may be currently in development by checking our
<a class="reference external" href="https://git.openstack.org/cgit/openstack/openstack-ansible-specs">specs repository</a> and <a class="reference external" href="https://review.openstack.org/#/q/status:+open+project:openstack/openstack-ansible-specs">unmerged specs</a> on review.openstack.org. If you
do not find a spec for the role, propose a blueprint/spec <a class="reference external" href="https://git.openstack.org/cgit/openstack/openstack-ansible-specs/tree/specs/templates/template.rst">(see also the
spec template)</a> outlining the new Role. By proposing a draft spec you can
help the OpenStack-Ansible community keep track of what roles are being
developed and perhaps connect you with others who may be interested and
able to help you in the process.</p>
</li>
<li><p class="first">Create a source repository (e.g. on Github) to start your work on the Role.</p>
</li>
<li><p class="first">Generate the reference directory structure for an Ansible role which is
the necessary subset of the documented <a class="reference external" href="https://docs.ansible.com/ansible/playbooks_best_practices.html#directory-layout">Best Practice</a>. You might use
Ansible Galaxy tools to do this for you (e.g. <code class="docutils literal"><span class="pre">ansible-galaxy</span> <span class="pre">init</span></code>).
You may additionally want to include directories such as <code class="docutils literal"><span class="pre">docs</span></code> and
<code class="docutils literal"><span class="pre">examples</span></code> and <code class="docutils literal"><span class="pre">tests</span></code> for your role.</p>
</li>
<li><p class="first">Generate a meta/main.yml right away. This file is important to Ansible to
ensure your dependent roles are installed and available and provides others
with the information they will need to understand the purpose of your role.</p>
</li>
<li><p class="first">Develop task files for each of the install stages in turn, creating any
handlers and templates as needed. Ensure that you notify handlers after any
task which impacts the way the service would run (such as configuration
file modifications). Also take care that file ownership and permissions are
appropriate.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Fill in variable defaults, libraries, and prerequisites as you
discover a need for them. You can also develop documentation for your
role at the same time.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="deploying-the-role">
<h2>Deploying the Role<a class="headerlink" href="#deploying-the-role" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Include your role on the deploy host. See also <a class="reference external" href="extending.html#adding-galaxy-roles">Adding Galaxy roles</a>.</p>
</li>
<li><p class="first">Perform any other host preparation (such as the tasks performed by the
<code class="docutils literal"><span class="pre">bootstrap-aio.yml</span></code> playbook). This includes any preparation tasks that
are particular to your service.</p>
</li>
<li><p class="first">Generate files to include your service in the Ansible inventory
using <a class="reference external" href="extending.html#env-d">env.d</a> and <a class="reference external" href="extending.html#conf-d">conf.d</a> files for use on your deploy host.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">You can follow examples from other roles, making the appropriate
modifications being sure that group labels in <code class="docutils literal"><span class="pre">env.d</span></code> and <code class="docutils literal"><span class="pre">conf.d</span></code>
files are consistent.</p>
</div>
</li>
<li><p class="first">Generate secrets, if any, as described in the <a class="reference external" href="http://docs.openstack.org/project-deploy-guide/openstack-ansible/newton/configure.html#configuring-service-credentials">Deployment Guide</a>.
You can append your keys to an existing <code class="docutils literal"><span class="pre">user_secrets.yml</span></code> file or add a
new file to the <code class="docutils literal"><span class="pre">openstack_deploy</span></code> directory to contain them. Provide
overrides for any other variables you will need at this time as well, either
in <code class="docutils literal"><span class="pre">user_variables.yml</span></code> or another file. This is explained in more depth
under <a class="reference external" href="extending.html#user-yml-files">Extending OpenStack-Ansible</a>.</p>
</li>
<li><p class="first">If your service is installed from source or relies on python packages which
need to be installed from source, specify a repository for the source
code of each requirement by adding a file to your deploy host under
<code class="docutils literal"><span class="pre">playbooks/defaults/repo_packages</span></code> in the OpenStack-Ansible source
repository and following the pattern of files currently in that directory.
You could also simply add an entry to an existing file there. Be sure to
run the <code class="docutils literal"><span class="pre">repo-build.yml</span></code> play later so that wheels for your packages will
be included in the repository infrastructure.</p>
</li>
<li><p class="first">Make any required adjustments to the load balancer configuration
(e.g. modify <code class="docutils literal"><span class="pre">playbooks/vars/configs/haproxy_config.yml</span></code> in the
OpenStack-Ansible source repository on your deploy host) so that your
service can be reached through a load balancer, if appropriate, and be sure
to run the <code class="docutils literal"><span class="pre">haproxy-install.yml</span></code> play later so your changes will be
applied.</p>
</li>
<li><p class="first">Put together a service install playbook file for your role. This can also
be modeled from any existing service playbook that has similar
dependencies to your service (database, messaging, storage drivers,
container mount points, etc.). A common place to keep playbook files in a
Galaxy role is in an <code class="docutils literal"><span class="pre">examples</span></code> directory off the root of the role.</p>
</li>
</ol>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">If you adhere to the pattern of isolating your role&#8217;s extra
deployment requirements (secrets and var files, HAProxy yml fragments,
repo_package files, etc.) in their own files it makes it easy for you to
automate these additional steps when testing your role.</p>
</div>
</div>
<div class="section" id="role-development-maturity">
<h2>Role development maturity<a class="headerlink" href="#role-development-maturity" title="Permalink to this headline">¶</a></h2>
<p>In order to include a role into the integrated build implemented by the
playbooks in the <code class="docutils literal"><span class="pre">openstack/openstack-ansible</span></code> repository, it needs to
meet an appropriate level of maturity requirements. Developers are
encouraged to observe the below-mentioned patterns in the existing roles.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Many of the existing roles may not fully implement all the patterns
just yet. It is important to look through multiple roles to get an
idea of the common patterns rather than to fixate on a single role&#8217;s
pattern.</p>
</div>
<p>The development of a role will usually go through the following stages:</p>
<ol class="arabic">
<li><p class="first">Initial role development</p>
<ul>
<li><p class="first">Include base scaffolding. To facilitate development and the tests
implemented across all OpenStack-Ansible roles, a base set of folders
and files need to be implemented. A base set of configuration and test
facilitation scripts must include at least the following:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">tox.ini</span></code>:
The lint testing, documentation build, release notes build and
functional build execution process for the role&#8217;s gate tests are all
defined in this file.</li>
<li><code class="docutils literal"><span class="pre">test-requirements.txt</span></code>:
The python requirements which must be installed when executing the
tests.</li>
<li><code class="docutils literal"><span class="pre">other-requirements.txt</span></code>:
The binary requirements which must be installed on the host the tests
are executed on for the python requirements and the tox execution to
work.</li>
<li><code class="docutils literal"><span class="pre">setup.cfg</span></code> and <code class="docutils literal"><span class="pre">setup.py</span></code>:
Information about the repository which is used during the build of any
artifacts.</li>
<li><code class="docutils literal"><span class="pre">run_tests.sh</span></code>:
A convenient script for developers to execute all standard tests on a
suitable host.</li>
<li><code class="docutils literal"><span class="pre">Vagrantfile</span></code>:
A convenient configuration file to allow a developer to easily create a
test virtual machine using <a class="reference external" href="https://www.vagrantup.com/">Vagrant</a>. This must automatically execute
<code class="docutils literal"><span class="pre">run_tests.sh</span></code>.</li>
<li><code class="docutils literal"><span class="pre">README.rst</span></code>, <code class="docutils literal"><span class="pre">LICENSE</span></code>, <code class="docutils literal"><span class="pre">CONTRIBUTING.rst</span></code>:
A set of standard files which have content describing their purpose.</li>
<li><code class="docutils literal"><span class="pre">.gitignore</span></code>:
A standard git configuration file for the repository which should be
pretty uniform across all the repositories.</li>
<li><code class="docutils literal"><span class="pre">.gitreview</span></code>:
A standard file configured for the project to inform the <code class="docutils literal"><span class="pre">git-review</span></code>
plugin where to find the upstream gerrit remote for the repository.</li>
</ul>
</li>
<li><p class="first">The role development should initially be focused on implementing a set of
tasks and a test playbook which converge. The convergence must:</p>
<ul class="simple">
<li>Implement <code class="docutils literal"><span class="pre">developer_mode</span></code> to build from a git source into a Python
venv.</li>
<li>Deploy the applicable configuration files in the right places.</li>
<li>Ensure that the service starts.</li>
</ul>
<p>The convergence may involve consuming other OpenStack-Ansible roles (For
example: <code class="docutils literal"><span class="pre">galera_server</span></code>, <code class="docutils literal"><span class="pre">galera_client</span></code>, <code class="docutils literal"><span class="pre">rabbitmq_server</span></code>) in
order to ensure that the appropriate infrastructure is in place. Reuse
of existing roles in OpenStack-Ansible or Ansible Galaxy is strongly
encouraged.</p>
</li>
<li><p class="first">The role <em>must</em> support Ubuntu 16.04 LTS. It should
ideally also support CentOS7 but this is not required at this time. The
patterns to achieve this include:</p>
<ul class="simple">
<li>The separation of platform specific variables into role vars files.</li>
<li>The detection and handling of different init systems (init.d, SystemD).</li>
<li>The detection and handling of different package managers (apt, yum).</li>
<li>The detection and handling of different network configuration methods.</li>
</ul>
<p>There are several examples of these patterns implemented across many of
the OpenStack-Ansible roles. Developers are advised to inspect the
established patterns and either implement or improve upon them.</p>
</li>
<li><p class="first">The role implementation should be done in such a way that it is agnostic
with regards to whether it is implemented in a container, or on a
physical host. The test infrastructure may make use of LXC containers for
the separation of services, but if a role is used by a playbook that
targets a host, it must work regardless of whether that host is a
container, a virtual server, or a physical server. The use of LXC
containers for role tests is not required but it may be useful in order
to simulate a multi-node build out as part of the testing infrastructure.</p>
</li>
<li><p class="first">Any secrets (For example: passwords) should not be provided with default
values in the tasks, role vars, or role defaults. The tasks should be
implemented in such a way that any secrets required, but not provided,
should result in the task execution failure. It is important for a
secure-by-default implementation to ensure that an environment is not
vulnerable due to the production use of default secrets. Deployers
must be forced to properly provide their own secret variable values.</p>
</li>
<li><p class="first">Once the initial convergence is working and the services are running,
the role development should focus on implementing some level of
functional testing. Ideally, the functional tests for an OpenStack role
should make use of Tempest to execute the functional tests. The ideal
tests to execute are scenario tests as they test the functions that
the service is expected to do in a production deployment. In the absence
of any scenario tests for the service a fallback option is to implement
the smoke tests instead.</p>
</li>
<li><p class="first">The role must include documentation. The <a class="reference external" href="contribute.html#documentation-and-release-note-guidelines">Documentation and Release Note
Guidelines</a> provide specific guidelines with regards to style and
conventions. The documentation must include a description of the
mandatory infrastructure (For example: a database and a message queue are
required), variables (For example: the database name and credentials) and
group names (For example: The role expects a group named <code class="docutils literal"><span class="pre">foo_all</span></code> to
be present and it expects the host to be a member of it) for the role&#8217;s
execution to succeed.</p>
</li>
</ul>
</li>
<li><p class="first">Integration development</p>
<p>Once the role has implemented the above requirements, work can begin on
integrating the role into the integrated build. This involves the
preparation of the following items:</p>
<ul>
<li><p class="first">Host and container group configuration</p>
<p>This is implemented into the dynamic inventory through the definition of
content in an <code class="docutils literal"><span class="pre">env.d</span></code> file. A description of how these work can be
found in <a class="reference external" href="http://docs.openstack.org/project-deploy-guide/openstack-ansible/draft/app-custom-layouts.html">Appendix C</a>
of the Deployment Guide.</p>
</li>
<li><p class="first">Load balancer configuration</p>
<p>OpenStack-Ansible deploys services in a highly available configuration by
default, so all API services must be configured for implementation behind
HAProxy. This is done through the modification of
<code class="docutils literal"><span class="pre">playbooks/vars/configs/haproxy_config.yml</span></code>.</p>
</li>
<li><p class="first">Install playbook</p>
<p>In order to implement the role in the appropriate way, an
<code class="docutils literal"><span class="pre">os-&lt;service&gt;-install.yml</span></code> playbook must be created and targeted
at the appropriate group defined in the service <code class="docutils literal"><span class="pre">env.d</span></code> file. The
playbook should also ensure that the database(s), database user(s),
rabbitmq vhost and rabbitmq user are setup for the service. It is
crucial that the implementation of the service is optional and that the
deployer must opt-in to the deployment through the population of a host
in the applicable host group. If the host group has no hosts, Ansible
skips the playbook&#8217;s tasks automatically.</p>
</li>
<li><p class="first">Secrets</p>
<p>Any secrets required for the role to work must be noted in the
<code class="docutils literal"><span class="pre">etc/openstack_deploy/user_secrets.yml</span></code> file.</p>
</li>
<li><p class="first">Group vars</p>
<p>Any variables needed by other roles to connect to the new role, or by the
new role to connect to other roles, should be implemented in
<code class="docutils literal"><span class="pre">playbooks/inventory/group_vars</span></code>. The group vars are essentially the
glue which playbooks use to ensure that all roles are given the
appropriate information. When group vars are implemented it should be a
minimum set to achieve the goal of integrating the new role into the
integrated build.</p>
</li>
<li><p class="first">Documentation</p>
<p>Content must be added to the Installation Guide to describe how to
implement the new service in an integrated environment. This content must
adhere to the <a class="reference external" href="contribute.html#documentation-and-release-note-guidelines">Documentation and Release Note Guidelines</a>. Until the
role has integrated functional testing implemented, the documentation
must make it clear that the service inclusion in OpenStack-Ansible is
experimental and is not fully tested by OpenStack-Ansible in an
integrated build.</p>
</li>
<li><p class="first">Release note</p>
<p>A feature release note must be added to announce the new service
availability and to refer to the Installation Guide entry and the role
documentation for further details. This content must adhere to the
<a class="reference external" href="contribute.html#documentation-and-release-note-guidelines">Documentation and Release Note Guidelines</a>.</p>
</li>
<li><p class="first">Integration test</p>
<p>It must be possible to execute a functional, integrated test which
executes a deployment in the same way as a production environment. The
test must execute a set of functional tests using Tempest. This is the
required last step before a service can remove the experimental warning
from the documentation.</p>
</li>
</ul>
</li>
</ol>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="role-services.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Roles and services"></i></a>
          
          
            <a href="../inventory/index.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Inventory"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2017-02-14 17:57</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="../_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="../index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../draft-operations-guide/index.html">Operations guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade-guide/index.html">Upgrade Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart-aio.html">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation-hosts-limited-connectivity.html">Installation on hosts with limited connectivity</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripts.html">Included Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks.html">Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="contribute.html">Contributor Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-triage.html">OpenStack-Ansible Bug Triage</a></li>
<li class="toctree-l2"><a class="reference internal" href="core-reviewers.html">Core Reviewers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="role-services.html">Roles and services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../inventory/index.html">Inventory</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "developer-docs/additional-roles" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/openstack-ansible/tree/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 55cab808b67095e989137cf8816c323575fc43ad";
        var bugProject = "openstack-ansible";
        var bugTitle = "Documentation bug";
    var fieldTags = "docs";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 15.0.0.0rc2.dev43 on 2017-02-14 17:57";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>