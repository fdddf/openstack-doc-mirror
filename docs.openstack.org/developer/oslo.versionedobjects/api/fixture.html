<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Fixture &mdash; oslo.versionedobjects 1.21.1.dev6 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.21.1.dev6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="oslo.versionedobjects 1.21.1.dev6 documentation" href="../index.html" />
    <link rel="up" title="API" href="index.html" />
    <link rel="next" title="Usage" href="../usage.html" />
    <link rel="prev" title="fields" href="fields.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-oslo_versionedobjects.fixture">
<span id="fixture"></span><h1>Fixture<a class="headerlink" href="#module-oslo_versionedobjects.fixture" title="Permalink to this headline">¶</a></h1>
<p>Fixtures for writing tests for code using oslo.versionedobjects</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This module has several extra dependencies not needed at runtime
for production code, and therefore not installed by default. To
ensure those dependencies are present for your tests, add
<code class="docutils literal"><span class="pre">oslo.versionedobjects[fixtures]</span></code> to your list of test dependencies.</p>
</div>
<dl class="class">
<dt id="oslo_versionedobjects.fixture.FakeIndirectionAPI">
<em class="property">class </em><code class="descclassname">oslo_versionedobjects.fixture.</code><code class="descname">FakeIndirectionAPI</code><span class="sig-paren">(</span><em>serializer=None</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.FakeIndirectionAPI" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="oslo_versionedobjects.fixture.FakeIndirectionAPI.object_action">
<code class="descname">object_action</code><span class="sig-paren">(</span><em>context</em>, <em>objinst</em>, <em>objmethod</em>, <em>args</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.FakeIndirectionAPI.object_action" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="oslo_versionedobjects.fixture.FakeIndirectionAPI.object_backport">
<code class="descname">object_backport</code><span class="sig-paren">(</span><em>context</em>, <em>objinst</em>, <em>target_version</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.FakeIndirectionAPI.object_backport" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="oslo_versionedobjects.fixture.FakeIndirectionAPI.object_class_action">
<code class="descname">object_class_action</code><span class="sig-paren">(</span><em>context</em>, <em>objname</em>, <em>objmethod</em>, <em>objver</em>, <em>args</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.FakeIndirectionAPI.object_class_action" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="oslo_versionedobjects.fixture.FakeIndirectionAPI.object_class_action_versions">
<code class="descname">object_class_action_versions</code><span class="sig-paren">(</span><em>context</em>, <em>objname</em>, <em>objmethod</em>, <em>object_versions</em>, <em>args</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.FakeIndirectionAPI.object_class_action_versions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="oslo_versionedobjects.fixture.IndirectionFixture">
<em class="property">class </em><code class="descclassname">oslo_versionedobjects.fixture.</code><code class="descname">IndirectionFixture</code><span class="sig-paren">(</span><em>indirection_api=None</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.IndirectionFixture" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="oslo_versionedobjects.fixture.IndirectionFixture.setUp">
<code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.IndirectionFixture.setUp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="exception">
<dt id="oslo_versionedobjects.fixture.ObjectHashMismatch">
<em class="property">exception </em><code class="descclassname">oslo_versionedobjects.fixture.</code><code class="descname">ObjectHashMismatch</code><span class="sig-paren">(</span><em>expected</em>, <em>actual</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.ObjectHashMismatch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="oslo_versionedobjects.fixture.ObjectVersionChecker">
<em class="property">class </em><code class="descclassname">oslo_versionedobjects.fixture.</code><code class="descname">ObjectVersionChecker</code><span class="sig-paren">(</span><em>obj_classes=defaultdict(&lt;type 'list'&gt;</em>, <em>{})</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.ObjectVersionChecker" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="oslo_versionedobjects.fixture.ObjectVersionChecker.get_dependency_tree">
<code class="descname">get_dependency_tree</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.ObjectVersionChecker.get_dependency_tree" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="oslo_versionedobjects.fixture.ObjectVersionChecker.get_hashes">
<code class="descname">get_hashes</code><span class="sig-paren">(</span><em>extra_data_func=None</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.ObjectVersionChecker.get_hashes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dict of computed object hashes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>extra_data_func</strong> &#8211; a function that is given the object class
which gathers more relevant data about the
class that is needed in versioning. Returns
a tuple containing the extra data bits.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="oslo_versionedobjects.fixture.ObjectVersionChecker.test_compatibility_routines">
<code class="descname">test_compatibility_routines</code><span class="sig-paren">(</span><em>use_manifest=False</em>, <em>init_args=None</em>, <em>init_kwargs=None</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.ObjectVersionChecker.test_compatibility_routines" title="Permalink to this definition">¶</a></dt>
<dd><p>Test obj_make_compatible() on all object classes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>use_manifest</strong> &#8211; a boolean that determines if the version
manifest should be passed to obj_make_compatible</li>
<li><strong>init_args</strong> &#8211; a dictionary of the format {obj_class: [arg1, arg2]}
that will be used to pass arguments to init on the
given obj_class. If no args are needed, the
obj_class does not need to be added to the dict</li>
<li><strong>init_kwargs</strong> &#8211; a dictionary of the format
{obj_class: {&#8216;kwarg1&#8217;: val1}} that will be used to
pass kwargs to init on the given obj_class. If no
kwargs are needed, the obj_class does not need to
be added to the dict</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="oslo_versionedobjects.fixture.ObjectVersionChecker.test_hashes">
<code class="descname">test_hashes</code><span class="sig-paren">(</span><em>expected_hashes</em>, <em>extra_data_func=None</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.ObjectVersionChecker.test_hashes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="oslo_versionedobjects.fixture.ObjectVersionChecker.test_relationships">
<code class="descname">test_relationships</code><span class="sig-paren">(</span><em>expected_tree</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.ObjectVersionChecker.test_relationships" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="oslo_versionedobjects.fixture.ObjectVersionChecker.test_relationships_in_order">
<code class="descname">test_relationships_in_order</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.ObjectVersionChecker.test_relationships_in_order" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="oslo_versionedobjects.fixture.StableObjectJsonFixture">
<em class="property">class </em><code class="descclassname">oslo_versionedobjects.fixture.</code><code class="descname">StableObjectJsonFixture</code><a class="headerlink" href="#oslo_versionedobjects.fixture.StableObjectJsonFixture" title="Permalink to this definition">¶</a></dt>
<dd><p>Fixture that makes sure we get stable JSON object representations.</p>
<p>Since objects contain things like set(), which can&#8217;t be converted to
JSON, we have some situations where the representation isn&#8217;t fully
deterministic. This doesn&#8217;t matter at all at runtime, but does to
unit tests that try to assert things at a low level.</p>
<p>This fixture mocks the obj_to_primitive() call and makes sure to
sort the list of changed fields (which came from a set) before
returning it to the caller.</p>
<dl class="method">
<dt id="oslo_versionedobjects.fixture.StableObjectJsonFixture.setUp">
<code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.StableObjectJsonFixture.setUp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="oslo_versionedobjects.fixture.VersionedObjectRegistryFixture">
<em class="property">class </em><code class="descclassname">oslo_versionedobjects.fixture.</code><code class="descname">VersionedObjectRegistryFixture</code><a class="headerlink" href="#oslo_versionedobjects.fixture.VersionedObjectRegistryFixture" title="Permalink to this definition">¶</a></dt>
<dd><p>Use a VersionedObjectRegistry as a temp registry pattern fixture.</p>
<p>The pattern solution is to backup the object registry, register
a class locally, and then restore the original registry. This could be
used for test objects that do not need to be registered permanently but
will have calls which lookup registration.</p>
<dl class="staticmethod">
<dt id="oslo_versionedobjects.fixture.VersionedObjectRegistryFixture.register">
<em class="property">static </em><code class="descname">register</code><span class="sig-paren">(</span><em>cls_name</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.VersionedObjectRegistryFixture.register" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="oslo_versionedobjects.fixture.VersionedObjectRegistryFixture.setUp">
<code class="descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.VersionedObjectRegistryFixture.setUp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="oslo_versionedobjects.fixture.compare_obj">
<code class="descclassname">oslo_versionedobjects.fixture.</code><code class="descname">compare_obj</code><span class="sig-paren">(</span><em>test</em>, <em>obj</em>, <em>db_obj</em>, <em>subs=None</em>, <em>allow_missing=None</em>, <em>comparators=None</em><span class="sig-paren">)</span><a class="headerlink" href="#oslo_versionedobjects.fixture.compare_obj" title="Permalink to this definition">¶</a></dt>
<dd><p>Compare a VersionedObject and a dict-like database object.</p>
<p>This automatically converts TZ-aware datetimes and iterates over
the fields of the object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>test</strong> &#8211; The TestCase doing the comparison</li>
<li><strong>obj</strong> &#8211; The VersionedObject to examine</li>
<li><strong>db_obj</strong> &#8211; The dict-like database object to use as reference</li>
<li><strong>subs</strong> &#8211; A dict of objkey=dbkey field substitutions</li>
<li><strong>allow_missing</strong> &#8211; A list of fields that may not be in db_obj</li>
<li><strong>comparators</strong> &#8211; Map of comparator functions to use for certain fields</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="section" id="objectversionchecker">
<h2>ObjectVersionChecker<a class="headerlink" href="#objectversionchecker" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fingerprints">
<h3>Fingerprints<a class="headerlink" href="#fingerprints" title="Permalink to this headline">¶</a></h3>
<p>One function of the ObjectVersionChecker is to generate fingerprints of versioned objects.
These fingerprints are a combination of the object&#8217;s version and a hash of the
RPC-critical attributes of the object: fields and remotable methods.</p>
<p>The test_hashes() method is used to retrieve the expected and actual fingerprints
of the objects. When using this method to assert the versions of objects in a
local project, the expected fingerprints are the fingerprints of the previous
state of the objects. These fingerprints are defined locally in the project and
passed to test_hashes(). The actual fingerprints are the dynamically-generated
fingerprints of the current state of the objects. If the expected and actual
fingerprints do not match on an object, this means the RPC contract that was
previously defined in the object is no longer the same. Because of this, the
object&#8217;s version must be updated. When the version is updated and the tests are
run again, a new fingerprint for the object is generated. This fingerprint
should be written over the previous version of the fingerprint. This shows the
newly generated fingerprint is now the most recent state of the object.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Fixture</a><ul>
<li><a class="reference internal" href="#objectversionchecker">ObjectVersionChecker</a><ul>
<li><a class="reference internal" href="#fingerprints">Fingerprints</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="fields.html"
                                  title="previous chapter">fields</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="../usage.html"
                                  title="next chapter">Usage</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/oslo.versionedobjects
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/api/fixture.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../usage.html" title="Usage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="fields.html" title="fields"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">oslo.versionedobjects 1.21.1.dev6 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">API</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, OpenStack Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/oslo.versionedobjects");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>