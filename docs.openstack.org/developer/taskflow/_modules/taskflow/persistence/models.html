<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>taskflow.persistence.models &mdash; TaskFlow 2.9.1.dev9 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.9.1.dev9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="TaskFlow 2.9.1.dev9 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for taskflow.persistence.models</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1">#    Copyright (C) 2012 Yahoo! Inc. All Rights Reserved.</span>
<span class="c1">#    Copyright (C) 2013 Rackspace Hosting All Rights Reserved.</span>
<span class="c1">#</span>
<span class="c1">#    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may</span>
<span class="c1">#    not use this file except in compliance with the License. You may obtain</span>
<span class="c1">#    a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#         http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1">#    Unless required by applicable law or agreed to in writing, software</span>
<span class="c1">#    distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span>
<span class="c1">#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span>
<span class="c1">#    License for the specific language governing permissions and limitations</span>
<span class="c1">#    under the License.</span>

<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">oslo_utils</span> <span class="kn">import</span> <span class="n">timeutils</span>
<span class="kn">from</span> <span class="nn">oslo_utils</span> <span class="kn">import</span> <span class="n">uuidutils</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">taskflow</span> <span class="kn">import</span> <span class="n">exceptions</span> <span class="k">as</span> <span class="n">exc</span>
<span class="kn">from</span> <span class="nn">taskflow</span> <span class="kn">import</span> <span class="n">states</span>
<span class="kn">from</span> <span class="nn">taskflow.types</span> <span class="kn">import</span> <span class="n">failure</span> <span class="k">as</span> <span class="n">ft</span>
<span class="kn">from</span> <span class="nn">taskflow.utils</span> <span class="kn">import</span> <span class="n">misc</span>


<span class="c1"># Internal helpers...</span>


<span class="k">def</span> <span class="nf">_format_meta</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">indent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format the common metadata dictionary in the same manner.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">- metadata:&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Progress for now is a special snowflake and will be formatted</span>
        <span class="c1"># in percent format.</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;progress&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">misc</span><span class="o">.</span><span class="n">NUMERIC_TYPES</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%0.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">+ </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">lines</span>


<span class="k">def</span> <span class="nf">_format_shared</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">indent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format the common shared attributes in the same manner.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">- </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span>
                                      <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">lines</span>


<span class="k">def</span> <span class="nf">_is_all_none</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">more_arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">more_arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">_copy_function</span><span class="p">(</span><span class="n">deep_copy</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">deep_copy</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">_safe_marshal_time</span><span class="p">(</span><span class="n">when</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">when</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">timeutils</span><span class="o">.</span><span class="n">marshall_now</span><span class="p">(</span><span class="n">now</span><span class="o">=</span><span class="n">when</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_safe_unmarshal_time</span><span class="p">(</span><span class="n">when</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">when</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">timeutils</span><span class="o">.</span><span class="n">unmarshall_time</span><span class="p">(</span><span class="n">when</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_fix_meta</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># Handle the case where older schemas allowed this to be non-dict by</span>
    <span class="c1"># correcting this case by replacing it with a dictionary when a non-dict</span>
    <span class="c1"># is found.</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">meta</span>


<div class="viewcode-block" id="LogBook"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.LogBook">[docs]</a><span class="k">class</span> <span class="nc">LogBook</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A collection of flow details and associated metadata.</span>

<span class="sd">    Typically this class contains a collection of flow detail entries</span>
<span class="sd">    for a given engine (or job) so that those entities can track what &#39;work&#39;</span>
<span class="sd">    has been completed for resumption, reverting and miscellaneous tracking</span>
<span class="sd">    purposes.</span>

<span class="sd">    The data contained within this class need **not** be persisted to the</span>
<span class="sd">    backend storage in real time. The data in this class will only be</span>
<span class="sd">    guaranteed to be persisted when a save occurs via some backend</span>
<span class="sd">    connection.</span>

<span class="sd">    NOTE(harlowja): the naming of this class is analogous to a ship&#39;s log or a</span>
<span class="sd">    similar type of record used in detailing work that has been completed (or</span>
<span class="sd">    work that has not been completed).</span>

<span class="sd">    :ivar created_at: A ``datetime.datetime`` object of when this logbook</span>
<span class="sd">                      was created.</span>
<span class="sd">    :ivar updated_at: A ``datetime.datetime`` object of when this logbook</span>
<span class="sd">                      was last updated at.</span>
<span class="sd">    :ivar meta: A dictionary of meta-data associated with this logbook.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">uuid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">uuid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_uuid</span> <span class="o">=</span> <span class="n">uuid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_uuid</span> <span class="o">=</span> <span class="n">uuidutils</span><span class="o">.</span><span class="n">generate_uuid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flowdetails_by_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">timeutils</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="LogBook.pformat"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.LogBook.pformat">[docs]</a>    <span class="k">def</span> <span class="nf">pformat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linesep</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pretty formats this logbook into a string.</span>

<span class="sd">        &gt;&gt;&gt; from taskflow.persistence import models</span>
<span class="sd">        &gt;&gt;&gt; tmp = models.LogBook(&quot;example&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(tmp.pformat())</span>
<span class="sd">        LogBook: &#39;example&#39;</span>
<span class="sd">         - uuid = ...</span>
<span class="sd">         - created_at = ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_format_shared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_format_meta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">- created_at = </span><span class="si">%s</span><span class="s2">&quot;</span>
                         <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">- updated_at = </span><span class="si">%s</span><span class="s2">&quot;</span>
                         <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">flow_detail</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow_detail</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                             <span class="n">linesep</span><span class="o">=</span><span class="n">linesep</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

<div class="viewcode-block" id="LogBook.add"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.LogBook.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a new flow detail into this logbook.</span>

<span class="sd">        NOTE(harlowja): if an existing flow detail exists with the same</span>
<span class="sd">        uuid the existing one will be overwritten with the newly provided</span>
<span class="sd">        one.</span>

<span class="sd">        Does not *guarantee* that the details will be immediately saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flowdetails_by_id</span><span class="p">[</span><span class="n">fd</span><span class="o">.</span><span class="n">uuid</span><span class="p">]</span> <span class="o">=</span> <span class="n">fd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">timeutils</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span></div>

<div class="viewcode-block" id="LogBook.find"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.LogBook.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow_uuid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Locate the flow detail corresponding to the given uuid.</span>

<span class="sd">        :returns: the flow detail with that uuid</span>
<span class="sd">        :rtype: :py:class:`.FlowDetail` (or ``None`` if not found)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flowdetails_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">flow_uuid</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="LogBook.merge"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.LogBook.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">deep_copy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Merges the current object state with the given ones state.</span>

<span class="sd">        If ``deep_copy`` is provided as truthy then the</span>
<span class="sd">        local object will use ``copy.deepcopy`` to replace this objects</span>
<span class="sd">        local attributes with the provided objects attributes (**only** if</span>
<span class="sd">        there is a difference between this objects attributes and the</span>
<span class="sd">        provided attributes). If ``deep_copy`` is falsey (the default) then a</span>
<span class="sd">        reference copy will occur instead when a difference is detected.</span>

<span class="sd">        NOTE(harlowja): If the provided object is this object itself</span>
<span class="sd">        then **no** merging is done. Also note that this does **not** merge</span>
<span class="sd">        the flow details contained in either.</span>

<span class="sd">        :returns: this logbook (freshly merged with the incoming object)</span>
<span class="sd">        :rtype: :py:class:`.LogBook`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="n">copy_fn</span> <span class="o">=</span> <span class="n">_copy_function</span><span class="p">(</span><span class="n">deep_copy</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">!=</span> <span class="n">lb</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">copy_fn</span><span class="p">(</span><span class="n">lb</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lb</span><span class="o">.</span><span class="n">created_at</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">copy_fn</span><span class="p">(</span><span class="n">lb</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lb</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">copy_fn</span><span class="p">(</span><span class="n">lb</span><span class="o">.</span><span class="n">updated_at</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="LogBook.to_dict"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.LogBook.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marshal_time</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Translates the internal state of this object to a ``dict``.</span>

<span class="sd">        NOTE(harlowja): The returned ``dict`` does **not** include any</span>
<span class="sd">        contained flow details.</span>

<span class="sd">        :returns: this logbook in ``dict`` form</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">marshal_time</span><span class="p">:</span>
            <span class="n">marshal_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">marshal_fn</span> <span class="o">=</span> <span class="n">_safe_marshal_time</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;meta&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
            <span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
            <span class="s1">&#39;updated_at&#39;</span><span class="p">:</span> <span class="n">marshal_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span><span class="p">),</span>
            <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="n">marshal_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">created_at</span><span class="p">),</span>
        <span class="p">}</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="LogBook.from_dict"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.LogBook.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">unmarshal_time</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Translates the given ``dict`` into an instance of this class.</span>

<span class="sd">        NOTE(harlowja): the ``dict`` provided should come from a prior</span>
<span class="sd">        call to :meth:`.to_dict`.</span>

<span class="sd">        :returns: a new logbook</span>
<span class="sd">        :rtype: :py:class:`.LogBook`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unmarshal_time</span><span class="p">:</span>
            <span class="n">unmarshal_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unmarshal_fn</span> <span class="o">=</span> <span class="n">_safe_unmarshal_time</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">uuid</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">unmarshal_fn</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;updated_at&#39;</span><span class="p">])</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">unmarshal_fn</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">])</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">_fix_meta</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unique identifer of this logbook.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uuid</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The name of this logbook.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fd</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flowdetails_by_id</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">fd</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flowdetails_by_id</span><span class="p">)</span>

<div class="viewcode-block" id="LogBook.copy"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.LogBook.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retain_contents</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies this logbook.</span>

<span class="sd">        Creates a shallow copy of this logbook. If this logbook contains</span>
<span class="sd">        flow details and ``retain_contents`` is truthy (the default) then</span>
<span class="sd">        the flow details container will be shallow copied (the flow details</span>
<span class="sd">        contained there-in will **not** be copied). If ``retain_contents`` is</span>
<span class="sd">        falsey then the copied logbook will have **no** contained flow</span>
<span class="sd">        details (but it will have the rest of the local objects attributes</span>
<span class="sd">        copied).</span>

<span class="sd">        :returns: a new logbook</span>
<span class="sd">        :rtype: :py:class:`.LogBook`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">retain_contents</span><span class="p">:</span>
            <span class="n">clone</span><span class="o">.</span><span class="n">_flowdetails_by_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clone</span><span class="o">.</span><span class="n">_flowdetails_by_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flowdetails_by_id</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="n">clone</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">clone</span></div></div>


<div class="viewcode-block" id="FlowDetail"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.FlowDetail">[docs]</a><span class="k">class</span> <span class="nc">FlowDetail</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A collection of atom details and associated metadata.</span>

<span class="sd">    Typically this class contains a collection of atom detail entries that</span>
<span class="sd">    represent the atoms in a given flow structure (along with any other needed</span>
<span class="sd">    metadata relevant to that flow).</span>

<span class="sd">    The data contained within this class need **not** be persisted to the</span>
<span class="sd">    backend storage in real time. The data in this class will only be</span>
<span class="sd">    guaranteed to be persisted when a save (or update) occurs via some backend</span>
<span class="sd">    connection.</span>

<span class="sd">    :ivar state: The state of the flow associated with this flow detail.</span>
<span class="sd">    :ivar meta: A dictionary of meta-data associated with this flow detail.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uuid</span> <span class="o">=</span> <span class="n">uuid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atomdetails_by_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="FlowDetail.update"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.FlowDetail.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the objects state to be the same as the given one.</span>

<span class="sd">        This will assign the private and public attributes of the given</span>
<span class="sd">        flow detail directly to this object (replacing any existing</span>
<span class="sd">        attributes in this object; even if they are the **same**).</span>

<span class="sd">        NOTE(harlowja): If the provided object is this object itself</span>
<span class="sd">        then **no** update is done.</span>

<span class="sd">        :returns: this flow detail</span>
<span class="sd">        :rtype: :py:class:`.FlowDetail`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fd</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atomdetails_by_id</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">_atomdetails_by_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">meta</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="FlowDetail.pformat"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.FlowDetail.pformat">[docs]</a>    <span class="k">def</span> <span class="nf">pformat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linesep</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pretty formats this flow detail into a string.</span>

<span class="sd">        &gt;&gt;&gt; from oslo_utils import uuidutils</span>
<span class="sd">        &gt;&gt;&gt; from taskflow.persistence import models</span>
<span class="sd">        &gt;&gt;&gt; flow_detail = models.FlowDetail(&quot;example&quot;,</span>
<span class="sd">        ...                                 uuid=uuidutils.generate_uuid())</span>
<span class="sd">        &gt;&gt;&gt; print(flow_detail.pformat())</span>
<span class="sd">        FlowDetail: &#39;example&#39;</span>
<span class="sd">         - uuid = ...</span>
<span class="sd">         - state = ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_format_shared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_format_meta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">atom_detail</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom_detail</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                             <span class="n">linesep</span><span class="o">=</span><span class="n">linesep</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

<div class="viewcode-block" id="FlowDetail.merge"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.FlowDetail.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">deep_copy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Merges the current object state with the given one&#39;s state.</span>

<span class="sd">        If ``deep_copy`` is provided as truthy then the</span>
<span class="sd">        local object will use ``copy.deepcopy`` to replace this objects</span>
<span class="sd">        local attributes with the provided objects attributes (**only** if</span>
<span class="sd">        there is a difference between this objects attributes and the</span>
<span class="sd">        provided attributes). If ``deep_copy`` is falsey (the default) then a</span>
<span class="sd">        reference copy will occur instead when a difference is detected.</span>

<span class="sd">        NOTE(harlowja): If the provided object is this object itself</span>
<span class="sd">        then **no** merging is done. Also this does **not** merge the atom</span>
<span class="sd">        details contained in either.</span>

<span class="sd">        :returns: this flow detail (freshly merged with the incoming object)</span>
<span class="sd">        :rtype: :py:class:`.FlowDetail`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fd</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="n">copy_fn</span> <span class="o">=</span> <span class="n">_copy_function</span><span class="p">(</span><span class="n">deep_copy</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">!=</span> <span class="n">fd</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">copy_fn</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">fd</span><span class="o">.</span><span class="n">state</span><span class="p">:</span>
            <span class="c1"># NOTE(imelnikov): states are just strings, no need to copy.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">state</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="FlowDetail.copy"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.FlowDetail.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retain_contents</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies this flow detail.</span>

<span class="sd">        Creates a shallow copy of this flow detail. If this detail contains</span>
<span class="sd">        flow details and ``retain_contents`` is truthy (the default) then</span>
<span class="sd">        the atom details container will be shallow copied (the atom details</span>
<span class="sd">        contained there-in will **not** be copied). If ``retain_contents`` is</span>
<span class="sd">        falsey then the copied flow detail will have **no** contained atom</span>
<span class="sd">        details (but it will have the rest of the local objects attributes</span>
<span class="sd">        copied).</span>

<span class="sd">        :returns: a new flow detail</span>
<span class="sd">        :rtype: :py:class:`.FlowDetail`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">retain_contents</span><span class="p">:</span>
            <span class="n">clone</span><span class="o">.</span><span class="n">_atomdetails_by_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clone</span><span class="o">.</span><span class="n">_atomdetails_by_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atomdetails_by_id</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="n">clone</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="FlowDetail.to_dict"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.FlowDetail.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Translates the internal state of this object to a ``dict``.</span>

<span class="sd">        NOTE(harlowja): The returned ``dict`` does **not** include any</span>
<span class="sd">        contained atom details.</span>

<span class="sd">        :returns: this flow detail in ``dict`` form</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;meta&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
            <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
            <span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
        <span class="p">}</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="FlowDetail.from_dict"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.FlowDetail.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Translates the given ``dict`` into an instance of this class.</span>

<span class="sd">        NOTE(harlowja): the ``dict`` provided should come from a prior</span>
<span class="sd">        call to :meth:`.to_dict`.</span>

<span class="sd">        :returns: a new flow detail</span>
<span class="sd">        :rtype: :py:class:`.FlowDetail`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">_fix_meta</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="FlowDetail.add"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.FlowDetail.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ad</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a new atom detail into this flow detail.</span>

<span class="sd">        NOTE(harlowja): if an existing atom detail exists with the same</span>
<span class="sd">        uuid the existing one will be overwritten with the newly provided</span>
<span class="sd">        one.</span>

<span class="sd">        Does not *guarantee* that the details will be immediately saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atomdetails_by_id</span><span class="p">[</span><span class="n">ad</span><span class="o">.</span><span class="n">uuid</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad</span></div>

<div class="viewcode-block" id="FlowDetail.find"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.FlowDetail.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ad_uuid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Locate the atom detail corresponding to the given uuid.</span>

<span class="sd">        :returns: the atom detail with that uuid</span>
<span class="sd">        :rtype: :py:class:`.AtomDetail` (or ``None`` if not found)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atomdetails_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ad_uuid</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unique identifer of this flow detail.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uuid</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The name of this flow detail.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ad</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atomdetails_by_id</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">ad</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atomdetails_by_id</span><span class="p">)</span></div>


<span class="nd">@six.add_metaclass</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">)</span>
<div class="viewcode-block" id="AtomDetail"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.AtomDetail">[docs]</a><span class="k">class</span> <span class="nc">AtomDetail</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A collection of atom specific runtime information and metadata.</span>

<span class="sd">    This is a base **abstract** class that contains attributes that are used</span>
<span class="sd">    to connect a atom to the persistence layer before, during, or after it is</span>
<span class="sd">    running. It includes any results it may have produced, any state that it</span>
<span class="sd">    may be in (for example ``FAILURE``), any exception that occurred when</span>
<span class="sd">    running, and any associated stacktrace that may have occurring during an</span>
<span class="sd">    exception being thrown. It may also contain any other metadata that</span>
<span class="sd">    should also be stored along-side the details about the connected atom.</span>

<span class="sd">    The data contained within this class need **not** be persisted to the</span>
<span class="sd">    backend storage in real time. The data in this class will only be</span>
<span class="sd">    guaranteed to be persisted when a save (or update) occurs via some backend</span>
<span class="sd">    connection.</span>

<span class="sd">    :ivar state: The state of the atom associated with this atom detail.</span>
<span class="sd">    :ivar intention: The execution strategy of the atom associated</span>
<span class="sd">                     with this atom detail (used by an engine/others to</span>
<span class="sd">                     determine if the associated atom needs to be</span>
<span class="sd">                     executed, reverted, retried and so-on).</span>
<span class="sd">    :ivar meta: A dictionary of meta-data associated with this atom detail.</span>
<span class="sd">    :ivar version: A version tuple or string that represents the</span>
<span class="sd">                   atom version this atom detail is associated with (typically</span>
<span class="sd">                   used for introspection and any data migration</span>
<span class="sd">                   strategies).</span>
<span class="sd">    :ivar results: Any results the atom produced from either its</span>
<span class="sd">                   ``execute`` method or from other sources.</span>
<span class="sd">    :ivar revert_results: Any results the atom produced from either its</span>
<span class="sd">                          ``revert`` method or from other sources.</span>
<span class="sd">    :ivar failure: If the atom failed (due to its ``execute`` method</span>
<span class="sd">                   raising) this will be a</span>
<span class="sd">                   :py:class:`~taskflow.types.failure.Failure` object that</span>
<span class="sd">                   represents that failure (if there was no failure this</span>
<span class="sd">                   will be set to none).</span>
<span class="sd">    :ivar revert_failure: If the atom failed (possibly due to its ``revert``</span>
<span class="sd">                          method raising) this will be a</span>
<span class="sd">                          :py:class:`~taskflow.types.failure.Failure` object</span>
<span class="sd">                          that represents that failure (if there was no</span>
<span class="sd">                          failure this will be set to none).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uuid</span> <span class="o">=</span> <span class="n">uuid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intention</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">EXECUTE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the atoms last result.</span>

<span class="sd">        If the atom has produced many results (for example if it has been</span>
<span class="sd">        retried, reverted, executed and ...) this returns the last one of</span>
<span class="sd">        many results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>

<div class="viewcode-block" id="AtomDetail.update"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.AtomDetail.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ad</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the object&#39;s state to be the same as the given one.</span>

<span class="sd">        This will assign the private and public attributes of the given</span>
<span class="sd">        atom detail directly to this object (replacing any existing</span>
<span class="sd">        attributes in this object; even if they are the **same**).</span>

<span class="sd">        NOTE(harlowja): If the provided object is this object itself</span>
<span class="sd">        then **no** update is done.</span>

<span class="sd">        :returns: this atom detail</span>
<span class="sd">        :rtype: :py:class:`.AtomDetail`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ad</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intention</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">intention</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">meta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">failure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">revert_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">revert_failure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">version</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="AtomDetail.merge"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.AtomDetail.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">deep_copy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Merges the current object state with the given ones state.</span>

<span class="sd">        If ``deep_copy`` is provided as truthy then the</span>
<span class="sd">        local object will use ``copy.deepcopy`` to replace this objects</span>
<span class="sd">        local attributes with the provided objects attributes (**only** if</span>
<span class="sd">        there is a difference between this objects attributes and the</span>
<span class="sd">        provided attributes). If ``deep_copy`` is falsey (the default) then a</span>
<span class="sd">        reference copy will occur instead when a difference is detected.</span>

<span class="sd">        NOTE(harlowja): If the provided object is this object itself</span>
<span class="sd">        then **no** merging is done. Do note that **no** results are merged</span>
<span class="sd">        in this method. That operation **must** to be the responsibilty of</span>
<span class="sd">        subclasses to implement and override this abstract method</span>
<span class="sd">        and provide that merging themselves as they see fit.</span>

<span class="sd">        :returns: this atom detail (freshly merged with the incoming object)</span>
<span class="sd">        :rtype: :py:class:`.AtomDetail`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copy_fn</span> <span class="o">=</span> <span class="n">_copy_function</span><span class="p">(</span><span class="n">deep_copy</span><span class="p">)</span>
        <span class="c1"># NOTE(imelnikov): states and intentions are just strings,</span>
        <span class="c1"># so there is no need to copy them (strings are immutable in python).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intention</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">intention</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">failure</span><span class="p">:</span>
            <span class="c1"># NOTE(imelnikov): we can&#39;t just deep copy Failures, as they</span>
            <span class="c1"># contain tracebacks, which are not copyable.</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">failure</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">deep_copy</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">failure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">failure</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">revert_failure</span><span class="p">:</span>
            <span class="c1"># NOTE(imelnikov): we can&#39;t just deep copy Failures, as they</span>
            <span class="c1"># contain tracebacks, which are not copyable.</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">revert_failure</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">deep_copy</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">revert_failure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">revert_failure</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">copy_fn</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">copy_fn</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="AtomDetail.put"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.AtomDetail.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Puts a result (acquired in the given state) into this detail.&quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="AtomDetail.to_dict"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.AtomDetail.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Translates the internal state of this object to a ``dict``.</span>

<span class="sd">        :returns: this atom detail in ``dict`` form</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure</span><span class="p">:</span>
            <span class="n">failure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">failure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span><span class="p">:</span>
            <span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;failure&#39;</span><span class="p">:</span> <span class="n">failure</span><span class="p">,</span>
            <span class="s1">&#39;revert_failure&#39;</span><span class="p">:</span> <span class="n">revert_failure</span><span class="p">,</span>
            <span class="s1">&#39;meta&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span>
            <span class="s1">&#39;revert_results&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span><span class="p">,</span>
            <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="s1">&#39;intention&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">intention</span><span class="p">,</span>
            <span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
        <span class="p">}</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="AtomDetail.from_dict"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.AtomDetail.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Translates the given ``dict`` into an instance of this class.</span>

<span class="sd">        NOTE(harlowja): the ``dict`` provided should come from a prior</span>
<span class="sd">        call to :meth:`.to_dict`.</span>

<span class="sd">        :returns: a new atom detail</span>
<span class="sd">        :rtype: :py:class:`.AtomDetail`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">intention</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;intention&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;revert_results&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">_fix_meta</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">failure</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;failure&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">failure</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">Failure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">failure</span><span class="p">)</span>
        <span class="n">revert_failure</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;revert_failure&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">revert_failure</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">Failure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">revert_failure</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unique identifer of this atom detail.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uuid</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The name of this atom detail.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="AtomDetail.reset"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.AtomDetail.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets this atom detail and sets ``state`` attribute value.&quot;&quot;&quot;</span></div>

    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="AtomDetail.copy"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.AtomDetail.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies this atom detail.&quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="AtomDetail.pformat"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.AtomDetail.pformat">[docs]</a>    <span class="k">def</span> <span class="nf">pformat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linesep</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pretty formats this atom detail into a string.&quot;&quot;&quot;</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span><span class="p">),</span> <span class="n">cls_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_format_shared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">- version = </span><span class="si">%s</span><span class="s2">&quot;</span>
                     <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">misc</span><span class="o">.</span><span class="n">get_version_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">- results = </span><span class="si">%s</span><span class="s2">&quot;</span>
                     <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">- failure = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                           <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failure</span><span class="p">)))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_format_meta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TaskDetail"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.TaskDetail">[docs]</a><span class="k">class</span> <span class="nc">TaskDetail</span><span class="p">(</span><span class="n">AtomDetail</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A task detail (an atom detail typically associated with a |tt| atom).</span>

<span class="sd">    .. |tt| replace:: :py:class:`~taskflow.task.Task`</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TaskDetail.reset"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.TaskDetail.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets this task detail and sets ``state`` attribute value.</span>

<span class="sd">        This sets any previously set ``results``, ``failure``,</span>
<span class="sd">        and ``revert_results`` attributes back to ``None`` and sets the</span>
<span class="sd">        state to the provided one, as well as setting this task</span>
<span class="sd">        details ``intention`` attribute to ``EXECUTE``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intention</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">EXECUTE</span></div>

<div class="viewcode-block" id="TaskDetail.put"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.TaskDetail.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Puts a result (acquired in the given state) into this detail.</span>

<span class="sd">        Returns whether this object was modified (or whether it was not).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
            <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">states</span><span class="o">.</span><span class="n">REVERT_FAILURE</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">!=</span> <span class="n">result</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="n">result</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_all_none</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">states</span><span class="o">.</span><span class="n">FAILURE</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">!=</span> <span class="n">result</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="n">result</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_all_none</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">states</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_all_none</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">failure</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="c1"># We don&#39;t really have the ability to determine equality of</span>
            <span class="c1"># task (user) results at the current time, without making</span>
            <span class="c1"># potentially bad guesses, so assume the task detail always needs</span>
            <span class="c1"># to be saved if they are not exactly equivalent...</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">result</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">states</span><span class="o">.</span><span class="n">REVERTED</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_all_none</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="n">result</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="n">was_altered</span></div>

<div class="viewcode-block" id="TaskDetail.merge"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.TaskDetail.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">deep_copy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Merges the current task detail with the given one.</span>

<span class="sd">        NOTE(harlowja): This merge does **not** copy and replace</span>
<span class="sd">        the ``results`` or ``revert_results`` if it differs. Instead the</span>
<span class="sd">        current objects ``results`` and ``revert_results`` attributes directly</span>
<span class="sd">        becomes (via assignment) the other objects attributes. Also note that</span>
<span class="sd">        if the provided object is this object itself then **no** merging is</span>
<span class="sd">        done.</span>

<span class="sd">        See: https://bugs.launchpad.net/taskflow/+bug/1452978 for</span>
<span class="sd">        what happens if this is copied at a deeper level (for example by</span>
<span class="sd">        using ``copy.deepcopy`` or by using ``copy.copy``).</span>

<span class="sd">        :returns: this task detail (freshly merged with the incoming object)</span>
<span class="sd">        :rtype: :py:class:`.TaskDetail`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">TaskDetail</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can only merge with other&quot;</span>
                                          <span class="s2">&quot; task details&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TaskDetail</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">deep_copy</span><span class="o">=</span><span class="n">deep_copy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">revert_results</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="TaskDetail.copy"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.TaskDetail.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies this task detail.</span>

<span class="sd">        Creates a shallow copy of this task detail (any meta-data and</span>
<span class="sd">        version information that this object maintains is shallow</span>
<span class="sd">        copied via ``copy.copy``).</span>

<span class="sd">        NOTE(harlowja): This copy does **not** copy and replace</span>
<span class="sd">        the ``results`` or ``revert_results`` attribute if it differs. Instead</span>
<span class="sd">        the current objects ``results`` and ``revert_results`` attributes</span>
<span class="sd">        directly becomes (via assignment) the cloned objects attributes.</span>

<span class="sd">        See: https://bugs.launchpad.net/taskflow/+bug/1452978 for</span>
<span class="sd">        what happens if this is copied at a deeper level (for example by</span>
<span class="sd">        using ``copy.deepcopy`` or by using ``copy.copy``).</span>

<span class="sd">        :returns: a new task detail</span>
<span class="sd">        :rtype: :py:class:`.TaskDetail`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="n">clone</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="n">clone</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clone</span></div></div>


<div class="viewcode-block" id="RetryDetail"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.RetryDetail">[docs]</a><span class="k">class</span> <span class="nc">RetryDetail</span><span class="p">(</span><span class="n">AtomDetail</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A retry detail (an atom detail typically associated with a |rt| atom).</span>

<span class="sd">    .. |rt| replace:: :py:class:`~taskflow.retry.Retry`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RetryDetail</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">uuid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="RetryDetail.reset"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.RetryDetail.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets this retry detail and sets ``state`` attribute value.</span>

<span class="sd">        This sets any previously added ``results`` back to an empty list</span>
<span class="sd">        and resets the ``failure`` and ``revert_failure`` and</span>
<span class="sd">        ``revert_results`` attributes back to ``None`` and sets the state</span>
<span class="sd">        to the provided one, as well as setting this retry</span>
<span class="sd">        details ``intention`` attribute to ``EXECUTE``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intention</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">EXECUTE</span></div>

<div class="viewcode-block" id="RetryDetail.copy"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.RetryDetail.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies this retry detail.</span>

<span class="sd">        Creates a shallow copy of this retry detail (any meta-data and</span>
<span class="sd">        version information that this object maintains is shallow</span>
<span class="sd">        copied via ``copy.copy``).</span>

<span class="sd">        NOTE(harlowja): This copy does **not** copy</span>
<span class="sd">        the incoming objects ``results`` or ``revert_results`` attributes.</span>
<span class="sd">        Instead this objects ``results`` attribute list is iterated over and</span>
<span class="sd">        a new list is constructed with each ``(data, failures)`` element in</span>
<span class="sd">        that list having its ``failures`` (a dictionary of each named</span>
<span class="sd">        :py:class:`~taskflow.types.failure.Failure` object that</span>
<span class="sd">        occured) copied but its ``data`` is left untouched. After</span>
<span class="sd">        this is done that new list becomes (via assignment) the cloned</span>
<span class="sd">        objects ``results`` attribute. The ``revert_results`` is directly</span>
<span class="sd">        assigned to the cloned objects ``revert_results`` attribute.</span>

<span class="sd">        See: https://bugs.launchpad.net/taskflow/+bug/1452978 for</span>
<span class="sd">        what happens if the ``data`` in ``results`` is copied at a</span>
<span class="sd">        deeper level (for example by using ``copy.deepcopy`` or by</span>
<span class="sd">        using ``copy.copy``).</span>

<span class="sd">        :returns: a new retry detail</span>
<span class="sd">        :rtype: :py:class:`.RetryDetail`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># NOTE(imelnikov): we can&#39;t just deep copy Failures, as they</span>
        <span class="c1"># contain tracebacks, which are not copyable.</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">failures</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="n">copied_failures</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">failure</span><span class="p">)</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">failures</span><span class="p">):</span>
                <span class="n">copied_failures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">failure</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">copied_failures</span><span class="p">))</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">results</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="n">clone</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="n">clone</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clone</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The last result that was produced.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">exc</span><span class="o">.</span><span class="n">raise_with_cause</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">NotFound</span><span class="p">,</span> <span class="s2">&quot;Last results not found&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_failures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The last failure dictionary that was produced.</span>

<span class="sd">        NOTE(harlowja): This is **not** the same as the</span>
<span class="sd">        local ``failure`` attribute as the obtained failure dictionary in</span>
<span class="sd">        the ``results`` attribute (which is what this returns) is from</span>
<span class="sd">        associated atom failures (which is different from the directly</span>
<span class="sd">        related failure of the retry unit associated with this</span>
<span class="sd">        atom detail).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">exc</span><span class="o">.</span><span class="n">raise_with_cause</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">NotFound</span><span class="p">,</span> <span class="s2">&quot;Last failures not found&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="RetryDetail.put"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.RetryDetail.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Puts a result (acquired in the given state) into this detail.</span>

<span class="sd">        Returns whether this object was modified (or whether it was not).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Do not clean retry history (only on reset does this happen).</span>
        <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
            <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">states</span><span class="o">.</span><span class="n">REVERT_FAILURE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="n">result</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_all_none</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">states</span><span class="o">.</span><span class="n">FAILURE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="n">result</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_all_none</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">states</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_all_none</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failure</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="c1"># Track what we produced, so that we can examine it (or avoid</span>
            <span class="c1"># using it again).</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">result</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">states</span><span class="o">.</span><span class="n">REVERTED</span><span class="p">:</span>
            <span class="c1"># We don&#39;t really have the ability to determine equality of</span>
            <span class="c1"># task (user) results at the current time, without making</span>
            <span class="c1"># potentially bad guesses, so assume the retry detail always needs</span>
            <span class="c1"># to be saved if they are not exactly equivalent...</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_results</span> <span class="o">=</span> <span class="n">result</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_all_none</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_failure</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">was_altered</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="n">was_altered</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RetryDetail.from_dict"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.RetryDetail.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Translates the given ``dict`` into an instance of this class.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">decode_results</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">new_results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">failures</span><span class="p">)</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">new_failures</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">failures</span><span class="p">):</span>
                    <span class="n">new_failures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">Failure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">new_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">new_failures</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">new_results</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">RetryDetail</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">decode_results</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="RetryDetail.to_dict"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.RetryDetail.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Translates the internal state of this object to a ``dict``.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">encode_results</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">new_results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">failures</span><span class="p">)</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">new_failures</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">failure</span><span class="p">)</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">failures</span><span class="p">):</span>
                    <span class="n">new_failures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">failure</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
                <span class="n">new_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">new_failures</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">new_results</span>

        <span class="n">base</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">RetryDetail</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">base</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encode_results</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">base</span></div>

<div class="viewcode-block" id="RetryDetail.merge"><a class="viewcode-back" href="../../../persistence.html#taskflow.persistence.models.RetryDetail.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">deep_copy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Merges the current retry detail with the given one.</span>

<span class="sd">        NOTE(harlowja): This merge does **not** deep copy</span>
<span class="sd">        the incoming objects ``results`` attribute (if it differs). Instead</span>
<span class="sd">        the incoming objects ``results`` attribute list is **always** iterated</span>
<span class="sd">        over and a new list is constructed with</span>
<span class="sd">        each ``(data, failures)`` element in that list having</span>
<span class="sd">        its ``failures`` (a dictionary of each named</span>
<span class="sd">        :py:class:`~taskflow.types.failure.Failure` objects that</span>
<span class="sd">        occurred) copied but its ``data`` is left untouched. After</span>
<span class="sd">        this is done that new list becomes (via assignment) this</span>
<span class="sd">        objects ``results`` attribute. Also note that if the provided object</span>
<span class="sd">        is this object itself then **no** merging is done.</span>

<span class="sd">        See: https://bugs.launchpad.net/taskflow/+bug/1452978 for</span>
<span class="sd">        what happens if the ``data`` in ``results`` is copied at a</span>
<span class="sd">        deeper level (for example by using ``copy.deepcopy`` or by</span>
<span class="sd">        using ``copy.copy``).</span>

<span class="sd">        :returns: this retry detail (freshly merged with the incoming object)</span>
<span class="sd">        :rtype: :py:class:`.RetryDetail`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">RetryDetail</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can only merge with other&quot;</span>
                                          <span class="s2">&quot; retry details&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RetryDetail</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">deep_copy</span><span class="o">=</span><span class="n">deep_copy</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># NOTE(imelnikov): we can&#39;t just deep copy Failures, as they</span>
        <span class="c1"># contain tracebacks, which are not copyable.</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">failures</span><span class="p">)</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="n">copied_failures</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">failure</span><span class="p">)</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">failures</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">deep_copy</span><span class="p">:</span>
                    <span class="n">copied_failures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">failure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">copied_failures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">failure</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">copied_failures</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">results</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<span class="n">_DETAIL_TO_NAME</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">RetryDetail</span><span class="p">:</span> <span class="s1">&#39;RETRY_DETAIL&#39;</span><span class="p">,</span>
    <span class="n">TaskDetail</span><span class="p">:</span> <span class="s1">&#39;TASK_DETAIL&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">_NAME_TO_DETAIL</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
                       <span class="k">for</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">_DETAIL_TO_NAME</span><span class="p">))</span>
<span class="n">ATOM_TYPES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">(</span><span class="n">_NAME_TO_DETAIL</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">atom_detail_class</span><span class="p">(</span><span class="n">atom_type</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_NAME_TO_DETAIL</span><span class="p">[</span><span class="n">atom_type</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unknown atom type &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom_type</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">atom_detail_type</span><span class="p">(</span><span class="n">atom_detail</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_DETAIL_TO_NAME</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">atom_detail</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unknown atom &#39;</span><span class="si">%s</span><span class="s2">&#39; (</span><span class="si">%s</span><span class="s2">)&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">atom_detail</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">atom_detail</span><span class="p">)))</span>
</pre></div>

          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
  <h3>Navigation</h3>
  <ul>

    <li><a href="../../../index.html">Table Of Contents</a></li>



  </ul>

            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/taskflow
"
                     rel="nofollow">Project Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">TaskFlow 2.9.1.dev9 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2017, OpenStack Foundation.
      Last updated on &#39;Fri Feb 10 20:11:17 2017, commit 643495f&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/TaskFlow");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>