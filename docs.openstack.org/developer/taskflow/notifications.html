<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Notifications and listeners &mdash; TaskFlow 2.9.1.dev9 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.9.1.dev9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="TaskFlow 2.9.1.dev9 documentation" href="index.html" />
    <link rel="next" title="Persistence" href="persistence.html" />
    <link rel="prev" title="Engines" href="engines.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="notifications-and-listeners">
<h1>Notifications and listeners<a class="headerlink" href="#notifications-and-listeners" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Engines provide a way to receive notification on task and flow state
transitions (see <a class="reference internal" href="states.html"><em>states</em></a>), which is useful for
monitoring, logging, metrics, debugging and plenty of other tasks.</p>
<p>To receive these notifications you should register a callback with
an instance of the <a class="reference internal" href="types.html#taskflow.types.notifier.Notifier" title="taskflow.types.notifier.Notifier"><code class="xref py py-class docutils literal"><span class="pre">Notifier</span></code></a>
class that is attached to <a class="reference internal" href="engines.html#taskflow.engines.base.Engine" title="taskflow.engines.base.Engine"><code class="xref py py-class docutils literal"><span class="pre">Engine</span></code></a>
attributes <code class="docutils literal"><span class="pre">atom_notifier</span></code> and <code class="docutils literal"><span class="pre">notifier</span></code>.</p>
<p>TaskFlow also comes with a set of predefined <a class="reference internal" href="#listeners"><span>listeners</span></a>, and
provides means to write your own listeners, which can be more convenient than
using raw callbacks.</p>
</div>
<div class="section" id="receiving-notifications-with-callbacks">
<h2>Receiving notifications with callbacks<a class="headerlink" href="#receiving-notifications-with-callbacks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="flow-notifications">
<h3>Flow notifications<a class="headerlink" href="#flow-notifications" title="Permalink to this headline">¶</a></h3>
<p>To receive notification on flow state changes use the
<a class="reference internal" href="types.html#taskflow.types.notifier.Notifier" title="taskflow.types.notifier.Notifier"><code class="xref py py-class docutils literal"><span class="pre">Notifier</span></code></a> instance available as the
<code class="docutils literal"><span class="pre">notifier</span></code> property of an engine.</p>
<p>A basic example is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CatTalk</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meow</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">meow</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s2">&quot;cat&quot;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">DogTalk</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">woof</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">woof</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s1">&#39;dog&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">flow_transition</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">details</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Flow &#39;</span><span class="si">%s</span><span class="s2">&#39; transition to state </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;flow_name&#39;</span><span class="p">],</span> <span class="n">state</span><span class="p">))</span>
<span class="gp">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flo</span> <span class="o">=</span> <span class="n">linear_flow</span><span class="o">.</span><span class="n">Flow</span><span class="p">(</span><span class="s2">&quot;cat-dog&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="gp">... </span>  <span class="n">CatTalk</span><span class="p">(),</span> <span class="n">DogTalk</span><span class="p">(</span><span class="n">provides</span><span class="o">=</span><span class="s2">&quot;dog&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eng</span> <span class="o">=</span> <span class="n">engines</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">flo</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;meow&#39;</span><span class="p">:</span> <span class="s1">&#39;meow&#39;</span><span class="p">,</span> <span class="s1">&#39;woof&#39;</span><span class="p">:</span> <span class="s1">&#39;woof&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eng</span><span class="o">.</span><span class="n">notifier</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ANY</span><span class="p">,</span> <span class="n">flow_transition</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eng</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="go">Flow &#39;cat-dog&#39; transition to state RUNNING</span>
<span class="go">meow</span>
<span class="go">woof</span>
<span class="go">Flow &#39;cat-dog&#39; transition to state SUCCESS</span>
</pre></div>
</div>
</div>
<div class="section" id="task-notifications">
<h3>Task notifications<a class="headerlink" href="#task-notifications" title="Permalink to this headline">¶</a></h3>
<p>To receive notification on task state changes use the
<a class="reference internal" href="types.html#taskflow.types.notifier.Notifier" title="taskflow.types.notifier.Notifier"><code class="xref py py-class docutils literal"><span class="pre">Notifier</span></code></a> instance available as the
<code class="docutils literal"><span class="pre">atom_notifier</span></code> property of an engine.</p>
<p>A basic example is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CatTalk</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meow</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">meow</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s2">&quot;cat&quot;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">DogTalk</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">woof</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">woof</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s1">&#39;dog&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">task_transition</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">details</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Task &#39;</span><span class="si">%s</span><span class="s2">&#39; transition to state </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;task_name&#39;</span><span class="p">],</span> <span class="n">state</span><span class="p">))</span>
<span class="gp">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flo</span> <span class="o">=</span> <span class="n">linear_flow</span><span class="o">.</span><span class="n">Flow</span><span class="p">(</span><span class="s2">&quot;cat-dog&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CatTalk</span><span class="p">(),</span> <span class="n">DogTalk</span><span class="p">(</span><span class="n">provides</span><span class="o">=</span><span class="s2">&quot;dog&quot;</span><span class="p">))</span>
<span class="go">&lt;taskflow.patterns.linear_flow.Flow object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eng</span> <span class="o">=</span> <span class="n">engines</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">flo</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;meow&#39;</span><span class="p">:</span> <span class="s1">&#39;meow&#39;</span><span class="p">,</span> <span class="s1">&#39;woof&#39;</span><span class="p">:</span> <span class="s1">&#39;woof&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eng</span><span class="o">.</span><span class="n">atom_notifier</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ANY</span><span class="p">,</span> <span class="n">task_transition</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eng</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="go">Task &#39;CatTalk&#39; transition to state RUNNING</span>
<span class="go">meow</span>
<span class="go">Task &#39;CatTalk&#39; transition to state SUCCESS</span>
<span class="go">Task &#39;DogTalk&#39; transition to state RUNNING</span>
<span class="go">woof</span>
<span class="go">Task &#39;DogTalk&#39; transition to state SUCCESS</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="listeners">
<span id="id1"></span><h2>Listeners<a class="headerlink" href="#listeners" title="Permalink to this headline">¶</a></h2>
<p>TaskFlow comes with a set of predefined listeners &#8211; helper classes that can be
used to do various actions on flow and/or tasks transitions. You can also
create your own listeners easily, which may be more convenient than using raw
callbacks for some use cases.</p>
<p>For example, this is how you can use
<a class="reference internal" href="#taskflow.listeners.printing.PrintingListener" title="taskflow.listeners.printing.PrintingListener"><code class="xref py py-class docutils literal"><span class="pre">PrintingListener</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">taskflow.listeners</span> <span class="kn">import</span> <span class="n">printing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">CatTalk</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meow</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">meow</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s2">&quot;cat&quot;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">DogTalk</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">woof</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">woof</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s1">&#39;dog&#39;</span>
<span class="gp">...</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flo</span> <span class="o">=</span> <span class="n">linear_flow</span><span class="o">.</span><span class="n">Flow</span><span class="p">(</span><span class="s2">&quot;cat-dog&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="gp">... </span>  <span class="n">CatTalk</span><span class="p">(),</span> <span class="n">DogTalk</span><span class="p">(</span><span class="n">provides</span><span class="o">=</span><span class="s2">&quot;dog&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eng</span> <span class="o">=</span> <span class="n">engines</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">flo</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;meow&#39;</span><span class="p">:</span> <span class="s1">&#39;meow&#39;</span><span class="p">,</span> <span class="s1">&#39;woof&#39;</span><span class="p">:</span> <span class="s1">&#39;woof&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">printing</span><span class="o">.</span><span class="n">PrintingListener</span><span class="p">(</span><span class="n">eng</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">eng</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="gp">...</span>
<span class="go">&lt;taskflow.engines.action_engine.engine.SerialActionEngine object at ...&gt; has moved flow &#39;cat-dog&#39; (...) into state &#39;RUNNING&#39; from state &#39;PENDING&#39;</span>
<span class="go">&lt;taskflow.engines.action_engine.engine.SerialActionEngine object at ...&gt; has moved task &#39;CatTalk&#39; (...) into state &#39;RUNNING&#39; from state &#39;PENDING&#39;</span>
<span class="go">meow</span>
<span class="go">&lt;taskflow.engines.action_engine.engine.SerialActionEngine object at ...&gt; has moved task &#39;CatTalk&#39; (...) into state &#39;SUCCESS&#39; from state &#39;RUNNING&#39; with result &#39;cat&#39; (failure=False)</span>
<span class="go">&lt;taskflow.engines.action_engine.engine.SerialActionEngine object at ...&gt; has moved task &#39;DogTalk&#39; (...) into state &#39;RUNNING&#39; from state &#39;PENDING&#39;</span>
<span class="go">woof</span>
<span class="go">&lt;taskflow.engines.action_engine.engine.SerialActionEngine object at ...&gt; has moved task &#39;DogTalk&#39; (...) into state &#39;SUCCESS&#39; from state &#39;RUNNING&#39; with result &#39;dog&#39; (failure=False)</span>
<span class="go">&lt;taskflow.engines.action_engine.engine.SerialActionEngine object at ...&gt; has moved flow &#39;cat-dog&#39; (...) into state &#39;SUCCESS&#39; from state &#39;RUNNING&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="module-taskflow.listeners.base">
<span id="interfaces"></span><h2>Interfaces<a class="headerlink" href="#module-taskflow.listeners.base" title="Permalink to this headline">¶</a></h2>
<dl class="data">
<dt id="taskflow.listeners.base.FINISH_STATES">
<code class="descclassname">taskflow.listeners.base.</code><code class="descname">FINISH_STATES</code><em class="property"> = ('FAILURE', 'SUCCESS', 'REVERTED', 'REVERT_FAILURE')</em><a class="headerlink" href="#taskflow.listeners.base.FINISH_STATES" title="Permalink to this definition">¶</a></dt>
<dd><p>These states will results be usable, other states do not produce results.</p>
</dd></dl>

<dl class="data">
<dt id="taskflow.listeners.base.DEFAULT_LISTEN_FOR">
<code class="descclassname">taskflow.listeners.base.</code><code class="descname">DEFAULT_LISTEN_FOR</code><em class="property"> = ('*',)</em><a class="headerlink" href="#taskflow.listeners.base.DEFAULT_LISTEN_FOR" title="Permalink to this definition">¶</a></dt>
<dd><p>What is listened for by default...</p>
</dd></dl>

<dl class="class">
<dt id="taskflow.listeners.base.Listener">
<em class="property">class </em><code class="descclassname">taskflow.listeners.base.</code><code class="descname">Listener</code><span class="sig-paren">(</span><em>engine</em>, <em>task_listen_for=('*'</em>, <em>)</em>, <em>flow_listen_for=('*'</em>, <em>)</em>, <em>retry_listen_for=('*'</em>, <em>)</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/listeners/base.html#Listener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.listeners.base.Listener" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Base class for listeners.</p>
<p>A listener can be attached to an engine to do various actions on flow and
atom state transitions. It implements the context manager protocol to be
able to register and unregister with a given engine automatically when a
context is entered and when it is exited.</p>
<p>To implement a listener, derive from this class and override
<code class="docutils literal"><span class="pre">_flow_receiver</span></code> and/or <code class="docutils literal"><span class="pre">_task_receiver</span></code> and/or <code class="docutils literal"><span class="pre">_retry_receiver</span></code>
methods (in this class, they do nothing).</p>
</dd></dl>

<dl class="class">
<dt id="taskflow.listeners.base.DumpingListener">
<em class="property">class </em><code class="descclassname">taskflow.listeners.base.</code><code class="descname">DumpingListener</code><span class="sig-paren">(</span><em>engine</em>, <em>task_listen_for=('*'</em>, <em>)</em>, <em>flow_listen_for=('*'</em>, <em>)</em>, <em>retry_listen_for=('*'</em>, <em>)</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/listeners/base.html#DumpingListener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.listeners.base.DumpingListener" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#taskflow.listeners.base.Listener" title="taskflow.listeners.base.Listener"><code class="xref py py-class docutils literal"><span class="pre">taskflow.listeners.base.Listener</span></code></a></p>
<p>Abstract base class for dumping listeners.</p>
<p>This provides a simple listener that can be attached to an engine which can
be derived from to dump task and/or flow state transitions to some target
backend.</p>
<p>To implement your own dumping listener derive from this class and
override the <code class="docutils literal"><span class="pre">_dump</span></code> method.</p>
</dd></dl>

</div>
<div class="section" id="implementations">
<h2>Implementations<a class="headerlink" href="#implementations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="printing-and-logging-listeners">
<h3>Printing and logging listeners<a class="headerlink" href="#printing-and-logging-listeners" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="taskflow.listeners.logging.LoggingListener">
<em class="property">class </em><code class="descclassname">taskflow.listeners.logging.</code><code class="descname">LoggingListener</code><span class="sig-paren">(</span><em>engine</em>, <em>task_listen_for=('*'</em>, <em>)</em>, <em>flow_listen_for=('*'</em>, <em>)</em>, <em>retry_listen_for=('*'</em>, <em>)</em>, <em>log=None</em>, <em>level=10</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/listeners/logging.html#LoggingListener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.listeners.logging.LoggingListener" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#taskflow.listeners.base.DumpingListener" title="taskflow.listeners.base.DumpingListener"><code class="xref py py-class docutils literal"><span class="pre">taskflow.listeners.base.DumpingListener</span></code></a></p>
<p>Listener that logs notifications it receives.</p>
<p>It listens for task and flow notifications and writes those notifications
to a provided logger, or logger of its module
(<code class="docutils literal"><span class="pre">taskflow.listeners.logging</span></code>) if none is provided (and no class
attribute is overridden). The log level can also be
configured, <code class="docutils literal"><span class="pre">logging.DEBUG</span></code> is used by default when none is provided.</p>
</dd></dl>

<dl class="class">
<dt id="taskflow.listeners.logging.DynamicLoggingListener">
<em class="property">class </em><code class="descclassname">taskflow.listeners.logging.</code><code class="descname">DynamicLoggingListener</code><span class="sig-paren">(</span><em>engine</em>, <em>task_listen_for=('*'</em>, <em>)</em>, <em>flow_listen_for=('*'</em>, <em>)</em>, <em>retry_listen_for=('*'</em>, <em>)</em>, <em>log=None</em>, <em>failure_level=30</em>, <em>level=10</em>, <em>hide_inputs_outputs_of=()</em>, <em>fail_formatter=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/listeners/logging.html#DynamicLoggingListener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.listeners.logging.DynamicLoggingListener" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#taskflow.listeners.base.Listener" title="taskflow.listeners.base.Listener"><code class="xref py py-class docutils literal"><span class="pre">taskflow.listeners.base.Listener</span></code></a></p>
<p>Listener that logs notifications it receives.</p>
<p>It listens for task and flow notifications and writes those notifications
to a provided logger, or logger of its module
(<code class="docutils literal"><span class="pre">taskflow.listeners.logging</span></code>) if none is provided (and no class
attribute is overridden). The log level can <em>slightly</em> be configured
and <code class="docutils literal"><span class="pre">logging.DEBUG</span></code> or <code class="docutils literal"><span class="pre">logging.WARNING</span></code> (unless overridden via a
constructor parameter) will be selected automatically based on the
execution state and results produced.</p>
<p>The following flow states cause <code class="docutils literal"><span class="pre">logging.WARNING</span></code> (or provided
level) to be used:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">states.FAILURE</span></code></li>
<li><code class="docutils literal"><span class="pre">states.REVERTED</span></code></li>
</ul>
<p>The following task states cause <code class="docutils literal"><span class="pre">logging.WARNING</span></code> (or provided level)
to be used:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">states.FAILURE</span></code></li>
<li><code class="docutils literal"><span class="pre">states.RETRYING</span></code></li>
<li><code class="docutils literal"><span class="pre">states.REVERTING</span></code></li>
<li><code class="docutils literal"><span class="pre">states.REVERT_FAILURE</span></code></li>
</ul>
<p>When a task produces a <a class="reference internal" href="types.html#taskflow.types.failure.Failure" title="taskflow.types.failure.Failure"><code class="xref py py-class docutils literal"><span class="pre">Failure</span></code></a> object
as its result (typically this happens when a task raises an exception) this
will <strong>always</strong> switch the logger to use <code class="docutils literal"><span class="pre">logging.WARNING</span></code> (if the
failure object contains a <code class="docutils literal"><span class="pre">exc_info</span></code> tuple this will also be logged to
provide a meaningful traceback).</p>
</dd></dl>

<dl class="class">
<dt id="taskflow.listeners.printing.PrintingListener">
<em class="property">class </em><code class="descclassname">taskflow.listeners.printing.</code><code class="descname">PrintingListener</code><span class="sig-paren">(</span><em>engine</em>, <em>task_listen_for=('*'</em>, <em>)</em>, <em>flow_listen_for=('*'</em>, <em>)</em>, <em>retry_listen_for=('*'</em>, <em>)</em>, <em>stderr=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/listeners/printing.html#PrintingListener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.listeners.printing.PrintingListener" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#taskflow.listeners.base.DumpingListener" title="taskflow.listeners.base.DumpingListener"><code class="xref py py-class docutils literal"><span class="pre">taskflow.listeners.base.DumpingListener</span></code></a></p>
<p>Writes the task and flow notifications messages to stdout or stderr.</p>
</dd></dl>

</div>
<div class="section" id="timing-listeners">
<h3>Timing listeners<a class="headerlink" href="#timing-listeners" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="taskflow.listeners.timing.DurationListener">
<em class="property">class </em><code class="descclassname">taskflow.listeners.timing.</code><code class="descname">DurationListener</code><span class="sig-paren">(</span><em>engine</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/listeners/timing.html#DurationListener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.listeners.timing.DurationListener" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#taskflow.listeners.base.Listener" title="taskflow.listeners.base.Listener"><code class="xref py py-class docutils literal"><span class="pre">taskflow.listeners.base.Listener</span></code></a></p>
<p>Listener that captures task duration.</p>
<p>It records how long a task took to execute (or fail)
to storage. It saves the duration in seconds as float value
to task metadata with key <code class="docutils literal"><span class="pre">'duration'</span></code>.</p>
</dd></dl>

<dl class="class">
<dt id="taskflow.listeners.timing.PrintingDurationListener">
<em class="property">class </em><code class="descclassname">taskflow.listeners.timing.</code><code class="descname">PrintingDurationListener</code><span class="sig-paren">(</span><em>engine</em>, <em>printer=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/listeners/timing.html#PrintingDurationListener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.listeners.timing.PrintingDurationListener" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#taskflow.listeners.timing.DurationListener" title="taskflow.listeners.timing.DurationListener"><code class="xref py py-class docutils literal"><span class="pre">taskflow.listeners.timing.DurationListener</span></code></a></p>
<p>Listener that prints the duration as well as recording it.</p>
</dd></dl>

<dl class="class">
<dt id="taskflow.listeners.timing.EventTimeListener">
<em class="property">class </em><code class="descclassname">taskflow.listeners.timing.</code><code class="descname">EventTimeListener</code><span class="sig-paren">(</span><em>engine</em>, <em>task_listen_for=('*'</em>, <em>)</em>, <em>flow_listen_for=('*'</em>, <em>)</em>, <em>retry_listen_for=('*'</em>, <em>)</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/listeners/timing.html#EventTimeListener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.listeners.timing.EventTimeListener" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#taskflow.listeners.base.Listener" title="taskflow.listeners.base.Listener"><code class="xref py py-class docutils literal"><span class="pre">taskflow.listeners.base.Listener</span></code></a></p>
<p>Listener that captures task, flow, and retry event timestamps.</p>
<p>It records how when an event is received (using unix time) to
storage. It saves the timestamps under keys (in atom or flow details
metadata) of the format <code class="docutils literal"><span class="pre">{event}-timestamp</span></code> where <code class="docutils literal"><span class="pre">event</span></code> is the
state/event name that has been received.</p>
<p>This information can be later extracted/examined to derive durations...</p>
</dd></dl>

</div>
<div class="section" id="claim-listener">
<h3>Claim listener<a class="headerlink" href="#claim-listener" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="taskflow.listeners.claims.CheckingClaimListener">
<em class="property">class </em><code class="descclassname">taskflow.listeners.claims.</code><code class="descname">CheckingClaimListener</code><span class="sig-paren">(</span><em>engine</em>, <em>job</em>, <em>board</em>, <em>owner</em>, <em>on_job_loss=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/listeners/claims.html#CheckingClaimListener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.listeners.claims.CheckingClaimListener" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#taskflow.listeners.base.Listener" title="taskflow.listeners.base.Listener"><code class="xref py py-class docutils literal"><span class="pre">taskflow.listeners.base.Listener</span></code></a></p>
<p>Listener that interacts [engine, job, jobboard]; ensures claim is valid.</p>
<p>This listener (or a derivative) can be associated with an engines
notification system after the job has been claimed (so that the jobs work
can be worked on by that engine). This listener (after associated) will
check that the job is still claimed <em>whenever</em> the engine notifies of a
task or flow state change. If the job is not claimed when a state change
occurs, a associated handler (or the default) will be activated to
determine how to react to this <em>hopefully</em> exceptional case.</p>
<p>NOTE(harlowja): this may create more traffic than desired to the
jobboard backend (zookeeper or other), since the amount of state change
per task and flow is non-zero (and checking during each state change will
result in quite a few calls to that management system to check the jobs
claim status); this could be later optimized to check less (or only check
on a smaller set of states)</p>
<p>NOTE(harlowja): if a custom <code class="docutils literal"><span class="pre">on_job_loss</span></code> callback is provided it must
accept three positional arguments, the first being the current engine being
ran, the second being the &#8216;task/flow&#8217; state and the third being the details
that were sent from the engine to listeners for inspection.</p>
</dd></dl>

</div>
<div class="section" id="capturing-listener">
<h3>Capturing listener<a class="headerlink" href="#capturing-listener" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="taskflow.listeners.capturing.CaptureListener">
<em class="property">class </em><code class="descclassname">taskflow.listeners.capturing.</code><code class="descname">CaptureListener</code><span class="sig-paren">(</span><em>engine</em>, <em>task_listen_for=('*'</em>, <em>)</em>, <em>flow_listen_for=('*'</em>, <em>)</em>, <em>retry_listen_for=('*'</em>, <em>)</em>, <em>capture_flow=True</em>, <em>capture_task=True</em>, <em>capture_retry=True</em>, <em>skip_tasks=None</em>, <em>skip_retries=None</em>, <em>skip_flows=None</em>, <em>values=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/listeners/capturing.html#CaptureListener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.listeners.capturing.CaptureListener" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#taskflow.listeners.base.Listener" title="taskflow.listeners.base.Listener"><code class="xref py py-class docutils literal"><span class="pre">taskflow.listeners.base.Listener</span></code></a></p>
<p>A listener that captures transitions and saves them locally.</p>
<p>NOTE(harlowja): this listener is <em>mainly</em> useful for testing (where it is
useful to test the appropriate/expected transitions, produced results...
occurred after engine running) but it could have other usages as well.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Variables:</th><td class="field-body"><strong>values</strong> &#8211; Captured transitions + details (the result of
the <code class="xref py py-meth docutils literal"><span class="pre">_format_capture()</span></code> method) are stored into this
list (a previous list to append to may be provided using the
constructor keyword argument of the same name); by default
this stores tuples of the format <code class="docutils literal"><span class="pre">(kind,</span> <span class="pre">state,</span> <span class="pre">details)</span></code>.</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="taskflow.listeners.capturing.CaptureListener.FLOW">
<code class="descname">FLOW</code><em class="property"> = 'flow'</em><a class="headerlink" href="#taskflow.listeners.capturing.CaptureListener.FLOW" title="Permalink to this definition">¶</a></dt>
<dd><p>Kind that denotes a &#8216;flow&#8217; capture.</p>
</dd></dl>

<dl class="attribute">
<dt id="taskflow.listeners.capturing.CaptureListener.TASK">
<code class="descname">TASK</code><em class="property"> = 'task'</em><a class="headerlink" href="#taskflow.listeners.capturing.CaptureListener.TASK" title="Permalink to this definition">¶</a></dt>
<dd><p>Kind that denotes a &#8216;task&#8217; capture.</p>
</dd></dl>

<dl class="attribute">
<dt id="taskflow.listeners.capturing.CaptureListener.RETRY">
<code class="descname">RETRY</code><em class="property"> = 'retry'</em><a class="headerlink" href="#taskflow.listeners.capturing.CaptureListener.RETRY" title="Permalink to this definition">¶</a></dt>
<dd><p>Kind that denotes a &#8216;retry&#8217; capture.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-taskflow.formatters">
<span id="formatters"></span><h3>Formatters<a class="headerlink" href="#module-taskflow.formatters" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="taskflow.formatters.FailureFormatter">
<em class="property">class </em><code class="descclassname">taskflow.formatters.</code><code class="descname">FailureFormatter</code><span class="sig-paren">(</span><em>engine</em>, <em>hide_inputs_outputs_of=()</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/formatters.html#FailureFormatter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.formatters.FailureFormatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Formats a failure and connects it to associated atoms &amp; engine.</p>
<dl class="method">
<dt id="taskflow.formatters.FailureFormatter.format">
<code class="descname">format</code><span class="sig-paren">(</span><em>fail</em>, <em>atom_matcher</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/taskflow/formatters.html#FailureFormatter.format"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#taskflow.formatters.FailureFormatter.format" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a (exc_info, details) tuple about the failure.</p>
<p>The <code class="docutils literal"><span class="pre">exc_info</span></code> tuple should be a standard three element
(exctype, value, traceback) tuple that will be used for further
logging. A non-empty string is typically returned for <code class="docutils literal"><span class="pre">details</span></code>; it
should contain any string info about the failure (with any specific
details the <code class="docutils literal"><span class="pre">exc_info</span></code> may not have/contain).</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="hierarchy">
<h2>Hierarchy<a class="headerlink" href="#hierarchy" title="Permalink to this headline">¶</a></h2>
<p class="graphviz">
<img src="_images/inheritance-184ab1b01b64b26f7dd8b525000e27155eda547a.png" alt="Inheritance diagram of taskflow.listeners.base.DumpingListener, taskflow.listeners.base.Listener, taskflow.listeners.capturing.CaptureListener, taskflow.listeners.claims.CheckingClaimListener, taskflow.listeners.logging.DynamicLoggingListener, taskflow.listeners.logging.LoggingListener, taskflow.listeners.printing.PrintingListener, taskflow.listeners.timing.PrintingDurationListener, taskflow.listeners.timing.EventTimeListener, taskflow.listeners.timing.DurationListener" usemap="#inheritanced26e99fd92" class="inheritance"/>
<map id="inheritanced26e99fd92" name="inheritanced26e99fd92">
<area shape="rect" id="node1" href="#taskflow.listeners.capturing.CaptureListener" target="_top" title="A listener that captures transitions and saves them locally." alt="" coords="154,5,278,31"/>
<area shape="rect" id="node2" href="#taskflow.listeners.base.Listener" target="_top" title="Base class for listeners." alt="" coords="5,129,79,155"/>
<area shape="rect" id="node3" href="#taskflow.listeners.claims.CheckingClaimListener" target="_top" title="Listener that interacts [engine, job, jobboard]; ensures claim is valid." alt="" coords="133,55,299,80"/>
<area shape="rect" id="node4" href="#taskflow.listeners.base.DumpingListener" target="_top" title="Abstract base class for dumping listeners." alt="" coords="151,104,281,129"/>
<area shape="rect" id="node5" href="#taskflow.listeners.timing.DurationListener" target="_top" title="Listener that captures task duration." alt="" coords="152,153,280,179"/>
<area shape="rect" id="node6" href="#taskflow.listeners.logging.DynamicLoggingListener" target="_top" title="Listener that logs notifications it receives." alt="" coords="127,203,305,228"/>
<area shape="rect" id="node7" href="#taskflow.listeners.timing.EventTimeListener" target="_top" title="Listener that captures task, flow, and retry event timestamps." alt="" coords="146,252,286,277"/>
<area shape="rect" id="node8" href="#taskflow.listeners.logging.LoggingListener" target="_top" title="Listener that logs notifications it receives." alt="" coords="380,55,503,80"/>
<area shape="rect" id="node10" href="#taskflow.listeners.printing.PrintingListener" target="_top" title="Writes the task and flow notifications messages to stdout or stderr." alt="" coords="381,104,502,129"/>
<area shape="rect" id="node9" href="#taskflow.listeners.timing.PrintingDurationListener" target="_top" title="Listener that prints the duration as well as recording it." alt="" coords="353,153,529,179"/>
</map>
</p>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Notifications and listeners</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#receiving-notifications-with-callbacks">Receiving notifications with callbacks</a><ul>
<li><a class="reference internal" href="#flow-notifications">Flow notifications</a></li>
<li><a class="reference internal" href="#task-notifications">Task notifications</a></li>
</ul>
</li>
<li><a class="reference internal" href="#listeners">Listeners</a></li>
<li><a class="reference internal" href="#module-taskflow.listeners.base">Interfaces</a></li>
<li><a class="reference internal" href="#implementations">Implementations</a><ul>
<li><a class="reference internal" href="#printing-and-logging-listeners">Printing and logging listeners</a></li>
<li><a class="reference internal" href="#timing-listeners">Timing listeners</a></li>
<li><a class="reference internal" href="#claim-listener">Claim listener</a></li>
<li><a class="reference internal" href="#capturing-listener">Capturing listener</a></li>
<li><a class="reference internal" href="#module-taskflow.formatters">Formatters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hierarchy">Hierarchy</a></li>
</ul>
</li>
</ul>

  <h3>Navigation</h3>
  <ul>

    <li><a href="index.html">Table Of Contents</a></li>


    <li><a href="persistence.html" title="next chapter">Next topic: Persistence</a></li>


    <li><a href="engines.html" title="previous chapter">Previous topic: Engines</a></li>

  </ul>

            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/taskflow
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/notifications.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="persistence.html" title="Persistence"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="engines.html" title="Engines"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">TaskFlow 2.9.1.dev9 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2017, OpenStack Foundation.
      Last updated on &#39;Fri Feb 10 20:11:17 2017, commit 643495f&#39;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/TaskFlow");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>