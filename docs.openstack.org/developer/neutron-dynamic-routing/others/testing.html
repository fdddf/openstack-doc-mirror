<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Testing &mdash; neutron-dynamic-routing 10.0.0.0rc2.dev3 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '10.0.0.0rc2.dev3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="neutron-dynamic-routing 10.0.0.0rc2.dev3 documentation" href="../index.html" />
    <link rel="prev" title="Route Advertisement" href="../functionality/route-advertisement.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>Dynamic routing enables advertisement of self-service network prefixes to physical network
devices that support dynamic routing protocol such as routers. Neutron dynamic routing project that
consists of a service plugin-in and agent can advertise neutron private network to outside of
OpenStack. This document will describe how to test the Dynamic Routing functionalities, introduce
what the environment architecture is for dynamic routing test and show how to setup dynamic routing
environment using Devstack.</p>
<div class="section" id="environment-architecture">
<h2>Environment Architecture<a class="headerlink" href="#environment-architecture" title="Permalink to this headline">¶</a></h2>
<p>Using the following example architecture as a test environment to deploy neutron-dynamic-routing in
your environment. The example architecture will deploy an all-in-one OpenStack and pick up an Ubuntu
VM running Quagga as a router outside of OpenStack . See following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>                                                    +--------------+
                                       10.156.18.20 |              |
                 +----------------------------------|   Quagga     |
                 | BGP Peering Session              |   Router     |
                 |                                  |  172.24.4.3  |
                 |                                  +--------------+
                 |                                         |
                 |10.156.18.21                             |       External Network(172.24.4.0/24)
--------------------------------------------------------------------------------------------------                                        |ETH0    |br-ex
        +---------------------------------------+
        |        |        |                     |
        |        |        |                     |
        |        |        +-------+             |
        |        |                |172.24.4.1   |
        |  +------------+     +-------+         |
        |  |            |     |Router |         |
        |  |  Dr-Agent  |     |       |         |
        |  |            |     +-------+         |
        |  +------------+         |             |
        |                  ----------------     |
        |                  Tenant Network       |
        |                   (10.0.0.0/24)       |
        |                                       |
        +---------------------------------------+
        All-In-One OpenStack Installation
</pre></div>
</div>
</div>
<div class="section" id="devstack-setup">
<h2>Devstack Setup<a class="headerlink" href="#devstack-setup" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Download devstack:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>git clone http://git.openstack.org/openstack-dev/devstack.git
</pre></div>
</div>
</li>
<li><p class="first">Enable neutron-dynamic-routing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[[local|localrc]]
enable_plugin neutron-dynamic-routing http://git.openstack.org/openstack/neutron-dynamic-routing
</pre></div>
</div>
</li>
<li><p class="first">Run devstack:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./stack.sh
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="quagga-configure">
<h2>Quagga Configure<a class="headerlink" href="#quagga-configure" title="Permalink to this headline">¶</a></h2>
<p>Quagga is a network routing software available in most GNU/Linux, Solaris, FreeBSD, and NetBSD. It provides
the implementation of OSPF, RIP, BGP and IS-IS. This section shows you how to install Quagga and then configure
it on Ubuntu Linux.</p>
<ol class="arabic">
<li><p class="first">Install Quagga using apt-get:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo apt-get install quagga quagga-doc
</pre></div>
</div>
</li>
<li><p class="first">Create an empty file (/etc/quagga/zebra.conf) and set permissions.</p>
<p>The Quagga files and configurations will be stored in /etc/quagga:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo touch /etc/quagga/zebra.conf
$ sudo chown quagga.quagga /etc/quagga/zebra.conf
$ sudo chmod 640 /etc/quagga/zebra.conf
</pre></div>
</div>
</li>
<li><p class="first">Update quagga deamon file.</p>
<p>You can enable/disable the daemons routing in the /etc/quagga/daemons file. Update /etc/quagga/deamons to enable zebra and bgp:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">zebra</span><span class="o">=</span><span class="n">yes</span>
<span class="n">bgpd</span><span class="o">=</span><span class="n">yes</span>
<span class="n">ospfd</span><span class="o">=</span><span class="n">no</span>
<span class="n">ospf6d</span><span class="o">=</span><span class="n">no</span>
<span class="n">ripd</span><span class="o">=</span><span class="n">no</span>
<span class="n">ripngd</span><span class="o">=</span><span class="n">no</span>
<span class="n">isisd</span><span class="o">=</span><span class="n">no</span>
</pre></div>
</div>
</li>
<li><p class="first">Update /etc/quagga/zebra.conf:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># Zebra configuration
# name of the router
hostname quagga_1
password zebra

# log
log file /var/log/quagga/zebra.log
</pre></div>
</div>
</li>
<li><p class="first">Update /etc/quagga/bgpd.conf:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># set router-id to the network address we announce
bgp router-id 10.156.18.20

# declare a router with local-as 1000
router bgp 1000

# expose neighbor network which dynamic routing agent is using
neighbor 10.156.18.21 remote-as 12345

# treat neutron dynamic routing agent as a passive peer in case
# quagga keeps making futile connection attempts
neighbor 10.156.18.21 passive

# log
log file /var/log/quagga/bgpd.log

debug bgp events
debug bgp filters
debug bgp fsm
debug bgp keepalives
debug bgp updates
</pre></div>
</div>
</li>
<li><p class="first">Restart the Quagga:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ sudo /etc/init.d/quagga restart
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="service-test">
<h2>Service Test<a class="headerlink" href="#service-test" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">As the dynamic routing is only supported by admin, source the devstack admin credentials:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ source devstack/openrc admin admin
</pre></div>
</div>
</li>
<li><p class="first">Verify the neutron dynamic routing agent is running.</p>
</li>
</ol>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron agent-list --agent-type <span class="s1">&#39;BGP dynamic routing agent&#39;</span>
<span class="go">+--------------------+--------------------+--------------------+-------------------+-------+----------------+---------------------+</span>
<span class="go">| id                 | agent_type         | host               | availability_zone | alive | admin_state_up | binary              |</span>
<span class="go">+--------------------+--------------------+--------------------+-------------------+-------+----------------+---------------------+</span>
<span class="go">| 69ad386f-e055-4284 | BGP dynamic        | yang-devstack-     |                   | :-)   | True           | neutron-bgp-dragent |</span>
<span class="go">| -8c8e-ef9bd540705c | routing agent      | ubuntu-1604        |                   |       |                |                     |</span>
<span class="go">+--------------------+--------------------+--------------------+-------------------+-------+----------------+---------------------+</span>
</pre></div>
</div>
<ol class="arabic" start="3">
<li><p class="first">Create an address scope.</p>
<p>The provider(external) and tenant networks must belong to the same address scope
for the agent to advertise those tenant network prefixes.</p>
<blockquote>
<div><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron address-scope-create --shared public <span class="m">4</span>
<span class="go">Created a new address_scope:</span>
<span class="go">+------------+--------------------------------------+</span>
<span class="go">| Field      | Value                                |</span>
<span class="go">+------------+--------------------------------------+</span>
<span class="go">| id         | c02c358a-9d35-43ea-8313-986b3e4a91c0 |</span>
<span class="go">| ip_version | 4                                    |</span>
<span class="go">| name       | public                               |</span>
<span class="go">| shared     | True                                 |</span>
<span class="go">| tenant_id  | b3ac05ef10bf441fbf4aa17f16ae1e6d     |</span>
<span class="go">+------------+--------------------------------------+</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create subnet pools. The provider and tenant networks use different pools.</p>
<blockquote>
<div><ul class="simple">
<li>Create the provider network pool.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron subnetpool-create --pool-prefix <span class="m">172</span>.24.4.0/24 <span class="se">\</span>
  --address-scope public provider
<span class="go">Created a new subnetpool:</span>
<span class="go">+-------------------+--------------------------------------+</span>
<span class="go">| Field             | Value                                |</span>
<span class="go">+-------------------+--------------------------------------+</span>
<span class="go">| address_scope_id  | 238aaf8f-f91a-4538-b6b2-c0140111cf69 |</span>
<span class="go">| created_at        | 2016-06-30T07:03:52                  |</span>
<span class="go">| default_prefixlen | 8                                    |</span>
<span class="go">| default_quota     |                                      |</span>
<span class="go">| description       |                                      |</span>
<span class="go">| id                | 8439bfee-e09c-40a9-a3ea-8cf7212b7ba9 |</span>
<span class="go">| ip_version        | 4                                    |</span>
<span class="go">| is_default        | False                                |</span>
<span class="go">| max_prefixlen     | 32                                   |</span>
<span class="go">| min_prefixlen     | 8                                    |</span>
<span class="go">| name              | provider                             |</span>
<span class="go">| prefixes          | 172.24.4.0/24                        |</span>
<span class="go">| shared            | False                                |</span>
<span class="go">| tenant_id         | 21734c4383284cf9906b7fe8246bffb1     |</span>
<span class="go">| updated_at        | 2016-06-30T07:03:52                  |</span>
<span class="go">+-------------------+--------------------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li>Create tenant network pool.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron subnetpool-create --pool-prefix <span class="m">10</span>.0.0.0/16 <span class="se">\</span>
  --address-scope public --shared selfservice
<span class="go">Created a new subnetpool:</span>
<span class="go">+-------------------+--------------------------------------+</span>
<span class="go">| Field             | Value                                |</span>
<span class="go">+-------------------+--------------------------------------+</span>
<span class="go">| address_scope_id  | c02c358a-9d35-43ea-8313-986b3e4a91c0 |</span>
<span class="go">| created_at        | 2016-06-30T07:08:30                  |</span>
<span class="go">| default_prefixlen | 8                                    |</span>
<span class="go">| default_quota     |                                      |</span>
<span class="go">| description       |                                      |</span>
<span class="go">| id                | c7e9737a-cfd3-45b5-a861-d1cee1135a92 |</span>
<span class="go">| ip_version        | 4                                    |</span>
<span class="go">| is_default        | False                                |</span>
<span class="go">| max_prefixlen     | 32                                   |</span>
<span class="go">| min_prefixlen     | 8                                    |</span>
<span class="go">| name              | selfservice                          |</span>
<span class="go">| prefixes          | 10.0.0.0/16                          |</span>
<span class="go">| shared            | True                                 |</span>
<span class="go">| tenant_id         | b3ac05ef10bf441fbf4aa17f16ae1e6d     |</span>
<span class="go">| updated_at        | 2016-06-30T07:08:30                  |</span>
<span class="go">+-------------------+--------------------------------------+</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create the provider and tenant networks.</p>
<blockquote>
<div><ul class="simple">
<li>Create the provider network.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron net-create --router:external True --provider:physical_network provider <span class="se">\</span>
  --provider:network_type flat provider
<span class="go">Created a new network:</span>
<span class="go">+---------------------------+--------------------------------------+</span>
<span class="go">| Field                     | Value                                |</span>
<span class="go">+---------------------------+--------------------------------------+</span>
<span class="go">| admin_state_up            | True                                 |</span>
<span class="go">| id                        | 68ec148c-181f-4656-8334-8f4eb148689d |</span>
<span class="go">| name                      | provider                             |</span>
<span class="go">| provider:network_type     | flat                                 |</span>
<span class="go">| provider:physical_network | provider                             |</span>
<span class="go">| provider:segmentation_id  |                                      |</span>
<span class="go">| router:external           | True                                 |</span>
<span class="go">| shared                    | False                                |</span>
<span class="go">| status                    | ACTIVE                               |</span>
<span class="go">| subnets                   |                                      |</span>
<span class="go">| tenant_id                 | b3ac05ef10bf441fbf4aa17f16ae1e6d     |</span>
<span class="go">+---------------------------+--------------------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li>Create a subnet on the provider network using an IP address allocation from the provider subnet pool.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron subnet-create --name provider --subnetpool provider <span class="se">\</span>
  --prefixlen <span class="m">24</span> provider
<span class="go">Created a new subnet:</span>
<span class="go">+-------------------+------------------------------------------------+</span>
<span class="go">| Field             | Value                                          |</span>
<span class="go">+-------------------+------------------------------------------------+</span>
<span class="go">| allocation_pools  | {&quot;start&quot;: &quot;172.24.4.2&quot;, &quot;end&quot;: &quot;172.24.4.254&quot;} |</span>
<span class="go">| cidr              | 172.24.4.0/24                                  |</span>
<span class="go">| created_at        | 2016-03-17T23:17:16                            |</span>
<span class="go">| description       |                                                |</span>
<span class="go">| dns_nameservers   |                                                |</span>
<span class="go">| enable_dhcp       | True                                           |</span>
<span class="go">| gateway_ip        | 172.24.4.1                                     |</span>
<span class="go">| host_routes       |                                                |</span>
<span class="go">| id                | 8ed65d41-2b2a-4f3a-9f92-45adb266e01a           |</span>
<span class="go">| ip_version        | 4                                              |</span>
<span class="go">| ipv6_address_mode |                                                |</span>
<span class="go">| ipv6_ra_mode      |                                                |</span>
<span class="go">| name              | provider                                       |</span>
<span class="go">| network_id        | 68ec148c-181f-4656-8334-8f4eb148689d           |</span>
<span class="go">| subnetpool_id     | 3771c0e7-7096-46d3-a3bd-699c58e70259           |</span>
<span class="go">| tenant_id         | b3ac05ef10bf441fbf4aa17f16ae1e6d               |</span>
<span class="go">| updated_at        | 2016-03-17T23:17:16                            |</span>
<span class="go">+-------------------+------------------------------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li>Create the tenant network.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron net-create private
<span class="go">Created a new network:</span>
<span class="go">+---------------------------+--------------------------------------+</span>
<span class="go">| Field                     | Value                                |</span>
<span class="go">+---------------------------+--------------------------------------+</span>
<span class="go">| admin_state_up            | True                                 |</span>
<span class="go">| id                        | 01da3e19-129f-4d26-b065-255ade0e5e2c |</span>
<span class="go">| name                      | private                              |</span>
<span class="go">| shared                    | False                                |</span>
<span class="go">| status                    | ACTIVE                               |</span>
<span class="go">| subnets                   |                                      |</span>
<span class="go">| tenant_id                 | b3ac05ef10bf441fbf4aa17f16ae1e6d     |</span>
<span class="go">+---------------------------+--------------------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li>Create a subnet on the tenant network using an IP address allocation from the private subnet pool.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron subnet-create --name selfservice --subnetpool private <span class="se">\</span>
  --prefixlen <span class="m">24</span> private
<span class="go">Created a new subnet:</span>
<span class="go">+-------------------+--------------------------------------------+</span>
<span class="go">| Field             | Value                                      |</span>
<span class="go">+-------------------+--------------------------------------------+</span>
<span class="go">| allocation_pools  | {&quot;start&quot;: &quot;10.0.0.2&quot;, &quot;end&quot;: &quot;10.0.0.254&quot;} |</span>
<span class="go">| cidr              | 10.0.0.0/24                                |</span>
<span class="go">| created_at        | 2016-03-17T23:20:20                        |</span>
<span class="go">| description       |                                            |</span>
<span class="go">| dns_nameservers   |                                            |</span>
<span class="go">| enable_dhcp       | True                                       |</span>
<span class="go">| gateway_ip        | 10.0.0.1                                   |</span>
<span class="go">| host_routes       |                                            |</span>
<span class="go">| id                | 8edd3dc2-df40-4d71-816e-a4586d61c809       |</span>
<span class="go">| ip_version        | 4                                          |</span>
<span class="go">| ipv6_address_mode |                                            |</span>
<span class="go">| ipv6_ra_mode      |                                            |</span>
<span class="go">| name              | private                                    |</span>
<span class="go">| network_id        | 01da3e19-129f-4d26-b065-255ade0e5e2c       |</span>
<span class="go">| subnetpool_id     | c7e9737a-cfd3-45b5-a861-d1cee1135a92       |</span>
<span class="go">| tenant_id         | b3ac05ef10bf441fbf4aa17f16ae1e6d           |</span>
<span class="go">| updated_at        | 2016-03-17T23:20:20                        |</span>
<span class="go">+-------------------+--------------------------------------------+</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create and configure router</p>
<blockquote>
<div><ul class="simple">
<li>Create a router.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron router-create router
<span class="go">+-----------------------+--------------------------------------+</span>
<span class="go">| Field                 | Value                                |</span>
<span class="go">+-----------------------+--------------------------------------+</span>
<span class="go">| admin_state_up        | True                                 |</span>
<span class="go">| external_gateway_info |                                      |</span>
<span class="go">| id                    | 49439b14-f6ee-420d-8c48-d3767fadcb3a |</span>
<span class="go">| name                  | router                               |</span>
<span class="go">| status                | ACTIVE                               |</span>
<span class="go">| tenant_id             | b3ac05ef10bf441fbf4aa17f16ae1e6d     |</span>
<span class="go">+-----------------------+--------------------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li>Add the private subnet as an interface on the router.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron router-interface-add router selfservice
<span class="go">Added interface 969a1d4b-7fa1-4346-9963-de06becab87a to router router.</span>
</pre></div>
</div>
<ul class="simple">
<li>Add the provide network as a gateway on the router</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron router-gateway-set router provider
<span class="go">Set gateway for router router</span>
</pre></div>
</div>
<ul class="simple">
<li>Verify router ports. Note: from this result, you can see what the advertised routes are.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron router-port-list router
<span class="go">+--------------------------------------+------+-------------------+----------------------------------------------------+</span>
<span class="go">| id                                   | name | mac_address       | fixed_ips                                          |</span>
<span class="go">+--------------------------------------+------+-------------------+----------------------------------------------------+</span>
<span class="go">| dc675aab-5a8b-462c-872e-2f791b6c1730 |      | fa:16:3e:e5:a2:d2 | {&quot;subnet_id&quot;: &quot;1c6b725e-                           |</span>
<span class="go">|                                      |      |                   | 890e-4454-8842-7ff22ffa704b&quot;, &quot;ip_address&quot;:        |</span>
<span class="go">|                                      |      |                   | &quot;10.0.0.1&quot;}                                        |</span>
<span class="go">| e15c701d-868f-4171-a282-e6a4567a8d83 |      | fa:16:3e:28:86:4c | {&quot;subnet_id&quot;:                                      |</span>
<span class="go">|                                      |      |                   | &quot;b442c453-7e4a-4568-9d70-1dde91a65fbb&quot;,            |</span>
<span class="go">|                                      |      |                   | &quot;ip_address&quot;: &quot;172.24.4.2&quot;}                        |</span>
<span class="go">+--------------------------------------+------+-------------------+----------------------------------------------------+</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create and configure the BGP speaker</p>
<p>The BGP speaker advertised the next-hop IP address for the tenant network prefix.</p>
<blockquote>
<div><ul class="simple">
<li>Create the BGP speaker.</li>
</ul>
<p>Replace LOCAL_AS with an appropriate local autonomous system number. The example configuration uses AS 12345.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron bgp-speaker-create --ip-version <span class="m">4</span> <span class="se">\</span>
  --local-as LOCAL_AS bgp-speaker
<span class="go">Created a new bgp_speaker:</span>
<span class="go">+-----------------------------------+--------------------------------------+</span>
<span class="go">| Field                             | Value                                |</span>
<span class="go">+-----------------------------------+--------------------------------------+</span>
<span class="go">| advertise_floating_ip_host_routes | True                                 |</span>
<span class="go">| advertise_tenant_networks         | True                                 |</span>
<span class="go">| id                                | 5f227f14-4f46-4eca-9524-fc5a1eabc358 |</span>
<span class="go">| ip_version                        | 4                                    |</span>
<span class="go">| local_as                          | 12345                                |</span>
<span class="go">| name                              | bgp-speaker                          |</span>
<span class="go">| networks                          |                                      |</span>
<span class="go">| peers                             |                                      |</span>
<span class="go">| tenant_id                         | b3ac05ef10bf441fbf4aa17f16ae1e6d     |</span>
<span class="go">+-----------------------------------+--------------------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li>Associate the BGP speaker with the provider network.</li>
</ul>
<p>A BGP speaker requires association with a provider network to determine eligible
prefixes. After the association, the BGP speaker can advertise the tenant network
prefixes with the corresponding router as the next-hop IP address.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron bgp-speaker-network-add bgp-speaker provider
<span class="go">Added network provider to BGP speaker bgpspeaker.</span>
</pre></div>
</div>
<ul class="simple">
<li>Verify the association of the provider network with the BGP speaker.</li>
</ul>
<p>Checking the <code class="docutils literal"><span class="pre">networks</span></code> attribute.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron bgp-speaker-show bgpspeaker
<span class="go">+-----------------------------------+--------------------------------------+</span>
<span class="go">| Field                             | Value                                |</span>
<span class="go">+-----------------------------------+--------------------------------------+</span>
<span class="go">| advertise_floating_ip_host_routes | True                                 |</span>
<span class="go">| advertise_tenant_networks         | True                                 |</span>
<span class="go">| id                                | 5f227f14-4f46-4eca-9524-fc5a1eabc358 |</span>
<span class="go">| ip_version                        | 4                                    |</span>
<span class="go">| local_as                          | 12345                                |</span>
<span class="go">| name                              | bgp-speaker                          |</span>
<span class="go">| networks                          | 68ec148c-181f-4656-8334-8f4eb148689d |</span>
<span class="go">| peers                             |                                      |</span>
<span class="go">| tenant_id                         | b3ac05ef10bf441fbf4aa17f16ae1e6d     |</span>
<span class="go">+-----------------------------------+--------------------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li>Verify the prefixes and next-hop ip addresses that the BGP speaker advertises.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron bgp-speaker-advertiseroute-list bgpspeaker
<span class="go">+-------------+------------+</span>
<span class="go">| destination | next_hop   |</span>
<span class="go">+-------------+------------+</span>
<span class="go">| 10.0.0.0/24 | 172.24.4.3 |</span>
<span class="go">+-------------+------------+</span>
</pre></div>
</div>
<ul class="simple">
<li>Create a BGP peer.</li>
</ul>
<p>Here the BGP peer is pointed to the quagga VM. Replace REMOTE_AS with an appropriate
remote autonomous system number. The example configuration uses AS 12345 which triggers
iBGP peering.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron bgp-peer-create --peer-ip <span class="m">10</span>.156.18.20 <span class="se">\</span>
  --remote-as REMOTE_AS bgp-peer
<span class="go">Created a new bgp_peer:</span>
<span class="go">+-----------+--------------------------------------+</span>
<span class="go">| Field     | Value                                |</span>
<span class="go">+-----------+--------------------------------------+</span>
<span class="go">| auth_type | none                                 |</span>
<span class="go">| id        | 35c89ca0-ac5a-4298-a815-0b073c2362e9 |</span>
<span class="go">| name      | bgp-peer                             |</span>
<span class="go">| peer_ip   | 10.156.18.20                         |</span>
<span class="go">| remote_as | 12345                                |</span>
<span class="go">| tenant_id | b3ac05ef10bf441fbf4aa17f16ae1e6d     |</span>
<span class="go">+-----------+--------------------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li>Add a BGP peer to the BGP speaker.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron bgp-speaker-peer-add bgp-speaker bgp-peer
<span class="go">Added BGP peer bgppeer to BGP speaker bgpspeaker.</span>
</pre></div>
</div>
<ul class="simple">
<li>Verify the association of the BGP peer with the BGP speaker.</li>
</ul>
<p>Checking the <code class="docutils literal"><span class="pre">peers</span></code> attribute.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron bgp-speaker-show bgp-speaker
<span class="go">+-----------------------------------+--------------------------------------+</span>
<span class="go">| Field                             | Value                                |</span>
<span class="go">+-----------------------------------+--------------------------------------+</span>
<span class="go">| advertise_floating_ip_host_routes | True                                 |</span>
<span class="go">| advertise_tenant_networks         | True                                 |</span>
<span class="go">| id                                | 5f227f14-4f46-4eca-9524-fc5a1eabc358 |</span>
<span class="go">| ip_version                        | 4                                    |</span>
<span class="go">| local_as                          | 12345                                |</span>
<span class="go">| name                              | bgp-speaker                          |</span>
<span class="go">| networks                          | 68ec148c-181f-4656-8334-8f4eb148689d |</span>
<span class="go">| peers                             | 35c89ca0-ac5a-4298-a815-0b073c2362e9 |</span>
<span class="go">| tenant_id                         | b3ac05ef10bf441fbf4aa17f16ae1e6d     |</span>
<span class="go">+-----------------------------------+--------------------------------------+</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Schedule the BGP speaker to an agent.</p>
<blockquote>
<div><ul class="simple">
<li>Schedule the BGP speaker to <code class="docutils literal"><span class="pre">BGP</span> <span class="pre">dynamic</span> <span class="pre">routing</span> <span class="pre">agent</span></code></li>
</ul>
<p>BGP speakers require manual scheduling to an agent. BGP speakers only form peering sessions.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron bgp-speaker-network-add bgp-speaker provider
<span class="go">Added network provider to BGP speaker bgpspeaker.</span>
</pre></div>
</div>
<ul class="simple">
<li>Verify scheduling of the BGP speaker to the agent.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">neutron bgp-dragent-list-hosting-speaker bgp-speaker</span>
<span class="go">+--------------------------------------+---------------------------+----------------+-------+</span>
<span class="go">| id                                   | host                      | admin_state_up | alive |</span>
<span class="go">+--------------------------------------+---------------------------+----------------+-------+</span>
<span class="go">| 69ad386f-e055-4284-8c8e-ef9bd540705c | yang-devstack-ubuntu-1604 | True           | :-)   |</span>
<span class="go">+--------------------------------------+---------------------------+----------------+-------+</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#environment-architecture">Environment Architecture</a></li>
<li><a class="reference internal" href="#devstack-setup">Devstack Setup</a></li>
<li><a class="reference internal" href="#quagga-configure">Quagga Configure</a></li>
<li><a class="reference internal" href="#service-test">Service Test</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../functionality/route-advertisement.html"
                                  title="previous chapter">Route Advertisement</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/neutron-dynamic-routing
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/others/testing.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../functionality/route-advertisement.html" title="Route Advertisement"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">neutron-dynamic-routing 10.0.0.0rc2.dev3 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, OpenStack Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/neutron-dynamic-routing");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>