<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Autoscaling using Ceilometer/Aodh</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../_static/css/combined.css" rel="stylesheet">
<link href="../_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Autoscaling using Ceilometer/Aodh</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="autoscaling_overview.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Support to AutoScaling"></i></a>
    
    
    <a href="autoscaling_heat.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Autoscaling with Heat"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Autoscaling using Ceilometer/Aodh</a><ul>
<li><a class="reference internal" href="#step-1-create-a-vm-cluster">Step 1: Create a VM cluster</a></li>
<li><a class="reference internal" href="#step-2-create-receivers">Step 2: Create Receivers</a></li>
<li><a class="reference internal" href="#step-3-creating-aodh-alarms">Step 3: Creating Aodh Alarms</a></li>
<li><a class="reference internal" href="#step-4-run-workloads-on-cluster-nodes">Step 4: Run Workloads on Cluster Nodes</a></li>
<li><a class="reference internal" href="#step-5-verify-cluster-scaling">Step 5: Verify Cluster Scaling</a></li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="autoscaling-using-ceilometer-aodh">
<span id="ref-scenario-autoscaling-ceilometer"></span><h1>Autoscaling using Ceilometer/Aodh<a class="headerlink" href="#autoscaling-using-ceilometer-aodh" title="Permalink to this headline">¶</a></h1>
<p>As a telemetry service, the ceilometer project consists of several sub-projects
which provide metering, monitoring and alarming services in the telemetry
space. This section walks you through the steps to build an auto-scaling
solution by integrating senlin with ceilometer/aodh.</p>
<div class="section" id="step-1-create-a-vm-cluster">
<h2>Step 1: Create a VM cluster<a class="headerlink" href="#step-1-create-a-vm-cluster" title="Permalink to this headline">¶</a></h2>
<p>The first step is to create a profile using a spec file like the following one
and save it to a file, e.g. <code class="file docutils literal"><span class="pre">sample_server.yaml</span></code>:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">os.nova.server</span>
<span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cirros_server</span>
  <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.tiny</span>
  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cirros-0.3.4-x86_64-uec</span>
  <span class="l l-Scalar l-Scalar-Plain">key_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">oskey</span>
  <span class="l l-Scalar l-Scalar-Plain">networks</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">network</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">private</span>
</pre></div>
</div>
<p>Note this spec file assumes that you have a working nova key-pair named
&#8220;<code class="docutils literal"><span class="pre">oskey</span></code>&#8221; and there is a network named &#8220;<code class="docutils literal"><span class="pre">private</span></code>&#8221;. You may need to change
these values based your environment settings. To create a profile using this
spec:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack cluster profile create --spec-file sample_server.yaml pserver
</pre></div>
</div>
<p>Then you can create a cluster using the profile named &#8220;<code class="docutils literal"><span class="pre">pserver</span></code>&#8221;:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> senlin cluster-create -p pserver -c <span class="m">2</span> mycluster
<span class="go">+------------------+--------------------------------------+</span>
<span class="go">| Property         | Value                                |</span>
<span class="go">+------------------+--------------------------------------+</span>
<span class="go">| created_at       | 2016-06-07T02:26:33Z                 |</span>
<span class="go">| data             | {}                                   |</span>
<span class="go">| desired_capacity | 2                                    |</span>
<span class="go">| domain_id        | None                                 |</span>
<span class="go">| id               | 10c80bfe-41af-41f7-b9b1-9c81c9e5d21f |</span>
<span class="go">| init_at          | 2016-06-07T02:26:17Z                 |</span>
<span class="go">| max_size         | -1                                   |</span>
<span class="go">| metadata         | {}                                   |</span>
<span class="go">| min_size         | 0                                    |</span>
<span class="go">| name             | mycluster                            |</span>
<span class="go">| node_ids         | 14936837-1459-416b-a1f3-dea026f6cffc |</span>
<span class="go">|                  | 99ab3862-a230-4c09-af73-076dc0dec39b |</span>
<span class="go">| profile_id       | 1de5686a-09bb-4fb0-9502-34fa38833010 |</span>
<span class="go">| profile_name     | pserver                              |</span>
<span class="go">| project_id       | 99185bcde62c478e8d05b702e52d8b8d     |</span>
<span class="go">| status           | ACTIVE                               |</span>
<span class="go">| status_reason    | Cluster creation succeeded.          |</span>
<span class="go">| timeout          | 3600                                 |</span>
<span class="go">| updated_at       | 2016-06-13T02:42:47Z                 |</span>
<span class="go">| user_id          | 6c369aec78b74a4da413f86dadb0255e     |</span>
<span class="go">+------------------+--------------------------------------+</span>
</pre></div>
</div>
<p>This creates a cluster with 2 nodes created at the beginning. We export the
cluster ID into an environment variable for convenience:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">export</span> <span class="nv">MYCLUSTER_ID</span><span class="o">=</span>10c80bfe-41af-41f7-b9b1-9c81c9e5d21f
</pre></div>
</div>
<p>You may want to check the IP addresses assigned to each node. In the output
from the following command, you will find the IP address for the specific node:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack cluster node show <span class="m">14936837</span>-1459-416b-a1f3-dea026f6cffc
<span class="go">...</span>
<span class="go">| details | +-----------+--------------------------------------+ |</span>
<span class="go">|         | | property  | value                                | |</span>
<span class="go">|         | +-----------+--------------------------------------+ |</span>
<span class="go">|         | | addresses | {                                    | |</span>
<span class="go">|         | |           |   &quot;private&quot;: [                       | |</span>
<span class="go">|         | |           |     {                                | |</span>
<span class="go">|         | |           |       &quot;OS-EXT-IPS-MAC:mac-addr&quot;: ... | |</span>
<span class="go">|         | |           |       &quot;OS-EXT-IPS:type&quot;: &quot;fixed&quot;,    | |</span>
<span class="go">|         | |           |       &quot;addr&quot;: &quot;10.0.0.9&quot;,            | |</span>
<span class="go">|         | |           |       &quot;version&quot;: 4                   | |</span>
<span class="go">|         | |           |     }                                | |</span>
<span class="go">|         | |           |   ]                                  | |</span>
<span class="go">|         | |           | }                                    | |</span>
<span class="go">|         | | flavor    | 1                                    | |</span>
<span class="go">|         | | id        | 362f57b2-c089-4aab-bab3-1a7ffd4e1834 | |</span>
<span class="go">...</span>
</pre></div>
</div>
<p>We will use these IP addresses later to generate workloads on each nova
server.</p>
</div>
<div class="section" id="step-2-create-receivers">
<h2>Step 2: Create Receivers<a class="headerlink" href="#step-2-create-receivers" title="Permalink to this headline">¶</a></h2>
<p>The next step is to create receivers for the cluster for triggering actions on
the cluster. Each receiver is usually created for a specific purpose, so for
different purposes you may need to create more than receivers.</p>
<p>The following command creates a receiver for scaling out the specified cluster
by two nodes every time it is triggered:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack cluster receiver create --action CLUSTER_SCALE_OUT --params <span class="nv">count</span><span class="o">=</span><span class="m">2</span> --cluster mycluster r_01
<span class="go">+------------+----------------------------------------------------------------------------+</span>
<span class="go">| Property   | Value                                                                      |</span>
<span class="go">+------------+----------------------------------------------------------------------------+</span>
<span class="go">| action     | CLUSTER_SCALE_OUT                                                          |</span>
<span class="go">| actor      | {                                                                          |</span>
<span class="go">|            |   &quot;trust_id&quot;: &quot;432f81d339444cac959bab2fd9ba92fa&quot;                           |</span>
<span class="go">|            | }                                                                          |</span>
<span class="go">| channel    | {                                                                          |</span>
<span class="go">|            |   &quot;alarm_url&quot;: &quot;http://node1:8778/v1/webhooks/ba...5a/trigger?V=1&amp;count=2&quot; |</span>
<span class="go">|            | }                                                                          |</span>
<span class="go">| cluster_id | b75d25e7-e84d-4742-abf7-d8a3001e25a9                                       |</span>
<span class="go">| created_at | 2016-08-01T02:17:14Z                                                       |</span>
<span class="go">| domain_id  | -                                                                          |</span>
<span class="go">| id         | ba13f7cd-7a95-4545-b646-6a833ba6505a                                       |</span>
<span class="go">| location   | -                                                                          |</span>
<span class="go">| name       | r_01                                                                       |</span>
<span class="go">| params     | {                                                                          |</span>
<span class="go">|            |   &quot;count&quot;: &quot;2&quot;                                                             |</span>
<span class="go">|            | }                                                                          |</span>
<span class="go">| project_id | 99185bcde62c478e8d05b702e52d8b8d                                           |</span>
<span class="go">| type       | webhook                                                                    |</span>
<span class="go">| updated_at | -                                                                          |</span>
<span class="go">| user_id    | 6c369aec78b74a4da413f86dadb0255e                                           |</span>
<span class="go">+------------+----------------------------------------------------------------------------+</span>
</pre></div>
</div>
<p>At present, all property values shown for a receiver are read only. You cannot
change their values once the receiver is created. The only type of receivers
senlin understands is &#8220;<code class="docutils literal"><span class="pre">webhook</span></code>&#8221;. For the &#8220;<code class="docutils literal"><span class="pre">action</span></code>&#8221; parameter, there are
many choices:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">CLUSTER_SCALE_OUT</span></code></li>
<li><code class="docutils literal"><span class="pre">CLUSTER_SCALE_IN</span></code></li>
<li><code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code></li>
<li><code class="docutils literal"><span class="pre">CLUSTER_CHECK</span></code></li>
<li><code class="docutils literal"><span class="pre">CLUSTER_UPDATE</span></code></li>
<li><code class="docutils literal"><span class="pre">CLUSTER_DELETE</span></code></li>
<li><code class="docutils literal"><span class="pre">CLUSTER_ADD_NODES</span></code></li>
<li><code class="docutils literal"><span class="pre">CLUSTER_DEL_NODES</span></code></li>
<li><code class="docutils literal"><span class="pre">NODE_CREATE</span></code></li>
<li><code class="docutils literal"><span class="pre">NODE_DELETE</span></code></li>
<li><code class="docutils literal"><span class="pre">NODE_UPDATE</span></code></li>
<li><code class="docutils literal"><span class="pre">NODE_CHECK</span></code></li>
<li><code class="docutils literal"><span class="pre">NODE_RECOVER</span></code></li>
</ul>
<p>Senlin may add supports to more action types in future.</p>
<p>After a receiver is created, you can check its &#8220;<code class="docutils literal"><span class="pre">channel</span></code>&#8221; property value to
find out how to trigger that receiver. For a receiver of type &#8220;<code class="docutils literal"><span class="pre">webhook</span></code>&#8221;
(the default and the only supported type as for now), this means you will
check the &#8220;<code class="docutils literal"><span class="pre">alarm_url</span></code>&#8221; value. We will use that value later for action
triggering. For convenience, we export that value to an environment variable:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">export</span> <span class="nv">ALRM_URL01</span><span class="o">=</span>http://node1:8778/v1/webhooks/ba...5a/trigger?V<span class="o">=</span><span class="m">1</span><span class="p">&amp;</span><span class="nv">count</span><span class="o">=</span><span class="m">2</span>
</pre></div>
</div>
<p>Similar to the example above, you can create other receivers for different
kinds of cluster operations or the same cluster operation with different
parameter values.</p>
</div>
<div class="section" id="step-3-creating-aodh-alarms">
<h2>Step 3: Creating Aodh Alarms<a class="headerlink" href="#step-3-creating-aodh-alarms" title="Permalink to this headline">¶</a></h2>
<p>Once we have the cluster created and prepared to receive external signals, we
can proceed to create alarms using the software/service you deployed. The
following command creates a threshold alarm using aodh alarm service so that:</p>
<ul class="simple">
<li>aodh will evaluate the CPU utilization (i.e. <code class="docutils literal"><span class="pre">cpu_util</span></code>) metric across the
specified cluster;</li>
<li>aodh will compute the CPU utilization using the average value during a given
period (i.e. 60 seconds here);</li>
<li>aodh will perform evaluation at the end of every single period;</li>
<li>aodh won&#8217;t trigger alarm actions repeatedly;</li>
<li>aodh will do metric aggregation based on the specified metadata.</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> aodh alarm create <span class="se">\</span>
  -t threshold --statistic avg --name cpu-high <span class="se">\</span>
  -m cpu_util --threshold <span class="m">70</span> --comparison-operator gt <span class="se">\</span>
  --period <span class="m">60</span> --evaluation-periods <span class="m">1</span> <span class="se">\</span>
  --alarm-action <span class="nv">$ALRM_URL01</span> <span class="se">\</span>
  --repeat-actions False <span class="se">\</span>
  --query metadata.user_metadata.cluster_id<span class="o">=</span><span class="nv">$MYCLUSTER_ID</span>
</pre></div>
</div>
<p>Note that we are referencing the two environment variables <code class="docutils literal"><span class="pre">MYCLUSTER_ID</span></code>
and <code class="docutils literal"><span class="pre">ALRM_URL01</span></code> in this command.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To make aodh aware of the <code class="docutils literal"><span class="pre">cluster_id</span></code> metadata senlin injects into each
and every VM server created, you may need to add the following line into
your <code class="file docutils literal"><span class="pre">/etc/ceilometer/ceilometer.conf</span></code> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">reserved_metadata_keys</span> <span class="o">=</span> <span class="n">cluster_id</span>
</pre></div>
</div>
<p>Also note that to make sure your CPU utilization driven metrics are
evaluated at least once per 60 seconds, you will need to change the
<code class="docutils literal"><span class="pre">interval</span></code> value for the <code class="docutils literal"><span class="pre">cpu_source</span></code> in the file
<code class="file docutils literal"><span class="pre">/etc/ceilometer/pipeline.yaml</span></code>. For example, you can change it from
the default value <code class="docutils literal"><span class="pre">600</span></code> to <code class="docutils literal"><span class="pre">60</span></code>:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span>sources:
  &lt;other stuff ...&gt;
  - name: cpu_source
    interval: 600   &lt;- change this to 60
    meters:
      - &quot;cpu&quot;
  &lt;other stuff ...&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-4-run-workloads-on-cluster-nodes">
<h2>Step 4: Run Workloads on Cluster Nodes<a class="headerlink" href="#step-4-run-workloads-on-cluster-nodes" title="Permalink to this headline">¶</a></h2>
<p>To examine the effect of cluster scaling under high CPU workload. You can now
log into each cluster nodes and run some CPU burning workloads there to drive
the CPU utilization high. For example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ssh cirros@10.0.0.9
<span class="gp">$</span> cat /dev/zero &gt; /dev/null
<span class="go">&lt; Guest system &quot;hang&quot; here... &gt;</span>
</pre></div>
</div>
<p>When all nodes in the cluster have their CPU pressure boosted, you can check
the CPU utilization on each node and finally proceed to the next step.</p>
</div>
<div class="section" id="step-5-verify-cluster-scaling">
<h2>Step 5: Verify Cluster Scaling<a class="headerlink" href="#step-5-verify-cluster-scaling" title="Permalink to this headline">¶</a></h2>
<p>After a while after the CPU workloads on cluster nodes are started, you will
notice that the cluster has been automatically scaled. Two new nodes are
created and added to the cluster. This can be verified by running the
following command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack cluster show <span class="nv">$MYCLUSTER_ID</span>
</pre></div>
</div>
<p>Optionally, you can use the following command to check if the anticipated
action was triggered and executed:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack cluster action list --filters <span class="nv">target</span><span class="o">=</span><span class="nv">$MYCLUSTER_ID</span>
</pre></div>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="autoscaling_overview.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Support to AutoScaling"></i></a>
          
          
            <a href="autoscaling_heat.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Autoscaling with Heat"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="../_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="../index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration Options</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/basics.html">Senlin Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/policies.html">Working with Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/receivers.html">Working with Receivers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/profile_types.html">Profile Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/profiles.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/clusters.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/nodes.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/membership.html">Cluster Membership</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types.html">Policy Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policies.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/bindings.html">Cluster-Policy Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/receivers.html">Receiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/actions.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/events.html">Events</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/affinity.html">Affinity Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/deletion.html">Deletion Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/load_balancing.html">Load-Balancing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/scaling.html">Scaling Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/region_placement.html">Region Placement Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/zone_placement.html">Zone Placement Policy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="affinity.html">Managing Node Affinity</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="autoscaling_overview.html">Support to AutoScaling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Autoscaling using Ceilometer/Aodh</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#step-1-create-a-vm-cluster">Step 1: Create a VM cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-create-receivers">Step 2: Create Receivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-creating-aodh-alarms">Step 3: Creating Aodh Alarms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-4-run-workloads-on-cluster-nodes">Step 4: Run Workloads on Cluster Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-5-verify-cluster-scaling">Step 5: Verify Cluster Scaling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="autoscaling_heat.html">Autoscaling with Heat</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer/api_microversion.html">API Microversioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/authorization.html">Senlin Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/profile.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/cluster.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/node.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/policy.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/action.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/receiver.html">Receiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/testing.html">Senlin testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/plugin_guide.html">Plugin Writer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/osprofiler.html">OSProfiler</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer/policies/affinity_v1.html">Affinity Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/policies/deletion_v1.html">Deletion Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/policies/health_v1.html">Health Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/policies/load_balance_v1.html">Load Balancing Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/policies/region_v1.html">Region Placement Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/policies/scaling_v1.html">Scaling Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/policies/zone_v1.html">Zone Placement Policy V1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer/reviews.html">Reviews</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../man/index.html">Man Pages</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "scenarios/autoscaling_ceilometer" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/senlin/tree/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 'Tue Feb 14 14:27:25 2017, commit e2451a7";
        var bugProject = "senlin";
        var bugTitle = "Autoscaling using Ceilometer/Aodh in senlin";
    var fieldTags = "docs";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 3.0.0.0rc2.dev62 on None";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>