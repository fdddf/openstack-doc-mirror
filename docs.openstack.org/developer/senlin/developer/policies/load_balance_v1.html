<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Load Balancing Policy V1.0</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="../../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../../_static/css/combined.css" rel="stylesheet">
<link href="../../_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Load Balancing Policy V1.0</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="deletion_v1.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Deletion Policy V1.0"></i></a>
    
    
    <a href="region_v1.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Region Placement Policy V1.0"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Load Balancing Policy V1.0</a><ul>
<li><a class="reference internal" href="#applicable-profiles">Applicable Profiles</a></li>
<li><a class="reference internal" href="#actions-handled">Actions Handled</a></li>
<li><a class="reference internal" href="#policy-properties">Policy Properties</a></li>
<li><a class="reference internal" href="#load-balancer-management">Load Balancer Management</a></li>
<li><a class="reference internal" href="#scenarios">Scenarios</a><ul>
<li><a class="reference internal" href="#s1-cluster-scale-in">S1: <code class="docutils literal"><span class="pre">CLUSTER_SCALE_IN</span></code></a></li>
<li><a class="reference internal" href="#s2-cluster-del-nodes">S2: <code class="docutils literal"><span class="pre">CLUSTER_DEL_NODES</span></code></a></li>
<li><a class="reference internal" href="#s3-cluster-resize-that-shrinks-a-cluster">S3: <code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code> that Shrinks a Cluster</a></li>
<li><a class="reference internal" href="#s4-cluster-scale-out">S4: <code class="docutils literal"><span class="pre">CLUSTER_SCALE_OUT</span></code></a></li>
<li><a class="reference internal" href="#s5-cluster-add-nodes">S5: <code class="docutils literal"><span class="pre">CLUSTER_ADD_NODES</span></code></a></li>
<li><a class="reference internal" href="#s6-cluster-resize-that-expands-a-cluster">S6: <code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code> that Expands a Cluster</a></li>
<li><a class="reference internal" href="#s7-handling-node-create-action">S7: Handling <code class="docutils literal"><span class="pre">NODE_CREATE</span></code> Action</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="load-balancing-policy-v1-0">
<h1>Load Balancing Policy V1.0<a class="headerlink" href="#load-balancing-policy-v1-0" title="Permalink to this headline">¶</a></h1>
<p>This policy is designed to enable senlin clusters to leverage the Neutron
LBaaS V2 features so that workloads can be distributed across nodes in a
reasonable manner.</p>
<div class="section" id="applicable-profiles">
<h2>Applicable Profiles<a class="headerlink" href="#applicable-profiles" title="Permalink to this headline">¶</a></h2>
<p>The policy is designed to handle only Nova server clusters, i.e. clusters
whose profile is a type of &#8220;<code class="docutils literal"><span class="pre">os.nova.server-1.0</span></code>&#8221;.</p>
</div>
<div class="section" id="actions-handled">
<h2>Actions Handled<a class="headerlink" href="#actions-handled" title="Permalink to this headline">¶</a></h2>
<p>The policy is capable of handling the following actions:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">CLUSTER_ADD_NODES</span></code>: an action that carries a list of node IDs for the
nodes (servers) to be added into the cluster.</li>
<li><code class="docutils literal"><span class="pre">CLUSTER_DEL_NODES</span></code>: an action that carries a list of node IDs for the
nodes (servers) to be removed from the cluster.</li>
<li><code class="docutils literal"><span class="pre">CLUSTER_SCALE_IN</span></code>: an action that carries an optional integer value named
<code class="docutils literal"><span class="pre">count</span></code> in its <code class="docutils literal"><span class="pre">inputs</span></code>.</li>
<li><code class="docutils literal"><span class="pre">CLUSTER_SCALE_OUT</span></code>: an action that carries an optional integer value
named <code class="docutils literal"><span class="pre">count</span></code> in its <code class="docutils literal"><span class="pre">inputs</span></code>.</li>
<li><code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code>: an action that carries some additional parameters that
specifying the details about the resize request, e.g. <code class="docutils literal"><span class="pre">adjustment_type</span></code>,
<code class="docutils literal"><span class="pre">number</span></code> etc. in its <code class="docutils literal"><span class="pre">inputs</span></code>.</li>
<li><code class="docutils literal"><span class="pre">NODE_CREATE</span></code>: an action originated directly from RPC request and it has
a node associated with it.</li>
<li><code class="docutils literal"><span class="pre">NODE_DELETE</span></code>: an action originated directly from RPC request and it has
a node associated with it.</li>
</ul>
<p>The policy will be checked <strong>AFTER</strong> one of the above mentioned actions that
adds new member nodes for the cluster is executed. It is also checked
<strong>BEFORE</strong> one of the above actions that removes existing members from the
cluster is executed.</p>
</div>
<div class="section" id="policy-properties">
<h2>Policy Properties<a class="headerlink" href="#policy-properties" title="Permalink to this headline">¶</a></h2>
<p>The load-balancing policy has its properties grouped into three categories:
<code class="docutils literal"><span class="pre">pool</span></code>, <code class="docutils literal"><span class="pre">vip</span></code> and <code class="docutils literal"><span class="pre">health_monitor</span></code>. The <code class="docutils literal"><span class="pre">pool</span></code> property accepts a map
that contains detailed specification for the load-balancing pool that
contains the nodes as members such as &#8220;<code class="docutils literal"><span class="pre">protocol</span></code>&#8221;, &#8220;<code class="docutils literal"><span class="pre">protocol_port</span></code>&#8221;,
&#8220;<code class="docutils literal"><span class="pre">subnet</span></code>&#8221;, &#8220;<code class="docutils literal"><span class="pre">lb_method</span></code>&#8221; etc. Most of the properties have a default value
except for the &#8220;<code class="docutils literal"><span class="pre">subnet</span></code>&#8221; which always requires an input.</p>
<p>The <code class="docutils literal"><span class="pre">vip</span></code> property also accepts a map that contains detailed specification
for the &#8220;virtual IP address&#8221; visible to the service users. These include for
example &#8220;<code class="docutils literal"><span class="pre">subnet</span></code>&#8221;, &#8220;<code class="docutils literal"><span class="pre">address</span></code>&#8221;, &#8220;<code class="docutils literal"><span class="pre">protocol</span></code>&#8221;, &#8220;<code class="docutils literal"><span class="pre">protocol_port</span></code>&#8221;
values to be associated/assigned to the VIP.</p>
<p>The <code class="docutils literal"><span class="pre">health_monitor</span></code> property accepts a map that specifies the details about
the configuration of the &#8220;health monitor&#8221; provided by (embedded into) the
load-balancer. The map may contain values for keys like &#8220;<code class="docutils literal"><span class="pre">type</span></code>&#8221;,
&#8220;<code class="docutils literal"><span class="pre">delay</span></code>&#8221;, &#8220;<code class="docutils literal"><span class="pre">max_retries</span></code>&#8221;, &#8220;<code class="docutils literal"><span class="pre">http_method</span></code>&#8221; etc.</p>
<p>For more details specifications of the policy specifications, you can use the
<strong class="command">openstack cluster policy type show senlin.policy.loadbalance-1.1</strong>
command.</p>
</div>
<div class="section" id="load-balancer-management">
<h2>Load Balancer Management<a class="headerlink" href="#load-balancer-management" title="Permalink to this headline">¶</a></h2>
<p>When attaching a loadbalance policy to a cluster, the engine will always try
to create a new load balancer followed by adding existing nodes to the new
load-balancer created. If any member node cannot be added to the
load-balancer, the engine refuses to attach the policy to the cluster.</p>
<p>After having successfully added a node to the load balancer, the engine saves
a key-value pair &#8220;<code class="docutils literal"><span class="pre">lb_member:</span> <span class="pre">&lt;ID&gt;</span></code>&#8221; into the <code class="docutils literal"><span class="pre">data</span></code> field of the node.
After all existing nodes have been successfully added to the load balancer,
the engine saves the load balancer information into the policy binding data.
The information stored is something like the following example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;LoadBalancingPolicy&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;loadbalancer&quot;</span><span class="p">:</span> <span class="s2">&quot;bb73fa92-324d-47a6-b6ce-556eda651532&quot;</span><span class="p">,</span>
      <span class="s2">&quot;listener&quot;</span><span class="p">:</span> <span class="s2">&quot;d5f621dd-5f93-4adf-9c76-51bc4ec9f313&quot;</span><span class="p">,</span>
      <span class="s2">&quot;pool&quot;</span><span class="p">:</span> <span class="s2">&quot;0f58df07-77d6-4aa0-adb1-8ac6977e955f&quot;</span><span class="p">,</span>
      <span class="s2">&quot;healthmonitor&quot;</span><span class="p">:</span> <span class="s2">&quot;83ebd781-1417-46ac-851b-afa92844252d&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When detaching a loadbalance policy from a cluster, the engine first checks
the information stored in the policy binding data where it will find the IDs
of the load balancer, the listener, the health monitor etc. It then proceeds
to delete these resources by invoking the LBaaS APIs. If any of the resources
cannot be deleted for some reasons, the policy detach request will be
rejected.</p>
<p>After all load balancer resources are removed, the engine will iterate through
all cluster nodes and delete the &#8220;<code class="docutils literal"><span class="pre">lb_member</span></code>&#8221; key-value pair stored there.
When all nodes have been virtually detached from the load-balancer, the detach
operation returns with a success.</p>
</div>
<div class="section" id="scenarios">
<h2>Scenarios<a class="headerlink" href="#scenarios" title="Permalink to this headline">¶</a></h2>
<div class="section" id="s1-cluster-scale-in">
<h3>S1: <code class="docutils literal"><span class="pre">CLUSTER_SCALE_IN</span></code><a class="headerlink" href="#s1-cluster-scale-in" title="Permalink to this headline">¶</a></h3>
<p>When scaling in a cluster, there may and may not be a scaling policy attached
to the cluster. The loadbalance policy has to cope with both cases. The
loadbalance policy first attempts to get the number of nodes to remove then it
tries to get the candidate nodes for removal.</p>
<p>It will first check if there is a &#8220;<code class="docutils literal"><span class="pre">deletion</span></code>&#8221; key in the action&#8217;s <code class="docutils literal"><span class="pre">data</span></code>
field. If it successfully finds it, it means there are other policies already
helped decide the number of nodes to remove, even the candidate nodes for
removal. If the &#8220;<code class="docutils literal"><span class="pre">deletion</span></code>&#8221; key is not found, it means the policy has to
figure out the deletion count itself. It first checks if the action has an
input named &#8220;<code class="docutils literal"><span class="pre">count</span></code>&#8221;. The <code class="docutils literal"><span class="pre">count</span></code> value will be used if found, or else it
will assume the <code class="docutils literal"><span class="pre">count</span></code> to be 1.</p>
<p>When the policy finds that the candidate nodes for removal have not yet been
chosen, it will try a random selection from all cluster nodes.</p>
<p>After the policy has figured out the candidate nodes for removal, it invokes
the LBaaS API to remove the candidates from the load balancer. If any of the
removal operation fails, the scale in operation fails before node removal
actually happens.</p>
<p>When all candidates have been removed from the load balancer, the scale in
operation continues to delete the candidate nodes.</p>
</div>
<div class="section" id="s2-cluster-del-nodes">
<h3>S2: <code class="docutils literal"><span class="pre">CLUSTER_DEL_NODES</span></code><a class="headerlink" href="#s2-cluster-del-nodes" title="Permalink to this headline">¶</a></h3>
<p>When deleting specified nodes from a cluster, the candidate nodes are already
provided in the action&#8217;s <code class="docutils literal"><span class="pre">inputs</span></code> property, so the loadbalance policy just
iterate the list of candidate nodes to update the load balancer. The load
balancer side operation is identical to that outlined in scenario <em>S1</em>.</p>
</div>
<div class="section" id="s3-cluster-resize-that-shrinks-a-cluster">
<h3>S3: <code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code> that Shrinks a Cluster<a class="headerlink" href="#s3-cluster-resize-that-shrinks-a-cluster" title="Permalink to this headline">¶</a></h3>
<p>For a cluster resize operation, the loadbalance policy is invoked <strong>BEFORE</strong>
the operation is attempting to remove any nodes from the cluster. If there are
other policies (such as a scaling policy or a deletion policy) attached to the
cluster, the number of nodes along with the candidate nodes might have already
been decided.</p>
<p>The policy first checks the &#8220;<code class="docutils literal"><span class="pre">deletion</span></code>&#8221; key in the action&#8217;s <code class="docutils literal"><span class="pre">data</span></code> field.
If it successfully finds it, it means there are other policies already helped
decide the number of nodes to remove, even the candidate nodes for removal.
If the &#8220;<code class="docutils literal"><span class="pre">deletion</span></code>&#8221; key is not found, it means the policy has to figure out
the deletion count itself. In the latter case, the policy will try to parse
the <code class="docutils literal"><span class="pre">inputs</span></code> property of the action and see if it is about to delete nodes
from the cluster. If the action is indeed about removing nodes, then the
policy gets what it wants, i.e. the <code class="docutils literal"><span class="pre">count</span></code> value. If the action is not
about deleting nodes, then the action passes the policy check directly.</p>
<p>After having figured out the number of nodes to delete, the policy may still
need to decide which nodes to remove, i.e. the candidates. When no other
policy has made a decision, the loadbalance policy randomly chooses the
specified number of nodes as candidates.</p>
<p>After the candidates is eventually selected, the policy proceeds to update the
load balancer as outlined in scenario <em>S1</em>.</p>
</div>
<div class="section" id="s4-cluster-scale-out">
<h3>S4: <code class="docutils literal"><span class="pre">CLUSTER_SCALE_OUT</span></code><a class="headerlink" href="#s4-cluster-scale-out" title="Permalink to this headline">¶</a></h3>
<p>The policy may be checked <strong>AFTER</strong> a scale out operation is performed on the
cluster. After new nodes have been created into the cluster, the loadbalance
policy needs to notify the load balancer about the new members added.
When the loadbalance policy is checked, there may and may not be other
policies attached to the cluster. So the policy will need to check both cases.</p>
<p>It first checks if there is a &#8220;<code class="docutils literal"><span class="pre">creation</span></code>&#8221; key in the action&#8217;s <code class="docutils literal"><span class="pre">data</span></code>
field. If the &#8220;<code class="docutils literal"><span class="pre">creation</span></code>&#8221; key is not found, it means the operation has
nothing to do with the loadbalance policy. For example, it could be a request
to resize a cluster, but the result is about removal of existing nodes instead
of creation of new nodes. In this case, the policy checking aborts immediately.</p>
<p>When new nodes are created, the operation is expected to have filled the
action&#8217;s <code class="docutils literal"><span class="pre">data</span></code> field with data that looks like the following example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;creation&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;4e54e810-6579-4436-a53e-11b18cb92e4c&quot;</span><span class="p">,</span>
      <span class="s2">&quot;e730b3d0-056a-4fa3-9b1c-b1e6e8f7d6eb&quot;</span><span class="p">,</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The &#8220;<code class="docutils literal"><span class="pre">nodes</span></code>&#8221; field in the <code class="docutils literal"><span class="pre">creation</span></code> map always contain a list of node
IDs for the nodes that have been created. After having get the node IDs, the
policy proceeds to add these nodes to the load balancer (recorded in the
policy binding data) by invoking the LBaaS API. If any update operation to the
load balancer fails, the policy returns with an error message. If a node has
been successfully added to the load balancer, the engine will record the
load balancer IDs into the node&#8217;s <code class="docutils literal"><span class="pre">data</span></code> field.</p>
</div>
<div class="section" id="s5-cluster-add-nodes">
<h3>S5: <code class="docutils literal"><span class="pre">CLUSTER_ADD_NODES</span></code><a class="headerlink" href="#s5-cluster-add-nodes" title="Permalink to this headline">¶</a></h3>
<p>When a <code class="docutils literal"><span class="pre">CLUSTER_ADD_NODES</span></code> operation is completed, it will record the IDs of
the nodes into the <code class="docutils literal"><span class="pre">creation</span></code> property of the action&#8217;s <code class="docutils literal"><span class="pre">data</span></code> field. The
logic to update the load balancer and the logic to update the <code class="docutils literal"><span class="pre">data</span></code> field
of individual nodes are identical to that described in scenario <em>S4</em>.</p>
</div>
<div class="section" id="s6-cluster-resize-that-expands-a-cluster">
<h3>S6: <code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code> that Expands a Cluster<a class="headerlink" href="#s6-cluster-resize-that-expands-a-cluster" title="Permalink to this headline">¶</a></h3>
<p>When a <code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code> operation is completed and the operation results in
some new nodes created and added to the cluster, it will record the IDs of
the nodes into the <code class="docutils literal"><span class="pre">creation</span></code> property of the action&#8217;s <code class="docutils literal"><span class="pre">data</span></code> field. The
logic to update the load balancer and the logic to update the <code class="docutils literal"><span class="pre">data</span></code> field
of individual nodes are identical to that described in scenario <em>S4</em>.</p>
</div>
<div class="section" id="s7-handling-node-create-action">
<h3>S7: Handling <code class="docutils literal"><span class="pre">NODE_CREATE</span></code> Action<a class="headerlink" href="#s7-handling-node-create-action" title="Permalink to this headline">¶</a></h3>
<p>When the action to be processed is a <code class="docutils literal"><span class="pre">NODE_CREATE</span></code> action, the new node has
been created and it is yet to be attached to the load balancer. The logic to
update the load balancer and the <code class="docutils literal"><span class="pre">data</span></code> field of the node in question are
identical to that described in scenario <em>S4</em>.</p>
<p>When the action to be processed is a <code class="docutils literal"><span class="pre">NODE_DELETE</span></code> action, the node is about
to be removed from the cluster. Before that, the policy is responsible to
detach it from the load balancer. The logic to update the load balancer and
the <code class="docutils literal"><span class="pre">data</span></code> field of the node in question are identical to that described in
scenario <em>S1</em>.</p>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="deletion_v1.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Deletion Policy V1.0"></i></a>
          
          
            <a href="region_v1.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Region Placement Policy V1.0"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="../../_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="../../index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Configuration Options</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/basics.html">Senlin Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/policies.html">Working with Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/receivers.html">Working with Receivers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/profile_types.html">Profile Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/profiles.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/clusters.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/nodes.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/membership.html">Cluster Membership</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types.html">Policy Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policies.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/bindings.html">Cluster-Policy Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/receivers.html">Receiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/actions.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/events.html">Events</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/affinity.html">Affinity Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/deletion.html">Deletion Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/load_balancing.html">Load-Balancing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/scaling.html">Scaling Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/region_placement.html">Region Placement Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/zone_placement.html">Zone Placement Policy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/affinity.html">Managing Node Affinity</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_overview.html">Support to AutoScaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_ceilometer.html">Autoscaling using Ceilometer/Aodh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_heat.html">Autoscaling with Heat</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api_microversion.html">API Microversioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authorization.html">Senlin Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profile.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../node.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policy.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../action.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../receiver.html">Receiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Senlin testing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../plugin_guide.html">Plugin Writer&#8217;s Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../policy_type.html">Policy Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../profile_type.html">Profile Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event_dispatcher.html">Event Dispatchers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../osprofiler.html">OSProfiler</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="affinity_v1.html">Affinity Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="deletion_v1.html">Deletion Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="health_v1.html">Health Policy V1.0</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Load Balancing Policy V1.0</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#applicable-profiles">Applicable Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#actions-handled">Actions Handled</a></li>
<li class="toctree-l2"><a class="reference internal" href="#policy-properties">Policy Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-balancer-management">Load Balancer Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scenarios">Scenarios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="region_v1.html">Region Placement Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="scaling_v1.html">Scaling Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="zone_v1.html">Zone Placement Policy V1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reviews.html">Reviews</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../man/index.html">Man Pages</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "developer/policies/load_balance_v1" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/senlin/tree/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 'Tue Feb 14 14:27:25 2017, commit e2451a7";
        var bugProject = "senlin";
        var bugTitle = "Load Balancing Policy V1.0 in senlin";
    var fieldTags = "docs";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 3.0.0.0rc2.dev62 on None";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>