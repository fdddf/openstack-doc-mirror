<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Health Policy V1.0</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="../../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../../_static/css/combined.css" rel="stylesheet">
<link href="../../_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Health Policy V1.0</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="../osprofiler.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: OSProfiler"></i></a>
    
    
    <a href="../reviews.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Reviews"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Health Policy V1.0</a><ul>
<li><a class="reference internal" href="#applicable-profile-types">Applicable Profile Types</a></li>
<li><a class="reference internal" href="#actions-handled">Actions Handled</a></li>
<li><a class="reference internal" href="#failure-detection">Failure Detection</a><ul>
<li><a class="reference internal" href="#proactive-node-status-polling">Proactive Node Status Polling</a></li>
<li><a class="reference internal" href="#listening-to-event-notifications">Listening to Event Notifications</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recovery-actions">Recovery Actions</a><ul>
<li><a class="reference internal" href="#default-recovery-action">Default Recovery Action</a></li>
<li><a class="reference internal" href="#profile-specific-recovery-actions">Profile-specific Recovery Actions</a></li>
<li><a class="reference internal" href="#external-recovery-actions">External Recovery Actions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fencing-support">Fencing Support</a></li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="health-policy-v1-0">
<h1>Health Policy V1.0<a class="headerlink" href="#health-policy-v1-0" title="Permalink to this headline">¶</a></h1>
<p>The health policy is designed to automate the failure detection and recovery
process for a cluster.</p>
<div class="section" id="applicable-profile-types">
<h2>Applicable Profile Types<a class="headerlink" href="#applicable-profile-types" title="Permalink to this headline">¶</a></h2>
<p>The policy is designed to handle both <code class="docutils literal"><span class="pre">os.nova.server</span></code> and <code class="docutils literal"><span class="pre">os.heat.stack</span></code>
profile types.</p>
</div>
<div class="section" id="actions-handled">
<h2>Actions Handled<a class="headerlink" href="#actions-handled" title="Permalink to this headline">¶</a></h2>
<p>The policy is capable of handling the following actions:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">CLUSTER_RECOVER</span></code>: an action that carries some optional parameters as its
inputs. The parameters are specific to the profile type of the target
cluster.</li>
<li><code class="docutils literal"><span class="pre">CLUSTER_DEL_NODES</span></code>: an action that carries a list value named
<code class="docutils literal"><span class="pre">candidates</span></code> in its <code class="docutils literal"><span class="pre">inputs</span></code> value.</li>
<li><code class="docutils literal"><span class="pre">CLUSTER_SCALE_IN</span></code>: an action that carries an optional integer value named
<code class="docutils literal"><span class="pre">count</span></code> in its <code class="docutils literal"><span class="pre">inputs</span></code> value.</li>
<li><code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code>: an action that carries various key-value pairs as
arguments to the action in its <code class="docutils literal"><span class="pre">inputs</span></code> value.</li>
<li><code class="docutils literal"><span class="pre">NODE_DELETE</span></code>: an action that has a node associated with it. This action
has to be originated from a RPC request directly so that it will be
processed by the health policy.</li>
</ul>
<p>The policy will be checked <strong>BEFORE</strong> a <code class="docutils literal"><span class="pre">CLUSTER_RECOVER</span></code> action is executed.
It will derive the appropriate inputs to the action based on the policy&#8217;s
properties.</p>
<p>The policy will be checked <strong>BEFORE</strong> and <strong>AFTER</strong> any one of the
<code class="docutils literal"><span class="pre">CLUSTER_DEL_NODES</span></code>, <code class="docutils literal"><span class="pre">CLUSTER_SCALE_IN</span></code>, <code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code> and the
<code class="docutils literal"><span class="pre">NODE_DELETE</span></code> action is executed. Under the condition that any of these
actions are originated from RPC requests, Senlin is aware of the fact that
a cluster is losing node member(s) because of a normal cluster membership
management operation initiated by users rather than unexpected node failures.
The health policy will temporarily disable the <em>health manager</em> function on
the cluster in question and re-enable the health management after the action
has completed.</p>
<p>The health policy can be treated as an interface for the <em>health manager</em>
engine running inside the <code class="docutils literal"><span class="pre">senlin-engine</span></code> process. Its specification
contains two main &#8220;sections&#8221;, <code class="docutils literal"><span class="pre">detection</span></code> and <code class="docutils literal"><span class="pre">recovery</span></code>, each of which
specifies how to detect node failures and how to recover a node to a healthy
status respectively.</p>
</div>
<div class="section" id="failure-detection">
<h2>Failure Detection<a class="headerlink" href="#failure-detection" title="Permalink to this headline">¶</a></h2>
<p>The health policy is designed to be flexible regarding node failure detection.
The current vision is that the health policy will support following types
of failure detection:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">NODE_STATUS_POLLING</span></code>: the <em>health manager</em> periodically polls a cluster
and check if there are nodes inactive.</li>
<li><code class="docutils literal"><span class="pre">LIFECYCLE_EVENTS</span></code>: the <em>health manager</em> listens to event notifications
sent by the backend service (e.g. nova-compute).</li>
<li><code class="docutils literal"><span class="pre">LB_STATUS_POLLING</span></code>: the <em>health manager</em> periodically polls the load
balancer (if any) and see if any node has gone offline.</li>
</ul>
<p>The third option above (<code class="docutils literal"><span class="pre">LB_STATUS_POLLING</span></code>) is not usable yet due to an
outstanding issue in the LBaaS service. But we are still tracking its progress
considering that metrics from the load-balancer is more trust-worthy and more
useful because they originate from the data plane rather than the control
plane.</p>
<p>Yet another option regarding load-balancer based health detection is to have
the load-balancer emit event notifications when node status changes. This is
also an ongoing work which may take some time to land.</p>
<div class="section" id="proactive-node-status-polling">
<h3>Proactive Node Status Polling<a class="headerlink" href="#proactive-node-status-polling" title="Permalink to this headline">¶</a></h3>
<p>The most straight-foward way of node failure detection is by checking the
backend service about the status of the physical resource represented by a
node. If the <code class="docutils literal"><span class="pre">type</span></code> of <code class="docutils literal"><span class="pre">detection</span></code> is set to &#8220;<code class="docutils literal"><span class="pre">NODE_STATUS_POLLING</span></code>&#8221;
(optionally, with an <code class="docutils literal"><span class="pre">interval</span></code> value specified), the <em>health manager</em> will
periodically check the resource status by querying the backend service and see
if the resource is active.  Below is a sample configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>type: senlin.policy.health
version: 1.0
properties:
  detection:
    type: NODE_STATUS_POLLING
    options:
      internal: 120

  ...
</pre></div>
</div>
<p><strong>NOTE</strong>: The current polling logic is only about checking with the backend
service whether a resource is in &#8220;ACTIVE&#8221; status. However, in future, this may
get extended to having the <em>health manager</em> ping the IP address of a nova
server or posting a &#8220;GET&#8221; request to a specific URL. We believe such
extensions can better reveal whether a specific node is operating.</p>
<p>Once such a policy object is attached to a cluster, Senlin registers the
cluster to the <em>health manager</em> engine for failure detection, i.e., node
health checking. A thread is created to issue a <code class="docutils literal"><span class="pre">CLUSTER_CHECK</span></code> RPC request
to the <code class="docutils literal"><span class="pre">senlin-engine</span></code> periodically at the specified interval. The
<code class="docutils literal"><span class="pre">CLUSTER_CHECK</span></code> action only refreshes the status of each and every node in
the cluster.</p>
<p>When one of the <code class="docutils literal"><span class="pre">senlin-engine</span></code> services is restarted, a new <em>health manager</em>
engine will be launched. This new engine will check the database and see if
there are clusters which have health policies attached and thus having its
health status maintained by a <em>health manager</em> that is no longer alive. The
new <em>health manager</em> will pick up these clusters for health management.</p>
</div>
<div class="section" id="listening-to-event-notifications">
<h3>Listening to Event Notifications<a class="headerlink" href="#listening-to-event-notifications" title="Permalink to this headline">¶</a></h3>
<p>For some profile types (currently <code class="docutils literal"><span class="pre">os.nova.server</span></code>), the backend service may
emit an event notification on the control plane message bus. These events are
more economic ways for node failure detection, assuming that all kinds of
status changes will be captured and reported by the backend service. Actually,
we have verified that most lifecycle events related to a VM server are already
captured and reported by Nova. For other profile types such as
<code class="docutils literal"><span class="pre">os.heat.stack</span></code>, there also exists such a possibility although based on our
knowledge Heat cannot detect all stack failures.</p>
<p>Event listening is a cheaper way for node failure detection when compared to
the status polling approach described above. To instruct the <em>health manager</em>
to listen to event notifications, users can attach their cluster(s) a health
policy which looks like the following example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>type: senlin.policy.health
version: 1.0
properties:
  detection:
    type: LIFECYCLE_EVENTS

  ...
</pre></div>
</div>
<p>When such a policy is attached to a cluster, Senlin registers the cluster to
the <em>health manager</em> engine for failure detection, i.e., node health checking.
A listener thread is created to listen to events that indicate certain node
has failed.  For nova server nodes, the current implementation treats all of
the following event types as indication of node failures:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">compute.instance.delete.end</span></code>: A server has been accidentally deleted.</li>
<li><code class="docutils literal"><span class="pre">compute.instance.pause.end</span></code>: A server has been accidentally paused.</li>
<li><code class="docutils literal"><span class="pre">compute.instance.power_off.end</span></code>: A server has been stopped accidentally.</li>
<li><code class="docutils literal"><span class="pre">compute.instance.rebuild.error</span></code>: A server rebuild has failed.</li>
<li><code class="docutils literal"><span class="pre">compute.instance.shutdown.end</span></code>: A server has been shut down for unknown
reasons.</li>
<li><code class="docutils literal"><span class="pre">compute.instance.soft_delete.end</span></code>: A server has been soft deleted.</li>
</ul>
<p>When any one of such an event is heard by the listener thread, it will issue
a <code class="docutils literal"><span class="pre">NODE_RECOVER</span></code> RPC request to the senlin-engine service. For the health
policy to make a smarter decision on the proper recover operation, the RPC
request is augmented with some parameters as hints to the recovery operation
as exemplified below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;SHUTDOWN&quot;</span><span class="p">,</span>
  <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;shutdown&quot;</span><span class="p">,</span>
  <span class="s2">&quot;instance_id&quot;</span><span class="p">:</span> <span class="s2">&quot;449ad837-3db2-4aa9-b324-ecd28e14ab14&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-11-27T12:10:58Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;publisher&quot;</span><span class="p">:</span> <span class="s2">&quot;nova-compute:node1&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ideally, a health management solution can react differently based on the
different types of failures detected. For example, a server stopped by accident
can be simply recovered by start it again; a paused server can be unpaused
quickly instead of being recreated.</p>
<p>When one of the <code class="docutils literal"><span class="pre">senlin-engine</span></code> services is restarted, a new <em>health manager</em>
engine will be launched. This new engine will check the database and see if
there are clusters which have health policies attached and thus having its
health status maintained by a <em>health manager</em> that is no longer alive. The
new <em>health manager</em> will pick up these clusters for health management.</p>
</div>
</div>
<div class="section" id="recovery-actions">
<h2>Recovery Actions<a class="headerlink" href="#recovery-actions" title="Permalink to this headline">¶</a></h2>
<p>The value of the recovery <code class="docutils literal"><span class="pre">actions</span></code> key for <code class="docutils literal"><span class="pre">recovery</span></code> is modeled as a
list, each of which specifies an action to try. The list of actions are to be
adjusted by the policy before passing on to a base <code class="docutils literal"><span class="pre">Profile</span></code> for actual
execution. An example (imaginary) list of actions is shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>type: senlin.policy.health
version: 1.0
properties:
  ...
  recovery:
    actions:
      - name: REBOOT
        params:
          type: soft
      - name: REBUILD
      - name: my_evacuation_workflow
        type: MISTRAL_WORKFLOW
        params:
          node_id: {{ node.physicalid }}
</pre></div>
</div>
<p>The above specification basically tells Senlin engine to try a list of
recovery actions one by one. The first thing to try is to &#8220;reboot&#8221; (an
operation only applicable on a Nova server) the failed node in question. If
that didn&#8217;t solve the problem, the engine is expected to &#8220;rebuild&#8221; (also a
Nova server specific verb) the failed node. If this cannot bring the node back
to healthy status, the engine should execute a Mistral workflow named
&#8220;<code class="docutils literal"><span class="pre">my_evacuation_workflow</span></code>&#8221; and pass in the physical ID of the node.</p>
<p>The health policy is triggered when a <code class="docutils literal"><span class="pre">CLUSTER_RECOVER</span></code> action is to be
executed. Using the above example, the policy object will fill in the <code class="docutils literal"><span class="pre">data</span></code>
field of the action object with the following content:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>{
  &quot;health&quot;: {
    &quot;recover_action&quot;: [
      {
        &quot;name&quot;: &quot;REBOOT&quot;,
        &quot;params&quot;: {
          &quot;type&quot;: &quot;soft&quot;
        }
      },
      {
        &quot;name&quot;: &quot;REBUILD&quot;
      },
      {
        &quot;name&quot;: &quot;my_evacuation_workflow&quot;,
        &quot;type&quot;: &quot;MISTRAL_WORKFLOW&quot;,
        &quot;params&quot;: {
          &quot;node_id&quot;: &quot;7a753f4b-417d-4c10-8065-681f60db0c9a&quot;
        }
      }
    ]
    ...
  }
}
</pre></div>
</div>
<p>This action customization is eventually passed on to the <code class="docutils literal"><span class="pre">Profile</span></code> base
class where the actual actions are performed.</p>
<p><strong>NOTE</strong>: Currently, we only support a single action in the list. The support
to Mistral workflow is also an ongoing work.</p>
<div class="section" id="default-recovery-action">
<h3>Default Recovery Action<a class="headerlink" href="#default-recovery-action" title="Permalink to this headline">¶</a></h3>
<p>Since Senlin is designed to manage different types of resources, each resource
type, i.e. <a class="reference internal" href="../../glossary.html#term-profile-type"><span class="xref std std-term">profile type</span></a>, may support different sets of operations that
can be used for failure recovery.</p>
<p>A more practical and more general operation to recover a failed resource is to
delete the old one followed by creating a new one, thus a <code class="docutils literal"><span class="pre">RECREATE</span></code>
operation. Note that the <code class="docutils literal"><span class="pre">RECREATE</span></code> action is although generic enough, it
may and may not be what users want. For example, there is not guarantee that a
recreated Nova server will preserve its physical ID or its IP address. The
temporary status of the original server will be lost for sure.</p>
</div>
<div class="section" id="profile-specific-recovery-actions">
<h3>Profile-specific Recovery Actions<a class="headerlink" href="#profile-specific-recovery-actions" title="Permalink to this headline">¶</a></h3>
<p>Each profile type supports a unique set of operations, some of which are
relevant to failure recovery. For example, a Nova server may support many
operations that can be used for failure recovery, a Heat stack may support
only the <code class="docutils literal"><span class="pre">STACK_UPDATE</span></code> operation for recovery. This set of actions that can
be specified for recovery is profile specific, thus an important part for the
policy to check and validate.</p>
</div>
<div class="section" id="external-recovery-actions">
<h3>External Recovery Actions<a class="headerlink" href="#external-recovery-actions" title="Permalink to this headline">¶</a></h3>
<p>In real-life deployments, there are use cases where a simple recovery of a
node itself is not sufficient to bring back the business services or
applications that were running on those nodes. There are other use cases where
appropriate actions must be taken on the storage and/or network used for a
full failure recovery. These are the triggers for the Senlin team to bring in
support to Mistral workflows as special actions.</p>
<p>The current design is to allow for a mixture of built-in recovery actions and
user provided workflows. In the forseeable future, Senlin does not manage the
workflows to be executed and the team has no plan to support the debugging of
workflow executions. Users have to make sure their workflows are doing things
they want.</p>
</div>
</div>
<div class="section" id="fencing-support">
<h2>Fencing Support<a class="headerlink" href="#fencing-support" title="Permalink to this headline">¶</a></h2>
<p>The term &#8220;fencing&#8221; is used to describe the operations that make sure a
seemingly failed resource is dead for sure. This is a very important aspect in
all high-availability solutions. Take a Nova server failure as an example,
there are many causes which can lead the server into an inactive status. A
physical host crash, a network connection breakage etc. can all result in a
node unreachable. From Nova controller&#8217;s perspective, it may appear that the
host has gone offline, however, what really happened could be just the
management network is experiencing some problems. The host is actually still
there, all the VM instances on it are still active, which means they are still
processing requests and they are still using the IP addresses allocated to
them by a DHCP server.</p>
<p>There are many such cases where a seemingly inactive node is still working and
these nodes will bring the whole cluster into unpredictable status if we only
attempt an immature recovery action without considering the possibility that
the nodes are still alive.</p>
<p>Considering this, we are working on modeling and implementing support to
fencing in the health policy.</p>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="../osprofiler.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: OSProfiler"></i></a>
          
          
            <a href="../reviews.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Reviews"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="../../_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="../../index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Configuration Options</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/basics.html">Senlin Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/policies.html">Working with Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/receivers.html">Working with Receivers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/profile_types.html">Profile Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/profiles.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/clusters.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/nodes.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/membership.html">Cluster Membership</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types.html">Policy Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policies.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/bindings.html">Cluster-Policy Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/receivers.html">Receiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/actions.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/events.html">Events</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/affinity.html">Affinity Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/deletion.html">Deletion Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/load_balancing.html">Load-Balancing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/scaling.html">Scaling Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/region_placement.html">Region Placement Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/zone_placement.html">Zone Placement Policy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/affinity.html">Managing Node Affinity</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_overview.html">Support to AutoScaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_ceilometer.html">Autoscaling using Ceilometer/Aodh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_heat.html">Autoscaling with Heat</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_microversion.html">API Microversioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authorization.html">Senlin Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profile.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../node.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policy.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../action.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../receiver.html">Receiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Senlin testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugin_guide.html">Plugin Writer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../osprofiler.html">OSProfiler</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="affinity_v1.html">Affinity Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="deletion_v1.html">Deletion Policy V1.0</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Health Policy V1.0</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#applicable-profile-types">Applicable Profile Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#actions-handled">Actions Handled</a></li>
<li class="toctree-l2"><a class="reference internal" href="#failure-detection">Failure Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#recovery-actions">Recovery Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fencing-support">Fencing Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="load_balance_v1.html">Load Balancing Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="region_v1.html">Region Placement Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="scaling_v1.html">Scaling Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="zone_v1.html">Zone Placement Policy V1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reviews.html">Reviews</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../man/index.html">Man Pages</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "developer/policies/health_v1" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/senlin/tree/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 'Tue Feb 14 14:27:25 2017, commit e2451a7";
        var bugProject = "senlin";
        var bugTitle = "Health Policy V1.0 in senlin";
    var fieldTags = "docs";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 3.0.0.0rc2.dev62 on None";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>