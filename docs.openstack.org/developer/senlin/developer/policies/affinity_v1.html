<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Affinity Policy V1.0</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="../../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../../_static/css/combined.css" rel="stylesheet">
<link href="../../_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Affinity Policy V1.0</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="../policy_type.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Policy Types"></i></a>
    
    
    <a href="deletion_v1.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Deletion Policy V1.0"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Affinity Policy V1.0</a><ul>
<li><a class="reference internal" href="#applicable-profiles">Applicable Profiles</a></li>
<li><a class="reference internal" href="#actions-handled">Actions Handled</a></li>
<li><a class="reference internal" href="#scenarios">Scenarios</a><ul>
<li><a class="reference internal" href="#s1-inheriting-server-group-from-profile">S1: Inheriting Server Group from Profile</a></li>
<li><a class="reference internal" href="#s2-creating-a-server-group-when-needed">S2: Creating A Server Group when Needed</a></li>
<li><a class="reference internal" href="#s3-enabling-vsphere-drs-extensions">S3: Enabling vSphere DRS Extensions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="affinity-policy-v1-0">
<h1>Affinity Policy V1.0<a class="headerlink" href="#affinity-policy-v1-0" title="Permalink to this headline">¶</a></h1>
<p>This policy is designed for Senlin clusters to exploit the <em>servergroup</em> API
exposed by the Nova compute service. The basic policy has been extended to
work with vSphere hypervisor when VMware DRS feature is enabled. However, such
an extension is only applicable to <em>admin</em> owned server clusters.</p>
<div class="section" id="applicable-profiles">
<h2>Applicable Profiles<a class="headerlink" href="#applicable-profiles" title="Permalink to this headline">¶</a></h2>
<p>The policy is designed to handle only Nova server profile type, e.g.
<code class="docutils literal"><span class="pre">os.nova.server-1.0</span></code>.</p>
</div>
<div class="section" id="actions-handled">
<h2>Actions Handled<a class="headerlink" href="#actions-handled" title="Permalink to this headline">¶</a></h2>
<p>The policy is capable of handling the following actions:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">CLUSTER_SCALE_OUT</span></code>: an action that carries an optional integer value
named <code class="docutils literal"><span class="pre">count</span></code> in its <code class="docutils literal"><span class="pre">inputs</span></code>.</li>
<li><code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code>: an action that carries various input parameters to
resize a cluster. The policy will try to parse the raw inputs if no other
policies have done this.</li>
<li><code class="docutils literal"><span class="pre">NODE_CREATE</span></code>: an action originated from a node creation RPC request.
The policy is capable of processing the node associated with this action.</li>
</ul>
<p>The policy will be checked <strong>BEFORE</strong> any of the above mentioned actions is
executed. When the action is <code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code>, the affinity policy will
check if it is about the creation of new nodes. If the resize request is about
the removal of existing nodes, the policy won&#8217;t block the request.</p>
<p>Senlin engine respects outputs (i.e. number of nodes to create) from other
policies, if any. If no such data exists, it then checks the user-provided
&#8220;<code class="docutils literal"><span class="pre">count</span></code>&#8221; input if there is one. The policy is also designed to parse a
cluster resize request and see if there are new nodes to be created.</p>
<p>After validating the <code class="docutils literal"><span class="pre">count</span></code> value, the affinity policy proceeds to update
the <code class="docutils literal"><span class="pre">data</span></code> property of the action with node placement data. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;placement&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;placements&#39;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span><span class="s1">&#39;servergroup&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZ-ABCD&#39;</span><span class="p">},</span>
      <span class="p">{</span><span class="s1">&#39;servergroup&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZ-ABCD&#39;</span><span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="scenarios">
<h2>Scenarios<a class="headerlink" href="#scenarios" title="Permalink to this headline">¶</a></h2>
<div class="section" id="s1-inheriting-server-group-from-profile">
<h3>S1: Inheriting Server Group from Profile<a class="headerlink" href="#s1-inheriting-server-group-from-profile" title="Permalink to this headline">¶</a></h3>
<p>When attaching the affinity policy to a cluster that is based on a profile
type of <code class="docutils literal"><span class="pre">os.nova.server-1.0</span></code>, if the profile contains <code class="docutils literal"><span class="pre">scheduler_hints</span></code>
property and the property value (a collection) has a <code class="docutils literal"><span class="pre">group</span></code> key, the engine
will use the value of the <code class="docutils literal"><span class="pre">group</span></code> key as a Nova server group name. In this
case, the affinity policy will check if the specified server group does exist.
If the group doesn&#8217;t exist, or the rules specified in the group doesn&#8217;t match
that specified (or implied) by the affinity policy, you will get an error when
attaching the policy to the cluster. If, on the contrary, the group is found
and the rules do match that of the current policy, the engine will record the
ID of the server group into the policy binding data. The engine also saves a
key-value pair <code class="docutils literal"><span class="pre">inherited_group:</span> <span class="pre">True</span></code> into the policy binding data, so that
in future the engine knows that the server group wasn&#8217;t created from scratch
by the affinity policy. This will lead to the following data stored into the
policy binding data:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;AffinityPolicy&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">&#39;servergroup_id&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZ-ABCD&#39;</span><span class="p">,</span>
      <span class="s1">&#39;inherited_group&#39;</span><span class="p">:</span> <span class="bp">True</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When an affinity policy is to be detached from a cluster, the Senlin engine
will check and learn the server group was not created by the affinity policy.
The engine will not delete the server group.</p>
<p>Before any of the targeted actions is executed, the affinity policy gets a
chance to be checked. It does so by looking into the policy binding data and
find out the server group ID to use. For node creation requests, the policy
will yield some data into <code class="docutils literal"><span class="pre">action.data</span></code> property that looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;placement&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;placements&#39;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span><span class="s1">&#39;servergroup&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZ-ABCD&#39;</span><span class="p">},</span>
      <span class="p">{</span><span class="s1">&#39;servergroup&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZ-ABCD&#39;</span><span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="s2-creating-a-server-group-when-needed">
<h3>S2: Creating A Server Group when Needed<a class="headerlink" href="#s2-creating-a-server-group-when-needed" title="Permalink to this headline">¶</a></h3>
<p>When attaching an affinity policy to a cluster, if the cluster profile doesn&#8217;t
contain a <code class="docutils literal"><span class="pre">scheduler_hints</span></code> property or there is no <code class="docutils literal"><span class="pre">group</span></code> value
specified in the <code class="docutils literal"><span class="pre">scheduler_hints</span></code> property, the engine will create a new
server group by invoking the Nova API, providing it the policies specified (or
implied) as inputs. The ID of the newly created server group is then saved
into the policy binding data, along with a <code class="docutils literal"><span class="pre">inherited_group:</span> <span class="pre">False</span></code> key-value
pair. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;AffinityPolicy&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">&#39;servergroup_id&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZ-ABCD&#39;</span><span class="p">,</span>
      <span class="s1">&#39;inherited_group&#39;</span><span class="p">:</span> <span class="bp">False</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When such a policy is later detached from the cluster, the Senlin engine will
check and learn that the server group should be deleted. It then deletes the
server group by invoking Nova API.</p>
<p>When the targeted actions are about to be executed, the protocol for checking
and data saving is identical to that outlined in scenario <em>S1</em>.</p>
</div>
<div class="section" id="s3-enabling-vsphere-drs-extensions">
<h3>S3: Enabling vSphere DRS Extensions<a class="headerlink" href="#s3-enabling-vsphere-drs-extensions" title="Permalink to this headline">¶</a></h3>
<p>When you have vSphere hosts (with DRS feature enabled) serving hypervisors to
Nova, a vSphere host is itself a collection of physical nodes. To make better
use of the vSphere DRS feature, you can enable the DRS extension by specifying
<code class="docutils literal"><span class="pre">enable_drs_extension:</span> <span class="pre">True</span></code> in your affinity policy.</p>
<p>When attaching and detaching the affinity policy to/from a cluster, the engine
operations are the same as described in scenario <em>S1</em> and <em>S2</em>. However, when
one of the targeted actions is triggered, the affinity policy will first check
if the <code class="docutils literal"><span class="pre">availability_zone</span></code> property is set and it will use &#8220;<code class="docutils literal"><span class="pre">nova</span></code>&#8221; as the
default value if not specified.</p>
<p>The engine then continues to check the input parameters (as outlined above) to
find out the number of nodes to create. It also checks the server group ID to
use by looking into the policy binding data.</p>
<p>After the policy has collected all inputs it needs, it proceeds to check the
available vSphere hypervisors with DRS enabled. It does so by looking into the
<code class="docutils literal"><span class="pre">hypervisor_hostname</span></code> property of each hypervisor reported by Nova
(<strong>Note</strong>: retrieving hypervisor list is an admin-only API, and that is the
reason the vSphere extension is only applicable to admin-owned clusters).
The policy attempts to find a hypervisor whose host name contains <code class="docutils literal"><span class="pre">drs</span></code>. If
it fails to find such a hypervisor, the policy check fails with the action&#8217;s
<code class="docutils literal"><span class="pre">data</span></code> field set to:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span>
  <span class="s1">&#39;status_reason&#39;</span><span class="p">:</span> <span class="s1">&#39;No suitable vSphere host is available.&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The affinity uses the first matching hypervisor as the target host and it
forms a string containing the availability zone name and the hypervisor
host name, e.g. &#8220;<code class="docutils literal"><span class="pre">nova:vsphere_drs_1</span></code>&#8221;. This string will later be used as
the availability zone name sent to Nova. For example, the following is sample
result when applying the affinity policy to a cluster with vSphere DRS
enabled.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;placement&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;placements&#39;</span><span class="p">:</span> <span class="p">[{</span>
        <span class="s1">&#39;zone&#39;</span><span class="p">:</span> <span class="s1">&#39;nova:vsphere_drs_1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;servergroup&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZ-ABCD&#39;</span>
      <span class="p">},</span> <span class="p">{</span>
        <span class="s1">&#39;zone&#39;</span><span class="p">:</span> <span class="s1">&#39;nova:vsphere_drs_1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;servergroup&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZ-ABCD&#39;</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>NOTE</strong>: The <code class="docutils literal"><span class="pre">availability_zone</span></code> property is effective even when the
vSphere DRS extension is not enabled. When <code class="docutils literal"><span class="pre">availability_zone</span></code> is explicitly
specified, the affinity policy will pass it along with the server group ID
to the Senlin engine for further processing, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;placement&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;placements&#39;</span><span class="p">:</span> <span class="p">[{</span>
        <span class="s1">&#39;zone&#39;</span><span class="p">:</span> <span class="s1">&#39;nova_1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;servergroup&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZ-ABCD&#39;</span>
      <span class="p">},</span> <span class="p">{</span>
        <span class="s1">&#39;zone&#39;</span><span class="p">:</span> <span class="s1">&#39;nova_1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;servergroup&#39;</span><span class="p">:</span> <span class="s1">&#39;XYZ-ABCD&#39;</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="../policy_type.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Policy Types"></i></a>
          
          
            <a href="deletion_v1.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Deletion Policy V1.0"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="../../_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="../../index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Configuration Options</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/basics.html">Senlin Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/policies.html">Working with Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/receivers.html">Working with Receivers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/profile_types.html">Profile Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/profiles.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/clusters.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/nodes.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/membership.html">Cluster Membership</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types.html">Policy Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policies.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/bindings.html">Cluster-Policy Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/receivers.html">Receiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/actions.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/events.html">Events</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/affinity.html">Affinity Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/deletion.html">Deletion Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/load_balancing.html">Load-Balancing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/scaling.html">Scaling Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/region_placement.html">Region Placement Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/zone_placement.html">Zone Placement Policy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/affinity.html">Managing Node Affinity</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_overview.html">Support to AutoScaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_ceilometer.html">Autoscaling using Ceilometer/Aodh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_heat.html">Autoscaling with Heat</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api_microversion.html">API Microversioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authorization.html">Senlin Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profile.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../node.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policy.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../action.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../receiver.html">Receiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Senlin testing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../plugin_guide.html">Plugin Writer&#8217;s Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../policy_type.html">Policy Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../profile_type.html">Profile Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event_dispatcher.html">Event Dispatchers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../osprofiler.html">OSProfiler</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Affinity Policy V1.0</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#applicable-profiles">Applicable Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#actions-handled">Actions Handled</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scenarios">Scenarios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deletion_v1.html">Deletion Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="health_v1.html">Health Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="load_balance_v1.html">Load Balancing Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="region_v1.html">Region Placement Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="scaling_v1.html">Scaling Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="zone_v1.html">Zone Placement Policy V1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reviews.html">Reviews</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../man/index.html">Man Pages</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "developer/policies/affinity_v1" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/senlin/tree/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 'Tue Feb 14 14:27:25 2017, commit e2451a7";
        var bugProject = "senlin";
        var bugTitle = "Affinity Policy V1.0 in senlin";
    var fieldTags = "docs";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 3.0.0.0rc2.dev62 on None";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>