<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Zone Placement Policy V1.0</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="../../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../../_static/css/combined.css" rel="stylesheet">
<link href="../../_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Zone Placement Policy V1.0</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="scaling_v1.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Scaling Policy V1.0"></i></a>
    
    
    <a href="../profile_type.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Profile Types"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Zone Placement Policy V1.0</a><ul>
<li><a class="reference internal" href="#applicable-profiles">Applicable Profiles</a></li>
<li><a class="reference internal" href="#actions-handled">Actions Handled</a></li>
<li><a class="reference internal" href="#scenarios">Scenarios</a><ul>
<li><a class="reference internal" href="#s1-cluster-scale-in">S1: <code class="docutils literal"><span class="pre">CLUSTER_SCALE_IN</span></code></a></li>
<li><a class="reference internal" href="#s2-cluster-scale-out">S2: <code class="docutils literal"><span class="pre">CLUSTER_SCALE_OUT</span></code></a></li>
<li><a class="reference internal" href="#s3-cluster-resize">S3: <code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code></a></li>
<li><a class="reference internal" href="#s4-node-create">S4: <code class="docutils literal"><span class="pre">NODE_CREATE</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="zone-placement-policy-v1-0">
<h1>Zone Placement Policy V1.0<a class="headerlink" href="#zone-placement-policy-v1-0" title="Permalink to this headline">¶</a></h1>
<p>This policy is designed to make sure the nodes in a cluster are distributed
across multiple availability zones according to a specified scheme.</p>
<div class="section" id="applicable-profiles">
<h2>Applicable Profiles<a class="headerlink" href="#applicable-profiles" title="Permalink to this headline">¶</a></h2>
<p>The policy is designed to handle Nova server clusters only, i.e. clusters with
a profile of type <code class="docutils literal"><span class="pre">os.nova.server-1.0</span></code> for example.</p>
</div>
<div class="section" id="actions-handled">
<h2>Actions Handled<a class="headerlink" href="#actions-handled" title="Permalink to this headline">¶</a></h2>
<p>The policy is capable of handling the following actions:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">CLUSTER_SCALE_IN</span></code>: an action that carries an optional integer value named
<code class="docutils literal"><span class="pre">count</span></code> in its <code class="docutils literal"><span class="pre">inputs</span></code>.</li>
<li><code class="docutils literal"><span class="pre">CLUSTER_SCALE_OUT</span></code>: an action that carries an optional integer value
named <code class="docutils literal"><span class="pre">count</span></code> in its <code class="docutils literal"><span class="pre">inputs</span></code>.</li>
<li><code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code>: an action that accepts a map as its input parameters in
its <code class="docutils literal"><span class="pre">inputs</span></code> property, such as &#8220;<code class="docutils literal"><span class="pre">adjustment_type</span></code>&#8221;, &#8220;<code class="docutils literal"><span class="pre">number</span></code>&#8221; etc.</li>
<li><code class="docutils literal"><span class="pre">NODE_CREATE</span></code>: an action originated directly from a RPC request. Such an
action will have a node object associated with it, which becomes the one to
be handled by this policy.</li>
</ul>
<p>The policy will be checked <strong>BEFORE</strong> any of the above mentioned actions is
executed. Because the same policy implementation is used for covering both the
cases of scaling out a cluster and the cases of scaling in, the zone placement
policy need to parse the inputs in different scenarios.</p>
<p>The placement policy can be used independently, with and without other polices
attached to the same cluster. So the policy needs to understand whether there
are policy decisions from other policies (such as a
<a class="reference internal" href="scaling_v1.html"><em>scaling policy</em></a>).</p>
<p>When the policy is checked, it will first attempt to get the proper <code class="docutils literal"><span class="pre">count</span></code>
input value, which may be an outcome from other policies or the inputs for
the action. For more details, check the scenarios described in following
sections.</p>
</div>
<div class="section" id="scenarios">
<h2>Scenarios<a class="headerlink" href="#scenarios" title="Permalink to this headline">¶</a></h2>
<div class="section" id="s1-cluster-scale-in">
<h3>S1: <code class="docutils literal"><span class="pre">CLUSTER_SCALE_IN</span></code><a class="headerlink" href="#s1-cluster-scale-in" title="Permalink to this headline">¶</a></h3>
<p>The placement policy first checks if there are policy decisions from other
policies by looking into the <code class="docutils literal"><span class="pre">deletion</span></code> field of the action&#8217;s <code class="docutils literal"><span class="pre">data</span></code>
property. If there is such a field, the policy attempts to extract the
<code class="docutils literal"><span class="pre">count</span></code> value from the <code class="docutils literal"><span class="pre">deletion</span></code> field. If the <code class="docutils literal"><span class="pre">count</span></code> value is not
found, 1 is assumed to be the default.</p>
<p>If, however, the policy fails to find the <code class="docutils literal"><span class="pre">deletion</span></code> field, it tries to find
if there is a <code class="docutils literal"><span class="pre">count</span></code> field in the action&#8217;s <code class="docutils literal"><span class="pre">inputs</span></code> property. If the
answer is true, the policy will use it, or else it will fall back to assume 1
as the default count.</p>
<p>After the policy has find out the <code class="docutils literal"><span class="pre">count</span></code> value (i.e. number of nodes to be
deleted), it validates the list of availability zone names provided to the
policy. If for some reason, none of the provided names passed the validation,
the policy check fails with the following data recorded in the action&#8217;s
<code class="docutils literal"><span class="pre">data</span></code> property:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
  <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;No availability zone found available.&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With the list of availability zones known to be good and the map of node
distribution specified in the policy spec, senlin engine continues to
calculate a distribution plan that best matches the desired distribution.
If there are nodes that cannot be fit into the distribution plan, the policy
check fails with an error recorded in the action&#8217;s <code class="docutils literal"><span class="pre">data</span></code>, as shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
  <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;There is no feasible plan to handle all nodes.&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If there is a feasible plan to remove nodes from each availability zone, the
policy saves the plan into the <code class="docutils literal"><span class="pre">data</span></code> property of the action as exemplified
below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span>
  <span class="s2">&quot;deletion&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;zones&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;nova-1&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;nova-2&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This means in total, 3 nodes should be removed from the cluster. Among them,
2 nodes should be selected from availability zone &#8220;<code class="docutils literal"><span class="pre">nova-1</span></code>&#8221; and the rest
one should be selected from availability zone &#8220;<code class="docutils literal"><span class="pre">nova-2</span></code>&#8221;.</p>
<p><strong>NOTE</strong>: When there is a <a class="reference internal" href="deletion_v1.html"><em>deletion policy</em></a> attached to the
same cluster. That deletion policy will be evaluated after the zone placement
policy and it is expected to rebase its candidate selection on the zone
distribution enforced here. For example, if the deletion policy is tasked to
select the oldest nodes for deletion, it will adapt its behavior to select
the oldest nodes from each availability zone. The number of nodes to be chosen
from each availability zone would be based on the output from this placement
policy.</p>
</div>
<div class="section" id="s2-cluster-scale-out">
<h3>S2: <code class="docutils literal"><span class="pre">CLUSTER_SCALE_OUT</span></code><a class="headerlink" href="#s2-cluster-scale-out" title="Permalink to this headline">¶</a></h3>
<p>The placement policy first checks if there are policy decisions from other
policies by looking into the <code class="docutils literal"><span class="pre">creation</span></code> field of the action&#8217;s <code class="docutils literal"><span class="pre">data</span></code>
property. If there is such a field, the policy attempts to extract the
<code class="docutils literal"><span class="pre">count</span></code> value from the <code class="docutils literal"><span class="pre">creation</span></code> field. If the <code class="docutils literal"><span class="pre">count</span></code> value is not
found, 1 is assumed to be the default.</p>
<p>If, however, the policy fails to find the <code class="docutils literal"><span class="pre">creation</span></code> field, it tries to find
if there is a <code class="docutils literal"><span class="pre">count</span></code> field in the action&#8217;s <code class="docutils literal"><span class="pre">inputs</span></code> property. If the
answer is true, the policy will use it, or else it will fall back to assume 1
as the default node count.</p>
<p>After the policy has find out the <code class="docutils literal"><span class="pre">count</span></code> value (i.e. number of nodes to be
created), it validates the list of availability zone names provided to the
policy and extracts the current distribution of nodes among those availability
zones.</p>
<p>If for some reason, none of the provided names passed the validation,
the policy check fails with the following data recorded in the action&#8217;s
<code class="docutils literal"><span class="pre">data</span></code> property:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
  <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;No availability zone found available.&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The logic of generating a distribution plan is almost identical to what have
been described in scenario <em>S1</em>, except for the output format. When there is
a feasible plan to accommodate all nodes, the plan is saved into the <code class="docutils literal"><span class="pre">data</span></code>
property of the action as shown in the following example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span>
  <span class="s2">&quot;creation&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;zones&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;nova-1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;nova-2&quot;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This means in total, 3 nodes should be created into the cluster. Among them,
2 nodes should be created at availability zone &#8220;<code class="docutils literal"><span class="pre">nova-1</span></code>&#8221; and the left one
should be created at availability zone &#8220;<code class="docutils literal"><span class="pre">nova-2</span></code>&#8221;.</p>
</div>
<div class="section" id="s3-cluster-resize">
<h3>S3: <code class="docutils literal"><span class="pre">CLUSTER_RESIZE</span></code><a class="headerlink" href="#s3-cluster-resize" title="Permalink to this headline">¶</a></h3>
<p>The placement policy first checks if there are policy decisions from other
policies by looking into the <code class="docutils literal"><span class="pre">creation</span></code> field of the action&#8217;s <code class="docutils literal"><span class="pre">data</span></code>
property. If there is such a field, the policy extracts the <code class="docutils literal"><span class="pre">count</span></code> value
from the <code class="docutils literal"><span class="pre">creation</span></code> field. If the <code class="docutils literal"><span class="pre">creation</span></code> field is not found, the policy
tries to find if there is a <code class="docutils literal"><span class="pre">deletion</span></code> field in the action&#8217;s <code class="docutils literal"><span class="pre">data</span></code>
property. If there is such a field, the policy extracts the <code class="docutils literal"><span class="pre">count</span></code> value
from the <code class="docutils literal"><span class="pre">creation</span></code> field. If neither <code class="docutils literal"><span class="pre">creation</span></code> nor <code class="docutils literal"><span class="pre">deletion</span></code> is found
in the action&#8217;s <code class="docutils literal"><span class="pre">data</span></code> property, the policy proceeds to parse the raw inputs
of the action.</p>
<p>The output from the parser may indicate an invalid combination of input
values. If that is the case, the policy check fails with the action&#8217;s
<code class="docutils literal"><span class="pre">data</span></code> set to something like the following example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>{
  &quot;status&quot;: &quot;ERROR&quot;,
  &quot;reason&quot;: &lt;error message from the parser.&gt;
}
</pre></div>
</div>
<p>If the parser successfully parsed the action&#8217;s raw inputs, the policy tries
again to find if there is either <code class="docutils literal"><span class="pre">creation</span></code> or <code class="docutils literal"><span class="pre">deletion</span></code> field in the
action&#8217;s <code class="docutils literal"><span class="pre">data</span></code> property. It will use the <code class="docutils literal"><span class="pre">count</span></code> value from the field
found as the number of nodes to be handled.</p>
<p>When the placement policy finds out the number of nodes to create (or delete),
it proceeds to calculate a distribution plan. If the action is about growing
the size of the cluster, the logic and the output format are the same as that
have been outlined in scenario <em>S2</em>. Otherwise, the logic and the output
format are identical to that have been described in scenario <em>S1</em>.</p>
</div>
<div class="section" id="s4-node-create">
<h3>S4: <code class="docutils literal"><span class="pre">NODE_CREATE</span></code><a class="headerlink" href="#s4-node-create" title="Permalink to this headline">¶</a></h3>
<p>When handling a <code class="docutils literal"><span class="pre">NODE_CREATE</span></code> action, the zone placement policy needs to
process the single node associated with the action, i.e. the node to be
created. If, however, the node is referencing a profile whose spec contains
a <code class="docutils literal"><span class="pre">availability_zone</span></code> property, it means the requesting user has a preferred
availability zone for the new node. In this case, the placement policy will
return directly without choosing availability zone for the node.</p>
<p>If the profile spec doesn&#8217;t have <code class="docutils literal"><span class="pre">availability_zone</span></code> specified, the
placement policy will proceed to do an evaluation of the current zone
distribution followed by a calculation of distribution plan so that the new
node will be deployed in a proper availability zone. These logics and the
output format are identical to that in scenario <em>S2</em>.</p>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="scaling_v1.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Scaling Policy V1.0"></i></a>
          
          
            <a href="../profile_type.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Profile Types"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="../../_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="../../index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Configuration Options</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/basics.html">Senlin Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/policies.html">Working with Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/receivers.html">Working with Receivers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/profile_types.html">Profile Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/profiles.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/clusters.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/nodes.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/membership.html">Cluster Membership</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types.html">Policy Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policies.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/bindings.html">Cluster-Policy Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/receivers.html">Receiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/actions.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/events.html">Events</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/affinity.html">Affinity Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/deletion.html">Deletion Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/load_balancing.html">Load-Balancing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/scaling.html">Scaling Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/region_placement.html">Region Placement Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/policy_types/zone_placement.html">Zone Placement Policy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/affinity.html">Managing Node Affinity</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_overview.html">Support to AutoScaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_ceilometer.html">Autoscaling using Ceilometer/Aodh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scenarios/autoscaling_heat.html">Autoscaling with Heat</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api_microversion.html">API Microversioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authorization.html">Senlin Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profile.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../node.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policy.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../action.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../receiver.html">Receiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Senlin testing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../plugin_guide.html">Plugin Writer&#8217;s Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../policy_type.html">Policy Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../profile_type.html">Profile Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event_dispatcher.html">Event Dispatchers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../osprofiler.html">OSProfiler</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="affinity_v1.html">Affinity Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="deletion_v1.html">Deletion Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="health_v1.html">Health Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="load_balance_v1.html">Load Balancing Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="region_v1.html">Region Placement Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="scaling_v1.html">Scaling Policy V1.0</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Zone Placement Policy V1.0</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#applicable-profiles">Applicable Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#actions-handled">Actions Handled</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scenarios">Scenarios</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reviews.html">Reviews</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../man/index.html">Man Pages</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "developer/policies/zone_v1" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/senlin/tree/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 'Tue Feb 14 14:27:25 2017, commit e2451a7";
        var bugProject = "senlin";
        var bugTitle = "Zone Placement Policy V1.0 in senlin";
    var fieldTags = "docs";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 3.0.0.0rc2.dev62 on None";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>