<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Senlin testing</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../_static/css/combined.css" rel="stylesheet">
<link href="../_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Senlin testing</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="receiver.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Receiver"></i></a>
    
    
    <a href="plugin_guide.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Plugin Writer&#8217;s Guide"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Senlin testing</a><ul>
<li><a class="reference internal" href="#overview-of-testing">Overview of Testing</a></li>
<li><a class="reference internal" href="#cloud-backends">Cloud Backends</a></li>
<li><a class="reference internal" href="#unit-tests">Unit Tests</a><ul>
<li><a class="reference internal" href="#writing-a-unit-test">Writing a Unit Test</a></li>
<li><a class="reference internal" href="#running-unit-tests">Running Unit Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api-tests">API Tests</a><ul>
<li><a class="reference internal" href="#writing-an-api-test-case">Writing an API Test Case</a></li>
<li><a class="reference internal" href="#running-api-tests">Running API Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functional-tests">Functional Tests</a><ul>
<li><a class="reference internal" href="#writing-functional-tests">Writing Functional Tests</a></li>
<li><a class="reference internal" href="#running-functional-tests">Running Functional Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integration-tests">Integration Tests</a><ul>
<li><a class="reference internal" href="#writing-integration-tests">Writing Integration Tests</a></li>
<li><a class="reference internal" href="#running-integration-tests">Running Integration Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#stress-tests">Stress Tests</a><ul>
<li><a class="reference internal" href="#writing-stress-test-cases">Writing Stress Test Cases</a></li>
<li><a class="reference internal" href="#running-stress-tests">Running Stress Tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="senlin-testing">
<h1>Senlin testing<a class="headerlink" href="#senlin-testing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview-of-testing">
<h2>Overview of Testing<a class="headerlink" href="#overview-of-testing" title="Permalink to this headline">¶</a></h2>
<p>The Senlin project currently has five different types of testing facilities in
place for developers to perform different kinds of tests:</p>
<ul class="simple">
<li><em>Unit Tests</em>: These are source code level testing that verifies the classes
and methods behave as implemented. Once implemented, these tests are also
used to guarantee that code behavior won&#8217;t change accidentally by other
patches.</li>
<li><em>API Tests</em>: These tests treat the <em>senlin-api</em> and the <em>senlin-engine</em> as
black boxes. The test cases focus more on the API surface rather than how
each API is implemented. Once implemented, these tests help ensure that
the user-visible service interface don&#8217;t change without a good reason.</li>
<li><em>Functional Tests</em>: These tests also treat the <em>senlin-api</em> and the
<em>senlin-engine</em> as block boxes. They focus more on the user perceivable
service behavior. Most tests are anticipated to test a particular &#8220;story&#8221;
and verify that the <em>senlin-engine</em> always behave consistently.</li>
<li><em>Integration Tests</em>: These are the tests that integrate senlin with other
OpenStack services and verify the senlin service can perform its operations
correctly when interacting with other services.</li>
<li><em>Stress Tests</em>: These are tests for measuring the performance of the
<em>senlin-api</em> and <em>senlin-engine</em> under different workloads.</li>
</ul>
</div>
<div class="section" id="cloud-backends">
<h2>Cloud Backends<a class="headerlink" href="#cloud-backends" title="Permalink to this headline">¶</a></h2>
<p>The senlin server is shipped with two collections of &#8220;cloud backends&#8221;: one for
interacting with a real OpenStack deployment, the other for running complex
tests including api tests, functional tests, stress tests. The first cloud
backend is referred to as &#8216;<cite>openstack</cite>&#8216; and the second is referred to as
&#8216;<cite>openstack_test</cite>&#8216;. While the <cite>openstack</cite> cloud backend contains full featured
drivers for senlin to talk to the OpenStack services supported, the
<cite>openstack_test</cite> backend contains some &#8220;dummy&#8221; drivers that return fake
responses for service requests. The <cite>openstack_test</cite> driver is located at
<code class="file docutils literal"><span class="pre">senlin/tests/drivers</span></code> subdirectory. It is provided to facilitate tests
on the senlin service itself without involving any other OpenStack services.
Several types of tests can benefit from these &#8220;dummy&#8221; drivers because 1) they
can save developers a lot time on debugging complex issues when interacting
with other OpenStack services, and 2) they make running those types of tests
much easier and quicker.</p>
<p>Note that &#8220;Integration Tests&#8221; are designed for senlin to interact with real
services so we should use the <cite>openstack</cite> backend rather than the
<cite>openstack_test</cite> backend.</p>
<p>To configure the backend to use before running tests, you can check the
<cite>[DEFAULT]</cite> section in the configuration file <code class="file docutils literal"><span class="pre">/etc/senlin/senlin.conf</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="n">cloud_backend</span> <span class="o">=</span> <span class="n">openstack_test</span>   <span class="c1"># use this for api, functional tests;</span>
                                 <span class="c1"># or &#39;openstack&#39; for production environment</span>
                                 <span class="c1"># and integration tests.</span>
</pre></div>
</div>
</div>
<div class="section" id="unit-tests">
<h2>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h2>
<p>All unit tests are to be placed in the <code class="file docutils literal"><span class="pre">senlin/tests/unit</span></code> sub-directory.
Test cases are organized by the targeted subsystems/modules. Each subsystem
directory must contain a separate blank __init__.py for tests discovery to
function properly.</p>
<p>An example directory structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>senlin
 `- tests
     `- unit
         |-- db
         |   |-- __init__.py
         |   |-- test_cluster_api.py
         |   `-- test_node_api.py
         |-- engine
         |   |-- __init__.py
         |   |-- test_clusters.py
         |   `-- test_nodes.py
         |-- __init__.py
         `-- test_utils.py
</pre></div>
</div>
<div class="section" id="writing-a-unit-test">
<h3>Writing a Unit Test<a class="headerlink" href="#writing-a-unit-test" title="Permalink to this headline">¶</a></h3>
<p>The <em>os-testr</em> software (see: <a class="reference external" href="http://pypi.python.org/pypi/os-testr">http://pypi.python.org/pypi/os-testr</a>) is used to
find and run tests, parallelize their runs, and record timing/results.</p>
<p>If new dependencies are introduced upon the development of a test, the
<cite>test-requirements.txt</cite> file needs to be updated so that the virtual
environment will be able to successfully execute all tests.</p>
<p>The <cite>test-requirements.txt</cite> file needs to be synchronized with the
openstack/global-requirements project. Developers should try avoid
introducing additional package dependencies unless forced to.</p>
</div>
<div class="section" id="running-unit-tests">
<h3>Running Unit Tests<a class="headerlink" href="#running-unit-tests" title="Permalink to this headline">¶</a></h3>
<p>Senlin uses <cite>tox</cite> for running unit tests, as practiced by many other OpenStack
projects:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ tox
</pre></div>
</div>
<p>This by default will run unit tests suite with Python 2.7 and PEP8/HACKING
style checks. To run only one type of tests you can explicitly provide <cite>tox</cite>
with the test environment to use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ tox -e py27 # test suite on python 2.7
$ tox -e pep8 # run full source code checker
</pre></div>
</div>
<p>To run only a subset of tests, you can provide <cite>tox</cite> with a regex argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ tox -e py27 -- -r ClusterTest
</pre></div>
</div>
<p>To use debugger like <cite>pdb</cite> during test run, you have to run tests directly
with other, non-concurrent test runner instead of <cite>testr</cite>.
That also presumes that you have a virtual env with all senlin dependencies
installed and configured.</p>
<p>A more convenient way to run specific test is to name the unit test directly,
as shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ python -m testtools.run senlin.tests.unit.db.test_cluster_api
</pre></div>
</div>
<p>This command, however, is not using dependent packages in a particular virtual
environment as the <cite>tox</cite> command does. It is using the system-wide Python
package repository when running the tests.</p>
</div>
</div>
<div class="section" id="api-tests">
<h2>API Tests<a class="headerlink" href="#api-tests" title="Permalink to this headline">¶</a></h2>
<p>Senlin API test cases are written based on the <em>tempest</em> framework (see:
<a class="reference external" href="http://docs.openstack.org/developer/tempest">tempest_overview</a>). Test cases are developed using the Tempest Plugin
Interface (see: <a class="reference external" href="http://docs.openstack.org/developer/tempest/plugin.html">tempest_plugin</a> ).</p>
<div class="section" id="writing-an-api-test-case">
<h3>Writing an API Test Case<a class="headerlink" href="#writing-an-api-test-case" title="Permalink to this headline">¶</a></h3>
<p>When new APIs are added or existing APIs are changed, an API test case should
be added to the <code class="file docutils literal"><span class="pre">senlin/tests/tempest/api</span></code> sub-directory, based on the
resources impacted by the change.</p>
<p>Each test case should derive from the class
<code class="xref py py-class docutils literal"><span class="pre">senlin.tests.tempest.api.base.BaseSenlinAPITest</span></code>. Positive test cases
should be separated from negative ones. We don&#8217;t encourage combining more than
one test case into a single method, unless there is an obvious reason.</p>
<p>To improve the readability of the test cases, Senlin has provided a utility
module which can be leveraged - <code class="file docutils literal"><span class="pre">senlin/tests/tempest/common/utils.py</span></code>.</p>
</div>
<div class="section" id="running-api-tests">
<h3>Running API Tests<a class="headerlink" href="#running-api-tests" title="Permalink to this headline">¶</a></h3>
<p>Senlin API tests use fake OpenStack drivers to improve the throughput of test
execution. This is because in API tests, we don&#8217;t care about the details in
how <em>senlin-engine</em> is interacting with other services. We care more about the
APIs succeeds in an expected way or fails in a predictable manner.</p>
<p>Although the senlin engine is talking to fake drivers, the test cases still
need to communicate to the senlin API service as it would in a real
deployment. That means you will have to export your OpenStack credentials
before running the tests. For example, you will source the <code class="file docutils literal"><span class="pre">openrc</span></code> file
when using a devstack environment:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ source $HOME/devstack/openrc
</pre></div>
</div>
<p>This will ensure you have environment variables such as <code class="docutils literal"><span class="pre">OS_AUTH_URL</span></code>,
<code class="docutils literal"><span class="pre">OS_USERNAME</span></code> properly set and exported. The next step is to enter the
<code class="file docutils literal"><span class="pre">tempest</span></code> directory and run the tests there:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd /opt/stack/tempest
$ ./run_tempest.sh -N -- senlin
</pre></div>
</div>
<p>To run a single test case, you can specify the test case name. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd /opt/stack/tempest
$ ./run_tempest.sh -N -- \
  senlin.tests.tempest.api.clusters.test_cluster_create
</pre></div>
</div>
<p>If you prefer running API tests in a virtual environment, you can simply use
the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd /opt/stack/senlin
$ tox -e api
</pre></div>
</div>
</div>
</div>
<div class="section" id="functional-tests">
<h2>Functional Tests<a class="headerlink" href="#functional-tests" title="Permalink to this headline">¶</a></h2>
<p>Similar to the API tests, senlin functional tests are also developed based on
the <em>tempest</em> framework. Test cases are written using the Tempest Plugin
Interface (see: <a class="reference external" href="http://docs.openstack.org/developer/tempest/plugin.html">tempest_plugin</a>).</p>
<div class="section" id="writing-functional-tests">
<h3>Writing Functional Tests<a class="headerlink" href="#writing-functional-tests" title="Permalink to this headline">¶</a></h3>
<p>There are current a limited collection of functional test cases which can be
found under <code class="file docutils literal"><span class="pre">senlin/tests/tempest/functional/</span></code> subdirectory. In future,
we may add more test cases when needed. The above subdirectory will remain the
home of newly added functional tests.</p>
<p>When writing functional tests, it is highly desirable that each test case is
designed for a specific use case or story line.</p>
</div>
<div class="section" id="running-functional-tests">
<h3>Running Functional Tests<a class="headerlink" href="#running-functional-tests" title="Permalink to this headline">¶</a></h3>
<p>Similar to API tests, you will need to export your OpenStack credentials
before running any functional tests.</p>
<p>The most straight forward way to run functional tests is to use the virtual
environment defined in the <code class="file docutils literal"><span class="pre">tox.ini</span></code> file, that is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd /opt/stack/senlin
$ tox -e functional
</pre></div>
</div>
<p>If you prefer running a particular functional test case, you can do the
following as well:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd /opt/stack/senlin
$ python -m testtools.run senlin.tests.tempest.functional.test_cluster_basic
</pre></div>
</div>
</div>
</div>
<div class="section" id="integration-tests">
<h2>Integration Tests<a class="headerlink" href="#integration-tests" title="Permalink to this headline">¶</a></h2>
<p>Integration tests are basically another flavor of functional tests. The only
difference from functional tests is that integration tests use real device
drivers so the <em>senlin-engine</em> is talking to real services.</p>
<div class="section" id="writing-integration-tests">
<h3>Writing Integration Tests<a class="headerlink" href="#writing-integration-tests" title="Permalink to this headline">¶</a></h3>
<p>Integration tests are designed to be run at Gerrit gate to ensure that changes
to senlin code won&#8217;t break its interactions with other (backend) services.
Since OpenStack gate infrastructure is a shared resource pool for all
OpenStack projects, we are supposed to be very careful when adding new test
cases. The test cases added are supposed to focus more on the interaction
between senlin and other services than other things.</p>
<p>All integration test cases are to be placed under the subdirectory
<code class="file docutils literal"><span class="pre">senlin/tests/tempest/integration</span></code>. Test cases are expected to be
organized into a small number of story lines that can exercise as many
interactions between senlin and backend services as possible.</p>
<p>Each &#8220;story line&#8221; should be organized into a separate class module that
inherits from the <code class="docutils literal"><span class="pre">BaseSenlinIntegrationTest</span></code> class which can be found at
<code class="file docutils literal"><span class="pre">senlin/tests/tempest/integration/base.py</span></code> file. Each test case should
be annotated with a <code class="docutils literal"><span class="pre">test.attr</span></code> annotator and an idempotent ID as shown
below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tempest.lib</span> <span class="kn">import</span> <span class="n">decorators</span>
<span class="kn">from</span> <span class="nn">tempest</span> <span class="kn">import</span> <span class="n">test</span>

<span class="kn">from</span> <span class="nn">senlin.tests.tempest.integration</span> <span class="kn">import</span> <span class="n">base</span>


<span class="k">class</span> <span class="nc">MyIntegrationTest</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">BaseSenlinIntegrationTest</span><span class="p">):</span>

  <span class="nd">@test.attr</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;integration&#39;</span><span class="p">])</span>
  <span class="nd">@decorators.idempotent_id</span><span class="p">(</span><span class="s1">&#39;&lt;A UUID for the test case&gt;&#39;</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">test_a_sad_story</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Test logic goes here</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
</div>
<div class="section" id="running-integration-tests">
<h3>Running Integration Tests<a class="headerlink" href="#running-integration-tests" title="Permalink to this headline">¶</a></h3>
<p>The integration tests are designed to be executed at Gerrit gate. However, you
can still run them locally in your development environment, i.e. a devstack
installation.</p>
<p>To run integration tests, you will need to configure <em>tempest</em> accounts by
editing the <code class="file docutils literal"><span class="pre">/etc/tempest/accounts.yaml</span></code> file. For each entry of the
tempest account, you will need to provide values for <code class="docutils literal"><span class="pre">username</span></code>,
<code class="docutils literal"><span class="pre">tenant_name</span></code>, <code class="docutils literal"><span class="pre">password</span></code> at least. For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">username</span><span class="p p-Indicator">:</span> <span class="s">&#39;demo&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">tenant_name</span><span class="p p-Indicator">:</span> <span class="s">&#39;demo&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="s">&#39;secretee&#39;</span>
</pre></div>
</div>
<p>After this is configured, you can run a specific test case using the following
command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /opt/stack/senlin
<span class="gp">$</span> python -m testtools.run <span class="se">\</span>
    senlin.tests.tempest.integration.test_nova_server_cluster
</pre></div>
</div>
</div>
</div>
<div class="section" id="stress-tests">
<h2>Stress Tests<a class="headerlink" href="#stress-tests" title="Permalink to this headline">¶</a></h2>
<p>Stress tests are designed to measure a service&#8217;s performance under certain
workload pressure. In senlin, the stress tests are written to be executed
using the <em>Rally</em> framework.</p>
<div class="section" id="writing-stress-test-cases">
<h3>Writing Stress Test Cases<a class="headerlink" href="#writing-stress-test-cases" title="Permalink to this headline">¶</a></h3>
<p>&lt;TBD&gt;</p>
</div>
<div class="section" id="running-stress-tests">
<h3>Running Stress Tests<a class="headerlink" href="#running-stress-tests" title="Permalink to this headline">¶</a></h3>
<p>&lt;TBD&gt;</p>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="receiver.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Receiver"></i></a>
          
          
            <a href="plugin_guide.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Plugin Writer&#8217;s Guide"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: None</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="../_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="../index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration Options</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/basics.html">Senlin Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/policies.html">Working with Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/receivers.html">Working with Receivers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/profile_types.html">Profile Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/profiles.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/clusters.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/nodes.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/membership.html">Cluster Membership</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types.html">Policy Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policies.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/bindings.html">Cluster-Policy Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/receivers.html">Receiver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/actions.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/events.html">Events</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/affinity.html">Affinity Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/deletion.html">Deletion Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/load_balancing.html">Load-Balancing Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/scaling.html">Scaling Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/region_placement.html">Region Placement Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/policy_types/zone_placement.html">Zone Placement Policy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenarios/affinity.html">Managing Node Affinity</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenarios/autoscaling_overview.html">Support to AutoScaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenarios/autoscaling_ceilometer.html">Autoscaling using Ceilometer/Aodh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenarios/autoscaling_heat.html">Autoscaling with Heat</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api_microversion.html">API Microversioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorization.html">Senlin Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="profile.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="cluster.html">Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="node.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="policy.html">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="action.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="receiver.html">Receiver</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Senlin testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-testing">Overview of Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloud-backends">Cloud Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unit-tests">Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api-tests">API Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functional-tests">Functional Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#integration-tests">Integration Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stress-tests">Stress Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plugin_guide.html">Plugin Writer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="osprofiler.html">OSProfiler</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="policies/affinity_v1.html">Affinity Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies/deletion_v1.html">Deletion Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies/health_v1.html">Health Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies/load_balance_v1.html">Load Balancing Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies/region_v1.html">Region Placement Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies/scaling_v1.html">Scaling Policy V1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies/zone_v1.html">Zone Placement Policy V1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reviews.html">Reviews</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../man/index.html">Man Pages</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "developer/testing" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/senlin/tree/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 'Tue Feb 14 14:27:25 2017, commit e2451a7";
        var bugProject = "senlin";
        var bugTitle = "Senlin testing in senlin";
    var fieldTags = "docs";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 3.0.0.0rc2.dev62 on None";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>