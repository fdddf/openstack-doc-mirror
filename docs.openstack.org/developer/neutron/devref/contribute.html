<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Contributing new extensions to Neutron &mdash; neutron 10.0.0.0rc2.dev58 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '10.0.0.0rc2.dev58',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="neutron 10.0.0.0rc2.dev58 documentation" href="../index.html" />
    <link rel="up" title="Developer Guide" href="index.html" />
    <link rel="next" title="Neutron public API" href="neutron_api.html" />
    <link rel="prev" title="Setting Up a Development Environment" href="development.environment.html" /> 
  </head>
  <body role="document">
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
      <li><a href="http://www.openstack.org/" title="Go to the Home page" class="link">Home</a></li>
      <li><a href="http://www.openstack.org/projects/" title="Go to the OpenStack Projects page">Projects</a></li>
      <li><a href="http://www.openstack.org/user-stories/" title="Go to the User Stories page" class="link">User Stories</a></li>
      <li><a href="http://www.openstack.org/community/" title="Go to the Community page" class="link">Community</a></li>
      <li><a href="http://www.openstack.org/blog/" title="Go to the OpenStack Blog">Blog</a></li>
      <li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
      <li><a href="http://docs.openstack.org/" title="Go to OpenStack Documentation" class="current">Documentation</a></li>
      
    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="contributing-new-extensions-to-neutron">
<h1>Contributing new extensions to Neutron<a class="headerlink" href="#contributing-new-extensions-to-neutron" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Neutron has a pluggable architecture, with a number of extension points.
This documentation covers aspects relevant to contributing new Neutron
v2 core (aka monolithic) plugins, ML2 mechanism drivers, and L3 service
plugins. This document will initially cover a number of process-oriented
aspects of the contribution process, and proceed to provide a how-to guide
that shows how to go from 0 LOC&#8217;s to successfully contributing new
extensions to Neutron. In the remainder of this guide, we will try to
use practical examples as much as we can so that people have working
solutions they can start from.</p>
<p>This guide is for a developer who wants to have a degree of visibility
within the OpenStack Networking project. If you are a developer who
wants to provide a Neutron-based solution without interacting with the
Neutron community, you are free to do so, but you can stop reading now,
as this guide is not for you.</p>
<p>Plugins and drivers for non-reference implementations are known as
&#8220;third-party&#8221; code. This includes code for supporting vendor products, as well
as code for supporting open-source networking implementations.</p>
<p>Before the Kilo release these plugins and drivers were included in the Neutron
tree. During the Kilo cycle the third-party plugins and drivers underwent the
first phase of a process called decomposition. During this phase, each plugin
and driver moved the bulk of its logic to a separate git repository, while
leaving a thin &#8220;shim&#8221; in the neutron tree together with the DB models and
migrations (and perhaps some config examples).</p>
<p>During the Liberty cycle the decomposition concept was taken to its conclusion
by allowing third-party code to exist entirely out of tree. Further extension
mechanisms have been provided to better support external plugins and drivers
that alter the API and/or the data model.</p>
<p>In the Mitaka cycle we will <strong>require</strong> all third-party code to be moved out of
the neutron tree completely.</p>
<p>&#8216;Outside the tree&#8217; can be anything that is publicly available: it may be a repo
on git.openstack.org for instance, a tarball, a pypi package, etc. A
plugin/drivers maintainer team self-governs in order to promote sharing, reuse,
innovation, and release of the &#8216;out-of-tree&#8217; deliverable. It should not be
required for any member of the core team to be involved with this process,
although core members of the Neutron team can participate in whichever capacity
is deemed necessary to facilitate out-of-tree development.</p>
<p>This guide is aimed at you as the maintainer of code that integrates with
Neutron but resides in a separate repository.</p>
</div>
<div class="section" id="contribution-process">
<h2>Contribution Process<a class="headerlink" href="#contribution-process" title="Permalink to this headline">¶</a></h2>
<p>If you want to extend OpenStack Networking with your technology, and you want
to do it within the visibility of the OpenStack project, follow the guidelines
and examples below. We&#8217;ll describe best practices for:</p>
<ul class="simple">
<li>Design and Development;</li>
<li>Testing and Continuous Integration;</li>
<li>Defect Management;</li>
<li>Backport Management for plugin specific code;</li>
<li>DevStack Integration;</li>
<li>Documentation;</li>
</ul>
<p>Once you have everything in place you may want to add your project to the list
of Neutron sub-projects. See <a class="reference external" href="http://docs.openstack.org/developer/neutron/stadium/governance.html#adding-or-removing-projects-to-the-stadium">Adding or removing projects to the stadium</a>
for details.</p>
</div>
<div class="section" id="design-and-development">
<h2>Design and Development<a class="headerlink" href="#design-and-development" title="Permalink to this headline">¶</a></h2>
<p>Assuming you have a working repository, any development to your own repo does
not need any blueprint, specification or bugs against Neutron. However, if your
project is a part of the Neutron Stadium effort, you are expected to
participate in the principles of the Four Opens, meaning your design should be
done in the open. Thus, it is encouraged to file documentation for changes in
your own repository.</p>
<p>If your code is hosted on git.openstack.org then the gerrit review system is
automatically provided. Contributors should follow the review guidelines
similar to those of Neutron. However, you as the maintainer have the
flexibility to choose who can approve/merge changes in your own repo.</p>
<p>It is recommended (but not required, see <a class="reference external" href="http://docs.openstack.org/developer/neutron/policies/thirdparty-ci.html">policies</a>)
that you set up a third-party CI system. This will provide a vehicle for
checking the third-party code against Neutron changes. See <a class="reference internal" href="#testing-and-continuous-integration">Testing and
Continuous Integration</a> below for more detailed recommendations.</p>
<p>Design documents can still be supplied in form of Restructured Text (RST)
documents, within the same third-party library repo. If changes to the common
Neutron code are required, an <a class="reference external" href="http://docs.openstack.org/developer/neutron/policies/blueprints.html#neutron-request-for-feature-enhancements">RFE</a>
may need to be filed. However, every case is different and you are invited to
seek guidance from Neutron core reviewers about what steps to follow.</p>
</div>
<div class="section" id="testing-and-continuous-integration">
<h2>Testing and Continuous Integration<a class="headerlink" href="#testing-and-continuous-integration" title="Permalink to this headline">¶</a></h2>
<p>The following strategies are recommendations only, since third-party CI testing
is not an enforced requirement. However, these strategies are employed by the
majority of the plugin/driver contributors that actively participate in the
Neutron development community, since they have learned from experience how
quickly their code can fall out of sync with the rapidly changing Neutron core
code base.</p>
<ul>
<li><p class="first">You should run unit tests in your own external library (e.g. on
git.openstack.org where Jenkins setup is for free).</p>
</li>
<li><p class="first">Your third-party CI should validate third-party integration with Neutron via
functional testing. The third-party CI is a communication mechanism. The
objective of this mechanism is as follows:</p>
<ul class="simple">
<li>it communicates to you when someone has contributed a change that
potentially breaks your code. It is then up to you maintaining the affected
plugin/driver to determine whether the failure is transient or real, and
resolve the problem if it is.</li>
<li>it communicates to a patch author that they may be breaking a plugin/driver.
If they have the time/energy/relationship with the maintainer of the
plugin/driver in question, then they can (at their discretion) work to
resolve the breakage.</li>
<li>it communicates to the community at large whether a given plugin/driver
is being actively maintained.</li>
<li>A maintainer that is perceived to be responsive to failures in their
third-party CI jobs is likely to generate community goodwill.</li>
</ul>
<p>It is worth noting that if the plugin/driver repository is hosted on
git.openstack.org, due to current openstack-infra limitations, it is not
possible to have third-party CI systems participating in the gate pipeline
for the repo. This means that the only validation provided during the merge
process to the repo is through unit tests. Post-merge hooks can still be
exploited to provide third-party CI feedback, and alert you of potential
issues. As mentioned above, third-party CI systems will continue to validate
Neutron core commits. This will allow them to detect when incompatible
changes occur, whether they are in Neutron or in the third-party repo.</p>
</li>
</ul>
</div>
<div class="section" id="defect-management">
<h2>Defect Management<a class="headerlink" href="#defect-management" title="Permalink to this headline">¶</a></h2>
<p>Bugs affecting third-party code should <em>not</em> be filed in the Neutron project on
launchpad. Bug tracking can be done in any system you choose, but by creating a
third-party project in launchpad, bugs that affect both Neutron and your code
can be more easily tracked using launchpad&#8217;s &#8220;also affects project&#8221; feature.</p>
<div class="section" id="security-issues">
<h3>Security Issues<a class="headerlink" href="#security-issues" title="Permalink to this headline">¶</a></h3>
<p>Here are some answers to how to handle security issues in your repo, taken
from <a class="reference external" href="http://lists.openstack.org/pipermail/openstack-dev/2015-July/068617.html">this openstack-dev mailing list message</a>:</p>
<ul class="simple">
<li>How should security your issues be managed?</li>
</ul>
<p>The OpenStack Vulnerability Management Team (VMT) follows a <a class="reference external" href="https://security.openstack.org/vmt-process.html">documented process</a> which can basically be
reused by any project-team when needed.</p>
<ul class="simple">
<li>Should the OpenStack security team be involved?</li>
</ul>
<p>The OpenStack VMT directly oversees vulnerability reporting and disclosure for
a <a class="reference external" href="https://wiki.openstack.org/wiki/Security_supported_projects">subset of OpenStack source code repositories</a>.  However, they
are still quite happy to answer any questions you might have about
vulnerability management for your own projects even if they&#8217;re not part of that
set. Feel free to reach out to the VMT in public or in private.</p>
<p>Also, the VMT is an autonomous subgroup of the much larger <a class="reference external" href="http://governance.openstack.org/reference/projects/security.html">OpenStack Security
project-team</a>. They&#8217;re a
knowledgeable bunch and quite responsive if you want to get their opinions or
help with security-related issues (vulnerabilities or otherwise).</p>
<ul class="simple">
<li>Does a CVE need to be filed?</li>
</ul>
<p>It can vary widely. If a commercial distribution such as Red Hat is
redistributing a vulnerable version of your software, then they may assign one
anyway even if you don&#8217;t request one yourself. Or the reporter may request one;
the reporter may even be affiliated with an organization who has already
assigned/obtained a CVE before they initiate contact with you.</p>
<ul class="simple">
<li>Do the maintainers need to publish OSSN or equivalent documents?</li>
</ul>
<p>OpenStack Security Advisories (OSSA) are official publications of the OpenStack
VMT and only cover VMT-supported software. OpenStack Security Notes (OSSN) are
published by editors within the OpenStack Security project-team on more general
security topics and may even cover issues in non-OpenStack software commonly
used in conjunction with OpenStack, so it&#8217;s at their discretion as to whether
they would be able to accommodate a particular issue with an OSSN.</p>
<p>However, these are all fairly arbitrary labels, and what really matters in the
grand scheme of things is that vulnerabilities are handled seriously, fixed
with due urgency and care, and announced widely &#8211; not just on relevant
OpenStack mailing lists but also preferably somewhere with broader distribution
like the <a class="reference external" href="http://oss-security.openwall.org/wiki/mailing-lists/oss-security">Open Source Security mailing list</a>. The goal
is to get information on your vulnerabilities, mitigating measures and fixes
into the hands of the people using your software in a timely manner.</p>
<ul class="simple">
<li>Anything else to consider here?</li>
</ul>
<p>The OpenStack VMT is in the process of trying to reinvent itself so that it can
better scale within the context of the &#8220;Big Tent.&#8221; This includes making sure
the policy/process documentation is more consumable and reusable even by
project-teams working on software outside the scope of our charter. It&#8217;s a work
in progress, and any input is welcome on how we can make this function well for
everyone.</p>
</div>
</div>
<div class="section" id="backport-management-strategies">
<h2>Backport Management Strategies<a class="headerlink" href="#backport-management-strategies" title="Permalink to this headline">¶</a></h2>
<p>This section applies only to third-party maintainers who had code in the
Neutron tree during the Kilo and earlier releases. It will be obsolete once the
Kilo release is no longer supported.</p>
<p>If a change made to out-of-tree third-party code needs to be back-ported to
in-tree code in a stable branch, you may submit a review without a
corresponding master branch change. The change will be evaluated by core
reviewers for stable branches to ensure that the backport is justified and that
it does not affect Neutron core code stability.</p>
</div>
<div class="section" id="devstack-integration-strategies">
<h2>DevStack Integration Strategies<a class="headerlink" href="#devstack-integration-strategies" title="Permalink to this headline">¶</a></h2>
<p>When developing and testing a new or existing plugin or driver, the aid provided
by DevStack is incredibly valuable: DevStack can help get all the software bits
installed, and configured correctly, and more importantly in a predictable way.
For DevStack integration there are a few options available, and they may or may not
make sense depending on whether you are contributing a new or existing plugin or
driver.</p>
<p>If you are contributing a new plugin, the approach to choose should be based on
<a class="reference external" href="http://docs.openstack.org/developer/devstack/plugins.html#extras-d-hooks">Extras.d Hooks&#8217; externally hosted plugins</a>.
With the extra.d hooks, the DevStack integration is co-located with the
third-party integration library, and it leads to the greatest level of
flexibility when dealing with DevStack based dev/test deployments.</p>
<p>One final consideration is worth making for third-party CI setups: if <a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/devstack-gate">Devstack
Gate</a> is used,
it does provide hook functions that can be executed at specific times of the
devstack-gate-wrap script run.  For example, the <a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/project-config/tree/jenkins/jobs/neutron.yaml">Neutron Functional job</a>
uses them. For more details see <a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/devstack-gate/tree/devstack-vm-gate-wrap.sh">devstack-vm-gate-wrap.sh</a>.</p>
</div>
<div class="section" id="project-initial-setup">
<h2>Project Initial Setup<a class="headerlink" href="#project-initial-setup" title="Permalink to this headline">¶</a></h2>
<p>The how-to below assumes that the third-party library will be hosted on
git.openstack.org. This lets you tap in the entire OpenStack CI infrastructure
and can be a great place to start from to contribute your new or existing
driver/plugin. The list of steps below are summarized version of what you can
find on <a class="reference external" href="http://docs.openstack.org/infra/manual/creators.html">http://docs.openstack.org/infra/manual/creators.html</a>. They are meant to
be the bare minimum you have to complete in order to get you off the ground.</p>
<ul class="simple">
<li>Create a public repository: this can be a personal git.openstack.org repo or any
publicly available git repo, e.g. <code class="docutils literal"><span class="pre">https://github.com/john-doe/foo.git</span></code>. This
would be a temporary buffer to be used to feed the one on git.openstack.org.</li>
<li>Initialize the repository: if you are starting afresh, you may <em>optionally</em>
want to use cookiecutter to get a skeleton project. You can learn how to use
cookiecutter on <a class="reference external" href="https://git.openstack.org/cgit/openstack-dev/cookiecutter">https://git.openstack.org/cgit/openstack-dev/cookiecutter</a>.
If you want to build the repository from an existing Neutron module, you may
want to skip this step now, build the history first (next step), and come back
here to initialize the remainder of the repository with other files being
generated by the cookiecutter (like tox.ini, setup.cfg, setup.py, etc.).</li>
<li>Create a repository on git.openstack.org. For
this you need the help of the OpenStack infra team. It is worth noting that
you only get one shot at creating the repository on git.openstack.org. This
is the time you get to choose whether you want to start from a clean slate,
or you want to import the repo created during the previous step. In the
latter case, you can do so by specifying the upstream section for your
project in project-config/gerrit/project.yaml.  Steps are documented on the
<a class="reference external" href="http://docs.openstack.org/infra/manual/creators.html">Repository Creator&#8217;s Guide</a>.</li>
<li>Ask for a Launchpad user to be assigned to the core team created. Steps are
documented in <a class="reference external" href="http://docs.openstack.org/infra/manual/creators.html#update-the-gerrit-group-members">this section</a>.</li>
<li>Fix, fix, fix: at this point you have an external base to work on. You can
develop against the new git.openstack.org project, the same way you work with
any other OpenStack project: you have pep8, docs, and python27 CI jobs that
validate your patches when posted to Gerrit. For instance, one thing you
would need to do is to define an entry point for your plugin or driver in
your own setup.cfg similarly as to how it is done in the <a class="reference external" href="https://git.openstack.org/cgit/openstack/networking-odl/tree/setup.cfg#n31">setup.cfg for ODL</a>.</li>
<li>Define an entry point for your plugin or driver in setup.cfg</li>
<li>Create third-party CI account: if you do not already have one, follow
instructions for <a class="reference external" href="http://docs.openstack.org/infra/system-config/third_party.html">third-party CI</a> to get
one.</li>
</ul>
</div>
<div class="section" id="internationalization-support">
<h2>Internationalization support<a class="headerlink" href="#internationalization-support" title="Permalink to this headline">¶</a></h2>
<p>OpenStack is committed to broad international support.
Internationalization (I18n) is one of important areas to make OpenStack ubiquitous.
Each project is recommended to support i18n.</p>
<p>This section describes how to set up translation support.
The description in this section uses the following variables:</p>
<ul class="simple">
<li>repository : <code class="docutils literal"><span class="pre">openstack/${REPOSITORY}</span></code> (e.g., <code class="docutils literal"><span class="pre">openstack/networking-foo</span></code>)</li>
<li>top level python path : <code class="docutils literal"><span class="pre">${MODULE_NAME}</span></code> (e.g., <code class="docutils literal"><span class="pre">networking_foo</span></code>)</li>
</ul>
<div class="section" id="oslo-i18n">
<h3>oslo.i18n<a class="headerlink" href="#oslo-i18n" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Each subproject repository should have its own oslo.i18n integration
wrapper module <code class="docutils literal"><span class="pre">${MODULE_NAME}/_i18n.py</span></code>. The detail is found at
<a class="reference external" href="http://docs.openstack.org/developer/oslo.i18n/usage.html">http://docs.openstack.org/developer/oslo.i18n/usage.html</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>DOMAIN</strong> name should match your <strong>module</strong> name <code class="docutils literal"><span class="pre">${MODULE_NAME}</span></code>.</p>
</div>
</li>
<li><p class="first">Import <code class="docutils literal"><span class="pre">_()</span></code> from your <code class="docutils literal"><span class="pre">${MODULE_NAME}/_i18n.py</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not use <code class="docutils literal"><span class="pre">_()</span></code> in the builtins namespace which is
registered by <strong>gettext.install()</strong> in <code class="docutils literal"><span class="pre">neutron/__init__.py</span></code>.
It is now deprecated as described in oslo.18n documentation.</p>
</div>
</li>
</ul>
</div>
<div class="section" id="setting-up-translation-support">
<h3>Setting up translation support<a class="headerlink" href="#setting-up-translation-support" title="Permalink to this headline">¶</a></h3>
<p>You need to create or edit the following files to start translation support:</p>
<ul class="simple">
<li>setup.cfg</li>
<li>babel.cfg</li>
</ul>
<p>We have a good example for an oslo project at
<a class="reference external" href="https://review.openstack.org/#/c/98248/">https://review.openstack.org/#/c/98248/</a>.</p>
<p>Add the following to <code class="docutils literal"><span class="pre">setup.cfg</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[extract_messages]
keywords = _ gettext ngettext l_ lazy_gettext
mapping_file = babel.cfg
output_file = ${MODULE_NAME}/locale/${MODULE_NAME}.pot

[compile_catalog]
directory = ${MODULE_NAME}/locale
domain = ${MODULE_NAME}

[update_catalog]
domain = ${MODULE_NAME}
output_dir = ${MODULE_NAME}/locale
input_file = ${MODULE_NAME}/locale/${MODULE_NAME}.pot
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">${MODULE_NAME}</span></code> is used in all names.</p>
<p>Create <code class="docutils literal"><span class="pre">babel.cfg</span></code> with the following contents:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[python: **.py]
</pre></div>
</div>
</div>
<div class="section" id="enable-translation">
<h3>Enable Translation<a class="headerlink" href="#enable-translation" title="Permalink to this headline">¶</a></h3>
<p>To update and import translations, you need to make a change in project-config.
A good example is found at <a class="reference external" href="https://review.openstack.org/#/c/224222/">https://review.openstack.org/#/c/224222/</a>.
After doing this, the necessary jobs will be run and push/pull a
message catalog to/from the translation infrastructure.</p>
</div>
</div>
<div class="section" id="integrating-with-the-neutron-system">
<h2>Integrating with the Neutron system<a class="headerlink" href="#integrating-with-the-neutron-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configuration-files">
<h3>Configuration Files<a class="headerlink" href="#configuration-files" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">data_files</span></code> in the <code class="docutils literal"><span class="pre">[files]</span></code> section of <code class="docutils literal"><span class="pre">setup.cfg</span></code> of Neutron shall
not contain any third-party references. These shall be located in the same
section of the third-party repo&#8217;s own <code class="docutils literal"><span class="pre">setup.cfg</span></code> file.</p>
<ul class="simple">
<li>Note: Care should be taken when naming sections in configuration files. When
the Neutron service or an agent starts, oslo.config loads sections from all
specified config files. This means that if a section [foo] exists in multiple
config files, duplicate settings will collide. It is therefore recommended to
prefix section names with a third-party string, e.g. [vendor_foo].</li>
</ul>
<p>Since Mitaka, configuration files are not maintained in the git repository but
should be generated as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>``tox -e genconfig``
</pre></div>
</div>
<p>If a &#8216;tox&#8217; environment is unavailable, then you can run the following script
instead to generate the configuration files:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>./tools/generate_config_file_samples.sh
</pre></div>
</div>
<p>It is advised that subprojects do not keep their configuration files in their
respective trees and instead generate them using a similar approach as Neutron
does.</p>
<dl class="docutils">
<dt><strong>ToDo: Inclusion in OpenStack documentation?</strong></dt>
<dd>Is there a recommended way to have third-party config options listed in the
configuration guide in docs.openstack.org?</dd>
</dl>
</div>
<div class="section" id="database-models-and-migrations">
<h3>Database Models and Migrations<a class="headerlink" href="#database-models-and-migrations" title="Permalink to this headline">¶</a></h3>
<p>A third-party repo may contain database models for its own tables. Although
these tables are in the Neutron database, they are independently managed
entirely within the third-party code. Third-party code shall <strong>never</strong> modify
neutron core tables in any way.</p>
<p>Each repo has its own <em>expand</em> and <em>contract</em> <a class="reference external" href="alembic_migrations.html#migration-branches">alembic migration branches</a>. A third-party repo&#8217;s alembic
migration branches may operate only on tables that are owned by the repo.</p>
<ul class="simple">
<li>Note: Care should be taken when adding new tables. To prevent collision of
table names it is <strong>required</strong> to prefix them with a vendor/plugin string.</li>
<li>Note: A third-party maintainer may opt to use a separate database for their
tables. This may complicate cases where there are foreign key constraints
across schemas for DBMS that do not support this well. Third-party maintainer
discretion advised.</li>
</ul>
<p>The database tables owned by a third-party repo can have references to fields
in neutron core tables. However, the alembic branch for a plugin/driver repo
shall never update any part of a table that it does not own.</p>
<p><strong>Note: What happens when a referenced item changes?</strong></p>
<ul class="simple">
<li><strong>Q:</strong> If a driver&#8217;s table has a reference (for example a foreign key) to a
neutron core table, and the referenced item is changed in neutron, what
should you do?</li>
<li><strong>A:</strong> Fortunately, this should be an extremely rare occurrence. Neutron core
reviewers will not allow such a change unless there is a very carefully
thought-out design decision behind it. That design will include how to
address any third-party code affected. (This is another good reason why you
should stay actively involved with the Neutron developer community.)</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">neutron-db-manage</span></code> alembic wrapper script for neutron detects alembic
branches for installed third-party repos, and the upgrade command automatically
applies to all of them. A third-party repo must register its alembic migrations
at installation time. This is done by providing an entrypoint in setup.cfg as
follows:</p>
<p>For a third-party repo named <code class="docutils literal"><span class="pre">networking-foo</span></code>, add the alembic_migrations
directory as an entrypoint in the <code class="docutils literal"><span class="pre">neutron.db.alembic_migrations</span></code> group:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[entry_points]
neutron.db.alembic_migrations =
    networking-foo = networking_foo.db.migration:alembic_migrations
</pre></div>
</div>
<dl class="docutils">
<dt><strong>ToDo: neutron-db-manage autogenerate</strong></dt>
<dd>The alembic autogenerate command needs to support branches in external
repos. Bug #1471333 has been filed for this.</dd>
</dl>
</div>
<div class="section" id="db-model-migration-testing">
<h3>DB Model/Migration Testing<a class="headerlink" href="#db-model-migration-testing" title="Permalink to this headline">¶</a></h3>
<p>Here is a <a class="reference external" href="http://docs.openstack.org/developer/neutron/devref/template_model_sync_test.html">template functional test</a> third-party
maintainers can use to develop tests for model-vs-migration sync in their
repos. It is recommended that each third-party CI sets up such a test, and runs
it regularly against Neutron master.</p>
</div>
<div class="section" id="entry-points">
<h3>Entry Points<a class="headerlink" href="#entry-points" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://pythonhosted.org/setuptools">Python setuptools</a> installs all
entry points for packages in one global namespace for an environment. Thus each
third-party repo can define its package&#8217;s own <code class="docutils literal"><span class="pre">[entry_points]</span></code> in its own
<code class="docutils literal"><span class="pre">setup.cfg</span></code> file.</p>
<p>For example, for the <code class="docutils literal"><span class="pre">networking-foo</span></code> repo:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[entry_points]
console_scripts =
    neutron-foo-agent = networking_foo.cmd.eventlet.agents.foo:main
neutron.core_plugins =
    foo_monolithic = networking_foo.plugins.monolithic.plugin:FooPluginV2
neutron.service_plugins =
    foo_l3 = networking_foo.services.l3_router.l3_foo:FooL3ServicePlugin
neutron.ml2.type_drivers =
    foo_type = networking_foo.plugins.ml2.drivers.foo:FooType
neutron.ml2.mechanism_drivers =
    foo_ml2 = networking_foo.plugins.ml2.drivers.foo:FooDriver
neutron.ml2.extension_drivers =
    foo_ext = networking_foo.plugins.ml2.drivers.foo:FooExtensionDriver
</pre></div>
</div>
<ul class="simple">
<li>Note: It is advisable to include <code class="docutils literal"><span class="pre">foo</span></code> in the names of these entry points to
avoid conflicts with other third-party packages that may get installed in the
same environment.</li>
</ul>
</div>
<div class="section" id="api-extensions">
<h3>API Extensions<a class="headerlink" href="#api-extensions" title="Permalink to this headline">¶</a></h3>
<p>Extensions can be loaded in two ways:</p>
<ol class="arabic simple">
<li>Use the <code class="docutils literal"><span class="pre">append_api_extensions_path()</span></code> library API. This method is defined
in <code class="docutils literal"><span class="pre">neutron/api/extensions.py</span></code> in the neutron tree.</li>
<li>Leverage the <code class="docutils literal"><span class="pre">api_extensions_path</span></code> config variable when deploying. See the
example config file <code class="docutils literal"><span class="pre">etc/neutron.conf</span></code> in the neutron tree where this
variable is commented.</li>
</ol>
</div>
<div class="section" id="service-providers">
<h3>Service Providers<a class="headerlink" href="#service-providers" title="Permalink to this headline">¶</a></h3>
<p>If your project uses service provider(s) the same way VPNAAS and LBAAS do, you
specify your service provider in your <code class="docutils literal"><span class="pre">project_name.conf</span></code> file like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">service_providers</span><span class="p">]</span>
<span class="c1"># Must be in form:</span>
<span class="c1"># service_provider=&lt;service_type&gt;:&lt;name&gt;:&lt;driver&gt;[:default][,...]</span>
</pre></div>
</div>
<p>In order for Neutron to load this correctly, make sure you do the following in
your code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">neutron.db</span> <span class="kn">import</span> <span class="n">servicetype_db</span>
<span class="n">service_type_manager</span> <span class="o">=</span> <span class="n">servicetype_db</span><span class="o">.</span><span class="n">ServiceTypeManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
<span class="n">service_type_manager</span><span class="o">.</span><span class="n">add_provider_configuration</span><span class="p">(</span>
    <span class="n">YOUR_SERVICE_TYPE</span><span class="p">,</span>
    <span class="n">pconf</span><span class="o">.</span><span class="n">ProviderConfiguration</span><span class="p">(</span><span class="n">YOUR_SERVICE_MODULE</span><span class="p">))</span>
</pre></div>
</div>
<p>This is typically required when you instantiate your service plugin class.</p>
</div>
<div class="section" id="interface-drivers">
<h3>Interface Drivers<a class="headerlink" href="#interface-drivers" title="Permalink to this headline">¶</a></h3>
<p>Interface (VIF) drivers for the reference implementations are defined in
<code class="docutils literal"><span class="pre">neutron/agent/linux/interface.py</span></code>. Third-party interface drivers shall be
defined in a similar location within their own repo.</p>
<p>The entry point for the interface driver is a Neutron config option. It is up to
the installer to configure this item in the <code class="docutils literal"><span class="pre">[default]</span></code> section. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">default</span><span class="p">]</span>
<span class="n">interface_driver</span> <span class="o">=</span> <span class="n">networking_foo</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">linux</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">FooInterfaceDriver</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong>ToDo: Interface Driver port bindings.</strong></dt>
<dd><code class="docutils literal"><span class="pre">VIF_TYPE_*</span></code> constants in <code class="docutils literal"><span class="pre">neutron/extensions/portbindings.py</span></code> should be
moved from neutron core to the repositories where their drivers are
implemented. We need to provide some config or hook mechanism for VIF types
to be registered by external interface drivers. For Nova, selecting the VIF
driver can be done outside of
Neutron (using the new <a class="reference external" href="https://review.openstack.org/193668">os-vif python library</a>?). Armando and Akihiro to discuss.</dd>
</dl>
</div>
<div class="section" id="rootwrap-filters">
<h3>Rootwrap Filters<a class="headerlink" href="#rootwrap-filters" title="Permalink to this headline">¶</a></h3>
<p>If a third-party repo needs a rootwrap filter for a command that is not used by
Neutron core, then the filter shall be defined in the third-party repo.</p>
<p>For example, to add a rootwrap filters for commands in repo <code class="docutils literal"><span class="pre">networking-foo</span></code>:</p>
<ul>
<li><p class="first">In the repo, create the file:
<code class="docutils literal"><span class="pre">etc/neutron/rootwrap.d/foo.filters</span></code></p>
</li>
<li><p class="first">In the repo&#8217;s <code class="docutils literal"><span class="pre">setup.cfg</span></code> add the filters to data_files:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[files]
data_files =
    etc/neutron/rootwrap.d =
        etc/neutron/rootwrap.d/foo.filters
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="extending-python-neutronclient">
<h3>Extending python-neutronclient<a class="headerlink" href="#extending-python-neutronclient" title="Permalink to this headline">¶</a></h3>
<p>The maintainer of a third-party component may wish to add extensions to the
Neutron CLI client. Thanks to <a class="reference external" href="https://review.openstack.org/148318">https://review.openstack.org/148318</a> this can now
be accomplished. See <a class="reference external" href="client_command_extensions.html">Client Command Extensions</a>.</p>
</div>
<div class="section" id="other-repo-split-items">
<h3>Other repo-split items<a class="headerlink" href="#other-repo-split-items" title="Permalink to this headline">¶</a></h3>
<p>(These are still TBD.)</p>
<ul class="simple">
<li>Splitting policy.json? <strong>ToDo</strong> Armando will investigate.</li>
<li>Generic instructions (or a template) for installing an out-of-tree plugin or
driver for Neutron. Possibly something for the networking guide, and/or a
template that plugin/driver maintainers can modify and include with their
package.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Contributing new extensions to Neutron</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#contribution-process">Contribution Process</a></li>
<li><a class="reference internal" href="#design-and-development">Design and Development</a></li>
<li><a class="reference internal" href="#testing-and-continuous-integration">Testing and Continuous Integration</a></li>
<li><a class="reference internal" href="#defect-management">Defect Management</a><ul>
<li><a class="reference internal" href="#security-issues">Security Issues</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backport-management-strategies">Backport Management Strategies</a></li>
<li><a class="reference internal" href="#devstack-integration-strategies">DevStack Integration Strategies</a></li>
<li><a class="reference internal" href="#project-initial-setup">Project Initial Setup</a></li>
<li><a class="reference internal" href="#internationalization-support">Internationalization support</a><ul>
<li><a class="reference internal" href="#oslo-i18n">oslo.i18n</a></li>
<li><a class="reference internal" href="#setting-up-translation-support">Setting up translation support</a></li>
<li><a class="reference internal" href="#enable-translation">Enable Translation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integrating-with-the-neutron-system">Integrating with the Neutron system</a><ul>
<li><a class="reference internal" href="#configuration-files">Configuration Files</a></li>
<li><a class="reference internal" href="#database-models-and-migrations">Database Models and Migrations</a></li>
<li><a class="reference internal" href="#db-model-migration-testing">DB Model/Migration Testing</a></li>
<li><a class="reference internal" href="#entry-points">Entry Points</a></li>
<li><a class="reference internal" href="#api-extensions">API Extensions</a></li>
<li><a class="reference internal" href="#service-providers">Service Providers</a></li>
<li><a class="reference internal" href="#interface-drivers">Interface Drivers</a></li>
<li><a class="reference internal" href="#rootwrap-filters">Rootwrap Filters</a></li>
<li><a class="reference internal" href="#extending-python-neutronclient">Extending python-neutronclient</a></li>
<li><a class="reference internal" href="#other-repo-split-items">Other repo-split items</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="development.environment.html"
                                  title="previous chapter">Setting Up a Development Environment</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="neutron_api.html"
                                  title="next chapter">Neutron public API</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack/neutron
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/devref/contribute.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="neutron_api.html" title="Neutron public API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="development.environment.html" title="Setting Up a Development Environment"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">neutron 10.0.0.0rc2.dev58 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Developer Guide</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2011-present, OpenStack Foundation..
      Last updated on Feb 14, 2017.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/neutron");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>