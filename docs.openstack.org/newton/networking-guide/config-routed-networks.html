<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Routed provider networks</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">
<link href="_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="_static/sphinxmark.css" type="text/css" />
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Routed provider networks</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="config-rbac.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Role-Based Access Control (RBAC)"></i></a>
    
    
    <a href="config-sfc.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Service function chaining"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2017-02-14 13:48</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Routed provider networks</a><ul>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#example-configuration">Example configuration</a><ul>
<li><a class="reference internal" href="#controller-node">Controller node</a></li>
<li><a class="reference internal" href="#network-or-compute-nodes">Network or compute nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-a-routed-provider-network">Create a routed provider network</a></li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="routed-provider-networks">
<span id="config-routed-provider-networks"></span><h1>Routed provider networks<a class="headerlink" href="#routed-provider-networks" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Experimental feature. Use of this feature requires the OpenStack client
version 3.3 or newer.</p>
</div>
<p>Before routed provider networks, the Networking service could not present a
multi-segment layer-3 network as a single entity. Thus, each operator typically
chose one of the following architectures:</p>
<ul class="simple">
<li>Single large layer-2 network</li>
<li>Multiple smaller layer-2 networks</li>
</ul>
<p>Single large layer-2 networks become complex at scale and involve significant
failure domains.</p>
<p>Multiple smaller layer-2 networks scale better and shrink failure domains, but
leave network selection to the user. Without additional information, users
cannot easily differentiate these networks.</p>
<p>A routed provider network enables a single provider network to represent
multiple layer-2 networks (broadcast domains) or segments and enables the
operator to present one network to users. However, the particular IP
addresses available to an instance depend on the segment of the network
available on the particular compute node.</p>
<p>Similar to conventional networking, layer-2 (switching) handles transit of
traffic between ports on the same segment and layer-3 (routing) handles
transit of traffic between segments.</p>
<p>Each segment requires at least one subnet that explicitly belongs to that
segment. The association between a segment and a subnet distinguishes a
routed provider network from other types of networks. The Networking service
enforces that either zero or all subnets on a particular network associate
with a segment. For example, attempting to create a subnet without a segment
on a network containing subnets with segments generates an error.</p>
<p>The Networking service does not provide layer-3 services between segments.
Instead, it relies on physical network infrastructure to route subnets.
Thus, both the Networking service and physical network infrastructure must
contain configuration for routed provider networks, similar to conventional
provider networks. In the future, implementation of dynamic routing protocols
may ease configuration of routed networks.</p>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>The Newton implementation contains the following limitations:</p>
<ul class="simple">
<li>The Compute scheduler lacks awareness of IP address resources on a routed
network. Thus, the scheduler could exhaust the IP addresses in one segment
before assigning IP addresses from another segment. The Ocata release of
the Compute scheduler should provide the capability of scheduling around
segments without available IP addresses. In Newton, the Compute scheduler
selects any compute node on the provider network. If the segment on that
compute node lacks available IP addresses, port binding fails and the
Compute scheduler chooses another compute node without regard to segments.
Rescheduling continues up to the maximum number of retries. Operators
should monitor IP usage and add subnets to segments prior to exhaustion
of IP addresses. For more information, see the
<a class="reference external" href="https://blueprints.launchpad.net/neutron/+spec/routed-networks">blueprint</a>.</li>
<li>A routed provider network cannot also function as a <code class="docutils literal"><span class="pre">router:external</span></code>
networks which prevents compatibility with floating IPv4 addresses.
Additional routing, possibly using <a class="reference internal" href="config-bgp-dynamic-routing.html#config-bgp-dynamic-routing"><span>BGP dynamic routing</span></a>,
could address this issue in the future.</li>
</ul>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Routed provider networks require additional prerequisites over conventional
provider networks. We recommend using the following procedure:</p>
<ol class="arabic">
<li><p class="first">Begin with segments. The Networking service defines a segment using the
following components:</p>
<ul class="simple">
<li>Unique physical network name</li>
<li>Segmentation type</li>
<li>Segmentation ID</li>
</ul>
<p>For example, <code class="docutils literal"><span class="pre">provider1</span></code>, <code class="docutils literal"><span class="pre">VLAN</span></code>, and <code class="docutils literal"><span class="pre">2016</span></code>. See the
<a class="reference external" href="http://developer.openstack.org/api-ref/networking/v2/#id57">API reference</a>
for more information.</p>
<p>Within a network, use a unique physical network name for each segment which
enables reuse of the same segmentation details between subnets. For
example, using the same VLAN ID across all segments of a particular
provider network. Similar to conventional provider networks, the operator
must provision the layer-2 physical network infrastructure accordingly.</p>
</li>
<li><p class="first">Implement routing between segments.</p>
<p>The Networking service does not provision routing among segments. The
operator must implement routing among segments of a provider network.
Each subnet on a segment must contain the gateway address of the
router interface on that particular subnet. For example:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="11%" />
<col width="37%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Segment</th>
<th class="head">Version</th>
<th class="head">Addresses</th>
<th class="head">Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>segment1</td>
<td>4</td>
<td>203.0.113.0/24</td>
<td>203.0.113.1</td>
</tr>
<tr class="row-odd"><td>segment1</td>
<td>6</td>
<td>fd00:203:0:113::/64</td>
<td>fd00:203:0:113::1</td>
</tr>
<tr class="row-even"><td>segment2</td>
<td>4</td>
<td>198.51.100.0/24</td>
<td>198.51.100.1</td>
</tr>
<tr class="row-odd"><td>segment2</td>
<td>6</td>
<td>fd00:198:51:100::/64</td>
<td>fd00:198:51:100::1</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">Map segments to compute nodes.</p>
<p>Routed provider networks imply that compute nodes reside on different
segments. The operator should maintain this mapping to assist with
configuration of agents.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="18%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Host</th>
<th class="head">Rack</th>
<th class="head">Physical Network</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>compute0001</td>
<td>rack 1</td>
<td>segment 1</td>
</tr>
<tr class="row-odd"><td>compute0002</td>
<td>rack 1</td>
<td>segment 1</td>
</tr>
<tr class="row-even"><td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="row-odd"><td>compute0101</td>
<td>rack 2</td>
<td>segment 2</td>
</tr>
<tr class="row-even"><td>compute0102</td>
<td>rack 2</td>
<td>segment 2</td>
</tr>
<tr class="row-odd"><td>compute0102</td>
<td>rack 2</td>
<td>segment 2</td>
</tr>
<tr class="row-even"><td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">Deploy DHCP agents.</p>
<p>Unlike conventional provider networks, a DHCP agent cannot support more
than one segment within a network. The operator must deploy at least one
DHCP agent per segment. Consider deploying DHCP agents on compute nodes
containing the segments rather than one or more network nodes to reduce
node count.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="18%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Host</th>
<th class="head">Rack</th>
<th class="head">Physical Network</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>network0001</td>
<td>rack 1</td>
<td>segment 1</td>
</tr>
<tr class="row-odd"><td>network0002</td>
<td>rack 2</td>
<td>segment 2</td>
</tr>
<tr class="row-even"><td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
<div class="section" id="example-configuration">
<h2>Example configuration<a class="headerlink" href="#example-configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="controller-node">
<h3>Controller node<a class="headerlink" href="#controller-node" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Enable the segments service plug-in by appending <code class="docutils literal"><span class="pre">segments</span></code> to the list
of <code class="docutils literal"><span class="pre">service_plugins</span></code> in the <code class="docutils literal"><span class="pre">neutron.conf</span></code> file on all nodes running the
<code class="docutils literal"><span class="pre">neutron-server</span></code> service:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[DEFAULT]</span>
<span class="na">...</span>
<span class="na">service_plugins</span> <span class="o">=</span> <span class="s">..., segments</span>
</pre></div>
</div>
</li>
<li><p class="first">Restart the <code class="docutils literal"><span class="pre">neutron-server</span></code> service.</p>
</li>
</ol>
</div>
<div class="section" id="network-or-compute-nodes">
<h3>Network or compute nodes<a class="headerlink" href="#network-or-compute-nodes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Configure the layer-2 agent on each node to map one or more segments to
the appropriate physical network bridge or interface and restart the
agent.</li>
</ul>
</div>
</div>
<div class="section" id="create-a-routed-provider-network">
<h2>Create a routed provider network<a class="headerlink" href="#create-a-routed-provider-network" title="Permalink to this headline">¶</a></h2>
<p>The following steps create a routed provider network with two segments. Each
segment contains one IPv4 subnet and one IPv6 subnet.</p>
<ol class="arabic">
<li><p class="first">Source the administrative project credentials.</p>
</li>
<li><p class="first">Create a VLAN provider network which includes a default segment. In this
example, the network uses the <code class="docutils literal"><span class="pre">provider1</span></code> physical network with VLAN ID
2016.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack network create --share --provider-physical-network provider1 <span class="se">\</span>
  --provider-network-type vlan --provider-segment <span class="m">2016</span> multisegment1
<span class="go">+---------------------------+--------------------------------------+</span>
<span class="go">| Field                     | Value                                |</span>
<span class="go">+---------------------------+--------------------------------------+</span>
<span class="go">| admin_state_up            | UP                                   |</span>
<span class="go">| id                        | 6ab19caa-dda9-4b3d-abc4-5b8f435b98d9 |</span>
<span class="go">| ipv4_address_scope        | None                                 |</span>
<span class="go">| ipv6_address_scope        | None                                 |</span>
<span class="go">| l2_adjacency              | True                                 |</span>
<span class="go">| mtu                       | 1500                                 |</span>
<span class="go">| name                      | multisegment1                        |</span>
<span class="go">| port_security_enabled     | True                                 |</span>
<span class="go">| provider:network_type     | vlan                                 |</span>
<span class="go">| provider:physical_network | provider1                            |</span>
<span class="go">| provider:segmentation_id  | 2016                                 |</span>
<span class="go">| router:external           | Internal                             |</span>
<span class="go">| shared                    | True                                 |</span>
<span class="go">| status                    | ACTIVE                               |</span>
<span class="go">| subnets                   |                                      |</span>
<span class="go">| tags                      | []                                   |</span>
<span class="go">+---------------------------+--------------------------------------+</span>
</pre></div>
</div>
</li>
<li><p class="first">Rename the default segment to <code class="docutils literal"><span class="pre">segment1</span></code>.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack network segment list --network multisegment1
<span class="go">+--------------------------------------+----------+--------------------------------------+--------------+---------+</span>
<span class="go">| ID                                   | Name     | Network                              | Network Type | Segment |</span>
<span class="go">+--------------------------------------+----------+--------------------------------------+--------------+---------+</span>
<span class="go">| 43e16869-ad31-48e4-87ce-acf756709e18 | None     | 6ab19caa-dda9-4b3d-abc4-5b8f435b98d9 | vlan         |    2016 |</span>
<span class="go">+--------------------------------------+----------+--------------------------------------+--------------+---------+</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack network segment <span class="nb">set</span> --name segment1 43e16869-ad31-48e4-87ce-acf756709e18
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command provides no output.</p>
</div>
</li>
<li><p class="first">Create a second segment on the provider network. In this example, the
segment uses the <code class="docutils literal"><span class="pre">provider2</span></code> physical network with VLAN ID 2016.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack network segment create --physical-network provider2 <span class="se">\</span>
   --network-type vlan --segment <span class="m">2016</span> --network multisegment1 segment2
<span class="go">+------------------+--------------------------------------+</span>
<span class="go">| Field            | Value                                |</span>
<span class="go">+------------------+--------------------------------------+</span>
<span class="go">| description      | None                                 |</span>
<span class="go">| headers          |                                      |</span>
<span class="go">| id               | 053b7925-9a89-4489-9992-e164c8cc8763 |</span>
<span class="go">| name             | segment2                             |</span>
<span class="go">| network_id       | 6ab19caa-dda9-4b3d-abc4-5b8f435b98d9 |</span>
<span class="go">| network_type     | vlan                                 |</span>
<span class="go">| physical_network | provider2                            |</span>
<span class="go">| segmentation_id  | 2016                                 |</span>
<span class="go">+------------------+--------------------------------------+</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify that the network contains the <code class="docutils literal"><span class="pre">segment1</span></code> and <code class="docutils literal"><span class="pre">segment2</span></code> segments.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack network segment list --network multisegment1
<span class="go">+--------------------------------------+----------+--------------------------------------+--------------+---------+</span>
<span class="go">| ID                                   | Name     | Network                              | Network Type | Segment |</span>
<span class="go">+--------------------------------------+----------+--------------------------------------+--------------+---------+</span>
<span class="go">| 053b7925-9a89-4489-9992-e164c8cc8763 | segment2 | 6ab19caa-dda9-4b3d-abc4-5b8f435b98d9 | vlan         |    2016 |</span>
<span class="go">| 43e16869-ad31-48e4-87ce-acf756709e18 | segment1 | 6ab19caa-dda9-4b3d-abc4-5b8f435b98d9 | vlan         |    2016 |</span>
<span class="go">+--------------------------------------+----------+--------------------------------------+--------------+---------+</span>
</pre></div>
</div>
</li>
<li><p class="first">Create subnets on the <code class="docutils literal"><span class="pre">segment1</span></code> segment. In this example, the IPv4
subnet uses 203.0.113.0/24 and the IPv6 subnet uses fd00:203:0:113::/64.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack subnet create <span class="se">\</span>
  --network multisegment1 --network-segment segment1 <span class="se">\</span>
  --ip-version <span class="m">4</span> --subnet-range <span class="m">203</span>.0.113.0/24 <span class="se">\</span>
  multisegment1-segment1-v4
<span class="go">+-------------------+--------------------------------------+</span>
<span class="go">| Field             | Value                                |</span>
<span class="go">+-------------------+--------------------------------------+</span>
<span class="go">| allocation_pools  | 203.0.113.2-203.0.113.254            |</span>
<span class="go">| cidr              | 203.0.113.0/24                       |</span>
<span class="go">| enable_dhcp       | True                                 |</span>
<span class="go">| gateway_ip        | 203.0.113.1                          |</span>
<span class="go">| id                | c428797a-6f8e-4cb1-b394-c404318a2762 |</span>
<span class="go">| ip_version        | 4                                    |</span>
<span class="go">| name              | multisegment1-segment1-v4            |</span>
<span class="go">| network_id        | 6ab19caa-dda9-4b3d-abc4-5b8f435b98d9 |</span>
<span class="go">| segment_id        | 43e16869-ad31-48e4-87ce-acf756709e18 |</span>
<span class="go">+-------------------+--------------------------------------+</span>

<span class="gp">$</span> openstack subnet create <span class="se">\</span>
  --network multisegment1 --network-segment segment1 <span class="se">\</span>
  --ip-version <span class="m">6</span> --subnet-range fd00:203:0:113::/64 <span class="se">\</span>
  --ipv6-address-mode slaac multisegment1-segment1-v6
<span class="go">+-------------------+------------------------------------------------------+</span>
<span class="go">| Field             | Value                                                |</span>
<span class="go">+-------------------+------------------------------------------------------+</span>
<span class="go">| allocation_pools  | fd00:203:0:113::2-fd00:203:0:113:ffff:ffff:ffff:ffff |</span>
<span class="go">| cidr              | fd00:203:0:113::/64                                  |</span>
<span class="go">| enable_dhcp       | True                                                 |</span>
<span class="go">| gateway_ip        | fd00:203:0:113::1                                    |</span>
<span class="go">| id                | e41cb069-9902-4c01-9e1c-268c8252256a                 |</span>
<span class="go">| ip_version        | 6                                                    |</span>
<span class="go">| ipv6_address_mode | slaac                                                |</span>
<span class="go">| ipv6_ra_mode      | None                                                 |</span>
<span class="go">| name              | multisegment1-segment1-v6                            |</span>
<span class="go">| network_id        | 6ab19caa-dda9-4b3d-abc4-5b8f435b98d9                 |</span>
<span class="go">| segment_id        | 43e16869-ad31-48e4-87ce-acf756709e18                 |</span>
<span class="go">+-------------------+------------------------------------------------------+</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, IPv6 subnets on provider networks rely on physical network
infrastructure for stateless address autoconfiguration (SLAAC) and
router advertisement.</p>
</div>
</li>
<li><p class="first">Create subnets on the <code class="docutils literal"><span class="pre">segment2</span></code> segment. In this example, the IPv4
subnet uses 198.51.100.0/24 and the IPv6 subnet uses fd00:198:51:100::/64.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack subnet create <span class="se">\</span>
  --network multisegment1 --network-segment segment2 <span class="se">\</span>
  --ip-version <span class="m">4</span> --subnet-range <span class="m">198</span>.51.100.0/24 <span class="se">\</span>
  multisegment1-segment2-v4
<span class="go">+-------------------+--------------------------------------+</span>
<span class="go">| Field             | Value                                |</span>
<span class="go">+-------------------+--------------------------------------+</span>
<span class="go">| allocation_pools  | 198.51.100.2-198.51.100.254          |</span>
<span class="go">| cidr              | 198.51.100.0/24                      |</span>
<span class="go">| enable_dhcp       | True                                 |</span>
<span class="go">| gateway_ip        | 198.51.100.1                         |</span>
<span class="go">| id                | 242755c2-f5fd-4e7d-bd7a-342ca95e50b2 |</span>
<span class="go">| ip_version        | 4                                    |</span>
<span class="go">| name              | multisegment1-segment2-v4            |</span>
<span class="go">| network_id        | 6ab19caa-dda9-4b3d-abc4-5b8f435b98d9 |</span>
<span class="go">| segment_id        | 053b7925-9a89-4489-9992-e164c8cc8763 |</span>
<span class="go">+-------------------+--------------------------------------+</span>

<span class="gp">$</span> openstack subnet create <span class="se">\</span>
  --network multisegment1 --network-segment segment2 <span class="se">\</span>
  --ip-version <span class="m">6</span> --subnet-range fd00:198:51:100::/64 <span class="se">\</span>
  --ipv6-address-mode slaac multisegment1-segment2-v6
<span class="go">+-------------------+--------------------------------------------------------+</span>
<span class="go">| Field             | Value                                                  |</span>
<span class="go">+-------------------+--------------------------------------------------------+</span>
<span class="go">| allocation_pools  | fd00:198:51:100::2-fd00:198:51:100:ffff:ffff:ffff:ffff |</span>
<span class="go">| cidr              | fd00:198:51:100::/64                                   |</span>
<span class="go">| enable_dhcp       | True                                                   |</span>
<span class="go">| gateway_ip        | fd00:198:51:100::1                                     |</span>
<span class="go">| id                | b884c40e-9cfe-4d1b-a085-0a15488e9441                   |</span>
<span class="go">| ip_version        | 6                                                      |</span>
<span class="go">| ipv6_address_mode | slaac                                                  |</span>
<span class="go">| ipv6_ra_mode      | None                                                   |</span>
<span class="go">| name              | multisegment1-segment2-v6                              |</span>
<span class="go">| network_id        | 6ab19caa-dda9-4b3d-abc4-5b8f435b98d9                   |</span>
<span class="go">| segment_id        | 053b7925-9a89-4489-9992-e164c8cc8763                   |</span>
<span class="go">+-------------------+--------------------------------------------------------+</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify that each IPv4 subnet associates with at least one DHCP agent.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> neutron dhcp-agent-list-hosting-net multisegment1
<span class="go">+--------------------------------------+-------------+----------------+-------+</span>
<span class="go">| id                                   | host        | admin_state_up | alive |</span>
<span class="go">+--------------------------------------+-------------+----------------+-------+</span>
<span class="go">| c904ed10-922c-4c1a-84fd-d928abaf8f55 | compute0001 | True           | :-)   |</span>
<span class="go">| e0b22cc0-d2a6-4f1c-b17c-27558e20b454 | compute0101 | True           | :-)   |</span>
<span class="go">+--------------------------------------+-------------+----------------+-------+</span>
</pre></div>
</div>
</li>
<li><p class="first">Launch one or more instances. Each instance obtains IP addresses according
to the segment it uses on the particular compute node.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Creating a port and passing it to an instance yields a different
behavior than conventional networks. The Networking service
defers assignment of IP addresses to the port until the particular
compute node becomes apparent. For example:</p>
<div class="last highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> openstack port create --network multisegment1 port1
<span class="go">+-----------------------+--------------------------------------+</span>
<span class="go">| Field                 | Value                                |</span>
<span class="go">+-----------------------+--------------------------------------+</span>
<span class="go">| admin_state_up        | UP                                   |</span>
<span class="go">| binding_vnic_type     | normal                               |</span>
<span class="go">| id                    | 6181fb47-7a74-4add-9b6b-f9837c1c90c4 |</span>
<span class="go">| ip_allocation         | deferred                             |</span>
<span class="go">| mac_address           | fa:16:3e:34:de:9b                    |</span>
<span class="go">| name                  | port1                                |</span>
<span class="go">| network_id            | 6ab19caa-dda9-4b3d-abc4-5b8f435b98d9 |</span>
<span class="go">| port_security_enabled | True                                 |</span>
<span class="go">| security_groups       | e4fcef0d-e2c5-40c3-a385-9c33ac9289c5 |</span>
<span class="go">| status                | DOWN                                 |</span>
<span class="go">+-----------------------+--------------------------------------+</span>
</pre></div>
</div>
</div>
</li>
</ol>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="config-rbac.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Role-Based Access Control (RBAC)"></i></a>
          
          
            <a href="config-sfc.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Service function chaining"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2017-02-14 13:48</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="config.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="config-ml2.html">ML2 plug-in</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-address-scopes.html">Address scopes</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-auto-allocation.html">Automatic allocation of network topologies</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-az.html">Availability zones</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-bgp-dynamic-routing.html">BGP dynamic routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-dhcp-ha.html">High-availability for DHCP</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-dns-int.html">DNS integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-dns-res.html">Name resolution for instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-dvr-ha-snat.html">Distributed Virtual Routing with VRRP</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-ipam.html">IPAM configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-ipv6.html">IPv6</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-lbaas.html">Load Balancer as a Service (LBaaS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-macvtap.html">Macvtap mechanism driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-mtu.html">MTU considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-ovs-dpdk.html">Open vSwitch with DPDK datapath</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-ovsfwdriver.html">Native Open vSwitch firewall driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-qos.html">Quality of Service (QoS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-rbac.html">Role-Based Access Control (RBAC)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Routed provider networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-sfc.html">Service function chaining</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-sriov.html">SR-IOV</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-subnet-pools.html">Subnet pools</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-service-subnets.html">Service subnets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">Deployment examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="ops.html">Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Miscellaneous</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/app-support.html">Community support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "config-routed-networks" + ".rst";
        gitURL = "Source: http://git.openstack.org/cgit/openstack/openstack-manuals/tree/doc/networking-guide/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: b8fd8c76e4ec1d07c2970cbd5770a38196b5b343";
        var bugProject = "openstack-manuals";
        var bugTitle = "Routed provider networks in Networking Guide";
    var fieldTags = "networking-guide";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.9 on 2017-02-14 13:48";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>