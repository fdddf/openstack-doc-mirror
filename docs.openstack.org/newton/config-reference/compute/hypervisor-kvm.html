<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: KVM</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../_static/css/combined.css" rel="stylesheet">
<link href="../_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="../_static/sphinxmark.css" type="text/css" />
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>KVM</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="hypervisor-basics.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Hypervisor configuration basics"></i></a>
    
    
    <a href="hypervisor-qemu.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: QEMU"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2017-02-14 13:49</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">KVM</a><ul>
<li><a class="reference internal" href="#enable-kvm">Enable KVM</a><ul>
<li><a class="reference internal" href="#for-x86-based-systems">For x86 based systems</a></li>
<li><a class="reference internal" href="#for-power-based-systems">For POWER based systems</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-compute-backing-storage">Configure Compute backing storage</a></li>
<li><a class="reference internal" href="#specify-the-cpu-model-of-kvm-guests">Specify the CPU model of KVM guests</a><ul>
<li><a class="reference internal" href="#host-model-default-for-kvm-qemu">Host model (default for KVM &amp; QEMU)</a></li>
<li><a class="reference internal" href="#host-pass-through">Host pass through</a></li>
<li><a class="reference internal" href="#custom">Custom</a></li>
<li><a class="reference internal" href="#none-default-for-all-libvirt-driven-hypervisors-other-than-kvm-qemu">None (default for all libvirt-driven hypervisors other than KVM &amp; QEMU)</a></li>
<li><a class="reference internal" href="#guest-agent-support">Guest agent support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kvm-performance-tweaks">KVM performance tweaks</a></li>
<li><a class="reference internal" href="#troubleshoot-kvm">Troubleshoot KVM</a></li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="kvm">
<h1>KVM<a class="headerlink" href="#kvm" title="Permalink to this headline">¶</a></h1>
<p>KVM is configured as the default hypervisor for Compute.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This document contains several sections about hypervisor selection.
If you are reading this document linearly, you do not want to load
the KVM module before you install <code class="docutils literal"><span class="pre">nova-compute</span></code>.
The <code class="docutils literal"><span class="pre">nova-compute</span></code> service depends on qemu-kvm, which installs
<code class="docutils literal"><span class="pre">/lib/udev/rules.d/45-qemu-kvm.rules</span></code>, which sets the correct
permissions on the <code class="docutils literal"><span class="pre">/dev/kvm</span></code> device node.</p>
</div>
<p>To enable KVM explicitly, add the following configuration options to the
<code class="docutils literal"><span class="pre">/etc/nova/nova.conf</span></code> file:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="na">compute_driver</span> <span class="o">=</span> <span class="s">libvirt.LibvirtDriver</span>

<span class="k">[libvirt]</span>
<span class="na">virt_type</span> <span class="o">=</span> <span class="s">kvm</span>
</pre></div>
</div>
<p>The KVM hypervisor supports the following virtual machine image formats:</p>
<ul class="simple">
<li>Raw</li>
<li>QEMU Copy-on-write (qcow2)</li>
<li>QED Qemu Enhanced Disk</li>
<li>VMware virtual machine disk format (vmdk)</li>
</ul>
<p>This section describes how to enable KVM on your system.
For more information, see the following distribution-specific documentation:</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.fedoraproject.org/en-US/Fedora/22/html/Virtualization_Getting_Started_Guide/index.html">Fedora: Virtualization Getting Started Guide</a>
from the Fedora 22 documentation.</li>
<li><a class="reference external" href="https://help.ubuntu.com/community/KVM/Installation">Ubuntu: KVM/Installation</a> from the Community Ubuntu documentation.</li>
<li><a class="reference external" href="http://static.debian-handbook.info/browse/stable/sect.virtualization.html#idp11279352">Debian: Virtualization with KVM</a> from the Debian handbook.</li>
<li><a class="reference external" href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Virtualization_Host_Configuration_and_Guest_Installation_Guide/sect-Virtualization_Host_Configuration_and_Guest_Installation_Guide-Host_Installation-Installing_KVM_packages_on_an_existing_Red_Hat_Enterprise_Linux_system.html">Red Hat Enterprise Linux: Installing virtualization packages on an existing
Red Hat Enterprise Linux system</a> from the <code class="docutils literal"><span class="pre">Red</span> <span class="pre">Hat</span> <span class="pre">Enterprise</span> <span class="pre">Linux</span>
<span class="pre">Virtualization</span> <span class="pre">Host</span> <span class="pre">Configuration</span> <span class="pre">and</span> <span class="pre">Guest</span> <span class="pre">Installation</span> <span class="pre">Guide</span></code>.</li>
<li><a class="reference external" href="http://doc.opensuse.org/documentation/html/openSUSE/opensuse-kvm/cha.kvm.requires.html#sec.kvm.requires.install">openSUSE: Installing KVM</a>
from the openSUSE Virtualization with KVM manual.</li>
<li><a class="reference external" href="https://www.suse.com/documentation/sles-12/book_virt/data/sec_vt_installation_kvm.html">SLES: Installing KVM</a> from the SUSE Linux Enterprise Server
<code class="docutils literal"><span class="pre">Virtualization</span> <span class="pre">Guide</span></code>.</li>
</ul>
<div class="section" id="enable-kvm">
<h2>Enable KVM<a class="headerlink" href="#enable-kvm" title="Permalink to this headline">¶</a></h2>
<p>The following sections outline how to enable KVM based hardware
virtualization on different architectures and platforms.
To perform these steps, you must be logged in as the <code class="docutils literal"><span class="pre">root</span></code> user.</p>
<div class="section" id="for-x86-based-systems">
<h3>For x86 based systems<a class="headerlink" href="#for-x86-based-systems" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">To determine whether the <code class="docutils literal"><span class="pre">svm</span></code> or <code class="docutils literal"><span class="pre">vmx</span></code> CPU extensions are present,
run this command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> grep -E <span class="s1">&#39;svm|vmx&#39;</span> /proc/cpuinfo
</pre></div>
</div>
<p>This command generates output if the CPU is capable of
hardware-virtualization. Even if output is shown, you might still need
to enable virtualization in the system BIOS for full support.</p>
<p>If no output appears, consult your system documentation to ensure that
your CPU and motherboard support hardware virtualization.
Verify that any relevant hardware virtualization options are enabled
in the system BIOS.</p>
<p>The BIOS for each manufacturer is different. If you must enable
virtualization in the BIOS, look for an option containing the words
<code class="docutils literal"><span class="pre">virtualization</span></code>, <code class="docutils literal"><span class="pre">VT</span></code>, <code class="docutils literal"><span class="pre">VMX</span></code>, or <code class="docutils literal"><span class="pre">SVM</span></code>.</p>
</li>
<li><p class="first">To list the loaded kernel modules and verify that the <code class="docutils literal"><span class="pre">kvm</span></code> modules
are loaded, run this command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> lsmod <span class="p">|</span> grep kvm
</pre></div>
</div>
<p>If the output includes <code class="docutils literal"><span class="pre">kvm_intel</span></code> or <code class="docutils literal"><span class="pre">kvm_amd</span></code>, the <code class="docutils literal"><span class="pre">kvm</span></code> hardware
virtualization modules are loaded and your kernel meets the module
requirements for OpenStack Compute.</p>
<p>If the output does not show that the <code class="docutils literal"><span class="pre">kvm</span></code> module is loaded, run this
command to load it:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> modprobe -a kvm
</pre></div>
</div>
<p>Run the command for your CPU. For Intel, run this command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> modprobe -a kvm-intel
</pre></div>
</div>
<p>For AMD, run this command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> modprobe -a kvm-amd
</pre></div>
</div>
<p>Because a KVM installation can change user group membership,
you might need to log in again for changes to take effect.</p>
<p>If the kernel modules do not load automatically, use the procedures
listed in these subsections.</p>
</li>
</ol>
<p>If the checks indicate that required hardware virtualization support
or kernel modules are disabled or unavailable, you must either enable
this support on the system or find a system with this support.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some systems require that you enable VT support in the system BIOS.
If you believe your processor supports hardware acceleration but
the previous command did not produce output, reboot your machine,
enter the system BIOS, and enable the VT option.</p>
</div>
<p>If KVM acceleration is not supported, configure Compute to use a different
hypervisor, such as <code class="docutils literal"><span class="pre">QEMU</span></code> or <code class="docutils literal"><span class="pre">Xen</span></code>. See <a class="reference internal" href="hypervisor-qemu.html#compute-qemu"><span>QEMU</span></a> or
<a class="reference internal" href="hypervisor-xen-api.html#compute-xen-api"><span>XenServer (and other XAPI based Xen variants)</span></a> for details.</p>
<p>These procedures help you load the kernel modules for Intel-based and
AMD-based processors if they do not load automatically during KVM
installation.</p>
<p><strong>Intel-based processors</strong></p>
<p>If your compute host is Intel-based, run these commands as root to load
the kernel modules:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> modprobe kvm
<span class="gp">#</span> modprobe kvm-intel
</pre></div>
</div>
<p>Add these lines to the <code class="docutils literal"><span class="pre">/etc/modules</span></code> file so that these modules load
on reboot:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">kvm</span>
<span class="go">kvm-intel</span>
</pre></div>
</div>
<p><strong>AMD-based processors</strong></p>
<p>If your compute host is AMD-based, run these commands as root to load
the kernel modules:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> modprobe kvm
<span class="gp">#</span> modprobe kvm-amd
</pre></div>
</div>
<p>Add these lines to <code class="docutils literal"><span class="pre">/etc/modules</span></code> file so that these modules load
on reboot:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">kvm</span>
<span class="go">kvm-amd</span>
</pre></div>
</div>
</div>
<div class="section" id="for-power-based-systems">
<h3>For POWER based systems<a class="headerlink" href="#for-power-based-systems" title="Permalink to this headline">¶</a></h3>
<p>KVM as a hypervisor is supported on POWER system&#8217;s PowerNV platform.</p>
<ol class="arabic">
<li><p class="first">To determine if your POWER platform supports KVM based virtualization
run the following command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> cat /proc/cpuinfo <span class="p">|</span> grep PowerNV
</pre></div>
</div>
<p>If the previous command generates the following output,
then CPU supports KVM based virtualization.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">platform: PowerNV</span>
</pre></div>
</div>
<p>If no output is displayed, then your POWER platform does not
support KVM based hardware virtualization.</p>
</li>
<li><p class="first">To list the loaded kernel modules and verify that the <code class="docutils literal"><span class="pre">kvm</span></code>
modules are loaded, run the following command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> lsmod <span class="p">|</span> grep kvm
</pre></div>
</div>
<p>If the output includes <code class="docutils literal"><span class="pre">kvm_hv</span></code>, the <code class="docutils literal"><span class="pre">kvm</span></code> hardware
virtualization modules are loaded and your kernel meets
the module requirements for OpenStack Compute.</p>
<p>If the output does not show that the <code class="docutils literal"><span class="pre">kvm</span></code> module is loaded,
run the following command to load it:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> modprobe -a kvm
</pre></div>
</div>
<p>For PowerNV platform, run the following command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> modprobe -a kvm-hv
</pre></div>
</div>
<p>Because a KVM installation can change user group membership,
you might need to log in again for changes to take effect.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="configure-compute-backing-storage">
<h2>Configure Compute backing storage<a class="headerlink" href="#configure-compute-backing-storage" title="Permalink to this headline">¶</a></h2>
<p>Backing Storage is the storage used to provide the expanded operating system
image, and any ephemeral storage. Inside the virtual machine, this is normally
presented as two virtual hard disks (for example, <code class="docutils literal"><span class="pre">/dev/vda</span></code> and <code class="docutils literal"><span class="pre">/dev/vdb</span></code>
respectively). However, inside OpenStack, this can be derived from one of
these methods: <code class="docutils literal"><span class="pre">lvm</span></code>, <code class="docutils literal"><span class="pre">qcow</span></code>, <code class="docutils literal"><span class="pre">rbd</span></code> or <code class="docutils literal"><span class="pre">raw</span></code>, chosen using the
<code class="docutils literal"><span class="pre">images_type</span></code> option in <code class="docutils literal"><span class="pre">nova.conf</span></code> on the compute node.</p>
<p>QCOW is the default backing store. It uses a copy-on-write philosophy to delay
allocation of storage until it is actually needed. This means that the space
required for the backing of an image can be significantly less on the real disk
than what seems available in the virtual machine operating system.</p>
<p>RAW creates files without any sort of file formatting, effectively creating
files with the plain binary one would normally see on a real disk. This can
increase performance, but means that the entire size of the virtual disk is
reserved on the physical disk.</p>
<p>Local <a class="reference external" href="http://en.wikipedia.org/wiki/Logical_Volume_Manager_(Linux)">LVM volumes</a> can also be
used. Set <code class="docutils literal"><span class="pre">images_volume_group</span> <span class="pre">=</span> <span class="pre">nova_local</span></code> where <code class="docutils literal"><span class="pre">nova_local</span></code> is the name
of the LVM group you have created.</p>
</div>
<div class="section" id="specify-the-cpu-model-of-kvm-guests">
<h2>Specify the CPU model of KVM guests<a class="headerlink" href="#specify-the-cpu-model-of-kvm-guests" title="Permalink to this headline">¶</a></h2>
<p>The Compute service enables you to control the guest CPU model that
is exposed to KVM virtual machines. Use cases include:</p>
<ul class="simple">
<li>To maximize performance of virtual machines by exposing new host
CPU features to the guest</li>
<li>To ensure a consistent default CPU across all machines, removing
reliance of variable QEMU defaults</li>
</ul>
<p>In libvirt, the CPU is specified by providing a base CPU model name
(which is a shorthand for a set of feature flags), a set of additional
feature flags, and the topology (sockets/cores/threads).
The libvirt KVM driver provides a number of standard CPU model names.
These models are defined in the <code class="docutils literal"><span class="pre">/usr/share/libvirt/cpu_map.xml</span></code> file.
Check this file to determine which models are supported by your local
installation.</p>
<p>Two Compute configuration options in the <code class="docutils literal"><span class="pre">[libvirt]</span></code> group of
<code class="docutils literal"><span class="pre">nova.conf</span></code> define which type of CPU model is exposed to the
hypervisor when using KVM: <code class="docutils literal"><span class="pre">cpu_mode</span></code> and <code class="docutils literal"><span class="pre">cpu_model</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">cpu_mode</span></code> option can take one of the following values:
<code class="docutils literal"><span class="pre">none</span></code>, <code class="docutils literal"><span class="pre">host-passthrough</span></code>, <code class="docutils literal"><span class="pre">host-model</span></code>, and <code class="docutils literal"><span class="pre">custom</span></code>.</p>
<div class="section" id="host-model-default-for-kvm-qemu">
<h3>Host model (default for KVM &amp; QEMU)<a class="headerlink" href="#host-model-default-for-kvm-qemu" title="Permalink to this headline">¶</a></h3>
<p>If your <code class="docutils literal"><span class="pre">nova.conf</span></code> file contains <code class="docutils literal"><span class="pre">cpu_mode=host-model</span></code>, libvirt
identifies the CPU model in <code class="docutils literal"><span class="pre">/usr/share/libvirt/cpu_map.xml</span></code> file
that most closely matches the host, and requests additional CPU flags
to complete the match. This configuration provides the maximum functionality
and performance and maintains good reliability and compatibility if the
guest is migrated to another host with slightly different host CPUs.</p>
</div>
<div class="section" id="host-pass-through">
<h3>Host pass through<a class="headerlink" href="#host-pass-through" title="Permalink to this headline">¶</a></h3>
<p>If your <code class="docutils literal"><span class="pre">nova.conf</span></code> file contains <code class="docutils literal"><span class="pre">cpu_mode=host-passthrough</span></code>,
libvirt tells KVM to pass through the host CPU with no modifications.
The difference to host-model, instead of just matching feature flags,
every last detail of the host CPU is matched. This gives the best
performance, and can be important to some apps which check low level
CPU details, but it comes at a cost with respect to migration.
The guest can only be migrated to a matching host CPU.</p>
</div>
<div class="section" id="custom">
<h3>Custom<a class="headerlink" href="#custom" title="Permalink to this headline">¶</a></h3>
<p>If your <code class="docutils literal"><span class="pre">nova.conf</span></code> file contains <code class="docutils literal"><span class="pre">cpu_mode=custom</span></code>, you can
explicitly specify one of the supported named models using the cpu_model
configuration option. For example, to configure the KVM guests to expose
Nehalem CPUs, your <code class="docutils literal"><span class="pre">nova.conf</span></code> file should contain:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[libvirt]</span>
<span class="na">cpu_mode</span> <span class="o">=</span> <span class="s">custom</span>
<span class="na">cpu_model</span> <span class="o">=</span> <span class="s">Nehalem</span>
</pre></div>
</div>
</div>
<div class="section" id="none-default-for-all-libvirt-driven-hypervisors-other-than-kvm-qemu">
<h3>None (default for all libvirt-driven hypervisors other than KVM &amp; QEMU)<a class="headerlink" href="#none-default-for-all-libvirt-driven-hypervisors-other-than-kvm-qemu" title="Permalink to this headline">¶</a></h3>
<p>If your <code class="docutils literal"><span class="pre">nova.conf</span></code> file contains <code class="docutils literal"><span class="pre">cpu_mode=none</span></code>, libvirt does not
specify a CPU model. Instead, the hypervisor chooses the default model.</p>
</div>
<div class="section" id="guest-agent-support">
<h3>Guest agent support<a class="headerlink" href="#guest-agent-support" title="Permalink to this headline">¶</a></h3>
<p>Use guest agents to enable optional access between compute nodes and
guests through a socket, using the QMP protocol.</p>
<p>To enable this feature, you must set <code class="docutils literal"><span class="pre">hw_qemu_guest_agent=yes</span></code> as a
metadata parameter on the image you wish to use to create the
guest-agent-capable instances from. You can explicitly disable the
feature by setting <code class="docutils literal"><span class="pre">hw_qemu_guest_agent=no</span></code> in the image metadata.</p>
</div>
</div>
<div class="section" id="kvm-performance-tweaks">
<h2>KVM performance tweaks<a class="headerlink" href="#kvm-performance-tweaks" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://www.linux-kvm.org/page/VhostNet">VHostNet</a> kernel module
improves network performance. To load the kernel module, run the following
command as root:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> modprobe vhost_net
</pre></div>
</div>
</div>
<div class="section" id="troubleshoot-kvm">
<h2>Troubleshoot KVM<a class="headerlink" href="#troubleshoot-kvm" title="Permalink to this headline">¶</a></h2>
<p>Trying to launch a new virtual machine instance fails with the
<code class="docutils literal"><span class="pre">ERROR</span></code> state, and the following error appears in the
<code class="docutils literal"><span class="pre">/var/log/nova/nova-compute.log</span></code> file:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">libvirtError: internal error no supported architecture for os type &#39;hvm&#39;</span>
</pre></div>
</div>
<p>This message indicates that the KVM kernel modules were not loaded.</p>
<p>If you cannot start VMs after installation without rebooting,
the permissions might not be set correctly. This can happen
if you load the KVM module before you install <code class="docutils literal"><span class="pre">nova-compute</span></code>.
To check whether the group is set to <code class="docutils literal"><span class="pre">kvm</span></code>, run:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> ls -l /dev/kvm
</pre></div>
</div>
<p>If it is not set to <code class="docutils literal"><span class="pre">kvm</span></code>, run:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> udevadm trigger
</pre></div>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="hypervisor-basics.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Hypervisor configuration basics"></i></a>
          
          
            <a href="hypervisor-qemu.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: QEMU"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2017-02-14 13:49</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="../_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="../index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../config-overview.html">OpenStack configuration overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common-configurations.html">Common configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../application-catalog.html">Application Catalog service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bare-metal.html">Bare Metal service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block-storage.html">Block Storage service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clustering.html">Clustering service</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../compute.html">Compute service</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="config-options.html">The full set of available options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tables/conf-changes/nova.html">New, updated, and deprecated options in Newton for Compute</a></li>
<li class="toctree-l2"><a class="reference internal" href="nova-conf.html">Overview of nova.conf</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">Compute API configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="resize.html">Configure resize</a></li>
<li class="toctree-l2"><a class="reference internal" href="database-connections.html">Database configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="fibre-channel.html">Fibre Channel support in Compute</a></li>
<li class="toctree-l2"><a class="reference internal" href="iscsi-offload.html">iSCSI interface and offload support in Compute</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="hypervisors.html">Hypervisors</a></li>
<li class="toctree-l2"><a class="reference internal" href="schedulers.html">Compute schedulers</a></li>
<li class="toctree-l2"><a class="reference internal" href="cells.html">Cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="conductor.html">Conductor</a></li>
<li class="toctree-l2"><a class="reference internal" href="logs.html">Compute log files</a></li>
<li class="toctree-l2"><a class="reference internal" href="nova-conf-samples.html">Example nova.conf configuration files</a></li>
<li class="toctree-l2"><a class="reference internal" href="samples/index.html">Compute service sample configuration files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-processing.html">Data Processing service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database.html">Database service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../identity.html">Identity service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../image.html">Image service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../message.html">Message service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking.html">Networking service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../object-storage.html">Object Storage service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orchestration.html">Orchestration service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shared-file-systems.html">Shared File Systems service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../telemetry.html">Telemetry service</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../policy-json-file.html">The policy.json file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewalls-default-ports.html">Firewalls and default ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common/app-support.html">Community support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../common/glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "compute/hypervisor-kvm" + ".rst";
        gitURL = "Source: http://git.openstack.org/cgit/openstack/openstack-manuals/tree/doc/config-reference/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: b8fd8c76e4ec1d07c2970cbd5770a38196b5b343";
        var bugProject = "openstack-manuals";
        var bugTitle = "KVM in Configuration Reference";
    var fieldTags = "config-reference";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.9 on 2017-02-14 13:49";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>