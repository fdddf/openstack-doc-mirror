<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuration &mdash; Nodepool 0.4.1.dev20 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.4.1.dev20',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Nodepool 0.4.1.dev20 documentation" href="index.html" />
    <link rel="next" title="Node Ready Scripts" href="scripts.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="scripts.html" title="Node Ready Scripts"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Nodepool 0.4.1.dev20 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="configuration">
<span id="id1"></span><h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<p>Nodepool reads its secure configuration from <tt class="docutils literal"><span class="pre">/etc/nodepool/secure.conf</span></tt>
by default. The secure file is a standard ini config file, with
one section for database, and another section for the jenkins
secrets for each target:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[database]
dburi={dburi}

[jenkins &quot;{target_name}&quot;]
user={user}
apikey={apikey}
credentials={credentials}
url={url}
</pre></div>
</div>
<p>Following settings are available:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>**required**
</pre></div>
</div>
<blockquote>
<div><p><tt class="docutils literal"><span class="pre">dburi</span></tt>
Indicates the URI for the database connection.  See the <a class="reference external" href="http://docs.sqlalchemy.org/en/latest/core/engines.html#database-urls">SQLAlchemy
documentation</a>
for the syntax.  Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">dburi</span><span class="o">=</span><span class="s1">&#39;mysql+pymysql://nodepool@localhost/nodepool&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>optional</strong></p>
<blockquote>
<div><p>While it is possible to run Nodepool without any Jenkins targets,
if Jenkins is used, the <cite>target_name</cite> and <cite>url</cite> are required. The
<cite>user</cite>, <cite>apikey</cite> and <cite>credentials</cite> also may be needed depending on
the Jenkins security settings.</p>
<p><tt class="docutils literal"><span class="pre">target_name</span></tt>
Name of the jenkins target. It needs to match with a target
specified in nodepool.yaml, in order to retrieve its settings.</p>
<p><tt class="docutils literal"><span class="pre">url</span></tt>
Url to the Jenkins REST API.</p>
<p><tt class="docutils literal"><span class="pre">user</span></tt>
Jenkins username.</p>
<p><tt class="docutils literal"><span class="pre">apikey</span></tt>
API key generated by Jenkins (not the user password).</p>
<p><tt class="docutils literal"><span class="pre">credentials</span></tt>
If provided, Nodepool will configure the Jenkins slave to use the Jenkins
credential identified by that ID, otherwise it will use the username and
ssh keys configured in the image.</p>
</div></blockquote>
<p>Nodepool reads its configuration from <tt class="docutils literal"><span class="pre">/etc/nodepool/nodepool.yaml</span></tt>
by default.  The configuration file follows the standard YAML syntax
with a number of sections defined with top level keys.  For example, a
full configuration file may have the <tt class="docutils literal"><span class="pre">diskimages</span></tt>, <tt class="docutils literal"><span class="pre">labels</span></tt>,
<tt class="docutils literal"><span class="pre">providers</span></tt>, and <tt class="docutils literal"><span class="pre">targets</span></tt> sections:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>diskimages:
  ...
labels:
  ...
providers:
  ...
targets:
  ...
</pre></div>
</div>
<p>The following sections are available.  All are required unless
otherwise indicated.</p>
<div class="section" id="elements-dir">
<span id="id2"></span><h2>elements-dir<a class="headerlink" href="#elements-dir" title="Permalink to this headline">¶</a></h2>
<p>If an image is configured to use diskimage-builder and glance to locally
create and upload images, then a collection of diskimage-builder elements
must be present. The <tt class="docutils literal"><span class="pre">elements-dir</span></tt> parameter indicates a directory
that holds one or more elements.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>elements-dir: /path/to/elements/dir
</pre></div>
</div>
</div>
<div class="section" id="images-dir">
<h2>images-dir<a class="headerlink" href="#images-dir" title="Permalink to this headline">¶</a></h2>
<p>When we generate images using diskimage-builder they need to be
written to somewhere. The <tt class="docutils literal"><span class="pre">images-dir</span></tt> parameter is the place to
write them.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>images-dir: /path/to/images/dir
</pre></div>
</div>
</div>
<div class="section" id="cron">
<h2>cron<a class="headerlink" href="#cron" title="Permalink to this headline">¶</a></h2>
<p>This section is optional.</p>
<p>Nodepool runs several periodic tasks.  The <tt class="docutils literal"><span class="pre">cleanup</span></tt> task deletes
old images and servers which may have encountered errors during their
initial deletion.  The <tt class="docutils literal"><span class="pre">check</span></tt> task attempts to log into each node
that is waiting to be used to make sure that it is still operational.
The following illustrates how to change the schedule for these tasks
and also indicates their default values:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cron:
  cleanup: &#39;27 */6 * * *&#39;
  check: &#39;*/15 * * * *&#39;
</pre></div>
</div>
</div>
<div class="section" id="zmq-publishers">
<h2>zmq-publishers<a class="headerlink" href="#zmq-publishers" title="Permalink to this headline">¶</a></h2>
<p>Lists the ZeroMQ endpoints for the Jenkins masters.  Nodepool uses
this to receive real-time notification that jobs are running on nodes
or are complete and nodes may be deleted.  Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>zmq-publishers:
  - tcp://jenkins1.example.com:8888
  - tcp://jenkins2.example.com:8888
</pre></div>
</div>
</div>
<div class="section" id="gearman-servers">
<h2>gearman-servers<a class="headerlink" href="#gearman-servers" title="Permalink to this headline">¶</a></h2>
<p>Lists the Zuul Gearman servers that should be consulted for real-time
demand.  Nodepool will use information from these servers to determine
if additional nodes should be created to satisfy current demand.
Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>gearman-servers:
  - host: zuul.example.com
    port: 4730
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">port</span></tt> key is optional (default: 4730).</p>
</div>
<div class="section" id="zookeeper-servers">
<h2>zookeeper-servers<a class="headerlink" href="#zookeeper-servers" title="Permalink to this headline">¶</a></h2>
<p>Lists the ZooKeeper servers uses for coordinating information between
nodepool workers. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>zookeeper-servers:
  - host: zk1.example.com
    port: 2181
    chroot: /nodepool
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">port</span></tt> key is optional (default: 2181).</p>
<p>The <tt class="docutils literal"><span class="pre">chroot</span></tt> key, used for interpreting ZooKeeper paths relative to
the supplied root path, is also optional and has no default.</p>
</div>
<div class="section" id="labels">
<span id="id3"></span><h2>labels<a class="headerlink" href="#labels" title="Permalink to this headline">¶</a></h2>
<p>Defines the types of nodes that should be created.  Maps node types to
the images that are used to back them and the providers that are used
to supply them.  Jobs should be written to run on nodes of a certain
label (so targets such as Jenkins don&#8217;t need to know about what
providers or images are used to create them).  Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>labels:
  - name: my-precise
    image: precise
    min-ready: 2
    providers:
      - name: provider1
      - name: provider2
  - name: multi-precise
    image: precise
    subnodes: 2
    min-ready: 2
    ready-script: setup_multinode.sh
    providers:
      - name: provider1
</pre></div>
</div>
<p><strong>required</strong></p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">name</span></tt></dt>
<dd>Unique name used to tie jobs to those instances.</dd>
<dt><tt class="docutils literal"><span class="pre">image</span></tt></dt>
<dd>Refers to providers images, see <a class="reference internal" href="#images"><em>images</em></a>.</dd>
<dt><tt class="docutils literal"><span class="pre">providers</span></tt> (list)</dt>
<dd>Required if any nodes should actually be created (e.g., the label is not
currently disabled, see <tt class="docutils literal"><span class="pre">min-ready</span></tt> below).</dd>
</dl>
</div></blockquote>
<p><strong>optional</strong></p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">min-ready</span></tt> (default: 2)</dt>
<dd>Minimum instances that should be in a ready state. Set to -1 to have the
label considered disabled. <tt class="docutils literal"><span class="pre">min-ready</span></tt> is best-effort based on available
capacity and is not a guaranteed allocation.</dd>
<dt><tt class="docutils literal"><span class="pre">subnodes</span></tt></dt>
<dd><p class="first">Used to configure multi-node support.  If a <cite>subnodes</cite> key is supplied to
an image, it indicates that the specified number of additional nodes of the
same image type should be created and associated with each node for that
image.</p>
<p class="last">Only one node from each such group will be added to the target, the
subnodes are expected to communicate directly with each other.  In the
example above, for each Precise node added to the target system, two
additional nodes will be created and associated with it.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ready-script</span></tt></dt>
<dd>A script to be used to perform any last minute changes to a node after it
has been launched but before it is put in the READY state to receive jobs.
For more information, see <a class="reference internal" href="scripts.html#scripts"><em>Node Ready Scripts</em></a>.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="diskimages">
<span id="id4"></span><h2>diskimages<a class="headerlink" href="#diskimages" title="Permalink to this headline">¶</a></h2>
<p>This section lists the images to be built using diskimage-builder. The
name of the diskimage is mapped to the <a class="reference internal" href="#images"><em>images</em></a> section of the
provider, to determine which providers should received uploads of each
image.  The diskimage will be built in every format required by the
providers with which it is associated.  Because Nodepool needs to know
which formats to build, if the diskimage will only be built if it
appears in at least one provider.</p>
<p>To remove a diskimage from the system entirely, remove all associated
entries in <a class="reference internal" href="#images"><em>images</em></a> and remove its entry from <cite>diskimages</cite>.  All
uploads will be deleted as well as the files on disk.</p>
<p>Example configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>diskimages:
  - name: ubuntu-precise
    pause: False
    rebuild-age: 86400
    elements:
      - ubuntu-minimal
      - vm
      - simple-init
      - openstack-repos
      - nodepool-base
      - cache-devstack
      - cache-bindep
      - growroot
      - infra-package-needs
    release: precise
    env-vars:
      TMPDIR: /opt/dib_tmp
      DIB_CHECKSUM: &#39;1&#39;
      DIB_IMAGE_CACHE: /opt/dib_cache
      DIB_APT_LOCAL_CACHE: &#39;0&#39;
      DIB_DISABLE_APT_CLEANUP: &#39;1&#39;
      FS_TYPE: ext3
  - name: ubuntu-xenial
    pause: True
    rebuild-age: 86400
    formats:
      - raw
      - tar
    elements:
      - ubuntu-minimal
      - vm
      - simple-init
      - openstack-repos
      - nodepool-base
      - cache-devstack
      - cache-bindep
      - growroot
      - infra-package-needs
    release: precise
    env-vars:
      TMPDIR: /opt/dib_tmp
      DIB_CHECKSUM: &#39;1&#39;
      DIB_IMAGE_CACHE: /opt/dib_cache
      DIB_APT_LOCAL_CACHE: &#39;0&#39;
      DIB_DISABLE_APT_CLEANUP: &#39;1&#39;
      FS_TYPE: ext3
</pre></div>
</div>
<p><strong>required</strong></p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">name</span></tt></dt>
<dd>Identifier to reference the disk image in <a class="reference internal" href="#images"><em>images</em></a> and <a class="reference internal" href="#labels"><em>labels</em></a>.</dd>
</dl>
</div></blockquote>
<p><strong>optional</strong></p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">formats</span></tt> (list)</dt>
<dd>The list of formats to build is normally automatically created based on the
needs of the providers to which the image is uploaded.  To build images even
when no providers are configured or to build additional formats which you
know you may need in the future, list those formats here.</dd>
<dt><tt class="docutils literal"><span class="pre">rebuild-age</span></tt></dt>
<dd>If the current diskimage is older than this value (in seconds),
then nodepool will attempt to rebuild it.  Defaults to 86400 (24
hours).</dd>
<dt><tt class="docutils literal"><span class="pre">release</span></tt></dt>
<dd>Specifies the distro to be used as a base image to build the image using
diskimage-builder.</dd>
<dt><tt class="docutils literal"><span class="pre">elements</span></tt> (list)</dt>
<dd>Enumerates all the elements that will be included when building the image,
and will point to the <a class="reference internal" href="#elements-dir"><em>elements-dir</em></a> path referenced in the same
config file.</dd>
<dt><tt class="docutils literal"><span class="pre">env-vars</span></tt> (dict)</dt>
<dd>Arbitrary environment variables that will be available in the spawned
diskimage-builder child process.</dd>
<dt><tt class="docutils literal"><span class="pre">pause</span></tt> (bool)</dt>
<dd>When set to True, nodepool-builder will not build the diskimage.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="provider">
<span id="id5"></span><h2>provider<a class="headerlink" href="#provider" title="Permalink to this headline">¶</a></h2>
<p>Lists the OpenStack cloud providers Nodepool should use.  Within each
provider, the Nodepool image types are also defined (see
<a class="reference internal" href="#images"><em>images</em></a> for details).  Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>providers:
  - name: provider1
    cloud: example
    region-name: &#39;region1&#39;
    max-servers: 96
    rate: 1.0
    availability-zones:
      - az1
    boot-timeout: 120
    launch-timeout: 900
    template-hostname: &#39;template-{image.name}-{timestamp}&#39;
    ipv6-preferred: False
    networks:
      - name: &#39;some-network-name&#39;
    images:
      - name: trusty
        min-ram: 8192
        name-filter: &#39;something to match&#39;
        username: jenkins
        user-home: &#39;/home/jenkins&#39;
        private-key: /var/lib/jenkins/.ssh/id_rsa
        meta:
            key: value
            key2: value
      - name: precise
        min-ram: 8192
        username: jenkins
        user-home: &#39;/home/jenkins&#39;
        private-key: /var/lib/jenkins/.ssh/id_rsa
      - name: devstack-trusty
        min-ram: 30720
        username: jenkins
        private-key: /home/nodepool/.ssh/id_rsa
  - name: provider2
    username: &#39;username&#39;
    password: &#39;password&#39;
    auth-url: &#39;http://auth.provider2.example.com/&#39;
    project-name: &#39;project&#39;
    service-type: &#39;compute&#39;
    service-name: &#39;compute&#39;
    region-name: &#39;region1&#39;
    max-servers: 96
    rate: 1.0
    template-hostname: &#39;{image.name}-{timestamp}-nodepool-template&#39;
    images:
      - name: precise
        min-ram: 8192
        username: jenkins
        user-home: &#39;/home/jenkins&#39;
        private-key: /var/lib/jenkins/.ssh/id_rsa
        meta:
            key: value
            key2: value
</pre></div>
</div>
<p><strong>cloud configuration*</strong></p>
<p><strong>preferred</strong></p>
<blockquote>
<div><p><tt class="docutils literal"><span class="pre">cloud</span></tt>
There are two methods supported for configuring cloud entries. The preferred
method is to create an <tt class="docutils literal"><span class="pre">~/.config/openstack/clouds.yaml</span></tt> file containing
your cloud configuration information. Then, use <tt class="docutils literal"><span class="pre">cloud</span></tt> to refer to a
named entry in that file.</p>
<p>More information about the contents of <cite>clouds.yaml</cite> can be found in
<a class="reference external" href="http://docs.openstack.org/developer/os-client-config/">the os-client-config documentation</a>.</p>
</div></blockquote>
<p><strong>compatablity</strong></p>
<blockquote>
<div><p>For backwards compatibility reasons, you can also include
portions of the cloud configuration directly in <tt class="docutils literal"><span class="pre">nodepool.yaml</span></tt>. Not all
of the options settable via <tt class="docutils literal"><span class="pre">clouds.yaml</span></tt> are available.</p>
<p><tt class="docutils literal"><span class="pre">username</span></tt></p>
<p><tt class="docutils literal"><span class="pre">password</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">project-id</span></tt> OR <tt class="docutils literal"><span class="pre">project-name</span></tt></dt>
<dd>Some clouds may refer to the <tt class="docutils literal"><span class="pre">project-id</span></tt> as <tt class="docutils literal"><span class="pre">tenant-id</span></tt>.
Some clouds may refer to the <tt class="docutils literal"><span class="pre">project-name</span></tt> as <tt class="docutils literal"><span class="pre">tenant-name</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">auth-url</span></tt></dt>
<dd>Keystone URL.</dd>
<dt><tt class="docutils literal"><span class="pre">image-type</span></tt></dt>
<dd><p class="first">Specifies the image type supported by this provider.  The disk images built
by diskimage-builder will output an image for each <tt class="docutils literal"><span class="pre">image-type</span></tt> specified
by a provider using that particular diskimage.</p>
<p class="last">By default, <tt class="docutils literal"><span class="pre">image-type</span></tt> is set to the value returned from
<tt class="docutils literal"><span class="pre">os-client-config</span></tt> and can be omitted in most cases.</p>
</dd>
</dl>
</div></blockquote>
<p><strong>required</strong></p>
<blockquote>
<div><p><tt class="docutils literal"><span class="pre">name</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">max-servers</span></tt></dt>
<dd>Maximum number of servers spawnable on this provider.</dd>
</dl>
</div></blockquote>
<p><strong>optional</strong></p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">availability-zones</span></tt> (list)</dt>
<dd><p class="first">Without it nodepool will rely on nova to schedule an availability zone.</p>
<p class="last">If it is provided the value should be a list of availability zone names.
Nodepool will select one at random and provide that to nova. This should
give a good distribution of availability zones being used. If you need more
control of the distribution you can use multiple logical providers each
providing a different list of availabiltiy zones.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">boot-timeout</span></tt></dt>
<dd><p class="first">Once an instance is active, how long to try connecting to the
image via SSH.  If the timeout is exceeded, the node launch is
aborted and the instance deleted.</p>
<p class="last">In seconds. Default 60.</p>
</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">launch-timeout</span></tt></p>
<blockquote>
<div><p>The time to wait from issuing the command to create a new instance
until that instance is reported as &#8220;active&#8221;.  If the timeout is
exceeded, the node launch is aborted and the instance deleted.</p>
<p>In seconds. Default 3600.</p>
</div></blockquote>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">keypair</span></tt></dt>
<dd>Default None</dd>
<dt><tt class="docutils literal"><span class="pre">networks</span></tt> (dict)</dt>
<dd>Specify custom Neutron networks that get attached to each
node. Specify the <tt class="docutils literal"><span class="pre">name</span></tt> of the network (a string).</dd>
<dt><tt class="docutils literal"><span class="pre">ipv6-preferred</span></tt></dt>
<dd>If it is set to True, nodepool will try to find ipv6 in public net first
as the ip address for ssh connection to build snapshot images and create
jenkins slave definition. If ipv6 is not found or the key is not
specified or set to False, ipv4 address will be used.</dd>
<dt><tt class="docutils literal"><span class="pre">api-timeout</span></tt> (compatability)</dt>
<dd>Timeout for the OpenStack API calls client in seconds. Prefer setting
this in <cite>clouds.yaml</cite></dd>
<dt><tt class="docutils literal"><span class="pre">service-type</span></tt> (compatability)</dt>
<dd>Prefer setting this in <cite>clouds.yaml</cite>.</dd>
<dt><tt class="docutils literal"><span class="pre">service-name</span></tt> (compatability)</dt>
<dd>Prefer setting this in <cite>clouds.yaml</cite>.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">region-name</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">template-hostname</span></tt></dt>
<dd>Hostname template to use for the spawned instance.
Default <tt class="docutils literal"><span class="pre">template-{image.name}-{timestamp}</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">rate</span></tt></dt>
<dd>In seconds. Default 1.0.</dd>
<dt><tt class="docutils literal"><span class="pre">clean-floating-ips</span></tt></dt>
<dd>If it is set to True, nodepool will assume it is the only user of the
OpenStack project and will attempt to clean unattached floating ips that
may have leaked around restarts.</dd>
</dl>
</div></blockquote>
<div class="section" id="images">
<span id="id6"></span><h3>images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h3>
<p>Each entry in a provider&#8217;s <cite>images</cite> section must correspond to an
entry in <a class="reference internal" href="#diskimages"><em>diskimages</em></a>.  Such an entry indicates that the
corresponding diskimage should be uploaded for use in this provider.
Additionally, any nodes that are created using the uploaded image will
have the associated attributes (such as flavor or metadata).</p>
<p>If an image is removed from this section, any previously uploaded
images will be deleted from the provider.</p>
<p>Example configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>images:
  - name: precise
    pause: False
    min-ram: 8192
    name-filter: &#39;something to match&#39;
    username: jenkins
    private-key: /var/lib/jenkins/.ssh/id_rsa
    meta:
        key: value
        key2: value
</pre></div>
</div>
<p><strong>required</strong></p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">name</span></tt></dt>
<dd>Identifier to refer this image from <a class="reference internal" href="#labels"><em>labels</em></a> and <a class="reference internal" href="#diskimages"><em>diskimages</em></a>
sections.</dd>
<dt><tt class="docutils literal"><span class="pre">min-ram</span></tt></dt>
<dd>Determine the flavor to use (e.g. <tt class="docutils literal"><span class="pre">m1.medium</span></tt>, <tt class="docutils literal"><span class="pre">m1.large</span></tt>,
etc).  The smallest flavor that meets the <tt class="docutils literal"><span class="pre">min-ram</span></tt> requirements
will be chosen. To further filter by flavor name, see optional
<tt class="docutils literal"><span class="pre">name-filter</span></tt> below.</dd>
</dl>
</div></blockquote>
<p><strong>optional</strong></p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">name-filter</span></tt></dt>
<dd>Additional filter complementing <tt class="docutils literal"><span class="pre">min-ram</span></tt>, will be required to match on
the flavor-name (e.g. Rackspace offer a &#8220;Performance&#8221; flavour; setting
<cite>name-filter</cite> to <tt class="docutils literal"><span class="pre">Performance</span></tt> will ensure the chosen flavor also
contains this string as well as meeting <cite>min-ram</cite> requirements).</dd>
<dt><tt class="docutils literal"><span class="pre">pause</span></tt> (bool)</dt>
<dd>When set to True, nodepool-builder will not upload the image to the
provider.</dd>
<dt><tt class="docutils literal"><span class="pre">username</span></tt></dt>
<dd>Nodepool expects that user to exist after running the script indicated by
<tt class="docutils literal"><span class="pre">setup</span></tt>. Default <tt class="docutils literal"><span class="pre">jenkins</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">private-key</span></tt></dt>
<dd>Default <tt class="docutils literal"><span class="pre">/var/lib/jenkins/.ssh/id_rsa</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">config-drive</span></tt> (boolean)</dt>
<dd>Whether config drive should be used for the image.</dd>
<dt><tt class="docutils literal"><span class="pre">meta</span></tt> (dict)</dt>
<dd>Arbitrary key/value metadata to store for this server using the Nova
metadata service. A maximum of five entries is allowed, and both keys and
values must be 255 characters or less.</dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="targets">
<span id="id7"></span><h2>targets<a class="headerlink" href="#targets" title="Permalink to this headline">¶</a></h2>
<p>Lists the Jenkins masters to which Nodepool should attach nodes after
they are created.  Nodes of each label will be evenly distributed
across all of the targets which are on-line:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>targets:
  - name: jenkins1
    hostname: &#39;{label.name}-{provider.name}-{node_id}&#39;
    subnode-hostname: &#39;{label.name}-{provider.name}-{node_id}-{subnode_id}&#39;
  - name: jenkins2
    hostname: &#39;{label.name}-{provider.name}-{node_id}&#39;
    subnode-hostname: &#39;{label.name}-{provider.name}-{node_id}-{subnode_id}&#39;
</pre></div>
</div>
<p><strong>required</strong></p>
<blockquote>
<div><tt class="docutils literal"><span class="pre">name</span></tt>
Identifier for the system an instance is attached to.</div></blockquote>
<p><strong>optional</strong></p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">hostname</span></tt></dt>
<dd>Default <tt class="docutils literal"><span class="pre">{label.name}-{provider.name}-{node_id}</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">subnode-hostname</span></tt></dt>
<dd>Default <tt class="docutils literal"><span class="pre">{label.name}-{provider.name}-{node_id}-{subnode_id}</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">rate</span></tt></dt>
<dd>In seconds. Default 1.0</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">jenkins</span></tt> (dict)</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">test-job</span></tt> (optional)</dt>
<dd><p class="first">Setting this would cause a newly created instance to be in a TEST state.
The job name given will then be executed with the node name as a
parameter.</p>
<p>If the job succeeds, move the node into READY state and relabel it with
the appropriate label (from the image name).</p>
<p>If it fails, immediately delete the node.</p>
<p class="last">If the job never runs, the node will eventually be cleaned up by the
periodic cleanup task.</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuration</a><ul>
<li><a class="reference internal" href="#elements-dir">elements-dir</a></li>
<li><a class="reference internal" href="#images-dir">images-dir</a></li>
<li><a class="reference internal" href="#cron">cron</a></li>
<li><a class="reference internal" href="#zmq-publishers">zmq-publishers</a></li>
<li><a class="reference internal" href="#gearman-servers">gearman-servers</a></li>
<li><a class="reference internal" href="#zookeeper-servers">zookeeper-servers</a></li>
<li><a class="reference internal" href="#labels">labels</a></li>
<li><a class="reference internal" href="#diskimages">diskimages</a></li>
<li><a class="reference internal" href="#provider">provider</a><ul>
<li><a class="reference internal" href="#images">images</a></li>
</ul>
</li>
<li><a class="reference internal" href="#targets">targets</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="scripts.html"
                        title="next chapter">Node Ready Scripts</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/configuration.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="scripts.html" title="Node Ready Scripts"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
        <li><a href="index.html">Nodepool 0.4.1.dev20 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2017, OpenStack.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>