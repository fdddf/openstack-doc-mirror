
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Zuul &mdash; OpenStack Project Infrastructure 0.0.1.dev12076 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1.dev12076',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="OpenStack Project Infrastructure 0.0.1.dev12076 documentation" href="index.html" />
    <link rel="up" title="Major Systems" href="systems.html" />
    <link rel="next" title="Jenkins Job Builder" href="jjb.html" />
    <link rel="prev" title="Grafyaml" href="grafyaml.html" /> 
  </head>
  <body>
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
<li><a href="index.html" title="Go to the Home page" class="link">Home</a></li>
<li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
<li><a href="http://review.openstack.org/" title="Go to the OpenStack Gerrit server">Gerrit</a></li>
<li><a href="http://jenkins.openstack.org/" title="Go to the OpenStack Jenkins server">Jenkins</a></li>
<li><a href="http://logstash.openstack.org/" title="Go to the OpenStack Logstash server">Logstash</a></li>
<li><a href="http://etherpad.openstack.org/" title="Go to the OpenStack Etherpad server">Etherpad</a></li>
<li><a href="http://paste.openstack.org/" title="Go to the OpenStack Paste server">Paste</a></li>
<li><a href="http://planet.openstack.org/" title="Go to the OpenStack Planet server">Planet</a></li>
<li><a href="http://lists.openstack.org/" title="Go to the OpenStack Mailman server">Mailman</a></li>

    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="zuul">
<span id="id1"></span><h1>Zuul<a class="headerlink" href="#zuul" title="Permalink to this headline">¶</a></h1>
<p>Zuul is a pipeline-oriented project gating system.  It facilitates
running tests and automated tasks in response to Gerrit events.</p>
<div class="section" id="at-a-glance">
<h2>At a Glance<a class="headerlink" href="#at-a-glance" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Hosts:</th><td class="field-body"><ul class="first simple">
<li><a class="reference external" href="http://status.openstack.org/zuul">http://status.openstack.org/zuul</a></li>
<li><a class="reference external" href="http://zuul.openstack.org">http://zuul.openstack.org</a></li>
<li><a class="reference external" href="http://zuul-dev.openstack.org">http://zuul-dev.openstack.org</a></li>
<li>zm*.openstack.org</li>
<li>zl*.openstack.org</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Puppet:</th><td class="field-body"><ul class="first simple">
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/puppet-zuul/tree/">https://git.openstack.org/cgit/openstack-infra/puppet-zuul/tree/</a></li>
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/system-config/tree/modules/openstack_project/manifests/zuul_prod.pp">system-config: modules/openstack_project/manifests/zuul_prod.pp</a></li>
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/system-config/tree/modules/openstack_project/manifests/zuul_dev.pp">system-config: modules/openstack_project/manifests/zuul_dev.pp</a></li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Configuration:</th><td class="field-body"><ul class="first simple">
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/project-config/tree/zuul/layout.yaml">project-config: zuul/layout.yaml</a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Projects:</th><td class="field-body"><ul class="first simple">
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/zuul">https://git.openstack.org/cgit/openstack-infra/zuul</a></li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Bugs:</th><td class="field-body"><ul class="first simple">
<li><a class="reference external" href="https://storyboard.openstack.org/#!/project/679">https://storyboard.openstack.org/#!/project/679</a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Resources:</th><td class="field-body"><ul class="first simple">
<li><a class="reference external" href="http://docs.openstack.org/infra/zuul">Zuul Reference Manual</a></li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Chat:</th><td class="field-body"><ul class="first last simple">
<li>#zuul on freenode</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The OpenStack project uses a number of pipelines in Zuul:</p>
<dl class="docutils">
<dt><strong>check</strong></dt>
<dd>Newly uploaded patchsets enter this pipeline to receive an initial
+/-1 Verified vote.</dd>
<dt><strong>gate</strong></dt>
<dd>Changes that have been approved by core developers are enqueued in
order in this pipeline, and if they pass tests, will be merged.</dd>
<dt><strong>post</strong></dt>
<dd>This pipeline runs jobs that operate after each change is merged.</dd>
<dt><strong>pre-release</strong></dt>
<dd>This pipeline runs jobs on projects in response to pre-release tags.</dd>
<dt><strong>release</strong></dt>
<dd>When a commit is tagged as a release, this pipeline runs jobs that
publish archives and documentation.</dd>
<dt><strong>silent</strong></dt>
<dd>This pipeline is used for silently testing new jobs.</dd>
<dt><strong>experimental</strong></dt>
<dd>This pipeline is used for on-demand testing of new jobs.</dd>
<dt><strong>periodic</strong></dt>
<dd>This pipeline has jobs triggered on a timer for e.g. testing for
environmental changes daily.</dd>
</dl>
<p>Zuul watches events in Gerrit (using the Gerrit &#8220;stream-events&#8221;
command) and matches those events to the pipelines above.  If a match
is found, it adds the change to the pipeline and starts running
related jobs.</p>
<p>The <strong>gate</strong> pipeline uses speculative execution to improve
throughput.  Changes are tested in parallel under the assumption that
changes ahead in the queue will merge.  If they do not, Zuul will
abort and restart tests without the affected changes.  This means that
many changes may be tested in parallel while continuing to assure that
each commit is correctly tested.</p>
<p>Zuul&#8217;s current status may be viewed at
<a class="reference external" href="http://status.openstack.org/zuul/">http://status.openstack.org/zuul/</a>.</p>
<p>Zuul&#8217;s configuration is stored in <a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/project-config/tree/zuul/layout.yaml">project-config: zuul/layout.yaml</a>.  Anyone
may propose a change to the configuration by editing that file and
submitting the change to Gerrit for review.</p>
<p>For the full syntax of Zuul&#8217;s configuration file format, see the <a class="reference external" href="http://docs.openstack.org/infra/zuul">Zuul
reference manual</a>.</p>
</div>
<div class="section" id="sysadmin">
<h2>Sysadmin<a class="headerlink" href="#sysadmin" title="Permalink to this headline">¶</a></h2>
<p>Zuul and gear are lightweight - it should be possible to run both on a
1G instance for small deployments. OpenStack&#8217;s deployment requires at
least a 2G instance at the time of writing.</p>
<p>Zuul is stateless, so the server does not need backing up. However
zuul talks through git and ssh so you will need to manually check ssh
host keys as the zuul user. e.g.:</p>
<div class="highlight-python"><pre>sudo su - zuul
ssh -p 29418 review.openstack.org</pre>
</div>
<div class="section" id="restarts">
<h3>Restarts<a class="headerlink" href="#restarts" title="Permalink to this headline">¶</a></h3>
<p>Zuul restarts are disruptive, so non-emergency restarts should always be
scheduled for quieter times of the day, week and cycle. To be as
courteous to developers as possible, just prior to a restart the <a class="reference external" href="http://status.openstack.org/zuul/">Zuul
Status Page</a> should be checked to
see the status of the gate. If there is a series of changes nearly
merged, wait until that has been completed.</p>
<p>Since Zuul is stateless, some work needs to be done to save and then
re-enqueue patches when restarts are done. To accomplish this, start by
running <a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/zuul/tree/tools/zuul-changes.py">zuul-changes.py</a>
to save the check and gate queues:</p>
<div class="highlight-python"><pre>python /opt/zuul/tools/zuul-changes.py http://zuul.openstack.org \
  check &gt;check.sh
python /opt/zuul/tools/zuul-changes.py http://zuul.openstack.org \
  gate &gt;gate.sh</pre>
</div>
<p>These check.sh and gate.sh scripts will be used after the restart to
re-enqueue the changes.</p>
<p>Now use <cite>service zuul stop</cite> to stop zuul and then run ps to make sure
the process has actually stopped, it may take several seconds for it to
finally go away.</p>
<p>With Zuul stopped, delete all the used nodes in nodepool. Wait for one
of each variety to come up before using <cite>service zuul start</cite> to start
zuul again.</p>
<p>Once Zuul is started, run netcat against localhost 4730 port to confirm
that all the node types (particularly the uncommon ones) are registered
with Gearman before re-enqueuing patches. For instance:</p>
<div class="highlight-python"><pre>echo "status" | nc localhost 4730 | grep :centos7</pre>
</div>
<p>When you are satisfied that all the node types have returned, first run
the gate.sh script and then check.sh to re-enqueue the changes from
before the restart:</p>
<div class="highlight-python"><pre>./gate.sh
./check.sh</pre>
</div>
<p>You may watch the <a class="reference external" href="http://status.openstack.org/zuul/">Zuul Status Page</a> to confirm that changes are
returning to the queues.</p>
</div>
<div class="section" id="mergers">
<h3>Mergers<a class="headerlink" href="#mergers" title="Permalink to this headline">¶</a></h3>
<p>Servers with names matching the pattern zm*.openstack.org are Zuul
Mergers.  These are horizontally scalable components of Zuul which
perform git operations for the benefit of jobs.  They serve git
repositories via Apache over http, and jobs fetch changes to test from
them.  They can be started and stopped at will, and new ones added as
necessary to accommodate load.  If you remove a merger, be sure to
leave Apache running for several hours until the last job that may
have been launched with instructions to fetch from that merger has
completed.</p>
</div>
<div class="section" id="launchers">
<h3>Launchers<a class="headerlink" href="#launchers" title="Permalink to this headline">¶</a></h3>
<p>We use an Ansible based launcher in Zuul to actually run jobs.  This
component runs on a horizontally scalable set of servers named
zl*.openstack.org.  It reads job configuration from Jenkins Job
Builder files in the project-config repository and translates that
into Ansible playbooks which it runs on our workers.  Our jobs are
configured to upload as much information as possible along with their
logs, but if there is an error which can not be diagnosed in that
manner, Ansible logs are available in the launcher-debug log file on
the launcher host.  You may use the Zuul build UUID to track
assignment of a given job from the Zuul scheduler to the Zuul launcher
used by that job.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Zuul</a><ul>
<li><a class="reference internal" href="#at-a-glance">At a Glance</a></li>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#sysadmin">Sysadmin</a><ul>
<li><a class="reference internal" href="#restarts">Restarts</a></li>
<li><a class="reference internal" href="#mergers">Mergers</a></li>
<li><a class="reference internal" href="#launchers">Launchers</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="grafyaml.html"
                                  title="previous chapter">Grafyaml</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="jjb.html"
                                  title="next chapter">Jenkins Job Builder</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack-infra/system-config
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/zuul.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="jjb.html" title="Jenkins Job Builder"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="grafyaml.html" title="Grafyaml"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">OpenStack Project Infrastructure 0.0.1.dev12076 documentation</a> &raquo;</li>
          <li><a href="systems.html" accesskey="U">Major Systems</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2012-2014, OpenStack Infastructure Team - see the <a href="https://git.openstack.org/cgit/openstack-infra/system-config/">system-config git repo</a> for details.
      Last updated on Mon Feb 13 23:40:08 2017, commit 91bca8d.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/OpenStack Project Infrastructure");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>