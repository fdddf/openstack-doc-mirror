
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Jeepyb &mdash; OpenStack Project Infrastructure 0.0.1.dev12076 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/tweaks.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1.dev12076',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="OpenStack Project Infrastructure 0.0.1.dev12076 documentation" href="index.html" />
    <link rel="up" title="Major Systems" href="systems.html" />
    <link rel="next" title="IRC Services" href="irc.html" />
    <link rel="prev" title="Nodepool" href="nodepool.html" /> 
  </head>
  <body>
  <div id="header">
    <h1 id="logo"><a href="http://www.openstack.org/">OpenStack</a></h1>
    <ul id="navigation">
      
<li><a href="index.html" title="Go to the Home page" class="link">Home</a></li>
<li><a href="http://wiki.openstack.org/" title="Go to the OpenStack Wiki">Wiki</a></li>
<li><a href="http://review.openstack.org/" title="Go to the OpenStack Gerrit server">Gerrit</a></li>
<li><a href="http://jenkins.openstack.org/" title="Go to the OpenStack Jenkins server">Jenkins</a></li>
<li><a href="http://logstash.openstack.org/" title="Go to the OpenStack Logstash server">Logstash</a></li>
<li><a href="http://etherpad.openstack.org/" title="Go to the OpenStack Etherpad server">Etherpad</a></li>
<li><a href="http://paste.openstack.org/" title="Go to the OpenStack Paste server">Paste</a></li>
<li><a href="http://planet.openstack.org/" title="Go to the OpenStack Planet server">Planet</a></li>
<li><a href="http://lists.openstack.org/" title="Go to the OpenStack Mailman server">Mailman</a></li>

    </ul>
  </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="jeepyb">
<span id="id1"></span><h1>Jeepyb<a class="headerlink" href="#jeepyb" title="Permalink to this headline">¶</a></h1>
<p>Jeepyb is a collection of tools which make managing Gerrit easier.
Specifically, management of Gerrit projects and their associated
upstream integration with things like Github and Launchpad.</p>
<div class="section" id="at-a-glance">
<h2>At a Glance<a class="headerlink" href="#at-a-glance" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Hosts:</th><td class="field-body"><ul class="first simple">
<li><a class="reference external" href="http://review.openstack.org">http://review.openstack.org</a></li>
<li><a class="reference external" href="http://review-dev.openstack.org">http://review-dev.openstack.org</a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Puppet:</th><td class="field-body"><ul class="first simple">
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/puppet-jeepyb/tree/">https://git.openstack.org/cgit/openstack-infra/puppet-jeepyb/tree/</a></li>
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/system-config/tree/modules/openstack_project/manifests/review.pp">system-config: modules/openstack_project/manifests/review.pp</a></li>
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/system-config/tree/modules/openstack_project/manifests/review_dev.pp">system-config: modules/openstack_project/manifests/review_dev.pp</a></li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Configuration:</th><td class="field-body"><ul class="first simple">
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/system-config/tree/modules/openstack_project/templates/review.projects.ini.erb">system-config: modules/openstack_project/templates/review.projects.ini.erb</a></li>
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/project-config/tree/gerrit/projects.yaml">project-config: gerrit/projects.yaml</a></li>
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/system-config/tree/modules/openstack_project/files/pypi-mirror.yaml">system-config: modules/openstack_project/files/pypi-mirror.yaml</a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Projects:</th><td class="field-body"><ul class="first simple">
<li><a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/jeepyb">https://git.openstack.org/cgit/openstack-infra/jeepyb</a></li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Bugs:</th><td class="field-body"><ul class="first last simple">
<li><a class="reference external" href="https://storyboard.openstack.org/#!/project/722">https://storyboard.openstack.org/#!/project/722</a></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="gerrit-project-configuration">
<h2>Gerrit Project Configuration<a class="headerlink" href="#gerrit-project-configuration" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">manage-projects</span></tt> command in Jeepyb is able to create a new
project in Gerrit, create the new project on Github, create a local
git replica on the Gerrit host, configure the project Access Controls,
and create new groups in Gerrit.</p>
<p>The global configuration data needed for <tt class="docutils literal"><span class="pre">manage-projects</span></tt> to know how to
connect to things or how to operate is in
<a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/system-config/tree/modules/openstack_project/templates/review.projects.ini.erb">system-config: modules/openstack_project/templates/review.projects.ini.erb</a>.</p>
<ol class="arabic">
<li><p class="first">Config values:</p>
<div class="highlight-python"><pre>[projects]
homepage=http://example.org
local-git-dir=/var/lib/git
gerrit-host=review.example.org
gerrit-user=example-project-creator
gerrit-key=/home/gerrit2/.ssh/example_project_id_rsa
github-config=/etc/github/github-projects.secure.config
has-wiki=False
has-issues=False
has-pull-requests=False
has-downloads=False</pre>
</div>
</li>
</ol>
<p>OpenStack Gerrit projects are configured in the
<a class="reference external" href="https://git.openstack.org/cgit/openstack-infra/project-config/tree/gerrit/projects.yaml">project-config: gerrit/projects.yaml</a>.  file.  When this file is updated,
<tt class="docutils literal"><span class="pre">manage-projects</span></tt> is run automatically.</p>
<ol class="arabic">
<li><p class="first">Project definition:</p>
<div class="highlight-python"><pre>- project: example/gerrit
  description: Fork of Gerrit used by Example
  remote: https://gerrit.googlesource.com/gerrit
- project: example/project1
  description: Best project ever.
  has-wiki: True
  acl-config: /path/to/acl/file</pre>
</div>
</li>
</ol>
<p>The above config gives puppet and its related scripts enough
information to create new projects, but not enough to add access
controls to each project. To add access control you need to have an
<tt class="docutils literal"><span class="pre">acl-config</span></tt> option for the project in <tt class="docutils literal"><span class="pre">projects.yaml</span></tt>. That
option should have a value that is a path to the <tt class="docutils literal"><span class="pre">project.config</span></tt>
for that project.</p>
<p>That is the high level view of how we can configure projects using the
pupppet repository. To create an actual change that does all of this for
a single project you will want to do the following:</p>
<ol class="arabic">
<li><p class="first">Add a <tt class="docutils literal"><span class="pre">gerrit/acls/organization/project-name.config</span></tt> file to the
<tt class="docutils literal"><span class="pre">project-config</span></tt> repo. The contents will probably end up looking like
the block below (note that the sections are in alphabetical order):</p>
<div class="highlight-python"><pre>[access "refs/heads/*"]
label-Code-Review = -2..+2 group project-name-core
label-Workflow = -1..+1 group project-name-core

[receive]
requireChangeId = true
requireContributorAgreement = true

[submit]
mergeContent = true</pre>
</div>
</li>
<li><p class="first">Add a project entry for the project in <tt class="docutils literal"><span class="pre">gerrit/projects.yaml</span></tt> in
the <tt class="docutils literal"><span class="pre">project-config</span></tt> repo.:</p>
<div class="highlight-python"><pre>- project: organization/project-name
  acl-config: /home/gerrit2/acls/organization/project-name.config</pre>
</div>
</li>
<li><p class="first">If there is an existing repo that is being replaced by this new
project you can set the upstream value for the project. When an
upstream is set, that upstream will be cloned and pushed into Gerrit
instead of an empty repository. eg:</p>
<div class="highlight-python"><pre>- project: organization/project-name
  acl-config: /home/gerrit2/acls/organization/project-name.config
  upstream: git://github.com/awesumsauce/project-name.git</pre>
</div>
</li>
</ol>
<p>That is all you need to do. Push the change to gerrit and if necessary
modify group membership for the groups you configured in the
<tt class="docutils literal"><span class="pre">project.config</span></tt> through Launchpad.</p>
</div>
<div class="section" id="commit-hooks">
<h2>Commit Hooks<a class="headerlink" href="#commit-hooks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="launchpad-bug-integration">
<h3>Launchpad Bug Integration<a class="headerlink" href="#launchpad-bug-integration" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">update-bug</span></tt> Jeepyb command is installed as a Gerrit commit hook
so that it runs each time a patchset is created.  It updates Launchpad
bugs based on information that it finds in the commit message.  It
also contains a manual mapping of Gerrit to Launchpad project names
for projects that use a different Launchpad project for their bugs.</p>
</div>
<div class="section" id="launchpad-blueprint-integration">
<h3>Launchpad Blueprint Integration<a class="headerlink" href="#launchpad-blueprint-integration" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">update-blueprint</span></tt> Jeepyb command is installed as a Gerrit
commit hook so that it runs each time a patchset is created.  It
updates Launchpad blueprints based on information that it finds in the
commit message.</p>
</div>
<div class="section" id="impact-notification">
<h3>Impact Notification<a class="headerlink" href="#impact-notification" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">notify-impact</span></tt> commit hook runs when new patchsets are created
and sends email notifications when certain regular expressions are
matched, such as:</p>
<ul class="simple">
<li>DocImpact</li>
<li>SecurityImpact</li>
</ul>
</div>
<div class="section" id="trivial-rebase-hook">
<h3>Trivial Rebase Hook<a class="headerlink" href="#trivial-rebase-hook" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">trivial-rebase</span></tt> commit hook runs when new patchsets are
uploaded and detects whether the new patchset is merely a rebase onto
a new parent, or is a substantial change.  If it is a rebase, it
restores previous review votes and leaves a comment in Gerrit.  It
uses Gerrit&#8217;s own SSH host key as the private key for access in order
to gain the &#8220;superuser&#8221; permissions needed to impersonate other users
in reviews.</p>
</div>
</div>
<div class="section" id="periodic-tasks">
<h2>Periodic Tasks<a class="headerlink" href="#periodic-tasks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="closing-github-pull-requests">
<h3>Closing Github Pull Requests<a class="headerlink" href="#closing-github-pull-requests" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">close-pull-requests</span></tt> Jeepyb command is installed as a cron job
and periodically closes all pull requests for projects so configured
in projects.yaml.</p>
</div>
<div class="section" id="expiring-old-reviews">
<h3>Expiring Old Reviews<a class="headerlink" href="#expiring-old-reviews" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">expire-old-reviews</span></tt> Jeepyb command is installed as a cron job
that periodically marks reviews that have seen little activity as
<cite>Abandoned</cite>.  Their owners may use the Gerrit interface to restore
them when they are ready for further review.</p>
</div>
<div class="section" id="manage-projects">
<h3>Manage Projects<a class="headerlink" href="#manage-projects" title="Permalink to this headline">¶</a></h3>
<p>Some projects may have upstreams defined in Jeepyb; the
<tt class="docutils literal"><span class="pre">manage-projects</span></tt> cron job will update these remotes so that their
commits are available in Gerrit. It will also ensure that project metadata
is set up as defined in projects.yaml.</p>
</div>
<div class="section" id="rss-feeds">
<h3>RSS feeds<a class="headerlink" href="#rss-feeds" title="Permalink to this headline">¶</a></h3>
<p>Jeepyb&#8217;s <tt class="docutils literal"><span class="pre">openstackwatch</span></tt> command publishes RSS feeds of Gerrit
projects.</p>
</div>
<div class="section" id="pypi-mirror">
<h3>Pypi Mirror<a class="headerlink" href="#pypi-mirror" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">run-mirror</span></tt> command builds a full Pypi mirror for a project or
set of projects by reading a requirements.txt file, installing all
listed dependencies into a virtualenv, inspecting the resulting
installed package set, and then downloading all of the second-level
(and further) dependencies.  Essentially, the mirror is built by
introspection and contains the full set of depedencies needed whether
they are explicitly listed or not.</p>
</div>
<div class="section" id="admin-tasks">
<h3>Admin tasks<a class="headerlink" href="#admin-tasks" title="Permalink to this headline">¶</a></h3>
<p>Jeepyb needs to run with the same ssh key registered with gerrit and github
(and any other ssh services it may be pointed at). Be sure to add your public
key when creating accounts.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
<div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Jeepyb</a><ul>
<li><a class="reference internal" href="#at-a-glance">At a Glance</a></li>
<li><a class="reference internal" href="#gerrit-project-configuration">Gerrit Project Configuration</a></li>
<li><a class="reference internal" href="#commit-hooks">Commit Hooks</a><ul>
<li><a class="reference internal" href="#launchpad-bug-integration">Launchpad Bug Integration</a></li>
<li><a class="reference internal" href="#launchpad-blueprint-integration">Launchpad Blueprint Integration</a></li>
<li><a class="reference internal" href="#impact-notification">Impact Notification</a></li>
<li><a class="reference internal" href="#trivial-rebase-hook">Trivial Rebase Hook</a></li>
</ul>
</li>
<li><a class="reference internal" href="#periodic-tasks">Periodic Tasks</a><ul>
<li><a class="reference internal" href="#closing-github-pull-requests">Closing Github Pull Requests</a></li>
<li><a class="reference internal" href="#expiring-old-reviews">Expiring Old Reviews</a></li>
<li><a class="reference internal" href="#manage-projects">Manage Projects</a></li>
<li><a class="reference internal" href="#rss-feeds">RSS feeds</a></li>
<li><a class="reference internal" href="#pypi-mirror">Pypi Mirror</a></li>
<li><a class="reference internal" href="#admin-tasks">Admin tasks</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="nodepool.html"
                                  title="previous chapter">Nodepool</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="irc.html"
                                  title="next chapter">IRC Services</a></p>
            <h3>Project Source</h3>
            <ul class="this-page-menu">
              <li><a href="http://git.openstack.org/cgit/openstack-infra/system-config
"
                     rel="nofollow">Project Source</a></li>
            </ul>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/jeepyb.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
</div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="irc.html" title="IRC Services"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="nodepool.html" title="Nodepool"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">OpenStack Project Infrastructure 0.0.1.dev12076 documentation</a> &raquo;</li>
          <li><a href="systems.html" accesskey="U">Major Systems</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2012-2014, OpenStack Infastructure Team - see the <a href="https://git.openstack.org/cgit/openstack-infra/system-config/">system-config git repo</a> for details.
      Last updated on Mon Feb 13 23:40:08 2017, commit 91bca8d.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
//Tracking docs.openstack.org/developer/<projectname> only
//The URL is built from the project variable in conf.py
var pageTracker = _gat._getTracker("UA-17511903-1");
pageTracker._setCookiePath("/developer/OpenStack Project Infrastructure");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>