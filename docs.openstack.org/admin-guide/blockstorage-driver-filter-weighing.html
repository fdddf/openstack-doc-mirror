<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Configure and use driver filter and weighing for scheduler</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">
<link href="_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Configure and use driver filter and weighing for scheduler</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="blockstorage-consistency-groups.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Consistency groups"></i></a>
    
    
    <a href="blockstorage-ratelimit-volume-copy-bandwidth.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Rate-limit volume copy bandwidth"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2017-02-14 13:52</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Configure and use driver filter and weighing for scheduler</a><ul>
<li><a class="reference internal" href="#what-is-driver-filter-and-weigher-and-when-to-use-it">What is driver filter and weigher and when to use it</a></li>
<li><a class="reference internal" href="#enable-driver-filter-and-weighing">Enable driver filter and weighing</a></li>
<li><a class="reference internal" href="#defining-your-own-filter-and-goodness-functions">Defining your own filter and goodness functions</a></li>
<li><a class="reference internal" href="#supported-operations-in-filter-and-goodness-functions">Supported operations in filter and goodness functions</a></li>
<li><a class="reference internal" href="#available-properties-when-creating-custom-functions">Available properties when creating custom functions</a><ul>
<li><a class="reference internal" href="#host-stats-for-a-back-end">Host stats for a back end</a></li>
<li><a class="reference internal" href="#capabilities-specific-to-a-back-end">Capabilities specific to a back end</a></li>
<li><a class="reference internal" href="#requested-volume-properties">Requested volume properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extra-specs-for-the-requested-volume-type">Extra specs for the requested volume type</a></li>
<li><a class="reference internal" href="#current-qos-specs-for-the-requested-volume-type">Current QoS specs for the requested volume type</a></li>
<li><a class="reference internal" href="#driver-filter-and-weigher-usage-examples">Driver filter and weigher usage examples</a></li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="configure-and-use-driver-filter-and-weighing-for-scheduler">
<span id="filter-weigh-scheduler"></span><h1>Configure and use driver filter and weighing for scheduler<a class="headerlink" href="#configure-and-use-driver-filter-and-weighing-for-scheduler" title="Permalink to this headline">¶</a></h1>
<p>OpenStack Block Storage enables you to choose a volume back end based on
back-end specific properties by using the DriverFilter and
GoodnessWeigher for the scheduler. The driver filter and weigher
scheduling can help ensure that the scheduler chooses the best back end
based on requested volume properties as well as various back-end
specific properties.</p>
<div class="section" id="what-is-driver-filter-and-weigher-and-when-to-use-it">
<h2>What is driver filter and weigher and when to use it<a class="headerlink" href="#what-is-driver-filter-and-weigher-and-when-to-use-it" title="Permalink to this headline">¶</a></h2>
<p>The driver filter and weigher gives you the ability to more finely
control how the OpenStack Block Storage scheduler chooses the best back
end to use when handling a volume request. One example scenario where
using the driver filter and weigher can be if a back end that utilizes
thin-provisioning is used. The default filters use the <code class="docutils literal"><span class="pre">free</span> <span class="pre">capacity</span></code>
property to determine the best back end, but that is not always perfect.
If a back end has the ability to provide a more accurate back-end
specific value you can use that as part of the weighing. Another example
of when the driver filter and weigher can prove useful is if a back end
exists where there is a hard limit of 1000 volumes. The maximum volume
size is 500&nbsp;GB. Once 75% of the total space is occupied the performance
of the back end degrades. The driver filter and weigher can provide a
way for these limits to be checked for.</p>
</div>
<div class="section" id="enable-driver-filter-and-weighing">
<h2>Enable driver filter and weighing<a class="headerlink" href="#enable-driver-filter-and-weighing" title="Permalink to this headline">¶</a></h2>
<p>To enable the driver filter, set the <code class="docutils literal"><span class="pre">scheduler_default_filters</span></code> option in
the <code class="docutils literal"><span class="pre">cinder.conf</span></code> file to <code class="docutils literal"><span class="pre">DriverFilter</span></code> or add it to the list if
other filters are already present.</p>
<p>To enable the goodness filter as a weigher, set the
<code class="docutils literal"><span class="pre">scheduler_default_weighers</span></code> option in the <code class="docutils literal"><span class="pre">cinder.conf</span></code> file to
<code class="docutils literal"><span class="pre">GoodnessWeigher</span></code> or add it to the list if other weighers are already
present.</p>
<p>You can choose to use the <code class="docutils literal"><span class="pre">DriverFilter</span></code> without the
<code class="docutils literal"><span class="pre">GoodnessWeigher</span></code> or vice-versa. The filter and weigher working
together, however, create the most benefits when helping the scheduler
choose an ideal back end.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The support for the <code class="docutils literal"><span class="pre">DriverFilter</span></code> and <code class="docutils literal"><span class="pre">GoodnessWeigher</span></code> is
optional for back ends. If you are using a back end that does not
support the filter and weigher functionality you may not get the
full benefit.</p>
</div>
<p>Example <code class="docutils literal"><span class="pre">cinder.conf</span></code> configuration file:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="na">scheduler_default_filters</span> <span class="o">=</span> <span class="s">DriverFilter</span>
<span class="na">scheduler_default_weighers</span> <span class="o">=</span> <span class="s">GoodnessWeigher</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is useful to use the other filters and weighers available in
OpenStack in combination with these custom ones. For example, the
<code class="docutils literal"><span class="pre">CapacityFilter</span></code> and <code class="docutils literal"><span class="pre">CapacityWeigher</span></code> can be combined with
these.</p>
</div>
</div>
<div class="section" id="defining-your-own-filter-and-goodness-functions">
<h2>Defining your own filter and goodness functions<a class="headerlink" href="#defining-your-own-filter-and-goodness-functions" title="Permalink to this headline">¶</a></h2>
<p>You can define your own filter and goodness functions through the use of
various properties that OpenStack Block Storage has exposed. Properties
exposed include information about the volume request being made,
<code class="docutils literal"><span class="pre">volume_type</span></code> settings, and back-end specific information about drivers.
All of these allow for a lot of control over how the ideal back end for
a volume request will be decided.</p>
<p>The <code class="docutils literal"><span class="pre">filter_function</span></code> option is a string defining an equation that
will determine whether a back end should be considered as a potential
candidate in the scheduler.</p>
<p>The <code class="docutils literal"><span class="pre">goodness_function</span></code> option is a string defining an equation that
will rate the quality of the potential host (0 to 100, 0 lowest, 100
highest).</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The drive filter and weigher will use default values for filter and
goodness functions for each back end if you do not define them
yourself. If complete control is desired then a filter and goodness
function should be defined for each of the back ends in
the <code class="docutils literal"><span class="pre">cinder.conf</span></code> file.</p>
</div>
</div>
<div class="section" id="supported-operations-in-filter-and-goodness-functions">
<h2>Supported operations in filter and goodness functions<a class="headerlink" href="#supported-operations-in-filter-and-goodness-functions" title="Permalink to this headline">¶</a></h2>
<p>Below is a table of all the operations currently usable in custom filter
and goodness functions created by you:</p>
<table border="1" class="docutils">
<colgroup>
<col width="56%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operations</th>
<th class="head">Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>+, -, *, /, ^</td>
<td>standard math</td>
</tr>
<tr class="row-odd"><td>not, and, or, &amp;, |, !</td>
<td>logic</td>
</tr>
<tr class="row-even"><td>&gt;, &gt;=, &lt;, &lt;=, ==, &lt;&gt;, !=</td>
<td>equality</td>
</tr>
<tr class="row-odd"><td>+, -</td>
<td>sign</td>
</tr>
<tr class="row-even"><td>x ? a : b</td>
<td>ternary</td>
</tr>
<tr class="row-odd"><td>abs(x), max(x, y), min(x, y)</td>
<td>math helper functions</td>
</tr>
</tbody>
</table>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Syntax errors you define in filter or goodness strings
are thrown at a volume request time.</p>
</div>
</div>
<div class="section" id="available-properties-when-creating-custom-functions">
<h2>Available properties when creating custom functions<a class="headerlink" href="#available-properties-when-creating-custom-functions" title="Permalink to this headline">¶</a></h2>
<p>There are various properties that can be used in either the
<code class="docutils literal"><span class="pre">filter_function</span></code> or the <code class="docutils literal"><span class="pre">goodness_function</span></code> strings. The properties allow
access to volume info, qos settings, extra specs, and so on.</p>
<p>The following properties and their sub-properties are currently
available for use:</p>
<div class="section" id="host-stats-for-a-back-end">
<h3>Host stats for a back end<a class="headerlink" href="#host-stats-for-a-back-end" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>host</dt>
<dd>The host&#8217;s name</dd>
<dt>volume_backend_name</dt>
<dd>The volume back end name</dd>
<dt>vendor_name</dt>
<dd>The vendor name</dd>
<dt>driver_version</dt>
<dd>The driver version</dd>
<dt>storage_protocol</dt>
<dd>The storage protocol</dd>
<dt>QoS_support</dt>
<dd>Boolean signifying whether QoS is supported</dd>
<dt>total_capacity_gb</dt>
<dd>The total capacity in GB</dd>
<dt>allocated_capacity_gb</dt>
<dd>The allocated capacity in GB</dd>
<dt>reserved_percentage</dt>
<dd>The reserved storage percentage</dd>
</dl>
</div>
<div class="section" id="capabilities-specific-to-a-back-end">
<h3>Capabilities specific to a back end<a class="headerlink" href="#capabilities-specific-to-a-back-end" title="Permalink to this headline">¶</a></h3>
<p>These properties are determined by the specific back end
you are creating filter and goodness functions for. Some back ends
may not have any properties available here.</p>
</div>
<div class="section" id="requested-volume-properties">
<h3>Requested volume properties<a class="headerlink" href="#requested-volume-properties" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>status</dt>
<dd>Status for the requested volume</dd>
<dt>volume_type_id</dt>
<dd>The volume type ID</dd>
<dt>display_name</dt>
<dd>The display name of the volume</dd>
<dt>volume_metadata</dt>
<dd>Any metadata the volume has</dd>
<dt>reservations</dt>
<dd>Any reservations the volume has</dd>
<dt>user_id</dt>
<dd>The volume&#8217;s user ID</dd>
<dt>attach_status</dt>
<dd>The attach status for the volume</dd>
<dt>display_description</dt>
<dd>The volume&#8217;s display description</dd>
<dt>id</dt>
<dd>The volume&#8217;s ID</dd>
<dt>replication_status</dt>
<dd>The volume&#8217;s replication status</dd>
<dt>snapshot_id</dt>
<dd>The volume&#8217;s snapshot ID</dd>
<dt>encryption_key_id</dt>
<dd>The volume&#8217;s encryption key ID</dd>
<dt>source_volid</dt>
<dd>The source volume ID</dd>
<dt>volume_admin_metadata</dt>
<dd>Any admin metadata for this volume</dd>
<dt>source_replicaid</dt>
<dd>The source replication ID</dd>
<dt>consistencygroup_id</dt>
<dd>The consistency group ID</dd>
<dt>size</dt>
<dd>The size of the volume in GB</dd>
<dt>metadata</dt>
<dd>General metadata</dd>
</dl>
<p>The property most used from here will most likely be the <code class="docutils literal"><span class="pre">size</span></code> sub-property.</p>
</div>
</div>
<div class="section" id="extra-specs-for-the-requested-volume-type">
<h2>Extra specs for the requested volume type<a class="headerlink" href="#extra-specs-for-the-requested-volume-type" title="Permalink to this headline">¶</a></h2>
<p>View the available properties for volume types by running:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> cinder extra-specs-list
</pre></div>
</div>
</div>
<div class="section" id="current-qos-specs-for-the-requested-volume-type">
<h2>Current QoS specs for the requested volume type<a class="headerlink" href="#current-qos-specs-for-the-requested-volume-type" title="Permalink to this headline">¶</a></h2>
<p>View the available properties for volume types by running:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> cinder qos-list
</pre></div>
</div>
<p>In order to access these properties in a custom string use the following
format:</p>
<p><code class="docutils literal"><span class="pre">&lt;property&gt;.&lt;sub_property&gt;</span></code></p>
</div>
<div class="section" id="driver-filter-and-weigher-usage-examples">
<h2>Driver filter and weigher usage examples<a class="headerlink" href="#driver-filter-and-weigher-usage-examples" title="Permalink to this headline">¶</a></h2>
<p>Below are examples for using the filter and weigher separately,
together, and using driver-specific properties.</p>
<p>Example <code class="docutils literal"><span class="pre">cinder.conf</span></code> file configuration for customizing the filter
function:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[default]</span>
<span class="na">scheduler_default_filters</span> <span class="o">=</span> <span class="s">DriverFilter</span>
<span class="na">enabled_backends</span> <span class="o">=</span> <span class="s">lvm-1, lvm-2</span>

<span class="k">[lvm-1]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.lvm.LVMVolumeDriver</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">sample_LVM</span>
<span class="na">filter_function</span> <span class="o">=</span> <span class="s">&quot;volume.size &lt; 10&quot;</span>

<span class="k">[lvm-2]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.lvm.LVMVolumeDriver</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">sample_LVM</span>
<span class="na">filter_function</span> <span class="o">=</span> <span class="s">&quot;volume.size &gt;= 10&quot;</span>
</pre></div>
</div>
<p>The above example will filter volumes to different back ends depending
on the size of the requested volume. Default OpenStack Block Storage
scheduler weighing is done. Volumes with a size less than 10&nbsp;GB are sent
to lvm-1 and volumes with a size greater than or equal to 10&nbsp;GB are sent
to lvm-2.</p>
<p>Example <code class="docutils literal"><span class="pre">cinder.conf</span></code> file configuration for customizing the goodness
function:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[default]</span>
<span class="na">scheduler_default_weighers</span> <span class="o">=</span> <span class="s">GoodnessWeigher</span>
<span class="na">enabled_backends</span> <span class="o">=</span> <span class="s">lvm-1, lvm-2</span>

<span class="k">[lvm-1]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.lvm.LVMVolumeDriver</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">sample_LVM</span>
<span class="na">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(volume.size &lt; 5) ? 100 : 50&quot;</span>

<span class="k">[lvm-2]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.lvm.LVMVolumeDriver</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">sample_LVM</span>
<span class="na">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(volume.size &gt;= 5) ? 100 : 25&quot;</span>
</pre></div>
</div>
<p>The above example will determine the goodness rating of a back end based
off of the requested volume&#8217;s size. Default OpenStack Block Storage
scheduler filtering is done. The example shows how the ternary if
statement can be used in a filter or goodness function. If a requested
volume is of size 10&nbsp;GB then lvm-1 is rated as 50 and lvm-2 is rated as
100. In this case lvm-2 wins. If a requested volume is of size 3&nbsp;GB then
lvm-1 is rated 100 and lvm-2 is rated 25. In this case lvm-1 would win.</p>
<p>Example <code class="docutils literal"><span class="pre">cinder.conf</span></code> file configuration for customizing both the
filter and goodness functions:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[default]</span>
<span class="na">scheduler_default_filters</span> <span class="o">=</span> <span class="s">DriverFilter</span>
<span class="na">scheduler_default_weighers</span> <span class="o">=</span> <span class="s">GoodnessWeigher</span>
<span class="na">enabled_backends</span> <span class="o">=</span> <span class="s">lvm-1, lvm-2</span>

<span class="k">[lvm-1]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.lvm.LVMVolumeDriver</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">sample_LVM</span>
<span class="na">filter_function</span> <span class="o">=</span> <span class="s">&quot;stats.total_capacity_gb &lt; 500&quot;</span>
<span class="na">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(volume.size &lt; 25) ? 100 : 50&quot;</span>

<span class="k">[lvm-2]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.lvm.LVMVolumeDriver</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">sample_LVM</span>
<span class="na">filter_function</span> <span class="o">=</span> <span class="s">&quot;stats.total_capacity_gb &gt;= 500&quot;</span>
<span class="na">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(volume.size &gt;= 25) ? 100 : 75&quot;</span>
</pre></div>
</div>
<p>The above example combines the techniques from the first two examples.
The best back end is now decided based off of the total capacity of the
back end and the requested volume&#8217;s size.</p>
<p>Example <code class="docutils literal"><span class="pre">cinder.conf</span></code> file configuration for accessing driver specific
properties:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[default]</span>
<span class="na">scheduler_default_filters</span> <span class="o">=</span> <span class="s">DriverFilter</span>
<span class="na">scheduler_default_weighers</span> <span class="o">=</span> <span class="s">GoodnessWeigher</span>
<span class="na">enabled_backends</span> <span class="o">=</span> <span class="s">lvm-1,lvm-2,lvm-3</span>

<span class="k">[lvm-1]</span>
<span class="na">volume_group</span> <span class="o">=</span> <span class="s">stack-volumes-lvmdriver-1</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.lvm.LVMVolumeDriver</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">lvmdriver-1</span>
<span class="na">filter_function</span> <span class="o">=</span> <span class="s">&quot;volume.size &lt; 5&quot;</span>
<span class="na">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(capabilities.total_volumes &lt; 3) ? 100 : 50&quot;</span>

<span class="k">[lvm-2]</span>
<span class="na">volume_group</span> <span class="o">=</span> <span class="s">stack-volumes-lvmdriver-2</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.lvm.LVMVolumeDriver</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">lvmdriver-2</span>
<span class="na">filter_function</span> <span class="o">=</span> <span class="s">&quot;volumes.size &lt; 5&quot;</span>
<span class="na">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(capabilities.total_volumes &lt; 8) ? 100 : 50&quot;</span>

<span class="k">[lvm-3]</span>
<span class="na">volume_group</span> <span class="o">=</span> <span class="s">stack-volumes-lvmdriver-3</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.LVMVolumeDriver</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">lvmdriver-3</span>
<span class="na">goodness_function</span> <span class="o">=</span> <span class="s">&quot;55&quot;</span>
</pre></div>
</div>
<p>The above is an example of how back-end specific properties can be used
in the filter and goodness functions. In this example the LVM driver&#8217;s
<code class="docutils literal"><span class="pre">total_volumes</span></code> capability is being used to determine which host gets
used during a volume request. In the above example, lvm-1 and lvm-2 will
handle volume requests for all volumes with a size less than 5&nbsp;GB. The
lvm-1 host will have priority until it contains three or more volumes.
After than lvm-2 will have priority until it contains eight or more
volumes. The lvm-3 will collect all volumes greater or equal to 5&nbsp;GB as
well as all volumes once lvm-1 and lvm-2 lose priority.</p>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="blockstorage-consistency-groups.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Consistency groups"></i></a>
          
          
            <a href="blockstorage-ratelimit-volume-copy-bandwidth.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Rate-limit volume copy bandwidth"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2017-02-14 13:52</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/get-started-with-openstack.html">Get started with OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="identity-management.html">Identity management</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="compute.html">Compute</a></li>
<li class="toctree-l1"><a class="reference internal" href="objectstorage.html">Object Storage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="blockstorage.html">Block Storage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="blockstorage-api-throughput.html">Increase Block Storage API service throughput</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="blockstorage-manage-volumes.html">Manage volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="blockstorage-troubleshoot.html">Troubleshoot your installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="shared-file-systems.html">Shared File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="telemetry.html">Telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="baremetal.html">Bare Metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestration.html">Orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">OpenStack command-line clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross-project.html">Cross-project features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="firewalls-default-ports.html">Firewalls and default ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/app-support.html">Community support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "blockstorage-driver-filter-weighing" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/openstack-manuals/tree/doc/admin-guide/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 3993c81360ea23a2e599faf5f3de0d288b10c20a";
        var bugProject = "openstack-manuals";
        var bugTitle = "Configure and use driver filter and weighing for scheduler in Administrator Guide";
    var fieldTags = "admin-guide";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.9 on 2017-02-14 13:52";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>