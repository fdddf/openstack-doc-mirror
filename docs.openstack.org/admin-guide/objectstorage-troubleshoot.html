<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Troubleshoot Object Storage</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">
<link href="_static/css/styles.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>
<nav class="navbar navbar-default inner" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
        <div id="gcse">
          <script type="text/javascript">
(function() {
  var cx = '000108871792296872333:noj9nikm74i';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//www.google.com/cse/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();
          </script>
          <gcse:search gname="standard"></gcse:search>
        </div>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
          <div id="gcse-mobile">
            <gcse:search gname="mobile"></gcse:search>
          </div>
        </li>
        <li>
          <a href="http://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/project-navigator/">Project Navigator</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/security/">Security</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/roadmap/">Roadmap</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/latest-release/">Latest Release</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/software/sourcecode/">Source Code</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/user-stories/" class="drop" id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/telecoms-and-nfv/">Telecoms and NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/enterprise/">OpenStack in the Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/appdev/">Application Developers & ISVs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org/">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/">OpenStack Foundation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://groups.openstack.org">User Groups</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/foundation/companies/">Supporting Companies</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/join/">Join The Community</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/marketplace/">Marketplace</a>
        </li>
        <li>
          <a href="http://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">The OpenStack Summit</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More OpenStack Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/community/events/#openstack_days">OpenStack Days</a></li>
          </ul>
        </li>
        <li>
          <a href="http://www.openstack.org/learn/" class="drop" id="dropdownMenuLearn">Learn <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/coa/">Get Certified</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//ask.openstack.org">Ask a Technical Question</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="//superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/analysts/">Analyst Reports</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/news/">News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.openstack.org/blog/">Blog</a></li>
          </ul>
        </li>
        <li>
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Troubleshoot Object Storage</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="objectstorage-admin.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: System administration for Object Storage"></i></a>
    
    
    <a href="blockstorage.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Block Storage"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2017-02-14 08:39</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Troubleshoot Object Storage</a><ul>
<li><a class="reference internal" href="#drive-failure">Drive failure</a><ul>
<li><a class="reference internal" href="#problem">Problem</a></li>
<li><a class="reference internal" href="#solution">Solution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#server-failure">Server failure</a><ul>
<li><a class="reference internal" href="#id1">Problem</a></li>
<li><a class="reference internal" href="#id2">Solution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#detect-failed-drives">Detect failed drives</a><ul>
<li><a class="reference internal" href="#id3">Problem</a></li>
<li><a class="reference internal" href="#id4">Solution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#emergency-recovery-of-ring-builder-files">Emergency recovery of ring builder files</a><ul>
<li><a class="reference internal" href="#id5">Problem</a></li>
<li><a class="reference internal" href="#id6">Solution</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="troubleshoot-object-storage">
<h1>Troubleshoot Object Storage<a class="headerlink" href="#troubleshoot-object-storage" title="Permalink to this headline">¶</a></h1>
<p>For Object Storage, everything is logged in <code class="docutils literal"><span class="pre">/var/log/syslog</span></code> (or
<code class="docutils literal"><span class="pre">messages</span></code> on some distros). Several settings enable further
customization of logging, such as <code class="docutils literal"><span class="pre">log_name</span></code>, <code class="docutils literal"><span class="pre">log_facility</span></code>, and
<code class="docutils literal"><span class="pre">log_level</span></code>, within the object server configuration files.</p>
<div class="section" id="drive-failure">
<h2>Drive failure<a class="headerlink" href="#drive-failure" title="Permalink to this headline">¶</a></h2>
<div class="section" id="problem">
<h3>Problem<a class="headerlink" href="#problem" title="Permalink to this headline">¶</a></h3>
<p>Drive failure can prevent Object Storage performing replication.</p>
</div>
<div class="section" id="solution">
<h3>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">¶</a></h3>
<p>In the event that a drive has failed, the first step is to make sure the
drive is unmounted. This will make it easier for Object Storage to work
around the failure until it has been resolved. If the drive is going to
be replaced immediately, then it is just best to replace the drive,
format it, remount it, and let replication fill it up.</p>
<p>If you cannot replace the drive immediately, then it is best to leave it
unmounted, and remove the drive from the ring. This will allow all the
replicas that were on that drive to be replicated elsewhere until the
drive is replaced. Once the drive is replaced, it can be re-added to the
ring.</p>
<p>You can look at error messages in the <code class="docutils literal"><span class="pre">/var/log/kern.log</span></code> file for
hints of drive failure.</p>
</div>
</div>
<div class="section" id="server-failure">
<h2>Server failure<a class="headerlink" href="#server-failure" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Problem<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The server is potentially offline, and may have failed, or require a
reboot.</p>
</div>
<div class="section" id="id2">
<h3>Solution<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>If a server is having hardware issues, it is a good idea to make sure
the Object Storage services are not running. This will allow Object
Storage to work around the failure while you troubleshoot.</p>
<p>If the server just needs a reboot, or a small amount of work that should
only last a couple of hours, then it is probably best to let Object
Storage work around the failure and get the machine fixed and back
online. When the machine comes back online, replication will make sure
that anything that is missing during the downtime will get updated.</p>
<p>If the server has more serious issues, then it is probably best to
remove all of the server&#8217;s devices from the ring. Once the server has
been repaired and is back online, the server&#8217;s devices can be added back
into the ring. It is important that the devices are reformatted before
putting them back into the ring as it is likely to be responsible for a
different set of partitions than before.</p>
</div>
</div>
<div class="section" id="detect-failed-drives">
<h2>Detect failed drives<a class="headerlink" href="#detect-failed-drives" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Problem<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>When drives fail, it can be difficult to detect that a drive has failed,
and the details of the failure.</p>
</div>
<div class="section" id="id4">
<h3>Solution<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>It has been our experience that when a drive is about to fail, error
messages appear in the <code class="docutils literal"><span class="pre">/var/log/kern.log</span></code> file. There is a script called
<code class="docutils literal"><span class="pre">swift-drive-audit</span></code> that can be run via cron to watch for bad drives. If
errors are detected, it will unmount the bad drive, so that Object
Storage can work around it. The script takes a configuration file with
the following settings:</p>
<table border="1" class="docutils" id="id7">
<caption><span class="caption-text"><strong>Description of configuration options for [drive-audit] in drive-audit.conf</strong></span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Configuration option = Default value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">device_dir</span> <span class="pre">=</span> <span class="pre">/srv/node</span></code></td>
<td>Directory devices are mounted under</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">error_limit</span> <span class="pre">=</span> <span class="pre">1</span></code></td>
<td>Number of errors to find before a device is unmounted</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">log_address</span> <span class="pre">=</span> <span class="pre">/dev/log</span></code></td>
<td>Location where syslog sends the logs to</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">log_facility</span> <span class="pre">=</span> <span class="pre">LOG_LOCAL0</span></code></td>
<td>Syslog log facility</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">log_file_pattern</span> <span class="pre">=</span> <span class="pre">/var/log/kern.*[!.][!g][!z]</span></code></td>
<td>Location of the log file with globbing pattern to check against device
errors locate device blocks with errors in the log file</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">log_level</span> <span class="pre">=</span> <span class="pre">INFO</span></code></td>
<td>Logging level</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">log_max_line_length</span> <span class="pre">=</span> <span class="pre">0</span></code></td>
<td>Caps the length of log lines to the value given; no limit if set to 0,
the default.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">log_to_console</span> <span class="pre">=</span> <span class="pre">False</span></code></td>
<td>No help text available for this option.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">minutes</span> <span class="pre">=</span> <span class="pre">60</span></code></td>
<td>Number of minutes to look back in <code class="docutils literal"><span class="pre">/var/log/kern.log</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">recon_cache_path</span> <span class="pre">=</span> <span class="pre">/var/cache/swift</span></code></td>
<td>Directory where stats for a few items will be stored</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">regex_pattern_1</span> <span class="pre">=</span> <span class="pre">\berror\b.*\b(dm-[0-9]{1,2}\d?)\b</span></code></td>
<td>No help text available for this option.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">unmount_failed_device</span> <span class="pre">=</span> <span class="pre">True</span></code></td>
<td>No help text available for this option.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This script has only been tested on Ubuntu 10.04; use with caution on
other operating systems in production.</p>
</div>
</div>
</div>
<div class="section" id="emergency-recovery-of-ring-builder-files">
<h2>Emergency recovery of ring builder files<a class="headerlink" href="#emergency-recovery-of-ring-builder-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>Problem<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>An emergency might prevent a successful backup from restoring the
cluster to operational status.</p>
</div>
<div class="section" id="id6">
<h3>Solution<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>You should always keep a backup of swift ring builder files. However, if
an emergency occurs, this procedure may assist in returning your cluster
to an operational state.</p>
<p>Using existing swift tools, there is no way to recover a builder file
from a <code class="docutils literal"><span class="pre">ring.gz</span></code> file. However, if you have a knowledge of Python, it
is possible to construct a builder file that is pretty close to the one
you have lost.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This procedure is a last-resort for emergency circumstances. It
requires knowledge of the swift python code and may not succeed.</p>
</div>
<ol class="arabic">
<li><p class="first">Load the ring and a new ringbuilder object in a Python REPL:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">swift.common.ring</span> <span class="kn">import</span> <span class="n">RingData</span><span class="p">,</span> <span class="n">RingBuilder</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ring</span> <span class="o">=</span> <span class="n">RingData</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;/path/to/account.ring.gz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Start copying the data we have in the ring into the builder:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">math</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">partitions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="o">.</span><span class="n">_replica2part2dev_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">replicas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="o">.</span><span class="n">_replica2part2dev_id</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">builder</span> <span class="o">=</span> <span class="n">RingBuilder</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">partitions</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">replicas</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">builder</span><span class="o">.</span><span class="n">devs</span> <span class="o">=</span> <span class="n">ring</span><span class="o">.</span><span class="n">devs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">builder</span><span class="o">.</span><span class="n">_replica2part2dev</span> <span class="o">=</span> <span class="n">ring</span><span class="o">.</span><span class="n">_replica2part2dev_id</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">builder</span><span class="o">.</span><span class="n">_last_part_moves_epoch</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">builder</span><span class="o">.</span><span class="n">_last_part_moves</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">partitions</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">builder</span><span class="o">.</span><span class="n">_set_parts_wanted</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">builder</span><span class="o">.</span><span class="n">_iter_devs</span><span class="p">():</span>
<span class="go">            d[&#39;parts&#39;] = 0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">p2d</span> <span class="ow">in</span> <span class="n">builder</span><span class="o">.</span><span class="n">_replica2part2dev</span><span class="p">:</span>
<span class="go">            for dev_id in p2d:</span>
<span class="go">                builder.devs[dev_id][&#39;parts&#39;] += 1</span>

<span class="go">This is the extent of the recoverable fields.</span>
</pre></div>
</div>
</li>
<li><p class="first">For <code class="docutils literal"><span class="pre">min_part_hours</span></code> you either have to remember what the value you
used was, or just make up a new one:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">builder</span><span class="o">.</span><span class="n">change_min_part_hours</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="c1"># or whatever you want it to be</span>
</pre></div>
</div>
</li>
<li><p class="first">Validate the builder. If this raises an exception, check your
previous code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">builder</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">After it validates, save the builder and create a new <code class="docutils literal"><span class="pre">account.builder</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;account.builder&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">),</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">exit</span> <span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">You should now have a file called <code class="docutils literal"><span class="pre">account.builder</span></code> in the current
working directory. Run
<strong class="command">swift-ring-builder account.builder write_ring</strong> and compare the new
<code class="docutils literal"><span class="pre">account.ring.gz</span></code> to the <code class="docutils literal"><span class="pre">account.ring.gz</span></code> that you started
from. They probably are not byte-for-byte identical, but if you load them
in a REPL and their <code class="docutils literal"><span class="pre">_replica2part2dev_id</span></code> and <code class="docutils literal"><span class="pre">devs</span></code> attributes are
the same (or nearly so), then you are in good shape.</p>
</li>
<li><p class="first">Repeat the procedure for <code class="docutils literal"><span class="pre">container.ring.gz</span></code> and
<code class="docutils literal"><span class="pre">object.ring.gz</span></code>, and you might get usable builder files.</p>
</li>
</ol>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="objectstorage-admin.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: System administration for Object Storage"></i></a>
          
          
            <a href="blockstorage.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Block Storage"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2017-02-14 08:39</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="http://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://ask.openstack.org" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="search-icon show">
    <i class="fa fa-search"></i> Search
  </div>
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="http://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Contents</h4></a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/get-started-with-openstack.html">Get started with OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="identity-management.html">Identity management</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="compute.html">Compute</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="objectstorage.html">Object Storage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="objectstorage-intro.html">Introduction to Object Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-features.html">Features and benefits</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-characteristics.html">Object Storage characteristics</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-components.html">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-ringbuilder.html">Ring-builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-arch.html">Cluster architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-replication.html">Replication</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-large-objects.html">Large object support</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-auditors.html">Object Auditor</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-EC.html">Erasure coding</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-account-reaper.html">Account reaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-tenant-specific-image-storage.html">Configure project-specific image locations with Object Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-monitoring.html">Object Storage monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="objectstorage-admin.html">System administration for Object Storage</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Troubleshoot Object Storage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="blockstorage.html">Block Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="shared-file-systems.html">Shared File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="telemetry.html">Telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="baremetal.html">Bare Metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestration.html">Orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">OpenStack command-line clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross-project.html">Cross-project features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="firewalls-default-ports.html">Firewalls and default ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/app-support.html">Community support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common/glossary.html">Glossary</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="http://openstack.org/projects/">Projects</a></li>
          <li><a href="http://openstack.org/projects/openstack-security/">OpenStack Security</a></li>
          <li><a href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="http://openstack.org/blog/">Blog</a></li>
          <li><a href="http://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="http://openstack.org/community/">User Groups</a></li>
          <li><a href="http://openstack.org/community/events/">Events</a></li>
          <li><a href="http://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="http://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="http://docs.openstack.org/infra/manual/developers.html">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="http://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="http://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="http://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="http://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="http://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="http://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="http://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-1.12.4.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "objectstorage-troubleshoot" + ".rst";
        gitURL = "Source: https://git.openstack.org/cgit/openstack/openstack-manuals/tree/doc/admin-guide/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: 0719207c6d82d2c215b9c13234f3a27478e0c0f3";
        var bugProject = "openstack-manuals";
        var bugTitle = "Troubleshoot Object Storage in Administrator Guide";
    var fieldTags = "admin-guide";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.9 on 2017-02-14 08:39";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags);
</script>

<!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
(function() {
var cx = '000108871792296872333:noj9nikm74i';
var gcse = document.createElement('script');
gcse.type = 'text/javascript';
gcse.async = true;
gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
'//www.google.com/cse/cse.js?cx=' + cx;
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(gcse, s);
})();
</script>

  </body>
</html>